var Jm=t=>{throw TypeError(t)};var Xu=(t,e,n)=>e.has(t)||Jm("Cannot "+n);var O=(t,e,n)=>(Xu(t,e,"read from private field"),n?n.call(t):e.get(t)),fe=(t,e,n)=>e.has(t)?Jm("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),ee=(t,e,n,i)=>(Xu(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n),rt=(t,e,n)=>(Xu(t,e,"access private method"),n);var sl=(t,e,n,i)=>({set _(r){ee(t,e,r,n)},get _(){return O(t,e,i)}});function HC(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in t)){const s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();var Zt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function w0(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function KC(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var r=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,r.get?r:{enumerable:!0,get:function(){return t[i]}})}),n}var k0={exports:{}},ru={},S0={exports:{}},ue={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wa=Symbol.for("react.element"),GC=Symbol.for("react.portal"),JC=Symbol.for("react.fragment"),QC=Symbol.for("react.strict_mode"),YC=Symbol.for("react.profiler"),XC=Symbol.for("react.provider"),ZC=Symbol.for("react.context"),e_=Symbol.for("react.forward_ref"),t_=Symbol.for("react.suspense"),n_=Symbol.for("react.memo"),i_=Symbol.for("react.lazy"),Qm=Symbol.iterator;function r_(t){return t===null||typeof t!="object"?null:(t=Qm&&t[Qm]||t["@@iterator"],typeof t=="function"?t:null)}var T0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C0=Object.assign,_0={};function go(t,e,n){this.props=t,this.context=e,this.refs=_0,this.updater=n||T0}go.prototype.isReactComponent={};go.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};go.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function E0(){}E0.prototype=go.prototype;function ep(t,e,n){this.props=t,this.context=e,this.refs=_0,this.updater=n||T0}var tp=ep.prototype=new E0;tp.constructor=ep;C0(tp,go.prototype);tp.isPureReactComponent=!0;var Ym=Array.isArray,P0=Object.prototype.hasOwnProperty,np={current:null},x0={key:!0,ref:!0,__self:!0,__source:!0};function R0(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)P0.call(e,i)&&!x0.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];r.children=l}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:Wa,type:t,key:s,ref:o,props:r,_owner:np.current}}function s_(t,e){return{$$typeof:Wa,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function ip(t){return typeof t=="object"&&t!==null&&t.$$typeof===Wa}function o_(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Xm=/\/+/g;function Zu(t,e){return typeof t=="object"&&t!==null&&t.key!=null?o_(""+t.key):e.toString(36)}function Ml(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Wa:case GC:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+Zu(o,0):i,Ym(r)?(n="",t!=null&&(n=t.replace(Xm,"$&/")+"/"),Ml(r,e,n,"",function(c){return c})):r!=null&&(ip(r)&&(r=s_(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(Xm,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",Ym(t))for(var a=0;a<t.length;a++){s=t[a];var l=i+Zu(s,a);o+=Ml(s,e,n,l,r)}else if(l=r_(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=i+Zu(s,a++),o+=Ml(s,e,n,l,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function ol(t,e,n){if(t==null)return t;var i=[],r=0;return Ml(t,i,"","",function(s){return e.call(n,s,r++)}),i}function a_(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var gt={current:null},Nl={transition:null},l_={ReactCurrentDispatcher:gt,ReactCurrentBatchConfig:Nl,ReactCurrentOwner:np};function I0(){throw Error("act(...) is not supported in production builds of React.")}ue.Children={map:ol,forEach:function(t,e,n){ol(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ol(t,function(){e++}),e},toArray:function(t){return ol(t,function(e){return e})||[]},only:function(t){if(!ip(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ue.Component=go;ue.Fragment=JC;ue.Profiler=YC;ue.PureComponent=ep;ue.StrictMode=QC;ue.Suspense=t_;ue.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=l_;ue.act=I0;ue.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=C0({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=np.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)P0.call(e,l)&&!x0.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];i.children=a}return{$$typeof:Wa,type:t.type,key:r,ref:s,props:i,_owner:o}};ue.createContext=function(t){return t={$$typeof:ZC,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:XC,_context:t},t.Consumer=t};ue.createElement=R0;ue.createFactory=function(t){var e=R0.bind(null,t);return e.type=t,e};ue.createRef=function(){return{current:null}};ue.forwardRef=function(t){return{$$typeof:e_,render:t}};ue.isValidElement=ip;ue.lazy=function(t){return{$$typeof:i_,_payload:{_status:-1,_result:t},_init:a_}};ue.memo=function(t,e){return{$$typeof:n_,type:t,compare:e===void 0?null:e}};ue.startTransition=function(t){var e=Nl.transition;Nl.transition={};try{t()}finally{Nl.transition=e}};ue.unstable_act=I0;ue.useCallback=function(t,e){return gt.current.useCallback(t,e)};ue.useContext=function(t){return gt.current.useContext(t)};ue.useDebugValue=function(){};ue.useDeferredValue=function(t){return gt.current.useDeferredValue(t)};ue.useEffect=function(t,e){return gt.current.useEffect(t,e)};ue.useId=function(){return gt.current.useId()};ue.useImperativeHandle=function(t,e,n){return gt.current.useImperativeHandle(t,e,n)};ue.useInsertionEffect=function(t,e){return gt.current.useInsertionEffect(t,e)};ue.useLayoutEffect=function(t,e){return gt.current.useLayoutEffect(t,e)};ue.useMemo=function(t,e){return gt.current.useMemo(t,e)};ue.useReducer=function(t,e,n){return gt.current.useReducer(t,e,n)};ue.useRef=function(t){return gt.current.useRef(t)};ue.useState=function(t){return gt.current.useState(t)};ue.useSyncExternalStore=function(t,e,n){return gt.current.useSyncExternalStore(t,e,n)};ue.useTransition=function(){return gt.current.useTransition()};ue.version="18.3.1";S0.exports=ue;var C=S0.exports;const V=w0(C),O0=HC({__proto__:null,default:V},[C]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var c_=C,u_=Symbol.for("react.element"),d_=Symbol.for("react.fragment"),h_=Object.prototype.hasOwnProperty,f_=c_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p_={key:!0,ref:!0,__self:!0,__source:!0};function A0(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)h_.call(e,i)&&!p_.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:u_,type:t,key:s,ref:o,props:r,_owner:f_.current}}ru.Fragment=d_;ru.jsx=A0;ru.jsxs=A0;k0.exports=ru;var A=k0.exports,D0={exports:{}},$t={},M0={exports:{}},N0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(I,M){var W=I.length;I.push(M);e:for(;0<W;){var Y=W-1>>>1,G=I[Y];if(0<r(G,M))I[Y]=M,I[W]=G,W=Y;else break e}}function n(I){return I.length===0?null:I[0]}function i(I){if(I.length===0)return null;var M=I[0],W=I.pop();if(W!==M){I[0]=W;e:for(var Y=0,G=I.length,ne=G>>>1;Y<ne;){var se=2*(Y+1)-1,Re=I[se],Be=se+1,me=I[Be];if(0>r(Re,W))Be<G&&0>r(me,Re)?(I[Y]=me,I[Be]=W,Y=Be):(I[Y]=Re,I[se]=W,Y=se);else if(Be<G&&0>r(me,W))I[Y]=me,I[Be]=W,Y=Be;else break e}}return M}function r(I,M){var W=I.sortIndex-M.sortIndex;return W!==0?W:I.id-M.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,d=null,h=3,f=!1,v=!1,p=!1,y=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(I){for(var M=n(c);M!==null;){if(M.callback===null)i(c);else if(M.startTime<=I)i(c),M.sortIndex=M.expirationTime,e(l,M);else break;M=n(c)}}function w(I){if(p=!1,b(I),!v)if(n(l)!==null)v=!0,Q(k);else{var M=n(c);M!==null&&X(w,M.startTime-I)}}function k(I,M){v=!1,p&&(p=!1,m(E),E=-1),f=!0;var W=h;try{for(b(M),d=n(l);d!==null&&(!(d.expirationTime>M)||I&&!L());){var Y=d.callback;if(typeof Y=="function"){d.callback=null,h=d.priorityLevel;var G=Y(d.expirationTime<=M);M=t.unstable_now(),typeof G=="function"?d.callback=G:d===n(l)&&i(l),b(M)}else i(l);d=n(l)}if(d!==null)var ne=!0;else{var se=n(c);se!==null&&X(w,se.startTime-M),ne=!1}return ne}finally{d=null,h=W,f=!1}}var S=!1,_=null,E=-1,x=5,R=-1;function L(){return!(t.unstable_now()-R<x)}function j(){if(_!==null){var I=t.unstable_now();R=I;var M=!0;try{M=_(!0,I)}finally{M?K():(S=!1,_=null)}}else S=!1}var K;if(typeof g=="function")K=function(){g(j)};else if(typeof MessageChannel<"u"){var B=new MessageChannel,J=B.port2;B.port1.onmessage=j,K=function(){J.postMessage(null)}}else K=function(){y(j,0)};function Q(I){_=I,S||(S=!0,K())}function X(I,M){E=y(function(){I(t.unstable_now())},M)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(I){I.callback=null},t.unstable_continueExecution=function(){v||f||(v=!0,Q(k))},t.unstable_forceFrameRate=function(I){0>I||125<I?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):x=0<I?Math.floor(1e3/I):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(I){switch(h){case 1:case 2:case 3:var M=3;break;default:M=h}var W=h;h=M;try{return I()}finally{h=W}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(I,M){switch(I){case 1:case 2:case 3:case 4:case 5:break;default:I=3}var W=h;h=I;try{return M()}finally{h=W}},t.unstable_scheduleCallback=function(I,M,W){var Y=t.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?Y+W:Y):W=Y,I){case 1:var G=-1;break;case 2:G=250;break;case 5:G=1073741823;break;case 4:G=1e4;break;default:G=5e3}return G=W+G,I={id:u++,callback:M,priorityLevel:I,startTime:W,expirationTime:G,sortIndex:-1},W>Y?(I.sortIndex=W,e(c,I),n(l)===null&&I===n(c)&&(p?(m(E),E=-1):p=!0,X(w,W-Y))):(I.sortIndex=G,e(l,I),v||f||(v=!0,Q(k))),I},t.unstable_shouldYield=L,t.unstable_wrapCallback=function(I){var M=h;return function(){var W=h;h=M;try{return I.apply(this,arguments)}finally{h=W}}}})(N0);M0.exports=N0;var m_=M0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var g_=C,Bt=m_;function F(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var L0=new Set,ma={};function Zr(t,e){io(t,e),io(t+"Capture",e)}function io(t,e){for(ma[t]=e,t=0;t<e.length;t++)L0.add(e[t])}var hi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),rh=Object.prototype.hasOwnProperty,v_=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Zm={},eg={};function y_(t){return rh.call(eg,t)?!0:rh.call(Zm,t)?!1:v_.test(t)?eg[t]=!0:(Zm[t]=!0,!1)}function b_(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function w_(t,e,n,i){if(e===null||typeof e>"u"||b_(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function vt(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var it={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){it[t]=new vt(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];it[e]=new vt(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){it[t]=new vt(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){it[t]=new vt(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){it[t]=new vt(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){it[t]=new vt(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){it[t]=new vt(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){it[t]=new vt(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){it[t]=new vt(t,5,!1,t.toLowerCase(),null,!1,!1)});var rp=/[\-:]([a-z])/g;function sp(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(rp,sp);it[e]=new vt(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(rp,sp);it[e]=new vt(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(rp,sp);it[e]=new vt(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){it[t]=new vt(t,1,!1,t.toLowerCase(),null,!1,!1)});it.xlinkHref=new vt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){it[t]=new vt(t,1,!1,t.toLowerCase(),null,!0,!0)});function op(t,e,n,i){var r=it.hasOwnProperty(e)?it[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(w_(e,n,r,i)&&(n=null),i||r===null?y_(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var bi=g_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,al=Symbol.for("react.element"),ws=Symbol.for("react.portal"),ks=Symbol.for("react.fragment"),ap=Symbol.for("react.strict_mode"),sh=Symbol.for("react.profiler"),j0=Symbol.for("react.provider"),U0=Symbol.for("react.context"),lp=Symbol.for("react.forward_ref"),oh=Symbol.for("react.suspense"),ah=Symbol.for("react.suspense_list"),cp=Symbol.for("react.memo"),Li=Symbol.for("react.lazy"),F0=Symbol.for("react.offscreen"),tg=Symbol.iterator;function Eo(t){return t===null||typeof t!="object"?null:(t=tg&&t[tg]||t["@@iterator"],typeof t=="function"?t:null)}var Ae=Object.assign,ed;function qo(t){if(ed===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);ed=e&&e[1]||""}return`
`+ed+t}var td=!1;function nd(t,e){if(!t||td)return"";td=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){i=c}t.call(e.prototype)}else{try{throw Error()}catch(c){i=c}t()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var r=c.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var l=`
`+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{td=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?qo(t):""}function k_(t){switch(t.tag){case 5:return qo(t.type);case 16:return qo("Lazy");case 13:return qo("Suspense");case 19:return qo("SuspenseList");case 0:case 2:case 15:return t=nd(t.type,!1),t;case 11:return t=nd(t.type.render,!1),t;case 1:return t=nd(t.type,!0),t;default:return""}}function lh(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case ks:return"Fragment";case ws:return"Portal";case sh:return"Profiler";case ap:return"StrictMode";case oh:return"Suspense";case ah:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case U0:return(t.displayName||"Context")+".Consumer";case j0:return(t._context.displayName||"Context")+".Provider";case lp:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case cp:return e=t.displayName||null,e!==null?e:lh(t.type)||"Memo";case Li:e=t._payload,t=t._init;try{return lh(t(e))}catch{}}return null}function S_(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return lh(e);case 8:return e===ap?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function lr(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function B0(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function T_(t){var e=B0(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function ll(t){t._valueTracker||(t._valueTracker=T_(t))}function $0(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=B0(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function lc(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function ch(t,e){var n=e.checked;return Ae({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function ng(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=lr(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function V0(t,e){e=e.checked,e!=null&&op(t,"checked",e,!1)}function uh(t,e){V0(t,e);var n=lr(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?dh(t,e.type,n):e.hasOwnProperty("defaultValue")&&dh(t,e.type,lr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function ig(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function dh(t,e,n){(e!=="number"||lc(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Wo=Array.isArray;function Ms(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+lr(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function hh(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(F(91));return Ae({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function rg(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(F(92));if(Wo(n)){if(1<n.length)throw Error(F(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:lr(n)}}function z0(t,e){var n=lr(e.value),i=lr(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function sg(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function q0(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function fh(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?q0(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var cl,W0=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(cl=cl||document.createElement("div"),cl.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=cl.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function ga(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Yo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},C_=["Webkit","ms","Moz","O"];Object.keys(Yo).forEach(function(t){C_.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Yo[e]=Yo[t]})});function H0(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Yo.hasOwnProperty(t)&&Yo[t]?(""+e).trim():e+"px"}function K0(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=H0(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var __=Ae({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ph(t,e){if(e){if(__[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(F(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(F(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(F(61))}if(e.style!=null&&typeof e.style!="object")throw Error(F(62))}}function mh(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var gh=null;function up(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var vh=null,Ns=null,Ls=null;function og(t){if(t=Ga(t)){if(typeof vh!="function")throw Error(F(280));var e=t.stateNode;e&&(e=cu(e),vh(t.stateNode,t.type,e))}}function G0(t){Ns?Ls?Ls.push(t):Ls=[t]:Ns=t}function J0(){if(Ns){var t=Ns,e=Ls;if(Ls=Ns=null,og(t),e)for(t=0;t<e.length;t++)og(e[t])}}function Q0(t,e){return t(e)}function Y0(){}var id=!1;function X0(t,e,n){if(id)return t(e,n);id=!0;try{return Q0(t,e,n)}finally{id=!1,(Ns!==null||Ls!==null)&&(Y0(),J0())}}function va(t,e){var n=t.stateNode;if(n===null)return null;var i=cu(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(F(231,e,typeof n));return n}var yh=!1;if(hi)try{var Po={};Object.defineProperty(Po,"passive",{get:function(){yh=!0}}),window.addEventListener("test",Po,Po),window.removeEventListener("test",Po,Po)}catch{yh=!1}function E_(t,e,n,i,r,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var Xo=!1,cc=null,uc=!1,bh=null,P_={onError:function(t){Xo=!0,cc=t}};function x_(t,e,n,i,r,s,o,a,l){Xo=!1,cc=null,E_.apply(P_,arguments)}function R_(t,e,n,i,r,s,o,a,l){if(x_.apply(this,arguments),Xo){if(Xo){var c=cc;Xo=!1,cc=null}else throw Error(F(198));uc||(uc=!0,bh=c)}}function es(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Z0(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function ag(t){if(es(t)!==t)throw Error(F(188))}function I_(t){var e=t.alternate;if(!e){if(e=es(t),e===null)throw Error(F(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return ag(r),t;if(s===i)return ag(r),e;s=s.sibling}throw Error(F(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(F(189))}}if(n.alternate!==i)throw Error(F(190))}if(n.tag!==3)throw Error(F(188));return n.stateNode.current===n?t:e}function eb(t){return t=I_(t),t!==null?tb(t):null}function tb(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=tb(t);if(e!==null)return e;t=t.sibling}return null}var nb=Bt.unstable_scheduleCallback,lg=Bt.unstable_cancelCallback,O_=Bt.unstable_shouldYield,A_=Bt.unstable_requestPaint,Ue=Bt.unstable_now,D_=Bt.unstable_getCurrentPriorityLevel,dp=Bt.unstable_ImmediatePriority,ib=Bt.unstable_UserBlockingPriority,dc=Bt.unstable_NormalPriority,M_=Bt.unstable_LowPriority,rb=Bt.unstable_IdlePriority,su=null,Fn=null;function N_(t){if(Fn&&typeof Fn.onCommitFiberRoot=="function")try{Fn.onCommitFiberRoot(su,t,void 0,(t.current.flags&128)===128)}catch{}}var wn=Math.clz32?Math.clz32:U_,L_=Math.log,j_=Math.LN2;function U_(t){return t>>>=0,t===0?32:31-(L_(t)/j_|0)|0}var ul=64,dl=4194304;function Ho(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function hc(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=Ho(a):(s&=o,s!==0&&(i=Ho(s)))}else o=n&~r,o!==0?i=Ho(o):s!==0&&(i=Ho(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-wn(e),r=1<<n,i|=t[n],e&=~r;return i}function F_(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function B_(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-wn(s),a=1<<o,l=r[o];l===-1?(!(a&n)||a&i)&&(r[o]=F_(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function wh(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function sb(){var t=ul;return ul<<=1,!(ul&4194240)&&(ul=64),t}function rd(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Ha(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-wn(e),t[e]=n}function $_(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-wn(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function hp(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-wn(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var ge=0;function ob(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var ab,fp,lb,cb,ub,kh=!1,hl=[],Yi=null,Xi=null,Zi=null,ya=new Map,ba=new Map,Ui=[],V_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function cg(t,e){switch(t){case"focusin":case"focusout":Yi=null;break;case"dragenter":case"dragleave":Xi=null;break;case"mouseover":case"mouseout":Zi=null;break;case"pointerover":case"pointerout":ya.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ba.delete(e.pointerId)}}function xo(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=Ga(e),e!==null&&fp(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function z_(t,e,n,i,r){switch(e){case"focusin":return Yi=xo(Yi,t,e,n,i,r),!0;case"dragenter":return Xi=xo(Xi,t,e,n,i,r),!0;case"mouseover":return Zi=xo(Zi,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return ya.set(s,xo(ya.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,ba.set(s,xo(ba.get(s)||null,t,e,n,i,r)),!0}return!1}function db(t){var e=Ar(t.target);if(e!==null){var n=es(e);if(n!==null){if(e=n.tag,e===13){if(e=Z0(n),e!==null){t.blockedOn=e,ub(t.priority,function(){lb(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Ll(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Sh(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);gh=i,n.target.dispatchEvent(i),gh=null}else return e=Ga(n),e!==null&&fp(e),t.blockedOn=n,!1;e.shift()}return!0}function ug(t,e,n){Ll(t)&&n.delete(e)}function q_(){kh=!1,Yi!==null&&Ll(Yi)&&(Yi=null),Xi!==null&&Ll(Xi)&&(Xi=null),Zi!==null&&Ll(Zi)&&(Zi=null),ya.forEach(ug),ba.forEach(ug)}function Ro(t,e){t.blockedOn===e&&(t.blockedOn=null,kh||(kh=!0,Bt.unstable_scheduleCallback(Bt.unstable_NormalPriority,q_)))}function wa(t){function e(r){return Ro(r,t)}if(0<hl.length){Ro(hl[0],t);for(var n=1;n<hl.length;n++){var i=hl[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Yi!==null&&Ro(Yi,t),Xi!==null&&Ro(Xi,t),Zi!==null&&Ro(Zi,t),ya.forEach(e),ba.forEach(e),n=0;n<Ui.length;n++)i=Ui[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Ui.length&&(n=Ui[0],n.blockedOn===null);)db(n),n.blockedOn===null&&Ui.shift()}var js=bi.ReactCurrentBatchConfig,fc=!0;function W_(t,e,n,i){var r=ge,s=js.transition;js.transition=null;try{ge=1,pp(t,e,n,i)}finally{ge=r,js.transition=s}}function H_(t,e,n,i){var r=ge,s=js.transition;js.transition=null;try{ge=4,pp(t,e,n,i)}finally{ge=r,js.transition=s}}function pp(t,e,n,i){if(fc){var r=Sh(t,e,n,i);if(r===null)pd(t,e,i,pc,n),cg(t,i);else if(z_(r,t,e,n,i))i.stopPropagation();else if(cg(t,i),e&4&&-1<V_.indexOf(t)){for(;r!==null;){var s=Ga(r);if(s!==null&&ab(s),s=Sh(t,e,n,i),s===null&&pd(t,e,i,pc,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else pd(t,e,i,null,n)}}var pc=null;function Sh(t,e,n,i){if(pc=null,t=up(i),t=Ar(t),t!==null)if(e=es(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Z0(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return pc=t,null}function hb(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(D_()){case dp:return 1;case ib:return 4;case dc:case M_:return 16;case rb:return 536870912;default:return 16}default:return 16}}var Ki=null,mp=null,jl=null;function fb(){if(jl)return jl;var t,e=mp,n=e.length,i,r="value"in Ki?Ki.value:Ki.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return jl=r.slice(t,1<i?1-i:void 0)}function Ul(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function fl(){return!0}function dg(){return!1}function Vt(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?fl:dg,this.isPropagationStopped=dg,this}return Ae(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=fl)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=fl)},persist:function(){},isPersistent:fl}),e}var vo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},gp=Vt(vo),Ka=Ae({},vo,{view:0,detail:0}),K_=Vt(Ka),sd,od,Io,ou=Ae({},Ka,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:vp,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Io&&(Io&&t.type==="mousemove"?(sd=t.screenX-Io.screenX,od=t.screenY-Io.screenY):od=sd=0,Io=t),sd)},movementY:function(t){return"movementY"in t?t.movementY:od}}),hg=Vt(ou),G_=Ae({},ou,{dataTransfer:0}),J_=Vt(G_),Q_=Ae({},Ka,{relatedTarget:0}),ad=Vt(Q_),Y_=Ae({},vo,{animationName:0,elapsedTime:0,pseudoElement:0}),X_=Vt(Y_),Z_=Ae({},vo,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),eE=Vt(Z_),tE=Ae({},vo,{data:0}),fg=Vt(tE),nE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},iE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function sE(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=rE[t])?!!e[t]:!1}function vp(){return sE}var oE=Ae({},Ka,{key:function(t){if(t.key){var e=nE[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Ul(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?iE[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:vp,charCode:function(t){return t.type==="keypress"?Ul(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Ul(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),aE=Vt(oE),lE=Ae({},ou,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),pg=Vt(lE),cE=Ae({},Ka,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:vp}),uE=Vt(cE),dE=Ae({},vo,{propertyName:0,elapsedTime:0,pseudoElement:0}),hE=Vt(dE),fE=Ae({},ou,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),pE=Vt(fE),mE=[9,13,27,32],yp=hi&&"CompositionEvent"in window,Zo=null;hi&&"documentMode"in document&&(Zo=document.documentMode);var gE=hi&&"TextEvent"in window&&!Zo,pb=hi&&(!yp||Zo&&8<Zo&&11>=Zo),mg=" ",gg=!1;function mb(t,e){switch(t){case"keyup":return mE.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function gb(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Ss=!1;function vE(t,e){switch(t){case"compositionend":return gb(e);case"keypress":return e.which!==32?null:(gg=!0,mg);case"textInput":return t=e.data,t===mg&&gg?null:t;default:return null}}function yE(t,e){if(Ss)return t==="compositionend"||!yp&&mb(t,e)?(t=fb(),jl=mp=Ki=null,Ss=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return pb&&e.locale!=="ko"?null:e.data;default:return null}}var bE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function vg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!bE[t.type]:e==="textarea"}function vb(t,e,n,i){G0(i),e=mc(e,"onChange"),0<e.length&&(n=new gp("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var ea=null,ka=null;function wE(t){xb(t,0)}function au(t){var e=_s(t);if($0(e))return t}function kE(t,e){if(t==="change")return e}var yb=!1;if(hi){var ld;if(hi){var cd="oninput"in document;if(!cd){var yg=document.createElement("div");yg.setAttribute("oninput","return;"),cd=typeof yg.oninput=="function"}ld=cd}else ld=!1;yb=ld&&(!document.documentMode||9<document.documentMode)}function bg(){ea&&(ea.detachEvent("onpropertychange",bb),ka=ea=null)}function bb(t){if(t.propertyName==="value"&&au(ka)){var e=[];vb(e,ka,t,up(t)),X0(wE,e)}}function SE(t,e,n){t==="focusin"?(bg(),ea=e,ka=n,ea.attachEvent("onpropertychange",bb)):t==="focusout"&&bg()}function TE(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return au(ka)}function CE(t,e){if(t==="click")return au(e)}function _E(t,e){if(t==="input"||t==="change")return au(e)}function EE(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Sn=typeof Object.is=="function"?Object.is:EE;function Sa(t,e){if(Sn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!rh.call(e,r)||!Sn(t[r],e[r]))return!1}return!0}function wg(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function kg(t,e){var n=wg(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=wg(n)}}function wb(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?wb(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function kb(){for(var t=window,e=lc();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=lc(t.document)}return e}function bp(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function PE(t){var e=kb(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&wb(n.ownerDocument.documentElement,n)){if(i!==null&&bp(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=kg(n,s);var o=kg(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var xE=hi&&"documentMode"in document&&11>=document.documentMode,Ts=null,Th=null,ta=null,Ch=!1;function Sg(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Ch||Ts==null||Ts!==lc(i)||(i=Ts,"selectionStart"in i&&bp(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),ta&&Sa(ta,i)||(ta=i,i=mc(Th,"onSelect"),0<i.length&&(e=new gp("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Ts)))}function pl(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Cs={animationend:pl("Animation","AnimationEnd"),animationiteration:pl("Animation","AnimationIteration"),animationstart:pl("Animation","AnimationStart"),transitionend:pl("Transition","TransitionEnd")},ud={},Sb={};hi&&(Sb=document.createElement("div").style,"AnimationEvent"in window||(delete Cs.animationend.animation,delete Cs.animationiteration.animation,delete Cs.animationstart.animation),"TransitionEvent"in window||delete Cs.transitionend.transition);function lu(t){if(ud[t])return ud[t];if(!Cs[t])return t;var e=Cs[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Sb)return ud[t]=e[n];return t}var Tb=lu("animationend"),Cb=lu("animationiteration"),_b=lu("animationstart"),Eb=lu("transitionend"),Pb=new Map,Tg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function mr(t,e){Pb.set(t,e),Zr(e,[t])}for(var dd=0;dd<Tg.length;dd++){var hd=Tg[dd],RE=hd.toLowerCase(),IE=hd[0].toUpperCase()+hd.slice(1);mr(RE,"on"+IE)}mr(Tb,"onAnimationEnd");mr(Cb,"onAnimationIteration");mr(_b,"onAnimationStart");mr("dblclick","onDoubleClick");mr("focusin","onFocus");mr("focusout","onBlur");mr(Eb,"onTransitionEnd");io("onMouseEnter",["mouseout","mouseover"]);io("onMouseLeave",["mouseout","mouseover"]);io("onPointerEnter",["pointerout","pointerover"]);io("onPointerLeave",["pointerout","pointerover"]);Zr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Zr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Zr("onBeforeInput",["compositionend","keypress","textInput","paste"]);Zr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Zr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Zr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ko="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),OE=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ko));function Cg(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,R_(i,e,void 0,t),t.currentTarget=null}function xb(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;Cg(r,a,c),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;Cg(r,a,c),s=l}}}if(uc)throw t=bh,uc=!1,bh=null,t}function Te(t,e){var n=e[Rh];n===void 0&&(n=e[Rh]=new Set);var i=t+"__bubble";n.has(i)||(Rb(e,t,2,!1),n.add(i))}function fd(t,e,n){var i=0;e&&(i|=4),Rb(n,t,i,e)}var ml="_reactListening"+Math.random().toString(36).slice(2);function Ta(t){if(!t[ml]){t[ml]=!0,L0.forEach(function(n){n!=="selectionchange"&&(OE.has(n)||fd(n,!1,t),fd(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[ml]||(e[ml]=!0,fd("selectionchange",!1,e))}}function Rb(t,e,n,i){switch(hb(e)){case 1:var r=W_;break;case 4:r=H_;break;default:r=pp}n=r.bind(null,e,n,t),r=void 0,!yh||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function pd(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=Ar(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}X0(function(){var c=s,u=up(n),d=[];e:{var h=Pb.get(t);if(h!==void 0){var f=gp,v=t;switch(t){case"keypress":if(Ul(n)===0)break e;case"keydown":case"keyup":f=aE;break;case"focusin":v="focus",f=ad;break;case"focusout":v="blur",f=ad;break;case"beforeblur":case"afterblur":f=ad;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=hg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=J_;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=uE;break;case Tb:case Cb:case _b:f=X_;break;case Eb:f=hE;break;case"scroll":f=K_;break;case"wheel":f=pE;break;case"copy":case"cut":case"paste":f=eE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=pg}var p=(e&4)!==0,y=!p&&t==="scroll",m=p?h!==null?h+"Capture":null:h;p=[];for(var g=c,b;g!==null;){b=g;var w=b.stateNode;if(b.tag===5&&w!==null&&(b=w,m!==null&&(w=va(g,m),w!=null&&p.push(Ca(g,w,b)))),y)break;g=g.return}0<p.length&&(h=new f(h,v,null,n,u),d.push({event:h,listeners:p}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",h&&n!==gh&&(v=n.relatedTarget||n.fromElement)&&(Ar(v)||v[fi]))break e;if((f||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,f?(v=n.relatedTarget||n.toElement,f=c,v=v?Ar(v):null,v!==null&&(y=es(v),v!==y||v.tag!==5&&v.tag!==6)&&(v=null)):(f=null,v=c),f!==v)){if(p=hg,w="onMouseLeave",m="onMouseEnter",g="mouse",(t==="pointerout"||t==="pointerover")&&(p=pg,w="onPointerLeave",m="onPointerEnter",g="pointer"),y=f==null?h:_s(f),b=v==null?h:_s(v),h=new p(w,g+"leave",f,n,u),h.target=y,h.relatedTarget=b,w=null,Ar(u)===c&&(p=new p(m,g+"enter",v,n,u),p.target=b,p.relatedTarget=y,w=p),y=w,f&&v)t:{for(p=f,m=v,g=0,b=p;b;b=cs(b))g++;for(b=0,w=m;w;w=cs(w))b++;for(;0<g-b;)p=cs(p),g--;for(;0<b-g;)m=cs(m),b--;for(;g--;){if(p===m||m!==null&&p===m.alternate)break t;p=cs(p),m=cs(m)}p=null}else p=null;f!==null&&_g(d,h,f,p,!1),v!==null&&y!==null&&_g(d,y,v,p,!0)}}e:{if(h=c?_s(c):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var k=kE;else if(vg(h))if(yb)k=_E;else{k=TE;var S=SE}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(k=CE);if(k&&(k=k(t,c))){vb(d,k,n,u);break e}S&&S(t,h,c),t==="focusout"&&(S=h._wrapperState)&&S.controlled&&h.type==="number"&&dh(h,"number",h.value)}switch(S=c?_s(c):window,t){case"focusin":(vg(S)||S.contentEditable==="true")&&(Ts=S,Th=c,ta=null);break;case"focusout":ta=Th=Ts=null;break;case"mousedown":Ch=!0;break;case"contextmenu":case"mouseup":case"dragend":Ch=!1,Sg(d,n,u);break;case"selectionchange":if(xE)break;case"keydown":case"keyup":Sg(d,n,u)}var _;if(yp)e:{switch(t){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else Ss?mb(t,n)&&(E="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(E="onCompositionStart");E&&(pb&&n.locale!=="ko"&&(Ss||E!=="onCompositionStart"?E==="onCompositionEnd"&&Ss&&(_=fb()):(Ki=u,mp="value"in Ki?Ki.value:Ki.textContent,Ss=!0)),S=mc(c,E),0<S.length&&(E=new fg(E,t,null,n,u),d.push({event:E,listeners:S}),_?E.data=_:(_=gb(n),_!==null&&(E.data=_)))),(_=gE?vE(t,n):yE(t,n))&&(c=mc(c,"onBeforeInput"),0<c.length&&(u=new fg("onBeforeInput","beforeinput",null,n,u),d.push({event:u,listeners:c}),u.data=_))}xb(d,e)})}function Ca(t,e,n){return{instance:t,listener:e,currentTarget:n}}function mc(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=va(t,n),s!=null&&i.unshift(Ca(t,s,r)),s=va(t,e),s!=null&&i.push(Ca(t,s,r))),t=t.return}return i}function cs(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function _g(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&c!==null&&(a=c,r?(l=va(n,s),l!=null&&o.unshift(Ca(n,l,a))):r||(l=va(n,s),l!=null&&o.push(Ca(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var AE=/\r\n?/g,DE=/\u0000|\uFFFD/g;function Eg(t){return(typeof t=="string"?t:""+t).replace(AE,`
`).replace(DE,"")}function gl(t,e,n){if(e=Eg(e),Eg(t)!==e&&n)throw Error(F(425))}function gc(){}var _h=null,Eh=null;function Ph(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var xh=typeof setTimeout=="function"?setTimeout:void 0,ME=typeof clearTimeout=="function"?clearTimeout:void 0,Pg=typeof Promise=="function"?Promise:void 0,NE=typeof queueMicrotask=="function"?queueMicrotask:typeof Pg<"u"?function(t){return Pg.resolve(null).then(t).catch(LE)}:xh;function LE(t){setTimeout(function(){throw t})}function md(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),wa(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);wa(e)}function er(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function xg(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var yo=Math.random().toString(36).slice(2),Ln="__reactFiber$"+yo,_a="__reactProps$"+yo,fi="__reactContainer$"+yo,Rh="__reactEvents$"+yo,jE="__reactListeners$"+yo,UE="__reactHandles$"+yo;function Ar(t){var e=t[Ln];if(e)return e;for(var n=t.parentNode;n;){if(e=n[fi]||n[Ln]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=xg(t);t!==null;){if(n=t[Ln])return n;t=xg(t)}return e}t=n,n=t.parentNode}return null}function Ga(t){return t=t[Ln]||t[fi],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function _s(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(F(33))}function cu(t){return t[_a]||null}var Ih=[],Es=-1;function gr(t){return{current:t}}function _e(t){0>Es||(t.current=Ih[Es],Ih[Es]=null,Es--)}function ke(t,e){Es++,Ih[Es]=t.current,t.current=e}var cr={},ct=gr(cr),Et=gr(!1),zr=cr;function ro(t,e){var n=t.type.contextTypes;if(!n)return cr;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function Pt(t){return t=t.childContextTypes,t!=null}function vc(){_e(Et),_e(ct)}function Rg(t,e,n){if(ct.current!==cr)throw Error(F(168));ke(ct,e),ke(Et,n)}function Ib(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(F(108,S_(t)||"Unknown",r));return Ae({},n,i)}function yc(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||cr,zr=ct.current,ke(ct,t),ke(Et,Et.current),!0}function Ig(t,e,n){var i=t.stateNode;if(!i)throw Error(F(169));n?(t=Ib(t,e,zr),i.__reactInternalMemoizedMergedChildContext=t,_e(Et),_e(ct),ke(ct,t)):_e(Et),ke(Et,n)}var ei=null,uu=!1,gd=!1;function Ob(t){ei===null?ei=[t]:ei.push(t)}function FE(t){uu=!0,Ob(t)}function vr(){if(!gd&&ei!==null){gd=!0;var t=0,e=ge;try{var n=ei;for(ge=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}ei=null,uu=!1}catch(r){throw ei!==null&&(ei=ei.slice(t+1)),nb(dp,vr),r}finally{ge=e,gd=!1}}return null}var Ps=[],xs=0,bc=null,wc=0,Gt=[],Jt=0,qr=null,li=1,ci="";function Pr(t,e){Ps[xs++]=wc,Ps[xs++]=bc,bc=t,wc=e}function Ab(t,e,n){Gt[Jt++]=li,Gt[Jt++]=ci,Gt[Jt++]=qr,qr=t;var i=li;t=ci;var r=32-wn(i)-1;i&=~(1<<r),n+=1;var s=32-wn(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,li=1<<32-wn(e)+r|n<<r|i,ci=s+t}else li=1<<s|n<<r|i,ci=t}function wp(t){t.return!==null&&(Pr(t,1),Ab(t,1,0))}function kp(t){for(;t===bc;)bc=Ps[--xs],Ps[xs]=null,wc=Ps[--xs],Ps[xs]=null;for(;t===qr;)qr=Gt[--Jt],Gt[Jt]=null,ci=Gt[--Jt],Gt[Jt]=null,li=Gt[--Jt],Gt[Jt]=null}var jt=null,Nt=null,Pe=!1,gn=null;function Db(t,e){var n=Qt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Og(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,jt=t,Nt=er(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,jt=t,Nt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=qr!==null?{id:li,overflow:ci}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Qt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,jt=t,Nt=null,!0):!1;default:return!1}}function Oh(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Ah(t){if(Pe){var e=Nt;if(e){var n=e;if(!Og(t,e)){if(Oh(t))throw Error(F(418));e=er(n.nextSibling);var i=jt;e&&Og(t,e)?Db(i,n):(t.flags=t.flags&-4097|2,Pe=!1,jt=t)}}else{if(Oh(t))throw Error(F(418));t.flags=t.flags&-4097|2,Pe=!1,jt=t}}}function Ag(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;jt=t}function vl(t){if(t!==jt)return!1;if(!Pe)return Ag(t),Pe=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Ph(t.type,t.memoizedProps)),e&&(e=Nt)){if(Oh(t))throw Mb(),Error(F(418));for(;e;)Db(t,e),e=er(e.nextSibling)}if(Ag(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(F(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Nt=er(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Nt=null}}else Nt=jt?er(t.stateNode.nextSibling):null;return!0}function Mb(){for(var t=Nt;t;)t=er(t.nextSibling)}function so(){Nt=jt=null,Pe=!1}function Sp(t){gn===null?gn=[t]:gn.push(t)}var BE=bi.ReactCurrentBatchConfig;function Oo(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(F(309));var i=n.stateNode}if(!i)throw Error(F(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(F(284));if(!n._owner)throw Error(F(290,t))}return t}function yl(t,e){throw t=Object.prototype.toString.call(e),Error(F(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Dg(t){var e=t._init;return e(t._payload)}function Nb(t){function e(m,g){if(t){var b=m.deletions;b===null?(m.deletions=[g],m.flags|=16):b.push(g)}}function n(m,g){if(!t)return null;for(;g!==null;)e(m,g),g=g.sibling;return null}function i(m,g){for(m=new Map;g!==null;)g.key!==null?m.set(g.key,g):m.set(g.index,g),g=g.sibling;return m}function r(m,g){return m=rr(m,g),m.index=0,m.sibling=null,m}function s(m,g,b){return m.index=b,t?(b=m.alternate,b!==null?(b=b.index,b<g?(m.flags|=2,g):b):(m.flags|=2,g)):(m.flags|=1048576,g)}function o(m){return t&&m.alternate===null&&(m.flags|=2),m}function a(m,g,b,w){return g===null||g.tag!==6?(g=Td(b,m.mode,w),g.return=m,g):(g=r(g,b),g.return=m,g)}function l(m,g,b,w){var k=b.type;return k===ks?u(m,g,b.props.children,w,b.key):g!==null&&(g.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Li&&Dg(k)===g.type)?(w=r(g,b.props),w.ref=Oo(m,g,b),w.return=m,w):(w=Wl(b.type,b.key,b.props,null,m.mode,w),w.ref=Oo(m,g,b),w.return=m,w)}function c(m,g,b,w){return g===null||g.tag!==4||g.stateNode.containerInfo!==b.containerInfo||g.stateNode.implementation!==b.implementation?(g=Cd(b,m.mode,w),g.return=m,g):(g=r(g,b.children||[]),g.return=m,g)}function u(m,g,b,w,k){return g===null||g.tag!==7?(g=Vr(b,m.mode,w,k),g.return=m,g):(g=r(g,b),g.return=m,g)}function d(m,g,b){if(typeof g=="string"&&g!==""||typeof g=="number")return g=Td(""+g,m.mode,b),g.return=m,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case al:return b=Wl(g.type,g.key,g.props,null,m.mode,b),b.ref=Oo(m,null,g),b.return=m,b;case ws:return g=Cd(g,m.mode,b),g.return=m,g;case Li:var w=g._init;return d(m,w(g._payload),b)}if(Wo(g)||Eo(g))return g=Vr(g,m.mode,b,null),g.return=m,g;yl(m,g)}return null}function h(m,g,b,w){var k=g!==null?g.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return k!==null?null:a(m,g,""+b,w);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case al:return b.key===k?l(m,g,b,w):null;case ws:return b.key===k?c(m,g,b,w):null;case Li:return k=b._init,h(m,g,k(b._payload),w)}if(Wo(b)||Eo(b))return k!==null?null:u(m,g,b,w,null);yl(m,b)}return null}function f(m,g,b,w,k){if(typeof w=="string"&&w!==""||typeof w=="number")return m=m.get(b)||null,a(g,m,""+w,k);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case al:return m=m.get(w.key===null?b:w.key)||null,l(g,m,w,k);case ws:return m=m.get(w.key===null?b:w.key)||null,c(g,m,w,k);case Li:var S=w._init;return f(m,g,b,S(w._payload),k)}if(Wo(w)||Eo(w))return m=m.get(b)||null,u(g,m,w,k,null);yl(g,w)}return null}function v(m,g,b,w){for(var k=null,S=null,_=g,E=g=0,x=null;_!==null&&E<b.length;E++){_.index>E?(x=_,_=null):x=_.sibling;var R=h(m,_,b[E],w);if(R===null){_===null&&(_=x);break}t&&_&&R.alternate===null&&e(m,_),g=s(R,g,E),S===null?k=R:S.sibling=R,S=R,_=x}if(E===b.length)return n(m,_),Pe&&Pr(m,E),k;if(_===null){for(;E<b.length;E++)_=d(m,b[E],w),_!==null&&(g=s(_,g,E),S===null?k=_:S.sibling=_,S=_);return Pe&&Pr(m,E),k}for(_=i(m,_);E<b.length;E++)x=f(_,m,E,b[E],w),x!==null&&(t&&x.alternate!==null&&_.delete(x.key===null?E:x.key),g=s(x,g,E),S===null?k=x:S.sibling=x,S=x);return t&&_.forEach(function(L){return e(m,L)}),Pe&&Pr(m,E),k}function p(m,g,b,w){var k=Eo(b);if(typeof k!="function")throw Error(F(150));if(b=k.call(b),b==null)throw Error(F(151));for(var S=k=null,_=g,E=g=0,x=null,R=b.next();_!==null&&!R.done;E++,R=b.next()){_.index>E?(x=_,_=null):x=_.sibling;var L=h(m,_,R.value,w);if(L===null){_===null&&(_=x);break}t&&_&&L.alternate===null&&e(m,_),g=s(L,g,E),S===null?k=L:S.sibling=L,S=L,_=x}if(R.done)return n(m,_),Pe&&Pr(m,E),k;if(_===null){for(;!R.done;E++,R=b.next())R=d(m,R.value,w),R!==null&&(g=s(R,g,E),S===null?k=R:S.sibling=R,S=R);return Pe&&Pr(m,E),k}for(_=i(m,_);!R.done;E++,R=b.next())R=f(_,m,E,R.value,w),R!==null&&(t&&R.alternate!==null&&_.delete(R.key===null?E:R.key),g=s(R,g,E),S===null?k=R:S.sibling=R,S=R);return t&&_.forEach(function(j){return e(m,j)}),Pe&&Pr(m,E),k}function y(m,g,b,w){if(typeof b=="object"&&b!==null&&b.type===ks&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case al:e:{for(var k=b.key,S=g;S!==null;){if(S.key===k){if(k=b.type,k===ks){if(S.tag===7){n(m,S.sibling),g=r(S,b.props.children),g.return=m,m=g;break e}}else if(S.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Li&&Dg(k)===S.type){n(m,S.sibling),g=r(S,b.props),g.ref=Oo(m,S,b),g.return=m,m=g;break e}n(m,S);break}else e(m,S);S=S.sibling}b.type===ks?(g=Vr(b.props.children,m.mode,w,b.key),g.return=m,m=g):(w=Wl(b.type,b.key,b.props,null,m.mode,w),w.ref=Oo(m,g,b),w.return=m,m=w)}return o(m);case ws:e:{for(S=b.key;g!==null;){if(g.key===S)if(g.tag===4&&g.stateNode.containerInfo===b.containerInfo&&g.stateNode.implementation===b.implementation){n(m,g.sibling),g=r(g,b.children||[]),g.return=m,m=g;break e}else{n(m,g);break}else e(m,g);g=g.sibling}g=Cd(b,m.mode,w),g.return=m,m=g}return o(m);case Li:return S=b._init,y(m,g,S(b._payload),w)}if(Wo(b))return v(m,g,b,w);if(Eo(b))return p(m,g,b,w);yl(m,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,g!==null&&g.tag===6?(n(m,g.sibling),g=r(g,b),g.return=m,m=g):(n(m,g),g=Td(b,m.mode,w),g.return=m,m=g),o(m)):n(m,g)}return y}var oo=Nb(!0),Lb=Nb(!1),kc=gr(null),Sc=null,Rs=null,Tp=null;function Cp(){Tp=Rs=Sc=null}function _p(t){var e=kc.current;_e(kc),t._currentValue=e}function Dh(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function Us(t,e){Sc=t,Tp=Rs=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Ct=!0),t.firstContext=null)}function en(t){var e=t._currentValue;if(Tp!==t)if(t={context:t,memoizedValue:e,next:null},Rs===null){if(Sc===null)throw Error(F(308));Rs=t,Sc.dependencies={lanes:0,firstContext:t}}else Rs=Rs.next=t;return e}var Dr=null;function Ep(t){Dr===null?Dr=[t]:Dr.push(t)}function jb(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,Ep(e)):(n.next=r.next,r.next=n),e.interleaved=n,pi(t,i)}function pi(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var ji=!1;function Pp(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ub(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function di(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function tr(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,he&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,pi(t,n)}return r=i.interleaved,r===null?(e.next=e,Ep(i)):(e.next=r.next,r.next=e),i.interleaved=e,pi(t,n)}function Fl(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,hp(t,n)}}function Mg(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Tc(t,e,n,i){var r=t.updateQueue;ji=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var d=r.baseState;o=0,u=c=l=null,a=s;do{var h=a.lane,f=a.eventTime;if((i&h)===h){u!==null&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var v=t,p=a;switch(h=e,f=n,p.tag){case 1:if(v=p.payload,typeof v=="function"){d=v.call(f,d,h);break e}d=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=p.payload,h=typeof v=="function"?v.call(f,d,h):v,h==null)break e;d=Ae({},d,h);break e;case 2:ji=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=r.effects,h===null?r.effects=[a]:h.push(a))}else f={eventTime:f,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=f,l=d):u=u.next=f,o|=h;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;h=a,a=h.next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}while(!0);if(u===null&&(l=d),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);Hr|=o,t.lanes=o,t.memoizedState=d}}function Ng(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(F(191,r));r.call(i)}}}var Ja={},Bn=gr(Ja),Ea=gr(Ja),Pa=gr(Ja);function Mr(t){if(t===Ja)throw Error(F(174));return t}function xp(t,e){switch(ke(Pa,e),ke(Ea,t),ke(Bn,Ja),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:fh(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=fh(e,t)}_e(Bn),ke(Bn,e)}function ao(){_e(Bn),_e(Ea),_e(Pa)}function Fb(t){Mr(Pa.current);var e=Mr(Bn.current),n=fh(e,t.type);e!==n&&(ke(Ea,t),ke(Bn,n))}function Rp(t){Ea.current===t&&(_e(Bn),_e(Ea))}var Ie=gr(0);function Cc(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var vd=[];function Ip(){for(var t=0;t<vd.length;t++)vd[t]._workInProgressVersionPrimary=null;vd.length=0}var Bl=bi.ReactCurrentDispatcher,yd=bi.ReactCurrentBatchConfig,Wr=0,Oe=null,He=null,Qe=null,_c=!1,na=!1,xa=0,$E=0;function st(){throw Error(F(321))}function Op(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Sn(t[n],e[n]))return!1;return!0}function Ap(t,e,n,i,r,s){if(Wr=s,Oe=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Bl.current=t===null||t.memoizedState===null?WE:HE,t=n(i,r),na){s=0;do{if(na=!1,xa=0,25<=s)throw Error(F(301));s+=1,Qe=He=null,e.updateQueue=null,Bl.current=KE,t=n(i,r)}while(na)}if(Bl.current=Ec,e=He!==null&&He.next!==null,Wr=0,Qe=He=Oe=null,_c=!1,e)throw Error(F(300));return t}function Dp(){var t=xa!==0;return xa=0,t}function In(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qe===null?Oe.memoizedState=Qe=t:Qe=Qe.next=t,Qe}function tn(){if(He===null){var t=Oe.alternate;t=t!==null?t.memoizedState:null}else t=He.next;var e=Qe===null?Oe.memoizedState:Qe.next;if(e!==null)Qe=e,He=t;else{if(t===null)throw Error(F(310));He=t,t={memoizedState:He.memoizedState,baseState:He.baseState,baseQueue:He.baseQueue,queue:He.queue,next:null},Qe===null?Oe.memoizedState=Qe=t:Qe=Qe.next=t}return Qe}function Ra(t,e){return typeof e=="function"?e(t):e}function bd(t){var e=tn(),n=e.queue;if(n===null)throw Error(F(311));n.lastRenderedReducer=t;var i=He,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((Wr&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:t(i,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,o=i):l=l.next=d,Oe.lanes|=u,Hr|=u}c=c.next}while(c!==null&&c!==s);l===null?o=i:l.next=a,Sn(i,e.memoizedState)||(Ct=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,Oe.lanes|=s,Hr|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function wd(t){var e=tn(),n=e.queue;if(n===null)throw Error(F(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);Sn(s,e.memoizedState)||(Ct=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function Bb(){}function $b(t,e){var n=Oe,i=tn(),r=e(),s=!Sn(i.memoizedState,r);if(s&&(i.memoizedState=r,Ct=!0),i=i.queue,Mp(qb.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||Qe!==null&&Qe.memoizedState.tag&1){if(n.flags|=2048,Ia(9,zb.bind(null,n,i,r,e),void 0,null),Ze===null)throw Error(F(349));Wr&30||Vb(n,e,r)}return r}function Vb(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Oe.updateQueue,e===null?(e={lastEffect:null,stores:null},Oe.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function zb(t,e,n,i){e.value=n,e.getSnapshot=i,Wb(e)&&Hb(t)}function qb(t,e,n){return n(function(){Wb(e)&&Hb(t)})}function Wb(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Sn(t,n)}catch{return!0}}function Hb(t){var e=pi(t,1);e!==null&&kn(e,t,1,-1)}function Lg(t){var e=In();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ra,lastRenderedState:t},e.queue=t,t=t.dispatch=qE.bind(null,Oe,t),[e.memoizedState,t]}function Ia(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=Oe.updateQueue,e===null?(e={lastEffect:null,stores:null},Oe.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function Kb(){return tn().memoizedState}function $l(t,e,n,i){var r=In();Oe.flags|=t,r.memoizedState=Ia(1|e,n,void 0,i===void 0?null:i)}function du(t,e,n,i){var r=tn();i=i===void 0?null:i;var s=void 0;if(He!==null){var o=He.memoizedState;if(s=o.destroy,i!==null&&Op(i,o.deps)){r.memoizedState=Ia(e,n,s,i);return}}Oe.flags|=t,r.memoizedState=Ia(1|e,n,s,i)}function jg(t,e){return $l(8390656,8,t,e)}function Mp(t,e){return du(2048,8,t,e)}function Gb(t,e){return du(4,2,t,e)}function Jb(t,e){return du(4,4,t,e)}function Qb(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Yb(t,e,n){return n=n!=null?n.concat([t]):null,du(4,4,Qb.bind(null,e,t),n)}function Np(){}function Xb(t,e){var n=tn();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Op(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Zb(t,e){var n=tn();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Op(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function ew(t,e,n){return Wr&21?(Sn(n,e)||(n=sb(),Oe.lanes|=n,Hr|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Ct=!0),t.memoizedState=n)}function VE(t,e){var n=ge;ge=n!==0&&4>n?n:4,t(!0);var i=yd.transition;yd.transition={};try{t(!1),e()}finally{ge=n,yd.transition=i}}function tw(){return tn().memoizedState}function zE(t,e,n){var i=ir(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},nw(t))iw(e,n);else if(n=jb(t,e,n,i),n!==null){var r=mt();kn(n,t,i,r),rw(n,e,i)}}function qE(t,e,n){var i=ir(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(nw(t))iw(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,Sn(a,o)){var l=e.interleaved;l===null?(r.next=r,Ep(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}n=jb(t,e,r,i),n!==null&&(r=mt(),kn(n,t,i,r),rw(n,e,i))}}function nw(t){var e=t.alternate;return t===Oe||e!==null&&e===Oe}function iw(t,e){na=_c=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function rw(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,hp(t,n)}}var Ec={readContext:en,useCallback:st,useContext:st,useEffect:st,useImperativeHandle:st,useInsertionEffect:st,useLayoutEffect:st,useMemo:st,useReducer:st,useRef:st,useState:st,useDebugValue:st,useDeferredValue:st,useTransition:st,useMutableSource:st,useSyncExternalStore:st,useId:st,unstable_isNewReconciler:!1},WE={readContext:en,useCallback:function(t,e){return In().memoizedState=[t,e===void 0?null:e],t},useContext:en,useEffect:jg,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,$l(4194308,4,Qb.bind(null,e,t),n)},useLayoutEffect:function(t,e){return $l(4194308,4,t,e)},useInsertionEffect:function(t,e){return $l(4,2,t,e)},useMemo:function(t,e){var n=In();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=In();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=zE.bind(null,Oe,t),[i.memoizedState,t]},useRef:function(t){var e=In();return t={current:t},e.memoizedState=t},useState:Lg,useDebugValue:Np,useDeferredValue:function(t){return In().memoizedState=t},useTransition:function(){var t=Lg(!1),e=t[0];return t=VE.bind(null,t[1]),In().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=Oe,r=In();if(Pe){if(n===void 0)throw Error(F(407));n=n()}else{if(n=e(),Ze===null)throw Error(F(349));Wr&30||Vb(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,jg(qb.bind(null,i,s,t),[t]),i.flags|=2048,Ia(9,zb.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=In(),e=Ze.identifierPrefix;if(Pe){var n=ci,i=li;n=(i&~(1<<32-wn(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=xa++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=$E++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},HE={readContext:en,useCallback:Xb,useContext:en,useEffect:Mp,useImperativeHandle:Yb,useInsertionEffect:Gb,useLayoutEffect:Jb,useMemo:Zb,useReducer:bd,useRef:Kb,useState:function(){return bd(Ra)},useDebugValue:Np,useDeferredValue:function(t){var e=tn();return ew(e,He.memoizedState,t)},useTransition:function(){var t=bd(Ra)[0],e=tn().memoizedState;return[t,e]},useMutableSource:Bb,useSyncExternalStore:$b,useId:tw,unstable_isNewReconciler:!1},KE={readContext:en,useCallback:Xb,useContext:en,useEffect:Mp,useImperativeHandle:Yb,useInsertionEffect:Gb,useLayoutEffect:Jb,useMemo:Zb,useReducer:wd,useRef:Kb,useState:function(){return wd(Ra)},useDebugValue:Np,useDeferredValue:function(t){var e=tn();return He===null?e.memoizedState=t:ew(e,He.memoizedState,t)},useTransition:function(){var t=wd(Ra)[0],e=tn().memoizedState;return[t,e]},useMutableSource:Bb,useSyncExternalStore:$b,useId:tw,unstable_isNewReconciler:!1};function cn(t,e){if(t&&t.defaultProps){e=Ae({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Mh(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:Ae({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var hu={isMounted:function(t){return(t=t._reactInternals)?es(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=mt(),r=ir(t),s=di(i,r);s.payload=e,n!=null&&(s.callback=n),e=tr(t,s,r),e!==null&&(kn(e,t,r,i),Fl(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=mt(),r=ir(t),s=di(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=tr(t,s,r),e!==null&&(kn(e,t,r,i),Fl(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=mt(),i=ir(t),r=di(n,i);r.tag=2,e!=null&&(r.callback=e),e=tr(t,r,i),e!==null&&(kn(e,t,i,n),Fl(e,t,i))}};function Ug(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!Sa(n,i)||!Sa(r,s):!0}function sw(t,e,n){var i=!1,r=cr,s=e.contextType;return typeof s=="object"&&s!==null?s=en(s):(r=Pt(e)?zr:ct.current,i=e.contextTypes,s=(i=i!=null)?ro(t,r):cr),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=hu,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function Fg(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&hu.enqueueReplaceState(e,e.state,null)}function Nh(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},Pp(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=en(s):(s=Pt(e)?zr:ct.current,r.context=ro(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Mh(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&hu.enqueueReplaceState(r,r.state,null),Tc(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function lo(t,e){try{var n="",i=e;do n+=k_(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function kd(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Lh(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var GE=typeof WeakMap=="function"?WeakMap:Map;function ow(t,e,n){n=di(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){xc||(xc=!0,Hh=i),Lh(t,e)},n}function aw(t,e,n){n=di(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){Lh(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){Lh(t,e),typeof i!="function"&&(nr===null?nr=new Set([this]):nr.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Bg(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new GE;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=lP.bind(null,t,e,n),e.then(t,t))}function $g(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Vg(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=di(-1,1),e.tag=2,tr(n,e,1))),n.lanes|=1),t)}var JE=bi.ReactCurrentOwner,Ct=!1;function dt(t,e,n,i){e.child=t===null?Lb(e,null,n,i):oo(e,t.child,n,i)}function zg(t,e,n,i,r){n=n.render;var s=e.ref;return Us(e,r),i=Ap(t,e,n,i,s,r),n=Dp(),t!==null&&!Ct?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,mi(t,e,r)):(Pe&&n&&wp(e),e.flags|=1,dt(t,e,i,r),e.child)}function qg(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!zp(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,lw(t,e,s,i,r)):(t=Wl(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&r)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Sa,n(o,i)&&t.ref===e.ref)return mi(t,e,r)}return e.flags|=1,t=rr(s,i),t.ref=e.ref,t.return=e,e.child=t}function lw(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(Sa(s,i)&&t.ref===e.ref)if(Ct=!1,e.pendingProps=i=s,(t.lanes&r)!==0)t.flags&131072&&(Ct=!0);else return e.lanes=t.lanes,mi(t,e,r)}return jh(t,e,n,i,r)}function cw(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ke(Os,Dt),Dt|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ke(Os,Dt),Dt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,ke(Os,Dt),Dt|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,ke(Os,Dt),Dt|=i;return dt(t,e,r,n),e.child}function uw(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function jh(t,e,n,i,r){var s=Pt(n)?zr:ct.current;return s=ro(e,s),Us(e,r),n=Ap(t,e,n,i,s,r),i=Dp(),t!==null&&!Ct?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,mi(t,e,r)):(Pe&&i&&wp(e),e.flags|=1,dt(t,e,n,r),e.child)}function Wg(t,e,n,i,r){if(Pt(n)){var s=!0;yc(e)}else s=!1;if(Us(e,r),e.stateNode===null)Vl(t,e),sw(e,n,i),Nh(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=en(c):(c=Pt(n)?zr:ct.current,c=ro(e,c));var u=n.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==c)&&Fg(e,o,i,c),ji=!1;var h=e.memoizedState;o.state=h,Tc(e,i,o,r),l=e.memoizedState,a!==i||h!==l||Et.current||ji?(typeof u=="function"&&(Mh(e,n,u,i),l=e.memoizedState),(a=ji||Ug(e,n,a,i,h,l,c))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,Ub(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:cn(e.type,a),o.props=c,d=e.pendingProps,h=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=en(l):(l=Pt(n)?zr:ct.current,l=ro(e,l));var f=n.getDerivedStateFromProps;(u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||h!==l)&&Fg(e,o,i,l),ji=!1,h=e.memoizedState,o.state=h,Tc(e,i,o,r);var v=e.memoizedState;a!==d||h!==v||Et.current||ji?(typeof f=="function"&&(Mh(e,n,f,i),v=e.memoizedState),(c=ji||Ug(e,n,c,i,h,v,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,v,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,v,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=v),o.props=i,o.state=v,o.context=l,i=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),i=!1)}return Uh(t,e,n,i,s,r)}function Uh(t,e,n,i,r,s){uw(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&Ig(e,n,!1),mi(t,e,s);i=e.stateNode,JE.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=oo(e,t.child,null,s),e.child=oo(e,null,a,s)):dt(t,e,a,s),e.memoizedState=i.state,r&&Ig(e,n,!0),e.child}function dw(t){var e=t.stateNode;e.pendingContext?Rg(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Rg(t,e.context,!1),xp(t,e.containerInfo)}function Hg(t,e,n,i,r){return so(),Sp(r),e.flags|=256,dt(t,e,n,i),e.child}var Fh={dehydrated:null,treeContext:null,retryLane:0};function Bh(t){return{baseLanes:t,cachePool:null,transitions:null}}function hw(t,e,n){var i=e.pendingProps,r=Ie.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),ke(Ie,r&1),t===null)return Ah(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=mu(o,i,0,null),t=Vr(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Bh(n),e.memoizedState=Fh,t):Lp(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return QE(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=rr(r,l),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=rr(a,s):(s=Vr(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?Bh(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=Fh,i}return s=t.child,t=s.sibling,i=rr(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function Lp(t,e){return e=mu({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function bl(t,e,n,i){return i!==null&&Sp(i),oo(e,t.child,null,n),t=Lp(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function QE(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=kd(Error(F(422))),bl(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=mu({mode:"visible",children:i.children},r,0,null),s=Vr(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&oo(e,t.child,null,o),e.child.memoizedState=Bh(o),e.memoizedState=Fh,s);if(!(e.mode&1))return bl(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(F(419)),i=kd(s,i,void 0),bl(t,e,o,i)}if(a=(o&t.childLanes)!==0,Ct||a){if(i=Ze,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,pi(t,r),kn(i,t,r,-1))}return Vp(),i=kd(Error(F(421))),bl(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=cP.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,Nt=er(r.nextSibling),jt=e,Pe=!0,gn=null,t!==null&&(Gt[Jt++]=li,Gt[Jt++]=ci,Gt[Jt++]=qr,li=t.id,ci=t.overflow,qr=e),e=Lp(e,i.children),e.flags|=4096,e)}function Kg(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),Dh(t.return,e,n)}function Sd(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function fw(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(dt(t,e,i.children,n),i=Ie.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Kg(t,n,e);else if(t.tag===19)Kg(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(ke(Ie,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&Cc(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),Sd(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&Cc(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}Sd(e,!0,n,null,s);break;case"together":Sd(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Vl(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function mi(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Hr|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(F(153));if(e.child!==null){for(t=e.child,n=rr(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=rr(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function YE(t,e,n){switch(e.tag){case 3:dw(e),so();break;case 5:Fb(e);break;case 1:Pt(e.type)&&yc(e);break;case 4:xp(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;ke(kc,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(ke(Ie,Ie.current&1),e.flags|=128,null):n&e.child.childLanes?hw(t,e,n):(ke(Ie,Ie.current&1),t=mi(t,e,n),t!==null?t.sibling:null);ke(Ie,Ie.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return fw(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),ke(Ie,Ie.current),i)break;return null;case 22:case 23:return e.lanes=0,cw(t,e,n)}return mi(t,e,n)}var pw,$h,mw,gw;pw=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};$h=function(){};mw=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,Mr(Bn.current);var s=null;switch(n){case"input":r=ch(t,r),i=ch(t,i),s=[];break;case"select":r=Ae({},r,{value:void 0}),i=Ae({},i,{value:void 0}),s=[];break;case"textarea":r=hh(t,r),i=hh(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=gc)}ph(n,i);var o;n=null;for(c in r)if(!i.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var a=r[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(ma.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(a=r!=null?r[c]:void 0,i.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(ma.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Te("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}n&&(s=s||[]).push("style",n);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};gw=function(t,e,n,i){n!==i&&(e.flags|=4)};function Ao(t,e){if(!Pe)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function ot(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function XE(t,e,n){var i=e.pendingProps;switch(kp(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ot(e),null;case 1:return Pt(e.type)&&vc(),ot(e),null;case 3:return i=e.stateNode,ao(),_e(Et),_e(ct),Ip(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(vl(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,gn!==null&&(Jh(gn),gn=null))),$h(t,e),ot(e),null;case 5:Rp(e);var r=Mr(Pa.current);if(n=e.type,t!==null&&e.stateNode!=null)mw(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(F(166));return ot(e),null}if(t=Mr(Bn.current),vl(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[Ln]=e,i[_a]=s,t=(e.mode&1)!==0,n){case"dialog":Te("cancel",i),Te("close",i);break;case"iframe":case"object":case"embed":Te("load",i);break;case"video":case"audio":for(r=0;r<Ko.length;r++)Te(Ko[r],i);break;case"source":Te("error",i);break;case"img":case"image":case"link":Te("error",i),Te("load",i);break;case"details":Te("toggle",i);break;case"input":ng(i,s),Te("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},Te("invalid",i);break;case"textarea":rg(i,s),Te("invalid",i)}ph(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&gl(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&gl(i.textContent,a,t),r=["children",""+a]):ma.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Te("scroll",i)}switch(n){case"input":ll(i),ig(i,s,!0);break;case"textarea":ll(i),sg(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=gc)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=q0(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[Ln]=e,t[_a]=i,pw(t,e,!1,!1),e.stateNode=t;e:{switch(o=mh(n,i),n){case"dialog":Te("cancel",t),Te("close",t),r=i;break;case"iframe":case"object":case"embed":Te("load",t),r=i;break;case"video":case"audio":for(r=0;r<Ko.length;r++)Te(Ko[r],t);r=i;break;case"source":Te("error",t),r=i;break;case"img":case"image":case"link":Te("error",t),Te("load",t),r=i;break;case"details":Te("toggle",t),r=i;break;case"input":ng(t,i),r=ch(t,i),Te("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=Ae({},i,{value:void 0}),Te("invalid",t);break;case"textarea":rg(t,i),r=hh(t,i),Te("invalid",t);break;default:r=i}ph(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?K0(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&W0(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&ga(t,l):typeof l=="number"&&ga(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(ma.hasOwnProperty(s)?l!=null&&s==="onScroll"&&Te("scroll",t):l!=null&&op(t,s,l,o))}switch(n){case"input":ll(t),ig(t,i,!1);break;case"textarea":ll(t),sg(t);break;case"option":i.value!=null&&t.setAttribute("value",""+lr(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?Ms(t,!!i.multiple,s,!1):i.defaultValue!=null&&Ms(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=gc)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ot(e),null;case 6:if(t&&e.stateNode!=null)gw(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(F(166));if(n=Mr(Pa.current),Mr(Bn.current),vl(e)){if(i=e.stateNode,n=e.memoizedProps,i[Ln]=e,(s=i.nodeValue!==n)&&(t=jt,t!==null))switch(t.tag){case 3:gl(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&gl(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[Ln]=e,e.stateNode=i}return ot(e),null;case 13:if(_e(Ie),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Pe&&Nt!==null&&e.mode&1&&!(e.flags&128))Mb(),so(),e.flags|=98560,s=!1;else if(s=vl(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(F(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(F(317));s[Ln]=e}else so(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ot(e),s=!1}else gn!==null&&(Jh(gn),gn=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||Ie.current&1?Je===0&&(Je=3):Vp())),e.updateQueue!==null&&(e.flags|=4),ot(e),null);case 4:return ao(),$h(t,e),t===null&&Ta(e.stateNode.containerInfo),ot(e),null;case 10:return _p(e.type._context),ot(e),null;case 17:return Pt(e.type)&&vc(),ot(e),null;case 19:if(_e(Ie),s=e.memoizedState,s===null)return ot(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)Ao(s,!1);else{if(Je!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Cc(t),o!==null){for(e.flags|=128,Ao(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ke(Ie,Ie.current&1|2),e.child}t=t.sibling}s.tail!==null&&Ue()>co&&(e.flags|=128,i=!0,Ao(s,!1),e.lanes=4194304)}else{if(!i)if(t=Cc(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Ao(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Pe)return ot(e),null}else 2*Ue()-s.renderingStartTime>co&&n!==1073741824&&(e.flags|=128,i=!0,Ao(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Ue(),e.sibling=null,n=Ie.current,ke(Ie,i?n&1|2:n&1),e):(ot(e),null);case 22:case 23:return $p(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Dt&1073741824&&(ot(e),e.subtreeFlags&6&&(e.flags|=8192)):ot(e),null;case 24:return null;case 25:return null}throw Error(F(156,e.tag))}function ZE(t,e){switch(kp(e),e.tag){case 1:return Pt(e.type)&&vc(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return ao(),_e(Et),_e(ct),Ip(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Rp(e),null;case 13:if(_e(Ie),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(F(340));so()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return _e(Ie),null;case 4:return ao(),null;case 10:return _p(e.type._context),null;case 22:case 23:return $p(),null;case 24:return null;default:return null}}var wl=!1,lt=!1,eP=typeof WeakSet=="function"?WeakSet:Set,H=null;function Is(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){Ne(t,e,i)}else n.current=null}function Vh(t,e,n){try{n()}catch(i){Ne(t,e,i)}}var Gg=!1;function tP(t,e){if(_h=fc,t=kb(),bp(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,d=t,h=null;t:for(;;){for(var f;d!==n||r!==0&&d.nodeType!==3||(a=o+r),d!==s||i!==0&&d.nodeType!==3||(l=o+i),d.nodeType===3&&(o+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===t)break t;if(h===n&&++c===r&&(a=o),h===s&&++u===i&&(l=o),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Eh={focusedElem:t,selectionRange:n},fc=!1,H=e;H!==null;)if(e=H,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,H=t;else for(;H!==null;){e=H;try{var v=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(v!==null){var p=v.memoizedProps,y=v.memoizedState,m=e.stateNode,g=m.getSnapshotBeforeUpdate(e.elementType===e.type?p:cn(e.type,p),y);m.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(F(163))}}catch(w){Ne(e,e.return,w)}if(t=e.sibling,t!==null){t.return=e.return,H=t;break}H=e.return}return v=Gg,Gg=!1,v}function ia(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&Vh(e,n,s)}r=r.next}while(r!==i)}}function fu(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function zh(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function vw(t){var e=t.alternate;e!==null&&(t.alternate=null,vw(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Ln],delete e[_a],delete e[Rh],delete e[jE],delete e[UE])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function yw(t){return t.tag===5||t.tag===3||t.tag===4}function Jg(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||yw(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function qh(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=gc));else if(i!==4&&(t=t.child,t!==null))for(qh(t,e,n),t=t.sibling;t!==null;)qh(t,e,n),t=t.sibling}function Wh(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(Wh(t,e,n),t=t.sibling;t!==null;)Wh(t,e,n),t=t.sibling}var et=null,fn=!1;function Pi(t,e,n){for(n=n.child;n!==null;)bw(t,e,n),n=n.sibling}function bw(t,e,n){if(Fn&&typeof Fn.onCommitFiberUnmount=="function")try{Fn.onCommitFiberUnmount(su,n)}catch{}switch(n.tag){case 5:lt||Is(n,e);case 6:var i=et,r=fn;et=null,Pi(t,e,n),et=i,fn=r,et!==null&&(fn?(t=et,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):et.removeChild(n.stateNode));break;case 18:et!==null&&(fn?(t=et,n=n.stateNode,t.nodeType===8?md(t.parentNode,n):t.nodeType===1&&md(t,n),wa(t)):md(et,n.stateNode));break;case 4:i=et,r=fn,et=n.stateNode.containerInfo,fn=!0,Pi(t,e,n),et=i,fn=r;break;case 0:case 11:case 14:case 15:if(!lt&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Vh(n,e,o),r=r.next}while(r!==i)}Pi(t,e,n);break;case 1:if(!lt&&(Is(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){Ne(n,e,a)}Pi(t,e,n);break;case 21:Pi(t,e,n);break;case 22:n.mode&1?(lt=(i=lt)||n.memoizedState!==null,Pi(t,e,n),lt=i):Pi(t,e,n);break;default:Pi(t,e,n)}}function Qg(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new eP),e.forEach(function(i){var r=uP.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function on(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:et=a.stateNode,fn=!1;break e;case 3:et=a.stateNode.containerInfo,fn=!0;break e;case 4:et=a.stateNode.containerInfo,fn=!0;break e}a=a.return}if(et===null)throw Error(F(160));bw(s,o,r),et=null,fn=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(c){Ne(r,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)ww(e,t),e=e.sibling}function ww(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(on(e,t),Pn(t),i&4){try{ia(3,t,t.return),fu(3,t)}catch(p){Ne(t,t.return,p)}try{ia(5,t,t.return)}catch(p){Ne(t,t.return,p)}}break;case 1:on(e,t),Pn(t),i&512&&n!==null&&Is(n,n.return);break;case 5:if(on(e,t),Pn(t),i&512&&n!==null&&Is(n,n.return),t.flags&32){var r=t.stateNode;try{ga(r,"")}catch(p){Ne(t,t.return,p)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&V0(r,s),mh(a,o);var c=mh(a,s);for(o=0;o<l.length;o+=2){var u=l[o],d=l[o+1];u==="style"?K0(r,d):u==="dangerouslySetInnerHTML"?W0(r,d):u==="children"?ga(r,d):op(r,u,d,c)}switch(a){case"input":uh(r,s);break;case"textarea":z0(r,s);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var f=s.value;f!=null?Ms(r,!!s.multiple,f,!1):h!==!!s.multiple&&(s.defaultValue!=null?Ms(r,!!s.multiple,s.defaultValue,!0):Ms(r,!!s.multiple,s.multiple?[]:"",!1))}r[_a]=s}catch(p){Ne(t,t.return,p)}}break;case 6:if(on(e,t),Pn(t),i&4){if(t.stateNode===null)throw Error(F(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(p){Ne(t,t.return,p)}}break;case 3:if(on(e,t),Pn(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{wa(e.containerInfo)}catch(p){Ne(t,t.return,p)}break;case 4:on(e,t),Pn(t);break;case 13:on(e,t),Pn(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(Fp=Ue())),i&4&&Qg(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(lt=(c=lt)||u,on(e,t),lt=c):on(e,t),Pn(t),i&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(H=t,u=t.child;u!==null;){for(d=H=u;H!==null;){switch(h=H,f=h.child,h.tag){case 0:case 11:case 14:case 15:ia(4,h,h.return);break;case 1:Is(h,h.return);var v=h.stateNode;if(typeof v.componentWillUnmount=="function"){i=h,n=h.return;try{e=i,v.props=e.memoizedProps,v.state=e.memoizedState,v.componentWillUnmount()}catch(p){Ne(i,n,p)}}break;case 5:Is(h,h.return);break;case 22:if(h.memoizedState!==null){Xg(d);continue}}f!==null?(f.return=h,H=f):Xg(d)}u=u.sibling}e:for(u=null,d=t;;){if(d.tag===5){if(u===null){u=d;try{r=d.stateNode,c?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=H0("display",o))}catch(p){Ne(t,t.return,p)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(p){Ne(t,t.return,p)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:on(e,t),Pn(t),i&4&&Qg(t);break;case 21:break;default:on(e,t),Pn(t)}}function Pn(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(yw(n)){var i=n;break e}n=n.return}throw Error(F(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(ga(r,""),i.flags&=-33);var s=Jg(t);Wh(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=Jg(t);qh(t,a,o);break;default:throw Error(F(161))}}catch(l){Ne(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function nP(t,e,n){H=t,kw(t)}function kw(t,e,n){for(var i=(t.mode&1)!==0;H!==null;){var r=H,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||wl;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||lt;a=wl;var c=lt;if(wl=o,(lt=l)&&!c)for(H=r;H!==null;)o=H,l=o.child,o.tag===22&&o.memoizedState!==null?Zg(r):l!==null?(l.return=o,H=l):Zg(r);for(;s!==null;)H=s,kw(s),s=s.sibling;H=r,wl=a,lt=c}Yg(t)}else r.subtreeFlags&8772&&s!==null?(s.return=r,H=s):Yg(t)}}function Yg(t){for(;H!==null;){var e=H;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:lt||fu(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!lt)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:cn(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Ng(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Ng(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&wa(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(F(163))}lt||e.flags&512&&zh(e)}catch(h){Ne(e,e.return,h)}}if(e===t){H=null;break}if(n=e.sibling,n!==null){n.return=e.return,H=n;break}H=e.return}}function Xg(t){for(;H!==null;){var e=H;if(e===t){H=null;break}var n=e.sibling;if(n!==null){n.return=e.return,H=n;break}H=e.return}}function Zg(t){for(;H!==null;){var e=H;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{fu(4,e)}catch(l){Ne(e,n,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){Ne(e,r,l)}}var s=e.return;try{zh(e)}catch(l){Ne(e,s,l)}break;case 5:var o=e.return;try{zh(e)}catch(l){Ne(e,o,l)}}}catch(l){Ne(e,e.return,l)}if(e===t){H=null;break}var a=e.sibling;if(a!==null){a.return=e.return,H=a;break}H=e.return}}var iP=Math.ceil,Pc=bi.ReactCurrentDispatcher,jp=bi.ReactCurrentOwner,Xt=bi.ReactCurrentBatchConfig,he=0,Ze=null,ze=null,nt=0,Dt=0,Os=gr(0),Je=0,Oa=null,Hr=0,pu=0,Up=0,ra=null,kt=null,Fp=0,co=1/0,Xn=null,xc=!1,Hh=null,nr=null,kl=!1,Gi=null,Rc=0,sa=0,Kh=null,zl=-1,ql=0;function mt(){return he&6?Ue():zl!==-1?zl:zl=Ue()}function ir(t){return t.mode&1?he&2&&nt!==0?nt&-nt:BE.transition!==null?(ql===0&&(ql=sb()),ql):(t=ge,t!==0||(t=window.event,t=t===void 0?16:hb(t.type)),t):1}function kn(t,e,n,i){if(50<sa)throw sa=0,Kh=null,Error(F(185));Ha(t,n,i),(!(he&2)||t!==Ze)&&(t===Ze&&(!(he&2)&&(pu|=n),Je===4&&Fi(t,nt)),xt(t,i),n===1&&he===0&&!(e.mode&1)&&(co=Ue()+500,uu&&vr()))}function xt(t,e){var n=t.callbackNode;B_(t,e);var i=hc(t,t===Ze?nt:0);if(i===0)n!==null&&lg(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&lg(n),e===1)t.tag===0?FE(ev.bind(null,t)):Ob(ev.bind(null,t)),NE(function(){!(he&6)&&vr()}),n=null;else{switch(ob(i)){case 1:n=dp;break;case 4:n=ib;break;case 16:n=dc;break;case 536870912:n=rb;break;default:n=dc}n=Rw(n,Sw.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Sw(t,e){if(zl=-1,ql=0,he&6)throw Error(F(327));var n=t.callbackNode;if(Fs()&&t.callbackNode!==n)return null;var i=hc(t,t===Ze?nt:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=Ic(t,i);else{e=i;var r=he;he|=2;var s=Cw();(Ze!==t||nt!==e)&&(Xn=null,co=Ue()+500,$r(t,e));do try{oP();break}catch(a){Tw(t,a)}while(!0);Cp(),Pc.current=s,he=r,ze!==null?e=0:(Ze=null,nt=0,e=Je)}if(e!==0){if(e===2&&(r=wh(t),r!==0&&(i=r,e=Gh(t,r))),e===1)throw n=Oa,$r(t,0),Fi(t,i),xt(t,Ue()),n;if(e===6)Fi(t,i);else{if(r=t.current.alternate,!(i&30)&&!rP(r)&&(e=Ic(t,i),e===2&&(s=wh(t),s!==0&&(i=s,e=Gh(t,s))),e===1))throw n=Oa,$r(t,0),Fi(t,i),xt(t,Ue()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(F(345));case 2:xr(t,kt,Xn);break;case 3:if(Fi(t,i),(i&130023424)===i&&(e=Fp+500-Ue(),10<e)){if(hc(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){mt(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=xh(xr.bind(null,t,kt,Xn),e);break}xr(t,kt,Xn);break;case 4:if(Fi(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-wn(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=Ue()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*iP(i/1960))-i,10<i){t.timeoutHandle=xh(xr.bind(null,t,kt,Xn),i);break}xr(t,kt,Xn);break;case 5:xr(t,kt,Xn);break;default:throw Error(F(329))}}}return xt(t,Ue()),t.callbackNode===n?Sw.bind(null,t):null}function Gh(t,e){var n=ra;return t.current.memoizedState.isDehydrated&&($r(t,e).flags|=256),t=Ic(t,e),t!==2&&(e=kt,kt=n,e!==null&&Jh(e)),t}function Jh(t){kt===null?kt=t:kt.push.apply(kt,t)}function rP(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!Sn(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Fi(t,e){for(e&=~Up,e&=~pu,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-wn(e),i=1<<n;t[n]=-1,e&=~i}}function ev(t){if(he&6)throw Error(F(327));Fs();var e=hc(t,0);if(!(e&1))return xt(t,Ue()),null;var n=Ic(t,e);if(t.tag!==0&&n===2){var i=wh(t);i!==0&&(e=i,n=Gh(t,i))}if(n===1)throw n=Oa,$r(t,0),Fi(t,e),xt(t,Ue()),n;if(n===6)throw Error(F(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,xr(t,kt,Xn),xt(t,Ue()),null}function Bp(t,e){var n=he;he|=1;try{return t(e)}finally{he=n,he===0&&(co=Ue()+500,uu&&vr())}}function Kr(t){Gi!==null&&Gi.tag===0&&!(he&6)&&Fs();var e=he;he|=1;var n=Xt.transition,i=ge;try{if(Xt.transition=null,ge=1,t)return t()}finally{ge=i,Xt.transition=n,he=e,!(he&6)&&vr()}}function $p(){Dt=Os.current,_e(Os)}function $r(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,ME(n)),ze!==null)for(n=ze.return;n!==null;){var i=n;switch(kp(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&vc();break;case 3:ao(),_e(Et),_e(ct),Ip();break;case 5:Rp(i);break;case 4:ao();break;case 13:_e(Ie);break;case 19:_e(Ie);break;case 10:_p(i.type._context);break;case 22:case 23:$p()}n=n.return}if(Ze=t,ze=t=rr(t.current,null),nt=Dt=e,Je=0,Oa=null,Up=pu=Hr=0,kt=ra=null,Dr!==null){for(e=0;e<Dr.length;e++)if(n=Dr[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}Dr=null}return t}function Tw(t,e){do{var n=ze;try{if(Cp(),Bl.current=Ec,_c){for(var i=Oe.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}_c=!1}if(Wr=0,Qe=He=Oe=null,na=!1,xa=0,jp.current=null,n===null||n.return===null){Je=1,Oa=e,ze=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=nt,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=$g(o);if(f!==null){f.flags&=-257,Vg(f,o,a,s,e),f.mode&1&&Bg(s,c,e),e=f,l=c;var v=e.updateQueue;if(v===null){var p=new Set;p.add(l),e.updateQueue=p}else v.add(l);break e}else{if(!(e&1)){Bg(s,c,e),Vp();break e}l=Error(F(426))}}else if(Pe&&a.mode&1){var y=$g(o);if(y!==null){!(y.flags&65536)&&(y.flags|=256),Vg(y,o,a,s,e),Sp(lo(l,a));break e}}s=l=lo(l,a),Je!==4&&(Je=2),ra===null?ra=[s]:ra.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var m=ow(s,l,e);Mg(s,m);break e;case 1:a=l;var g=s.type,b=s.stateNode;if(!(s.flags&128)&&(typeof g.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(nr===null||!nr.has(b)))){s.flags|=65536,e&=-e,s.lanes|=e;var w=aw(s,a,e);Mg(s,w);break e}}s=s.return}while(s!==null)}Ew(n)}catch(k){e=k,ze===n&&n!==null&&(ze=n=n.return);continue}break}while(!0)}function Cw(){var t=Pc.current;return Pc.current=Ec,t===null?Ec:t}function Vp(){(Je===0||Je===3||Je===2)&&(Je=4),Ze===null||!(Hr&268435455)&&!(pu&268435455)||Fi(Ze,nt)}function Ic(t,e){var n=he;he|=2;var i=Cw();(Ze!==t||nt!==e)&&(Xn=null,$r(t,e));do try{sP();break}catch(r){Tw(t,r)}while(!0);if(Cp(),he=n,Pc.current=i,ze!==null)throw Error(F(261));return Ze=null,nt=0,Je}function sP(){for(;ze!==null;)_w(ze)}function oP(){for(;ze!==null&&!O_();)_w(ze)}function _w(t){var e=xw(t.alternate,t,Dt);t.memoizedProps=t.pendingProps,e===null?Ew(t):ze=e,jp.current=null}function Ew(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=ZE(n,e),n!==null){n.flags&=32767,ze=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Je=6,ze=null;return}}else if(n=XE(n,e,Dt),n!==null){ze=n;return}if(e=e.sibling,e!==null){ze=e;return}ze=e=t}while(e!==null);Je===0&&(Je=5)}function xr(t,e,n){var i=ge,r=Xt.transition;try{Xt.transition=null,ge=1,aP(t,e,n,i)}finally{Xt.transition=r,ge=i}return null}function aP(t,e,n,i){do Fs();while(Gi!==null);if(he&6)throw Error(F(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(F(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if($_(t,s),t===Ze&&(ze=Ze=null,nt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||kl||(kl=!0,Rw(dc,function(){return Fs(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=Xt.transition,Xt.transition=null;var o=ge;ge=1;var a=he;he|=4,jp.current=null,tP(t,n),ww(n,t),PE(Eh),fc=!!_h,Eh=_h=null,t.current=n,nP(n),A_(),he=a,ge=o,Xt.transition=s}else t.current=n;if(kl&&(kl=!1,Gi=t,Rc=r),s=t.pendingLanes,s===0&&(nr=null),N_(n.stateNode),xt(t,Ue()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(xc)throw xc=!1,t=Hh,Hh=null,t;return Rc&1&&t.tag!==0&&Fs(),s=t.pendingLanes,s&1?t===Kh?sa++:(sa=0,Kh=t):sa=0,vr(),null}function Fs(){if(Gi!==null){var t=ob(Rc),e=Xt.transition,n=ge;try{if(Xt.transition=null,ge=16>t?16:t,Gi===null)var i=!1;else{if(t=Gi,Gi=null,Rc=0,he&6)throw Error(F(331));var r=he;for(he|=4,H=t.current;H!==null;){var s=H,o=s.child;if(H.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(H=c;H!==null;){var u=H;switch(u.tag){case 0:case 11:case 15:ia(8,u,s)}var d=u.child;if(d!==null)d.return=u,H=d;else for(;H!==null;){u=H;var h=u.sibling,f=u.return;if(vw(u),u===c){H=null;break}if(h!==null){h.return=f,H=h;break}H=f}}}var v=s.alternate;if(v!==null){var p=v.child;if(p!==null){v.child=null;do{var y=p.sibling;p.sibling=null,p=y}while(p!==null)}}H=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,H=o;else e:for(;H!==null;){if(s=H,s.flags&2048)switch(s.tag){case 0:case 11:case 15:ia(9,s,s.return)}var m=s.sibling;if(m!==null){m.return=s.return,H=m;break e}H=s.return}}var g=t.current;for(H=g;H!==null;){o=H;var b=o.child;if(o.subtreeFlags&2064&&b!==null)b.return=o,H=b;else e:for(o=g;H!==null;){if(a=H,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:fu(9,a)}}catch(k){Ne(a,a.return,k)}if(a===o){H=null;break e}var w=a.sibling;if(w!==null){w.return=a.return,H=w;break e}H=a.return}}if(he=r,vr(),Fn&&typeof Fn.onPostCommitFiberRoot=="function")try{Fn.onPostCommitFiberRoot(su,t)}catch{}i=!0}return i}finally{ge=n,Xt.transition=e}}return!1}function tv(t,e,n){e=lo(n,e),e=ow(t,e,1),t=tr(t,e,1),e=mt(),t!==null&&(Ha(t,1,e),xt(t,e))}function Ne(t,e,n){if(t.tag===3)tv(t,t,n);else for(;e!==null;){if(e.tag===3){tv(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(nr===null||!nr.has(i))){t=lo(n,t),t=aw(e,t,1),e=tr(e,t,1),t=mt(),e!==null&&(Ha(e,1,t),xt(e,t));break}}e=e.return}}function lP(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=mt(),t.pingedLanes|=t.suspendedLanes&n,Ze===t&&(nt&n)===n&&(Je===4||Je===3&&(nt&130023424)===nt&&500>Ue()-Fp?$r(t,0):Up|=n),xt(t,e)}function Pw(t,e){e===0&&(t.mode&1?(e=dl,dl<<=1,!(dl&130023424)&&(dl=4194304)):e=1);var n=mt();t=pi(t,e),t!==null&&(Ha(t,e,n),xt(t,n))}function cP(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Pw(t,n)}function uP(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(F(314))}i!==null&&i.delete(e),Pw(t,n)}var xw;xw=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Et.current)Ct=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Ct=!1,YE(t,e,n);Ct=!!(t.flags&131072)}else Ct=!1,Pe&&e.flags&1048576&&Ab(e,wc,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Vl(t,e),t=e.pendingProps;var r=ro(e,ct.current);Us(e,n),r=Ap(null,e,i,t,r,n);var s=Dp();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Pt(i)?(s=!0,yc(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Pp(e),r.updater=hu,e.stateNode=r,r._reactInternals=e,Nh(e,i,t,n),e=Uh(null,e,i,!0,s,n)):(e.tag=0,Pe&&s&&wp(e),dt(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(Vl(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=hP(i),t=cn(i,t),r){case 0:e=jh(null,e,i,t,n);break e;case 1:e=Wg(null,e,i,t,n);break e;case 11:e=zg(null,e,i,t,n);break e;case 14:e=qg(null,e,i,cn(i.type,t),n);break e}throw Error(F(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:cn(i,r),jh(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:cn(i,r),Wg(t,e,i,r,n);case 3:e:{if(dw(e),t===null)throw Error(F(387));i=e.pendingProps,s=e.memoizedState,r=s.element,Ub(t,e),Tc(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=lo(Error(F(423)),e),e=Hg(t,e,i,n,r);break e}else if(i!==r){r=lo(Error(F(424)),e),e=Hg(t,e,i,n,r);break e}else for(Nt=er(e.stateNode.containerInfo.firstChild),jt=e,Pe=!0,gn=null,n=Lb(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(so(),i===r){e=mi(t,e,n);break e}dt(t,e,i,n)}e=e.child}return e;case 5:return Fb(e),t===null&&Ah(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,Ph(i,r)?o=null:s!==null&&Ph(i,s)&&(e.flags|=32),uw(t,e),dt(t,e,o,n),e.child;case 6:return t===null&&Ah(e),null;case 13:return hw(t,e,n);case 4:return xp(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=oo(e,null,i,n):dt(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:cn(i,r),zg(t,e,i,r,n);case 7:return dt(t,e,e.pendingProps,n),e.child;case 8:return dt(t,e,e.pendingProps.children,n),e.child;case 12:return dt(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,ke(kc,i._currentValue),i._currentValue=o,s!==null)if(Sn(s.value,o)){if(s.children===r.children&&!Et.current){e=mi(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=di(-1,n&-n),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),Dh(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(F(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Dh(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}dt(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,Us(e,n),r=en(r),i=i(r),e.flags|=1,dt(t,e,i,n),e.child;case 14:return i=e.type,r=cn(i,e.pendingProps),r=cn(i.type,r),qg(t,e,i,r,n);case 15:return lw(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:cn(i,r),Vl(t,e),e.tag=1,Pt(i)?(t=!0,yc(e)):t=!1,Us(e,n),sw(e,i,r),Nh(e,i,r,n),Uh(null,e,i,!0,t,n);case 19:return fw(t,e,n);case 22:return cw(t,e,n)}throw Error(F(156,e.tag))};function Rw(t,e){return nb(t,e)}function dP(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Qt(t,e,n,i){return new dP(t,e,n,i)}function zp(t){return t=t.prototype,!(!t||!t.isReactComponent)}function hP(t){if(typeof t=="function")return zp(t)?1:0;if(t!=null){if(t=t.$$typeof,t===lp)return 11;if(t===cp)return 14}return 2}function rr(t,e){var n=t.alternate;return n===null?(n=Qt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Wl(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")zp(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case ks:return Vr(n.children,r,s,e);case ap:o=8,r|=8;break;case sh:return t=Qt(12,n,e,r|2),t.elementType=sh,t.lanes=s,t;case oh:return t=Qt(13,n,e,r),t.elementType=oh,t.lanes=s,t;case ah:return t=Qt(19,n,e,r),t.elementType=ah,t.lanes=s,t;case F0:return mu(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case j0:o=10;break e;case U0:o=9;break e;case lp:o=11;break e;case cp:o=14;break e;case Li:o=16,i=null;break e}throw Error(F(130,t==null?t:typeof t,""))}return e=Qt(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function Vr(t,e,n,i){return t=Qt(7,t,i,e),t.lanes=n,t}function mu(t,e,n,i){return t=Qt(22,t,i,e),t.elementType=F0,t.lanes=n,t.stateNode={isHidden:!1},t}function Td(t,e,n){return t=Qt(6,t,null,e),t.lanes=n,t}function Cd(t,e,n){return e=Qt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function fP(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=rd(0),this.expirationTimes=rd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=rd(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function qp(t,e,n,i,r,s,o,a,l){return t=new fP(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Qt(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Pp(s),t}function pP(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ws,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function Iw(t){if(!t)return cr;t=t._reactInternals;e:{if(es(t)!==t||t.tag!==1)throw Error(F(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Pt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(F(171))}if(t.tag===1){var n=t.type;if(Pt(n))return Ib(t,n,e)}return e}function Ow(t,e,n,i,r,s,o,a,l){return t=qp(n,i,!0,t,r,s,o,a,l),t.context=Iw(null),n=t.current,i=mt(),r=ir(n),s=di(i,r),s.callback=e??null,tr(n,s,r),t.current.lanes=r,Ha(t,r,i),xt(t,i),t}function gu(t,e,n,i){var r=e.current,s=mt(),o=ir(r);return n=Iw(n),e.context===null?e.context=n:e.pendingContext=n,e=di(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=tr(r,e,o),t!==null&&(kn(t,r,o,s),Fl(t,r,o)),o}function Oc(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function nv(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Wp(t,e){nv(t,e),(t=t.alternate)&&nv(t,e)}function mP(){return null}var Aw=typeof reportError=="function"?reportError:function(t){console.error(t)};function Hp(t){this._internalRoot=t}vu.prototype.render=Hp.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(F(409));gu(t,e,null,null)};vu.prototype.unmount=Hp.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Kr(function(){gu(null,t,null,null)}),e[fi]=null}};function vu(t){this._internalRoot=t}vu.prototype.unstable_scheduleHydration=function(t){if(t){var e=cb();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Ui.length&&e!==0&&e<Ui[n].priority;n++);Ui.splice(n,0,t),n===0&&db(t)}};function Kp(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function yu(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function iv(){}function gP(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var c=Oc(o);s.call(c)}}var o=Ow(e,i,t,0,null,!1,!1,"",iv);return t._reactRootContainer=o,t[fi]=o.current,Ta(t.nodeType===8?t.parentNode:t),Kr(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var c=Oc(l);a.call(c)}}var l=qp(t,0,!1,null,null,!1,!1,"",iv);return t._reactRootContainer=l,t[fi]=l.current,Ta(t.nodeType===8?t.parentNode:t),Kr(function(){gu(e,l,n,i)}),l}function bu(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var l=Oc(o);a.call(l)}}gu(e,o,t,r)}else o=gP(n,e,t,r,i);return Oc(o)}ab=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Ho(e.pendingLanes);n!==0&&(hp(e,n|1),xt(e,Ue()),!(he&6)&&(co=Ue()+500,vr()))}break;case 13:Kr(function(){var i=pi(t,1);if(i!==null){var r=mt();kn(i,t,1,r)}}),Wp(t,1)}};fp=function(t){if(t.tag===13){var e=pi(t,134217728);if(e!==null){var n=mt();kn(e,t,134217728,n)}Wp(t,134217728)}};lb=function(t){if(t.tag===13){var e=ir(t),n=pi(t,e);if(n!==null){var i=mt();kn(n,t,e,i)}Wp(t,e)}};cb=function(){return ge};ub=function(t,e){var n=ge;try{return ge=t,e()}finally{ge=n}};vh=function(t,e,n){switch(e){case"input":if(uh(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=cu(i);if(!r)throw Error(F(90));$0(i),uh(i,r)}}}break;case"textarea":z0(t,n);break;case"select":e=n.value,e!=null&&Ms(t,!!n.multiple,e,!1)}};Q0=Bp;Y0=Kr;var vP={usingClientEntryPoint:!1,Events:[Ga,_s,cu,G0,J0,Bp]},Do={findFiberByHostInstance:Ar,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},yP={bundleType:Do.bundleType,version:Do.version,rendererPackageName:Do.rendererPackageName,rendererConfig:Do.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:bi.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=eb(t),t===null?null:t.stateNode},findFiberByHostInstance:Do.findFiberByHostInstance||mP,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Sl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Sl.isDisabled&&Sl.supportsFiber)try{su=Sl.inject(yP),Fn=Sl}catch{}}$t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=vP;$t.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Kp(e))throw Error(F(200));return pP(t,e,null,n)};$t.createRoot=function(t,e){if(!Kp(t))throw Error(F(299));var n=!1,i="",r=Aw;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=qp(t,1,!1,null,null,n,!1,i,r),t[fi]=e.current,Ta(t.nodeType===8?t.parentNode:t),new Hp(e)};$t.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(F(188)):(t=Object.keys(t).join(","),Error(F(268,t)));return t=eb(e),t=t===null?null:t.stateNode,t};$t.flushSync=function(t){return Kr(t)};$t.hydrate=function(t,e,n){if(!yu(e))throw Error(F(200));return bu(null,t,e,!0,n)};$t.hydrateRoot=function(t,e,n){if(!Kp(t))throw Error(F(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=Aw;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Ow(e,null,t,1,n??null,r,!1,s,o),t[fi]=e.current,Ta(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new vu(e)};$t.render=function(t,e,n){if(!yu(e))throw Error(F(200));return bu(null,t,e,!1,n)};$t.unmountComponentAtNode=function(t){if(!yu(t))throw Error(F(40));return t._reactRootContainer?(Kr(function(){bu(null,null,t,!1,function(){t._reactRootContainer=null,t[fi]=null})}),!0):!1};$t.unstable_batchedUpdates=Bp;$t.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!yu(n))throw Error(F(200));if(t==null||t._reactInternals===void 0)throw Error(F(38));return bu(t,e,n,!1,i)};$t.version="18.3.1-next-f1338f8080-20240426";function Dw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Dw)}catch(t){console.error(t)}}Dw(),D0.exports=$t;var Qa=D0.exports;const Mw=w0(Qa);var Nw,rv=Qa;Nw=rv.createRoot,rv.hydrateRoot;const bP=1,wP=1e6;let _d=0;function kP(){return _d=(_d+1)%Number.MAX_SAFE_INTEGER,_d.toString()}const Ed=new Map,sv=t=>{if(Ed.has(t))return;const e=setTimeout(()=>{Ed.delete(t),oa({type:"REMOVE_TOAST",toastId:t})},wP);Ed.set(t,e)},SP=(t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,bP)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(n=>n.id===e.toast.id?{...n,...e.toast}:n)};case"DISMISS_TOAST":{const{toastId:n}=e;return n?sv(n):t.toasts.forEach(i=>{sv(i.id)}),{...t,toasts:t.toasts.map(i=>i.id===n||n===void 0?{...i,open:!1}:i)}}case"REMOVE_TOAST":return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(n=>n.id!==e.toastId)}}},Hl=[];let Kl={toasts:[]};function oa(t){Kl=SP(Kl,t),Hl.forEach(e=>{e(Kl)})}function TP({...t}){const e=kP(),n=r=>oa({type:"UPDATE_TOAST",toast:{...r,id:e}}),i=()=>oa({type:"DISMISS_TOAST",toastId:e});return oa({type:"ADD_TOAST",toast:{...t,id:e,open:!0,onOpenChange:r=>{r||i()}}}),{id:e,dismiss:i,update:n}}function Lw(){const[t,e]=C.useState(Kl);return C.useEffect(()=>(Hl.push(e),()=>{const n=Hl.indexOf(e);n>-1&&Hl.splice(n,1)}),[t]),{...t,toast:TP,dismiss:n=>oa({type:"DISMISS_TOAST",toastId:n})}}function Ke(t,e,{checkForDefaultPrevented:n=!0}={}){return function(r){if(t==null||t(r),n===!1||!r.defaultPrevented)return e==null?void 0:e(r)}}function ov(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function jw(...t){return e=>{let n=!1;const i=t.map(r=>{const s=ov(r,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let r=0;r<i.length;r++){const s=i[r];typeof s=="function"?s():ov(t[r],null)}}}}function Tn(...t){return C.useCallback(jw(...t),t)}function wu(t,e=[]){let n=[];function i(s,o){const a=C.createContext(o),l=n.length;n=[...n,o];const c=d=>{var m;const{scope:h,children:f,...v}=d,p=((m=h==null?void 0:h[t])==null?void 0:m[l])||a,y=C.useMemo(()=>v,Object.values(v));return A.jsx(p.Provider,{value:y,children:f})};c.displayName=s+"Provider";function u(d,h){var p;const f=((p=h==null?void 0:h[t])==null?void 0:p[l])||a,v=C.useContext(f);if(v)return v;if(o!==void 0)return o;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[c,u]}const r=()=>{const s=n.map(o=>C.createContext(o));return function(a){const l=(a==null?void 0:a[t])||s;return C.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return r.scopeName=t,[i,CP(r,...e)]}function CP(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const i=t.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(s){const o=i.reduce((a,{useScope:l,scopeName:c})=>{const d=l(s)[`__scope${c}`];return{...a,...d}},{});return C.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}function Ac(t){const e=EP(t),n=C.forwardRef((i,r)=>{const{children:s,...o}=i,a=C.Children.toArray(s),l=a.find(xP);if(l){const c=l.props.children,u=a.map(d=>d===l?C.Children.count(c)>1?C.Children.only(null):C.isValidElement(c)?c.props.children:null:d);return A.jsx(e,{...o,ref:r,children:C.isValidElement(c)?C.cloneElement(c,void 0,u):null})}return A.jsx(e,{...o,ref:r,children:s})});return n.displayName=`${t}.Slot`,n}var _P=Ac("Slot");function EP(t){const e=C.forwardRef((n,i)=>{const{children:r,...s}=n;if(C.isValidElement(r)){const o=IP(r),a=RP(s,r.props);return r.type!==C.Fragment&&(a.ref=i?jw(i,o):o),C.cloneElement(r,a)}return C.Children.count(r)>1?C.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var Uw=Symbol("radix.slottable");function PP(t){const e=({children:n})=>A.jsx(A.Fragment,{children:n});return e.displayName=`${t}.Slottable`,e.__radixId=Uw,e}function xP(t){return C.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Uw}function RP(t,e){const n={...e};for(const i in e){const r=t[i],s=e[i];/^on[A-Z]/.test(i)?r&&s?n[i]=(...a)=>{const l=s(...a);return r(...a),l}:r&&(n[i]=r):i==="style"?n[i]={...r,...s}:i==="className"&&(n[i]=[r,s].filter(Boolean).join(" "))}return{...t,...n}}function IP(t){var i,r;let e=(i=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(r=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}function OP(t){const e=t+"CollectionProvider",[n,i]=wu(e),[r,s]=n(e,{collectionRef:{current:null},itemMap:new Map}),o=p=>{const{scope:y,children:m}=p,g=V.useRef(null),b=V.useRef(new Map).current;return A.jsx(r,{scope:y,itemMap:b,collectionRef:g,children:m})};o.displayName=e;const a=t+"CollectionSlot",l=Ac(a),c=V.forwardRef((p,y)=>{const{scope:m,children:g}=p,b=s(a,m),w=Tn(y,b.collectionRef);return A.jsx(l,{ref:w,children:g})});c.displayName=a;const u=t+"CollectionItemSlot",d="data-radix-collection-item",h=Ac(u),f=V.forwardRef((p,y)=>{const{scope:m,children:g,...b}=p,w=V.useRef(null),k=Tn(y,w),S=s(u,m);return V.useEffect(()=>(S.itemMap.set(w,{ref:w,...b}),()=>void S.itemMap.delete(w))),A.jsx(h,{[d]:"",ref:k,children:g})});f.displayName=u;function v(p){const y=s(t+"CollectionConsumer",p);return V.useCallback(()=>{const g=y.collectionRef.current;if(!g)return[];const b=Array.from(g.querySelectorAll(`[${d}]`));return Array.from(y.itemMap.values()).sort((S,_)=>b.indexOf(S.ref.current)-b.indexOf(_.ref.current))},[y.collectionRef,y.itemMap])}return[{Provider:o,Slot:c,ItemSlot:f},v,i]}var AP=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],At=AP.reduce((t,e)=>{const n=Ac(`Primitive.${e}`),i=C.forwardRef((r,s)=>{const{asChild:o,...a}=r,l=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),A.jsx(l,{...a,ref:s})});return i.displayName=`Primitive.${e}`,{...t,[e]:i}},{});function Fw(t,e){t&&Qa.flushSync(()=>t.dispatchEvent(e))}function ur(t){const e=C.useRef(t);return C.useEffect(()=>{e.current=t}),C.useMemo(()=>(...n)=>{var i;return(i=e.current)==null?void 0:i.call(e,...n)},[])}function DP(t,e=globalThis==null?void 0:globalThis.document){const n=ur(t);C.useEffect(()=>{const i=r=>{r.key==="Escape"&&n(r)};return e.addEventListener("keydown",i,{capture:!0}),()=>e.removeEventListener("keydown",i,{capture:!0})},[n,e])}var MP="DismissableLayer",Qh="dismissableLayer.update",NP="dismissableLayer.pointerDownOutside",LP="dismissableLayer.focusOutside",av,Bw=C.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Gp=C.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:i,onPointerDownOutside:r,onFocusOutside:s,onInteractOutside:o,onDismiss:a,...l}=t,c=C.useContext(Bw),[u,d]=C.useState(null),h=(u==null?void 0:u.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,f]=C.useState({}),v=Tn(e,_=>d(_)),p=Array.from(c.layers),[y]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),m=p.indexOf(y),g=u?p.indexOf(u):-1,b=c.layersWithOutsidePointerEventsDisabled.size>0,w=g>=m,k=UP(_=>{const E=_.target,x=[...c.branches].some(R=>R.contains(E));!w||x||(r==null||r(_),o==null||o(_),_.defaultPrevented||a==null||a())},h),S=FP(_=>{const E=_.target;[...c.branches].some(R=>R.contains(E))||(s==null||s(_),o==null||o(_),_.defaultPrevented||a==null||a())},h);return DP(_=>{g===c.layers.size-1&&(i==null||i(_),!_.defaultPrevented&&a&&(_.preventDefault(),a()))},h),C.useEffect(()=>{if(u)return n&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(av=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),lv(),()=>{n&&c.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=av)}},[u,h,n,c]),C.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),lv())},[u,c]),C.useEffect(()=>{const _=()=>f({});return document.addEventListener(Qh,_),()=>document.removeEventListener(Qh,_)},[]),A.jsx(At.div,{...l,ref:v,style:{pointerEvents:b?w?"auto":"none":void 0,...t.style},onFocusCapture:Ke(t.onFocusCapture,S.onFocusCapture),onBlurCapture:Ke(t.onBlurCapture,S.onBlurCapture),onPointerDownCapture:Ke(t.onPointerDownCapture,k.onPointerDownCapture)})});Gp.displayName=MP;var jP="DismissableLayerBranch",$w=C.forwardRef((t,e)=>{const n=C.useContext(Bw),i=C.useRef(null),r=Tn(e,i);return C.useEffect(()=>{const s=i.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),A.jsx(At.div,{...t,ref:r})});$w.displayName=jP;function UP(t,e=globalThis==null?void 0:globalThis.document){const n=ur(t),i=C.useRef(!1),r=C.useRef(()=>{});return C.useEffect(()=>{const s=a=>{if(a.target&&!i.current){let l=function(){Vw(NP,n,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",r.current),r.current=l,e.addEventListener("click",r.current,{once:!0})):l()}else e.removeEventListener("click",r.current);i.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",s),e.removeEventListener("click",r.current)}},[e,n]),{onPointerDownCapture:()=>i.current=!0}}function FP(t,e=globalThis==null?void 0:globalThis.document){const n=ur(t),i=C.useRef(!1);return C.useEffect(()=>{const r=s=>{s.target&&!i.current&&Vw(LP,n,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",r),()=>e.removeEventListener("focusin",r)},[e,n]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function lv(){const t=new CustomEvent(Qh);document.dispatchEvent(t)}function Vw(t,e,n,{discrete:i}){const r=n.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&r.addEventListener(t,e,{once:!0}),i?Fw(r,s):r.dispatchEvent(s)}var BP=Gp,$P=$w,dr=globalThis!=null&&globalThis.document?C.useLayoutEffect:()=>{},VP="Portal",zw=C.forwardRef((t,e)=>{var a;const{container:n,...i}=t,[r,s]=C.useState(!1);dr(()=>s(!0),[]);const o=n||r&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return o?Mw.createPortal(A.jsx(At.div,{...i,ref:e}),o):null});zw.displayName=VP;function zP(t,e){return C.useReducer((n,i)=>e[n][i]??n,t)}var Jp=t=>{const{present:e,children:n}=t,i=qP(e),r=typeof n=="function"?n({present:i.isPresent}):C.Children.only(n),s=Tn(i.ref,WP(r));return typeof n=="function"||i.isPresent?C.cloneElement(r,{ref:s}):null};Jp.displayName="Presence";function qP(t){const[e,n]=C.useState(),i=C.useRef(null),r=C.useRef(t),s=C.useRef("none"),o=t?"mounted":"unmounted",[a,l]=zP(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return C.useEffect(()=>{const c=Tl(i.current);s.current=a==="mounted"?c:"none"},[a]),dr(()=>{const c=i.current,u=r.current;if(u!==t){const h=s.current,f=Tl(c);t?l("MOUNT"):f==="none"||(c==null?void 0:c.display)==="none"?l("UNMOUNT"):l(u&&h!==f?"ANIMATION_OUT":"UNMOUNT"),r.current=t}},[t,l]),dr(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,d=f=>{const p=Tl(i.current).includes(f.animationName);if(f.target===e&&p&&(l("ANIMATION_END"),!r.current)){const y=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=y)})}},h=f=>{f.target===e&&(s.current=Tl(i.current))};return e.addEventListener("animationstart",h),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",h),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:C.useCallback(c=>{i.current=c?getComputedStyle(c):null,n(c)},[])}}function Tl(t){return(t==null?void 0:t.animationName)||"none"}function WP(t){var i,r;let e=(i=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(r=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var HP=O0[" useInsertionEffect ".trim().toString()]||dr;function KP({prop:t,defaultProp:e,onChange:n=()=>{},caller:i}){const[r,s,o]=GP({defaultProp:e,onChange:n}),a=t!==void 0,l=a?t:r;{const u=C.useRef(t!==void 0);C.useEffect(()=>{const d=u.current;d!==a&&console.warn(`${i} is changing from ${d?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=a},[a,i])}const c=C.useCallback(u=>{var d;if(a){const h=JP(u)?u(t):u;h!==t&&((d=o.current)==null||d.call(o,h))}else s(u)},[a,t,s,o]);return[l,c]}function GP({defaultProp:t,onChange:e}){const[n,i]=C.useState(t),r=C.useRef(n),s=C.useRef(e);return HP(()=>{s.current=e},[e]),C.useEffect(()=>{var o;r.current!==n&&((o=s.current)==null||o.call(s,n),r.current=n)},[n,r]),[n,i,s]}function JP(t){return typeof t=="function"}var QP=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),YP="VisuallyHidden",ku=C.forwardRef((t,e)=>A.jsx(At.span,{...t,ref:e,style:{...QP,...t.style}}));ku.displayName=YP;var XP=ku,Qp="ToastProvider",[Yp,ZP,ex]=OP("Toast"),[qw,EU]=wu("Toast",[ex]),[tx,Su]=qw(Qp),Ww=t=>{const{__scopeToast:e,label:n="Notification",duration:i=5e3,swipeDirection:r="right",swipeThreshold:s=50,children:o}=t,[a,l]=C.useState(null),[c,u]=C.useState(0),d=C.useRef(!1),h=C.useRef(!1);return n.trim()||console.error(`Invalid prop \`label\` supplied to \`${Qp}\`. Expected non-empty \`string\`.`),A.jsx(Yp.Provider,{scope:e,children:A.jsx(tx,{scope:e,label:n,duration:i,swipeDirection:r,swipeThreshold:s,toastCount:c,viewport:a,onViewportChange:l,onToastAdd:C.useCallback(()=>u(f=>f+1),[]),onToastRemove:C.useCallback(()=>u(f=>f-1),[]),isFocusedToastEscapeKeyDownRef:d,isClosePausedRef:h,children:o})})};Ww.displayName=Qp;var Hw="ToastViewport",nx=["F8"],Yh="toast.viewportPause",Xh="toast.viewportResume",Kw=C.forwardRef((t,e)=>{const{__scopeToast:n,hotkey:i=nx,label:r="Notifications ({hotkey})",...s}=t,o=Su(Hw,n),a=ZP(n),l=C.useRef(null),c=C.useRef(null),u=C.useRef(null),d=C.useRef(null),h=Tn(e,d,o.onViewportChange),f=i.join("+").replace(/Key/g,"").replace(/Digit/g,""),v=o.toastCount>0;C.useEffect(()=>{const y=m=>{var b;i.length!==0&&i.every(w=>m[w]||m.code===w)&&((b=d.current)==null||b.focus())};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[i]),C.useEffect(()=>{const y=l.current,m=d.current;if(v&&y&&m){const g=()=>{if(!o.isClosePausedRef.current){const S=new CustomEvent(Yh);m.dispatchEvent(S),o.isClosePausedRef.current=!0}},b=()=>{if(o.isClosePausedRef.current){const S=new CustomEvent(Xh);m.dispatchEvent(S),o.isClosePausedRef.current=!1}},w=S=>{!y.contains(S.relatedTarget)&&b()},k=()=>{y.contains(document.activeElement)||b()};return y.addEventListener("focusin",g),y.addEventListener("focusout",w),y.addEventListener("pointermove",g),y.addEventListener("pointerleave",k),window.addEventListener("blur",g),window.addEventListener("focus",b),()=>{y.removeEventListener("focusin",g),y.removeEventListener("focusout",w),y.removeEventListener("pointermove",g),y.removeEventListener("pointerleave",k),window.removeEventListener("blur",g),window.removeEventListener("focus",b)}}},[v,o.isClosePausedRef]);const p=C.useCallback(({tabbingDirection:y})=>{const g=a().map(b=>{const w=b.ref.current,k=[w,...mx(w)];return y==="forwards"?k:k.reverse()});return(y==="forwards"?g.reverse():g).flat()},[a]);return C.useEffect(()=>{const y=d.current;if(y){const m=g=>{var k,S,_;const b=g.altKey||g.ctrlKey||g.metaKey;if(g.key==="Tab"&&!b){const E=document.activeElement,x=g.shiftKey;if(g.target===y&&x){(k=c.current)==null||k.focus();return}const j=p({tabbingDirection:x?"backwards":"forwards"}),K=j.findIndex(B=>B===E);Pd(j.slice(K+1))?g.preventDefault():x?(S=c.current)==null||S.focus():(_=u.current)==null||_.focus()}};return y.addEventListener("keydown",m),()=>y.removeEventListener("keydown",m)}},[a,p]),A.jsxs($P,{ref:l,role:"region","aria-label":r.replace("{hotkey}",f),tabIndex:-1,style:{pointerEvents:v?void 0:"none"},children:[v&&A.jsx(Zh,{ref:c,onFocusFromOutsideViewport:()=>{const y=p({tabbingDirection:"forwards"});Pd(y)}}),A.jsx(Yp.Slot,{scope:n,children:A.jsx(At.ol,{tabIndex:-1,...s,ref:h})}),v&&A.jsx(Zh,{ref:u,onFocusFromOutsideViewport:()=>{const y=p({tabbingDirection:"backwards"});Pd(y)}})]})});Kw.displayName=Hw;var Gw="ToastFocusProxy",Zh=C.forwardRef((t,e)=>{const{__scopeToast:n,onFocusFromOutsideViewport:i,...r}=t,s=Su(Gw,n);return A.jsx(ku,{"aria-hidden":!0,tabIndex:0,...r,ref:e,style:{position:"fixed"},onFocus:o=>{var c;const a=o.relatedTarget;!((c=s.viewport)!=null&&c.contains(a))&&i()}})});Zh.displayName=Gw;var Ya="Toast",ix="toast.swipeStart",rx="toast.swipeMove",sx="toast.swipeCancel",ox="toast.swipeEnd",Jw=C.forwardRef((t,e)=>{const{forceMount:n,open:i,defaultOpen:r,onOpenChange:s,...o}=t,[a,l]=KP({prop:i,defaultProp:r??!0,onChange:s,caller:Ya});return A.jsx(Jp,{present:n||a,children:A.jsx(cx,{open:a,...o,ref:e,onClose:()=>l(!1),onPause:ur(t.onPause),onResume:ur(t.onResume),onSwipeStart:Ke(t.onSwipeStart,c=>{c.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Ke(t.onSwipeMove,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","move"),c.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${d}px`)}),onSwipeCancel:Ke(t.onSwipeCancel,c=>{c.currentTarget.setAttribute("data-swipe","cancel"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Ke(t.onSwipeEnd,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","end"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${d}px`),l(!1)})})})});Jw.displayName=Ya;var[ax,lx]=qw(Ya,{onClose(){}}),cx=C.forwardRef((t,e)=>{const{__scopeToast:n,type:i="foreground",duration:r,open:s,onClose:o,onEscapeKeyDown:a,onPause:l,onResume:c,onSwipeStart:u,onSwipeMove:d,onSwipeCancel:h,onSwipeEnd:f,...v}=t,p=Su(Ya,n),[y,m]=C.useState(null),g=Tn(e,B=>m(B)),b=C.useRef(null),w=C.useRef(null),k=r||p.duration,S=C.useRef(0),_=C.useRef(k),E=C.useRef(0),{onToastAdd:x,onToastRemove:R}=p,L=ur(()=>{var J;(y==null?void 0:y.contains(document.activeElement))&&((J=p.viewport)==null||J.focus()),o()}),j=C.useCallback(B=>{!B||B===1/0||(window.clearTimeout(E.current),S.current=new Date().getTime(),E.current=window.setTimeout(L,B))},[L]);C.useEffect(()=>{const B=p.viewport;if(B){const J=()=>{j(_.current),c==null||c()},Q=()=>{const X=new Date().getTime()-S.current;_.current=_.current-X,window.clearTimeout(E.current),l==null||l()};return B.addEventListener(Yh,Q),B.addEventListener(Xh,J),()=>{B.removeEventListener(Yh,Q),B.removeEventListener(Xh,J)}}},[p.viewport,k,l,c,j]),C.useEffect(()=>{s&&!p.isClosePausedRef.current&&j(k)},[s,k,p.isClosePausedRef,j]),C.useEffect(()=>(x(),()=>R()),[x,R]);const K=C.useMemo(()=>y?nk(y):null,[y]);return p.viewport?A.jsxs(A.Fragment,{children:[K&&A.jsx(ux,{__scopeToast:n,role:"status","aria-live":i==="foreground"?"assertive":"polite","aria-atomic":!0,children:K}),A.jsx(ax,{scope:n,onClose:L,children:Qa.createPortal(A.jsx(Yp.ItemSlot,{scope:n,children:A.jsx(BP,{asChild:!0,onEscapeKeyDown:Ke(a,()=>{p.isFocusedToastEscapeKeyDownRef.current||L(),p.isFocusedToastEscapeKeyDownRef.current=!1}),children:A.jsx(At.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":s?"open":"closed","data-swipe-direction":p.swipeDirection,...v,ref:g,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:Ke(t.onKeyDown,B=>{B.key==="Escape"&&(a==null||a(B.nativeEvent),B.nativeEvent.defaultPrevented||(p.isFocusedToastEscapeKeyDownRef.current=!0,L()))}),onPointerDown:Ke(t.onPointerDown,B=>{B.button===0&&(b.current={x:B.clientX,y:B.clientY})}),onPointerMove:Ke(t.onPointerMove,B=>{if(!b.current)return;const J=B.clientX-b.current.x,Q=B.clientY-b.current.y,X=!!w.current,I=["left","right"].includes(p.swipeDirection),M=["left","up"].includes(p.swipeDirection)?Math.min:Math.max,W=I?M(0,J):0,Y=I?0:M(0,Q),G=B.pointerType==="touch"?10:2,ne={x:W,y:Y},se={originalEvent:B,delta:ne};X?(w.current=ne,Cl(rx,d,se,{discrete:!1})):cv(ne,p.swipeDirection,G)?(w.current=ne,Cl(ix,u,se,{discrete:!1}),B.target.setPointerCapture(B.pointerId)):(Math.abs(J)>G||Math.abs(Q)>G)&&(b.current=null)}),onPointerUp:Ke(t.onPointerUp,B=>{const J=w.current,Q=B.target;if(Q.hasPointerCapture(B.pointerId)&&Q.releasePointerCapture(B.pointerId),w.current=null,b.current=null,J){const X=B.currentTarget,I={originalEvent:B,delta:J};cv(J,p.swipeDirection,p.swipeThreshold)?Cl(ox,f,I,{discrete:!0}):Cl(sx,h,I,{discrete:!0}),X.addEventListener("click",M=>M.preventDefault(),{once:!0})}})})})}),p.viewport)})]}):null}),ux=t=>{const{__scopeToast:e,children:n,...i}=t,r=Su(Ya,e),[s,o]=C.useState(!1),[a,l]=C.useState(!1);return fx(()=>o(!0)),C.useEffect(()=>{const c=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(c)},[]),a?null:A.jsx(zw,{asChild:!0,children:A.jsx(ku,{...i,children:s&&A.jsxs(A.Fragment,{children:[r.label," ",n]})})})},dx="ToastTitle",Qw=C.forwardRef((t,e)=>{const{__scopeToast:n,...i}=t;return A.jsx(At.div,{...i,ref:e})});Qw.displayName=dx;var hx="ToastDescription",Yw=C.forwardRef((t,e)=>{const{__scopeToast:n,...i}=t;return A.jsx(At.div,{...i,ref:e})});Yw.displayName=hx;var Xw="ToastAction",Zw=C.forwardRef((t,e)=>{const{altText:n,...i}=t;return n.trim()?A.jsx(tk,{altText:n,asChild:!0,children:A.jsx(Xp,{...i,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${Xw}\`. Expected non-empty \`string\`.`),null)});Zw.displayName=Xw;var ek="ToastClose",Xp=C.forwardRef((t,e)=>{const{__scopeToast:n,...i}=t,r=lx(ek,n);return A.jsx(tk,{asChild:!0,children:A.jsx(At.button,{type:"button",...i,ref:e,onClick:Ke(t.onClick,r.onClose)})})});Xp.displayName=ek;var tk=C.forwardRef((t,e)=>{const{__scopeToast:n,altText:i,...r}=t;return A.jsx(At.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":i||void 0,...r,ref:e})});function nk(t){const e=[];return Array.from(t.childNodes).forEach(i=>{if(i.nodeType===i.TEXT_NODE&&i.textContent&&e.push(i.textContent),px(i)){const r=i.ariaHidden||i.hidden||i.style.display==="none",s=i.dataset.radixToastAnnounceExclude==="";if(!r)if(s){const o=i.dataset.radixToastAnnounceAlt;o&&e.push(o)}else e.push(...nk(i))}}),e}function Cl(t,e,n,{discrete:i}){const r=n.originalEvent.currentTarget,s=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:n});e&&r.addEventListener(t,e,{once:!0}),i?Fw(r,s):r.dispatchEvent(s)}var cv=(t,e,n=0)=>{const i=Math.abs(t.x),r=Math.abs(t.y),s=i>r;return e==="left"||e==="right"?s&&i>n:!s&&r>n};function fx(t=()=>{}){const e=ur(t);dr(()=>{let n=0,i=0;return n=window.requestAnimationFrame(()=>i=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(n),window.cancelAnimationFrame(i)}},[e])}function px(t){return t.nodeType===t.ELEMENT_NODE}function mx(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:i=>{const r=i.tagName==="INPUT"&&i.type==="hidden";return i.disabled||i.hidden||r?NodeFilter.FILTER_SKIP:i.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function Pd(t){const e=document.activeElement;return t.some(n=>n===e?!0:(n.focus(),document.activeElement!==e))}var gx=Ww,ik=Kw,rk=Jw,sk=Qw,ok=Yw,ak=Zw,lk=Xp;function ck(t){var e,n,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(n=ck(t[e]))&&(i&&(i+=" "),i+=n)}else for(n in t)t[n]&&(i&&(i+=" "),i+=n);return i}function uk(){for(var t,e,n=0,i="",r=arguments.length;n<r;n++)(t=arguments[n])&&(e=ck(t))&&(i&&(i+=" "),i+=e);return i}const uv=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,dv=uk,dk=(t,e)=>n=>{var i;if((e==null?void 0:e.variants)==null)return dv(t,n==null?void 0:n.class,n==null?void 0:n.className);const{variants:r,defaultVariants:s}=e,o=Object.keys(r).map(c=>{const u=n==null?void 0:n[c],d=s==null?void 0:s[c];if(u===null)return null;const h=uv(u)||uv(d);return r[c][h]}),a=n&&Object.entries(n).reduce((c,u)=>{let[d,h]=u;return h===void 0||(c[d]=h),c},{}),l=e==null||(i=e.compoundVariants)===null||i===void 0?void 0:i.reduce((c,u)=>{let{class:d,className:h,...f}=u;return Object.entries(f).every(v=>{let[p,y]=v;return Array.isArray(y)?y.includes({...s,...a}[p]):{...s,...a}[p]===y})?[...c,d,h]:c},[]);return dv(t,o,l,n==null?void 0:n.class,n==null?void 0:n.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vx=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),hk=(...t)=>t.filter((e,n,i)=>!!e&&e.trim()!==""&&i.indexOf(e)===n).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var yx={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bx=C.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:r="",children:s,iconNode:o,...a},l)=>C.createElement("svg",{ref:l,...yx,width:e,height:e,stroke:t,strokeWidth:i?Number(n)*24/Number(e):n,className:hk("lucide",r),...a},[...o.map(([c,u])=>C.createElement(c,u)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tu=(t,e)=>{const n=C.forwardRef(({className:i,...r},s)=>C.createElement(bx,{ref:s,iconNode:e,className:hk(`lucide-${vx(t)}`,i),...r}));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wx=Tu("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kx=Tu("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sx=Tu("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tx=Tu("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Zp="-",Cx=t=>{const e=Ex(t),{conflictingClassGroups:n,conflictingClassGroupModifiers:i}=t;return{getClassGroupId:o=>{const a=o.split(Zp);return a[0]===""&&a.length!==1&&a.shift(),fk(a,e)||_x(o)},getConflictingClassGroupIds:(o,a)=>{const l=n[o]||[];return a&&i[o]?[...l,...i[o]]:l}}},fk=(t,e)=>{var o;if(t.length===0)return e.classGroupId;const n=t[0],i=e.nextPart.get(n),r=i?fk(t.slice(1),i):void 0;if(r)return r;if(e.validators.length===0)return;const s=t.join(Zp);return(o=e.validators.find(({validator:a})=>a(s)))==null?void 0:o.classGroupId},hv=/^\[(.+)\]$/,_x=t=>{if(hv.test(t)){const e=hv.exec(t)[1],n=e==null?void 0:e.substring(0,e.indexOf(":"));if(n)return"arbitrary.."+n}},Ex=t=>{const{theme:e,prefix:n}=t,i={nextPart:new Map,validators:[]};return xx(Object.entries(t.classGroups),n).forEach(([s,o])=>{ef(o,i,s,e)}),i},ef=(t,e,n,i)=>{t.forEach(r=>{if(typeof r=="string"){const s=r===""?e:fv(e,r);s.classGroupId=n;return}if(typeof r=="function"){if(Px(r)){ef(r(i),e,n,i);return}e.validators.push({validator:r,classGroupId:n});return}Object.entries(r).forEach(([s,o])=>{ef(o,fv(e,s),n,i)})})},fv=(t,e)=>{let n=t;return e.split(Zp).forEach(i=>{n.nextPart.has(i)||n.nextPart.set(i,{nextPart:new Map,validators:[]}),n=n.nextPart.get(i)}),n},Px=t=>t.isThemeGetter,xx=(t,e)=>e?t.map(([n,i])=>{const r=i.map(s=>typeof s=="string"?e+s:typeof s=="object"?Object.fromEntries(Object.entries(s).map(([o,a])=>[e+o,a])):s);return[n,r]}):t,Rx=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,n=new Map,i=new Map;const r=(s,o)=>{n.set(s,o),e++,e>t&&(e=0,i=n,n=new Map)};return{get(s){let o=n.get(s);if(o!==void 0)return o;if((o=i.get(s))!==void 0)return r(s,o),o},set(s,o){n.has(s)?n.set(s,o):r(s,o)}}},pk="!",Ix=t=>{const{separator:e,experimentalParseClassName:n}=t,i=e.length===1,r=e[0],s=e.length,o=a=>{const l=[];let c=0,u=0,d;for(let y=0;y<a.length;y++){let m=a[y];if(c===0){if(m===r&&(i||a.slice(y,y+s)===e)){l.push(a.slice(u,y)),u=y+s;continue}if(m==="/"){d=y;continue}}m==="["?c++:m==="]"&&c--}const h=l.length===0?a:a.substring(u),f=h.startsWith(pk),v=f?h.substring(1):h,p=d&&d>u?d-u:void 0;return{modifiers:l,hasImportantModifier:f,baseClassName:v,maybePostfixModifierPosition:p}};return n?a=>n({className:a,parseClassName:o}):o},Ox=t=>{if(t.length<=1)return t;const e=[];let n=[];return t.forEach(i=>{i[0]==="["?(e.push(...n.sort(),i),n=[]):n.push(i)}),e.push(...n.sort()),e},Ax=t=>({cache:Rx(t.cacheSize),parseClassName:Ix(t),...Cx(t)}),Dx=/\s+/,Mx=(t,e)=>{const{parseClassName:n,getClassGroupId:i,getConflictingClassGroupIds:r}=e,s=[],o=t.trim().split(Dx);let a="";for(let l=o.length-1;l>=0;l-=1){const c=o[l],{modifiers:u,hasImportantModifier:d,baseClassName:h,maybePostfixModifierPosition:f}=n(c);let v=!!f,p=i(v?h.substring(0,f):h);if(!p){if(!v){a=c+(a.length>0?" "+a:a);continue}if(p=i(h),!p){a=c+(a.length>0?" "+a:a);continue}v=!1}const y=Ox(u).join(":"),m=d?y+pk:y,g=m+p;if(s.includes(g))continue;s.push(g);const b=r(p,v);for(let w=0;w<b.length;++w){const k=b[w];s.push(m+k)}a=c+(a.length>0?" "+a:a)}return a};function Nx(){let t=0,e,n,i="";for(;t<arguments.length;)(e=arguments[t++])&&(n=mk(e))&&(i&&(i+=" "),i+=n);return i}const mk=t=>{if(typeof t=="string")return t;let e,n="";for(let i=0;i<t.length;i++)t[i]&&(e=mk(t[i]))&&(n&&(n+=" "),n+=e);return n};function Lx(t,...e){let n,i,r,s=o;function o(l){const c=e.reduce((u,d)=>d(u),t());return n=Ax(c),i=n.cache.get,r=n.cache.set,s=a,a(l)}function a(l){const c=i(l);if(c)return c;const u=Mx(l,n);return r(l,u),u}return function(){return s(Nx.apply(null,arguments))}}const Se=t=>{const e=n=>n[t]||[];return e.isThemeGetter=!0,e},gk=/^\[(?:([a-z-]+):)?(.+)\]$/i,jx=/^\d+\/\d+$/,Ux=new Set(["px","full","screen"]),Fx=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Bx=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,$x=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Vx=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,zx=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Gn=t=>Bs(t)||Ux.has(t)||jx.test(t),xi=t=>bo(t,"length",Yx),Bs=t=>!!t&&!Number.isNaN(Number(t)),xd=t=>bo(t,"number",Bs),Mo=t=>!!t&&Number.isInteger(Number(t)),qx=t=>t.endsWith("%")&&Bs(t.slice(0,-1)),ie=t=>gk.test(t),Ri=t=>Fx.test(t),Wx=new Set(["length","size","percentage"]),Hx=t=>bo(t,Wx,vk),Kx=t=>bo(t,"position",vk),Gx=new Set(["image","url"]),Jx=t=>bo(t,Gx,Zx),Qx=t=>bo(t,"",Xx),No=()=>!0,bo=(t,e,n)=>{const i=gk.exec(t);return i?i[1]?typeof e=="string"?i[1]===e:e.has(i[1]):n(i[2]):!1},Yx=t=>Bx.test(t)&&!$x.test(t),vk=()=>!1,Xx=t=>Vx.test(t),Zx=t=>zx.test(t),e1=()=>{const t=Se("colors"),e=Se("spacing"),n=Se("blur"),i=Se("brightness"),r=Se("borderColor"),s=Se("borderRadius"),o=Se("borderSpacing"),a=Se("borderWidth"),l=Se("contrast"),c=Se("grayscale"),u=Se("hueRotate"),d=Se("invert"),h=Se("gap"),f=Se("gradientColorStops"),v=Se("gradientColorStopPositions"),p=Se("inset"),y=Se("margin"),m=Se("opacity"),g=Se("padding"),b=Se("saturate"),w=Se("scale"),k=Se("sepia"),S=Se("skew"),_=Se("space"),E=Se("translate"),x=()=>["auto","contain","none"],R=()=>["auto","hidden","clip","visible","scroll"],L=()=>["auto",ie,e],j=()=>[ie,e],K=()=>["",Gn,xi],B=()=>["auto",Bs,ie],J=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Q=()=>["solid","dashed","dotted","double","none"],X=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],I=()=>["start","end","center","between","around","evenly","stretch"],M=()=>["","0",ie],W=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Y=()=>[Bs,ie];return{cacheSize:500,separator:":",theme:{colors:[No],spacing:[Gn,xi],blur:["none","",Ri,ie],brightness:Y(),borderColor:[t],borderRadius:["none","","full",Ri,ie],borderSpacing:j(),borderWidth:K(),contrast:Y(),grayscale:M(),hueRotate:Y(),invert:M(),gap:j(),gradientColorStops:[t],gradientColorStopPositions:[qx,xi],inset:L(),margin:L(),opacity:Y(),padding:j(),saturate:Y(),scale:Y(),sepia:M(),skew:Y(),space:j(),translate:j()},classGroups:{aspect:[{aspect:["auto","square","video",ie]}],container:["container"],columns:[{columns:[Ri]}],"break-after":[{"break-after":W()}],"break-before":[{"break-before":W()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...J(),ie]}],overflow:[{overflow:R()}],"overflow-x":[{"overflow-x":R()}],"overflow-y":[{"overflow-y":R()}],overscroll:[{overscroll:x()}],"overscroll-x":[{"overscroll-x":x()}],"overscroll-y":[{"overscroll-y":x()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[p]}],"inset-x":[{"inset-x":[p]}],"inset-y":[{"inset-y":[p]}],start:[{start:[p]}],end:[{end:[p]}],top:[{top:[p]}],right:[{right:[p]}],bottom:[{bottom:[p]}],left:[{left:[p]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Mo,ie]}],basis:[{basis:L()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",ie]}],grow:[{grow:M()}],shrink:[{shrink:M()}],order:[{order:["first","last","none",Mo,ie]}],"grid-cols":[{"grid-cols":[No]}],"col-start-end":[{col:["auto",{span:["full",Mo,ie]},ie]}],"col-start":[{"col-start":B()}],"col-end":[{"col-end":B()}],"grid-rows":[{"grid-rows":[No]}],"row-start-end":[{row:["auto",{span:[Mo,ie]},ie]}],"row-start":[{"row-start":B()}],"row-end":[{"row-end":B()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",ie]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",ie]}],gap:[{gap:[h]}],"gap-x":[{"gap-x":[h]}],"gap-y":[{"gap-y":[h]}],"justify-content":[{justify:["normal",...I()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...I(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...I(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[g]}],px:[{px:[g]}],py:[{py:[g]}],ps:[{ps:[g]}],pe:[{pe:[g]}],pt:[{pt:[g]}],pr:[{pr:[g]}],pb:[{pb:[g]}],pl:[{pl:[g]}],m:[{m:[y]}],mx:[{mx:[y]}],my:[{my:[y]}],ms:[{ms:[y]}],me:[{me:[y]}],mt:[{mt:[y]}],mr:[{mr:[y]}],mb:[{mb:[y]}],ml:[{ml:[y]}],"space-x":[{"space-x":[_]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[_]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",ie,e]}],"min-w":[{"min-w":[ie,e,"min","max","fit"]}],"max-w":[{"max-w":[ie,e,"none","full","min","max","fit","prose",{screen:[Ri]},Ri]}],h:[{h:[ie,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[ie,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[ie,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[ie,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Ri,xi]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",xd]}],"font-family":[{font:[No]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",ie]}],"line-clamp":[{"line-clamp":["none",Bs,xd]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Gn,ie]}],"list-image":[{"list-image":["none",ie]}],"list-style-type":[{list:["none","disc","decimal",ie]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[m]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[m]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Q(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Gn,xi]}],"underline-offset":[{"underline-offset":["auto",Gn,ie]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:j()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ie]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ie]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[m]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...J(),Kx]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Hx]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Jx]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[v]}],"gradient-via-pos":[{via:[v]}],"gradient-to-pos":[{to:[v]}],"gradient-from":[{from:[f]}],"gradient-via":[{via:[f]}],"gradient-to":[{to:[f]}],rounded:[{rounded:[s]}],"rounded-s":[{"rounded-s":[s]}],"rounded-e":[{"rounded-e":[s]}],"rounded-t":[{"rounded-t":[s]}],"rounded-r":[{"rounded-r":[s]}],"rounded-b":[{"rounded-b":[s]}],"rounded-l":[{"rounded-l":[s]}],"rounded-ss":[{"rounded-ss":[s]}],"rounded-se":[{"rounded-se":[s]}],"rounded-ee":[{"rounded-ee":[s]}],"rounded-es":[{"rounded-es":[s]}],"rounded-tl":[{"rounded-tl":[s]}],"rounded-tr":[{"rounded-tr":[s]}],"rounded-br":[{"rounded-br":[s]}],"rounded-bl":[{"rounded-bl":[s]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[m]}],"border-style":[{border:[...Q(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[m]}],"divide-style":[{divide:Q()}],"border-color":[{border:[r]}],"border-color-x":[{"border-x":[r]}],"border-color-y":[{"border-y":[r]}],"border-color-s":[{"border-s":[r]}],"border-color-e":[{"border-e":[r]}],"border-color-t":[{"border-t":[r]}],"border-color-r":[{"border-r":[r]}],"border-color-b":[{"border-b":[r]}],"border-color-l":[{"border-l":[r]}],"divide-color":[{divide:[r]}],"outline-style":[{outline:["",...Q()]}],"outline-offset":[{"outline-offset":[Gn,ie]}],"outline-w":[{outline:[Gn,xi]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:K()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[m]}],"ring-offset-w":[{"ring-offset":[Gn,xi]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",Ri,Qx]}],"shadow-color":[{shadow:[No]}],opacity:[{opacity:[m]}],"mix-blend":[{"mix-blend":[...X(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":X()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[i]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",Ri,ie]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[d]}],saturate:[{saturate:[b]}],sepia:[{sepia:[k]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[i]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[d]}],"backdrop-opacity":[{"backdrop-opacity":[m]}],"backdrop-saturate":[{"backdrop-saturate":[b]}],"backdrop-sepia":[{"backdrop-sepia":[k]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",ie]}],duration:[{duration:Y()}],ease:[{ease:["linear","in","out","in-out",ie]}],delay:[{delay:Y()}],animate:[{animate:["none","spin","ping","pulse","bounce",ie]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[w]}],"scale-x":[{"scale-x":[w]}],"scale-y":[{"scale-y":[w]}],rotate:[{rotate:[Mo,ie]}],"translate-x":[{"translate-x":[E]}],"translate-y":[{"translate-y":[E]}],"skew-x":[{"skew-x":[S]}],"skew-y":[{"skew-y":[S]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ie]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ie]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":j()}],"scroll-mx":[{"scroll-mx":j()}],"scroll-my":[{"scroll-my":j()}],"scroll-ms":[{"scroll-ms":j()}],"scroll-me":[{"scroll-me":j()}],"scroll-mt":[{"scroll-mt":j()}],"scroll-mr":[{"scroll-mr":j()}],"scroll-mb":[{"scroll-mb":j()}],"scroll-ml":[{"scroll-ml":j()}],"scroll-p":[{"scroll-p":j()}],"scroll-px":[{"scroll-px":j()}],"scroll-py":[{"scroll-py":j()}],"scroll-ps":[{"scroll-ps":j()}],"scroll-pe":[{"scroll-pe":j()}],"scroll-pt":[{"scroll-pt":j()}],"scroll-pr":[{"scroll-pr":j()}],"scroll-pb":[{"scroll-pb":j()}],"scroll-pl":[{"scroll-pl":j()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ie]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[Gn,xi,xd]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},t1=Lx(e1);function yr(...t){return t1(uk(t))}const n1=gx,yk=C.forwardRef(({className:t,...e},n)=>A.jsx(ik,{ref:n,className:yr("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...e}));yk.displayName=ik.displayName;const i1=dk("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),bk=C.forwardRef(({className:t,variant:e,...n},i)=>A.jsx(rk,{ref:i,className:yr(i1({variant:e}),t),...n}));bk.displayName=rk.displayName;const r1=C.forwardRef(({className:t,...e},n)=>A.jsx(ak,{ref:n,className:yr("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",t),...e}));r1.displayName=ak.displayName;const wk=C.forwardRef(({className:t,...e},n)=>A.jsx(lk,{ref:n,className:yr("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...e,children:A.jsx(Tx,{className:"h-4 w-4"})}));wk.displayName=lk.displayName;const kk=C.forwardRef(({className:t,...e},n)=>A.jsx(sk,{ref:n,className:yr("text-sm font-semibold",t),...e}));kk.displayName=sk.displayName;const Sk=C.forwardRef(({className:t,...e},n)=>A.jsx(ok,{ref:n,className:yr("text-sm opacity-90",t),...e}));Sk.displayName=ok.displayName;function s1(){const{toasts:t}=Lw();return A.jsxs(n1,{children:[t.map(function({id:e,title:n,description:i,action:r,...s}){return A.jsxs(bk,{...s,children:[A.jsxs("div",{className:"grid gap-1",children:[n&&A.jsx(kk,{children:n}),i&&A.jsx(Sk,{children:i})]}),r,A.jsx(wk,{})]},e)}),A.jsx(yk,{})]})}var pv=["light","dark"],o1="(prefers-color-scheme: dark)",a1=C.createContext(void 0),l1={setTheme:t=>{},themes:[]},c1=()=>{var t;return(t=C.useContext(a1))!=null?t:l1};C.memo(({forcedTheme:t,storageKey:e,attribute:n,enableSystem:i,enableColorScheme:r,defaultTheme:s,value:o,attrs:a,nonce:l})=>{let c=s==="system",u=n==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${a.map(v=>`'${v}'`).join(",")})`};`:`var d=document.documentElement,n='${n}',s='setAttribute';`,d=r?pv.includes(s)&&s?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${s}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",h=(v,p=!1,y=!0)=>{let m=o?o[v]:v,g=p?v+"|| ''":`'${m}'`,b="";return r&&y&&!p&&pv.includes(v)&&(b+=`d.style.colorScheme = '${v}';`),n==="class"?p||m?b+=`c.add(${g})`:b+="null":m&&(b+=`d[s](n,${g})`),b},f=t?`!function(){${u}${h(t)}}()`:i?`!function(){try{${u}var e=localStorage.getItem('${e}');if('system'===e||(!e&&${c})){var t='${o1}',m=window.matchMedia(t);if(m.media!==t||m.matches){${h("dark")}}else{${h("light")}}}else if(e){${o?`var x=${JSON.stringify(o)};`:""}${h(o?"x[e]":"e",!0)}}${c?"":"else{"+h(s,!1,!1)+"}"}${d}}catch(e){}}()`:`!function(){try{${u}var e=localStorage.getItem('${e}');if(e){${o?`var x=${JSON.stringify(o)};`:""}${h(o?"x[e]":"e",!0)}}else{${h(s,!1,!1)};}${d}}catch(t){}}();`;return C.createElement("script",{nonce:l,dangerouslySetInnerHTML:{__html:f}})});var u1=t=>{switch(t){case"success":return f1;case"info":return m1;case"warning":return p1;case"error":return g1;default:return null}},d1=Array(12).fill(0),h1=({visible:t,className:e})=>V.createElement("div",{className:["sonner-loading-wrapper",e].filter(Boolean).join(" "),"data-visible":t},V.createElement("div",{className:"sonner-spinner"},d1.map((n,i)=>V.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${i}`})))),f1=V.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},V.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),p1=V.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},V.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),m1=V.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},V.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),g1=V.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},V.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),v1=V.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},V.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),V.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),y1=()=>{let[t,e]=V.useState(document.hidden);return V.useEffect(()=>{let n=()=>{e(document.hidden)};return document.addEventListener("visibilitychange",n),()=>window.removeEventListener("visibilitychange",n)},[]),t},tf=1,b1=class{constructor(){this.subscribe=t=>(this.subscribers.push(t),()=>{let e=this.subscribers.indexOf(t);this.subscribers.splice(e,1)}),this.publish=t=>{this.subscribers.forEach(e=>e(t))},this.addToast=t=>{this.publish(t),this.toasts=[...this.toasts,t]},this.create=t=>{var e;let{message:n,...i}=t,r=typeof(t==null?void 0:t.id)=="number"||((e=t.id)==null?void 0:e.length)>0?t.id:tf++,s=this.toasts.find(a=>a.id===r),o=t.dismissible===void 0?!0:t.dismissible;return this.dismissedToasts.has(r)&&this.dismissedToasts.delete(r),s?this.toasts=this.toasts.map(a=>a.id===r?(this.publish({...a,...t,id:r,title:n}),{...a,...t,id:r,dismissible:o,title:n}):a):this.addToast({title:n,...i,dismissible:o,id:r}),r},this.dismiss=t=>(this.dismissedToasts.add(t),t||this.toasts.forEach(e=>{this.subscribers.forEach(n=>n({id:e.id,dismiss:!0}))}),this.subscribers.forEach(e=>e({id:t,dismiss:!0})),t),this.message=(t,e)=>this.create({...e,message:t}),this.error=(t,e)=>this.create({...e,message:t,type:"error"}),this.success=(t,e)=>this.create({...e,type:"success",message:t}),this.info=(t,e)=>this.create({...e,type:"info",message:t}),this.warning=(t,e)=>this.create({...e,type:"warning",message:t}),this.loading=(t,e)=>this.create({...e,type:"loading",message:t}),this.promise=(t,e)=>{if(!e)return;let n;e.loading!==void 0&&(n=this.create({...e,promise:t,type:"loading",message:e.loading,description:typeof e.description!="function"?e.description:void 0}));let i=t instanceof Promise?t:t(),r=n!==void 0,s,o=i.then(async l=>{if(s=["resolve",l],V.isValidElement(l))r=!1,this.create({id:n,type:"default",message:l});else if(k1(l)&&!l.ok){r=!1;let c=typeof e.error=="function"?await e.error(`HTTP error! status: ${l.status}`):e.error,u=typeof e.description=="function"?await e.description(`HTTP error! status: ${l.status}`):e.description;this.create({id:n,type:"error",message:c,description:u})}else if(e.success!==void 0){r=!1;let c=typeof e.success=="function"?await e.success(l):e.success,u=typeof e.description=="function"?await e.description(l):e.description;this.create({id:n,type:"success",message:c,description:u})}}).catch(async l=>{if(s=["reject",l],e.error!==void 0){r=!1;let c=typeof e.error=="function"?await e.error(l):e.error,u=typeof e.description=="function"?await e.description(l):e.description;this.create({id:n,type:"error",message:c,description:u})}}).finally(()=>{var l;r&&(this.dismiss(n),n=void 0),(l=e.finally)==null||l.call(e)}),a=()=>new Promise((l,c)=>o.then(()=>s[0]==="reject"?c(s[1]):l(s[1])).catch(c));return typeof n!="string"&&typeof n!="number"?{unwrap:a}:Object.assign(n,{unwrap:a})},this.custom=(t,e)=>{let n=(e==null?void 0:e.id)||tf++;return this.create({jsx:t(n),id:n,...e}),n},this.getActiveToasts=()=>this.toasts.filter(t=>!this.dismissedToasts.has(t.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},wt=new b1,w1=(t,e)=>{let n=(e==null?void 0:e.id)||tf++;return wt.addToast({title:t,...e,id:n}),n},k1=t=>t&&typeof t=="object"&&"ok"in t&&typeof t.ok=="boolean"&&"status"in t&&typeof t.status=="number",S1=w1,T1=()=>wt.toasts,C1=()=>wt.getActiveToasts();Object.assign(S1,{success:wt.success,info:wt.info,warning:wt.warning,error:wt.error,custom:wt.custom,message:wt.message,promise:wt.promise,dismiss:wt.dismiss,loading:wt.loading},{getHistory:T1,getToasts:C1});function _1(t,{insertAt:e}={}){if(typeof document>"u")return;let n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",e==="top"&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}_1(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function _l(t){return t.label!==void 0}var E1=3,P1="32px",x1="16px",mv=4e3,R1=356,I1=14,O1=20,A1=200;function an(...t){return t.filter(Boolean).join(" ")}function D1(t){let[e,n]=t.split("-"),i=[];return e&&i.push(e),n&&i.push(n),i}var M1=t=>{var e,n,i,r,s,o,a,l,c,u,d;let{invert:h,toast:f,unstyled:v,interacting:p,setHeights:y,visibleToasts:m,heights:g,index:b,toasts:w,expanded:k,removeToast:S,defaultRichColors:_,closeButton:E,style:x,cancelButtonStyle:R,actionButtonStyle:L,className:j="",descriptionClassName:K="",duration:B,position:J,gap:Q,loadingIcon:X,expandByDefault:I,classNames:M,icons:W,closeButtonAriaLabel:Y="Close toast",pauseWhenPageIsHidden:G}=t,[ne,se]=V.useState(null),[Re,Be]=V.useState(null),[me,is]=V.useState(!1),[ki,Sr]=V.useState(!1),[Si,rs]=V.useState(!1),[Ti,nl]=V.useState(!1),[Gu,il]=V.useState(!1),[Ju,Co]=V.useState(0),[ss,zm]=V.useState(0),_o=V.useRef(f.duration||B||mv),qm=V.useRef(null),Tr=V.useRef(null),jC=b===0,UC=b+1<=m,zt=f.type,os=f.dismissible!==!1,FC=f.className||"",BC=f.descriptionClassName||"",rl=V.useMemo(()=>g.findIndex(Z=>Z.toastId===f.id)||0,[g,f.id]),$C=V.useMemo(()=>{var Z;return(Z=f.closeButton)!=null?Z:E},[f.closeButton,E]),Wm=V.useMemo(()=>f.duration||B||mv,[f.duration,B]),Qu=V.useRef(0),as=V.useRef(0),Hm=V.useRef(0),ls=V.useRef(null),[VC,zC]=J.split("-"),Km=V.useMemo(()=>g.reduce((Z,ve,Ee)=>Ee>=rl?Z:Z+ve.height,0),[g,rl]),Gm=y1(),qC=f.invert||h,Yu=zt==="loading";as.current=V.useMemo(()=>rl*Q+Km,[rl,Km]),V.useEffect(()=>{_o.current=Wm},[Wm]),V.useEffect(()=>{is(!0)},[]),V.useEffect(()=>{let Z=Tr.current;if(Z){let ve=Z.getBoundingClientRect().height;return zm(ve),y(Ee=>[{toastId:f.id,height:ve,position:f.position},...Ee]),()=>y(Ee=>Ee.filter(nn=>nn.toastId!==f.id))}},[y,f.id]),V.useLayoutEffect(()=>{if(!me)return;let Z=Tr.current,ve=Z.style.height;Z.style.height="auto";let Ee=Z.getBoundingClientRect().height;Z.style.height=ve,zm(Ee),y(nn=>nn.find(rn=>rn.toastId===f.id)?nn.map(rn=>rn.toastId===f.id?{...rn,height:Ee}:rn):[{toastId:f.id,height:Ee,position:f.position},...nn])},[me,f.title,f.description,y,f.id]);let Ci=V.useCallback(()=>{Sr(!0),Co(as.current),y(Z=>Z.filter(ve=>ve.toastId!==f.id)),setTimeout(()=>{S(f)},A1)},[f,S,y,as]);V.useEffect(()=>{if(f.promise&&zt==="loading"||f.duration===1/0||f.type==="loading")return;let Z;return k||p||G&&Gm?(()=>{if(Hm.current<Qu.current){let ve=new Date().getTime()-Qu.current;_o.current=_o.current-ve}Hm.current=new Date().getTime()})():_o.current!==1/0&&(Qu.current=new Date().getTime(),Z=setTimeout(()=>{var ve;(ve=f.onAutoClose)==null||ve.call(f,f),Ci()},_o.current)),()=>clearTimeout(Z)},[k,p,f,zt,G,Gm,Ci]),V.useEffect(()=>{f.delete&&Ci()},[Ci,f.delete]);function WC(){var Z,ve,Ee;return W!=null&&W.loading?V.createElement("div",{className:an(M==null?void 0:M.loader,(Z=f==null?void 0:f.classNames)==null?void 0:Z.loader,"sonner-loader"),"data-visible":zt==="loading"},W.loading):X?V.createElement("div",{className:an(M==null?void 0:M.loader,(ve=f==null?void 0:f.classNames)==null?void 0:ve.loader,"sonner-loader"),"data-visible":zt==="loading"},X):V.createElement(h1,{className:an(M==null?void 0:M.loader,(Ee=f==null?void 0:f.classNames)==null?void 0:Ee.loader),visible:zt==="loading"})}return V.createElement("li",{tabIndex:0,ref:Tr,className:an(j,FC,M==null?void 0:M.toast,(e=f==null?void 0:f.classNames)==null?void 0:e.toast,M==null?void 0:M.default,M==null?void 0:M[zt],(n=f==null?void 0:f.classNames)==null?void 0:n[zt]),"data-sonner-toast":"","data-rich-colors":(i=f.richColors)!=null?i:_,"data-styled":!(f.jsx||f.unstyled||v),"data-mounted":me,"data-promise":!!f.promise,"data-swiped":Gu,"data-removed":ki,"data-visible":UC,"data-y-position":VC,"data-x-position":zC,"data-index":b,"data-front":jC,"data-swiping":Si,"data-dismissible":os,"data-type":zt,"data-invert":qC,"data-swipe-out":Ti,"data-swipe-direction":Re,"data-expanded":!!(k||I&&me),style:{"--index":b,"--toasts-before":b,"--z-index":w.length-b,"--offset":`${ki?Ju:as.current}px`,"--initial-height":I?"auto":`${ss}px`,...x,...f.style},onDragEnd:()=>{rs(!1),se(null),ls.current=null},onPointerDown:Z=>{Yu||!os||(qm.current=new Date,Co(as.current),Z.target.setPointerCapture(Z.pointerId),Z.target.tagName!=="BUTTON"&&(rs(!0),ls.current={x:Z.clientX,y:Z.clientY}))},onPointerUp:()=>{var Z,ve,Ee,nn;if(Ti||!os)return;ls.current=null;let rn=Number(((Z=Tr.current)==null?void 0:Z.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),_i=Number(((ve=Tr.current)==null?void 0:ve.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Cr=new Date().getTime()-((Ee=qm.current)==null?void 0:Ee.getTime()),sn=ne==="x"?rn:_i,Ei=Math.abs(sn)/Cr;if(Math.abs(sn)>=O1||Ei>.11){Co(as.current),(nn=f.onDismiss)==null||nn.call(f,f),Be(ne==="x"?rn>0?"right":"left":_i>0?"down":"up"),Ci(),nl(!0),il(!1);return}rs(!1),se(null)},onPointerMove:Z=>{var ve,Ee,nn,rn;if(!ls.current||!os||((ve=window.getSelection())==null?void 0:ve.toString().length)>0)return;let _i=Z.clientY-ls.current.y,Cr=Z.clientX-ls.current.x,sn=(Ee=t.swipeDirections)!=null?Ee:D1(J);!ne&&(Math.abs(Cr)>1||Math.abs(_i)>1)&&se(Math.abs(Cr)>Math.abs(_i)?"x":"y");let Ei={x:0,y:0};ne==="y"?(sn.includes("top")||sn.includes("bottom"))&&(sn.includes("top")&&_i<0||sn.includes("bottom")&&_i>0)&&(Ei.y=_i):ne==="x"&&(sn.includes("left")||sn.includes("right"))&&(sn.includes("left")&&Cr<0||sn.includes("right")&&Cr>0)&&(Ei.x=Cr),(Math.abs(Ei.x)>0||Math.abs(Ei.y)>0)&&il(!0),(nn=Tr.current)==null||nn.style.setProperty("--swipe-amount-x",`${Ei.x}px`),(rn=Tr.current)==null||rn.style.setProperty("--swipe-amount-y",`${Ei.y}px`)}},$C&&!f.jsx?V.createElement("button",{"aria-label":Y,"data-disabled":Yu,"data-close-button":!0,onClick:Yu||!os?()=>{}:()=>{var Z;Ci(),(Z=f.onDismiss)==null||Z.call(f,f)},className:an(M==null?void 0:M.closeButton,(r=f==null?void 0:f.classNames)==null?void 0:r.closeButton)},(s=W==null?void 0:W.close)!=null?s:v1):null,f.jsx||C.isValidElement(f.title)?f.jsx?f.jsx:typeof f.title=="function"?f.title():f.title:V.createElement(V.Fragment,null,zt||f.icon||f.promise?V.createElement("div",{"data-icon":"",className:an(M==null?void 0:M.icon,(o=f==null?void 0:f.classNames)==null?void 0:o.icon)},f.promise||f.type==="loading"&&!f.icon?f.icon||WC():null,f.type!=="loading"?f.icon||(W==null?void 0:W[zt])||u1(zt):null):null,V.createElement("div",{"data-content":"",className:an(M==null?void 0:M.content,(a=f==null?void 0:f.classNames)==null?void 0:a.content)},V.createElement("div",{"data-title":"",className:an(M==null?void 0:M.title,(l=f==null?void 0:f.classNames)==null?void 0:l.title)},typeof f.title=="function"?f.title():f.title),f.description?V.createElement("div",{"data-description":"",className:an(K,BC,M==null?void 0:M.description,(c=f==null?void 0:f.classNames)==null?void 0:c.description)},typeof f.description=="function"?f.description():f.description):null),C.isValidElement(f.cancel)?f.cancel:f.cancel&&_l(f.cancel)?V.createElement("button",{"data-button":!0,"data-cancel":!0,style:f.cancelButtonStyle||R,onClick:Z=>{var ve,Ee;_l(f.cancel)&&os&&((Ee=(ve=f.cancel).onClick)==null||Ee.call(ve,Z),Ci())},className:an(M==null?void 0:M.cancelButton,(u=f==null?void 0:f.classNames)==null?void 0:u.cancelButton)},f.cancel.label):null,C.isValidElement(f.action)?f.action:f.action&&_l(f.action)?V.createElement("button",{"data-button":!0,"data-action":!0,style:f.actionButtonStyle||L,onClick:Z=>{var ve,Ee;_l(f.action)&&((Ee=(ve=f.action).onClick)==null||Ee.call(ve,Z),!Z.defaultPrevented&&Ci())},className:an(M==null?void 0:M.actionButton,(d=f==null?void 0:f.classNames)==null?void 0:d.actionButton)},f.action.label):null))};function gv(){if(typeof window>"u"||typeof document>"u")return"ltr";let t=document.documentElement.getAttribute("dir");return t==="auto"||!t?window.getComputedStyle(document.documentElement).direction:t}function N1(t,e){let n={};return[t,e].forEach((i,r)=>{let s=r===1,o=s?"--mobile-offset":"--offset",a=s?x1:P1;function l(c){["top","right","bottom","left"].forEach(u=>{n[`${o}-${u}`]=typeof c=="number"?`${c}px`:c})}typeof i=="number"||typeof i=="string"?l(i):typeof i=="object"?["top","right","bottom","left"].forEach(c=>{i[c]===void 0?n[`${o}-${c}`]=a:n[`${o}-${c}`]=typeof i[c]=="number"?`${i[c]}px`:i[c]}):l(a)}),n}var L1=C.forwardRef(function(t,e){let{invert:n,position:i="bottom-right",hotkey:r=["altKey","KeyT"],expand:s,closeButton:o,className:a,offset:l,mobileOffset:c,theme:u="light",richColors:d,duration:h,style:f,visibleToasts:v=E1,toastOptions:p,dir:y=gv(),gap:m=I1,loadingIcon:g,icons:b,containerAriaLabel:w="Notifications",pauseWhenPageIsHidden:k}=t,[S,_]=V.useState([]),E=V.useMemo(()=>Array.from(new Set([i].concat(S.filter(G=>G.position).map(G=>G.position)))),[S,i]),[x,R]=V.useState([]),[L,j]=V.useState(!1),[K,B]=V.useState(!1),[J,Q]=V.useState(u!=="system"?u:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),X=V.useRef(null),I=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),M=V.useRef(null),W=V.useRef(!1),Y=V.useCallback(G=>{_(ne=>{var se;return(se=ne.find(Re=>Re.id===G.id))!=null&&se.delete||wt.dismiss(G.id),ne.filter(({id:Re})=>Re!==G.id)})},[]);return V.useEffect(()=>wt.subscribe(G=>{if(G.dismiss){_(ne=>ne.map(se=>se.id===G.id?{...se,delete:!0}:se));return}setTimeout(()=>{Mw.flushSync(()=>{_(ne=>{let se=ne.findIndex(Re=>Re.id===G.id);return se!==-1?[...ne.slice(0,se),{...ne[se],...G},...ne.slice(se+1)]:[G,...ne]})})})}),[]),V.useEffect(()=>{if(u!=="system"){Q(u);return}if(u==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Q("dark"):Q("light")),typeof window>"u")return;let G=window.matchMedia("(prefers-color-scheme: dark)");try{G.addEventListener("change",({matches:ne})=>{Q(ne?"dark":"light")})}catch{G.addListener(({matches:se})=>{try{Q(se?"dark":"light")}catch(Re){console.error(Re)}})}},[u]),V.useEffect(()=>{S.length<=1&&j(!1)},[S]),V.useEffect(()=>{let G=ne=>{var se,Re;r.every(Be=>ne[Be]||ne.code===Be)&&(j(!0),(se=X.current)==null||se.focus()),ne.code==="Escape"&&(document.activeElement===X.current||(Re=X.current)!=null&&Re.contains(document.activeElement))&&j(!1)};return document.addEventListener("keydown",G),()=>document.removeEventListener("keydown",G)},[r]),V.useEffect(()=>{if(X.current)return()=>{M.current&&(M.current.focus({preventScroll:!0}),M.current=null,W.current=!1)}},[X.current]),V.createElement("section",{ref:e,"aria-label":`${w} ${I}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},E.map((G,ne)=>{var se;let[Re,Be]=G.split("-");return S.length?V.createElement("ol",{key:G,dir:y==="auto"?gv():y,tabIndex:-1,ref:X,className:a,"data-sonner-toaster":!0,"data-theme":J,"data-y-position":Re,"data-lifted":L&&S.length>1&&!s,"data-x-position":Be,style:{"--front-toast-height":`${((se=x[0])==null?void 0:se.height)||0}px`,"--width":`${R1}px`,"--gap":`${m}px`,...f,...N1(l,c)},onBlur:me=>{W.current&&!me.currentTarget.contains(me.relatedTarget)&&(W.current=!1,M.current&&(M.current.focus({preventScroll:!0}),M.current=null))},onFocus:me=>{me.target instanceof HTMLElement&&me.target.dataset.dismissible==="false"||W.current||(W.current=!0,M.current=me.relatedTarget)},onMouseEnter:()=>j(!0),onMouseMove:()=>j(!0),onMouseLeave:()=>{K||j(!1)},onDragEnd:()=>j(!1),onPointerDown:me=>{me.target instanceof HTMLElement&&me.target.dataset.dismissible==="false"||B(!0)},onPointerUp:()=>B(!1)},S.filter(me=>!me.position&&ne===0||me.position===G).map((me,is)=>{var ki,Sr;return V.createElement(M1,{key:me.id,icons:b,index:is,toast:me,defaultRichColors:d,duration:(ki=p==null?void 0:p.duration)!=null?ki:h,className:p==null?void 0:p.className,descriptionClassName:p==null?void 0:p.descriptionClassName,invert:n,visibleToasts:v,closeButton:(Sr=p==null?void 0:p.closeButton)!=null?Sr:o,interacting:K,position:G,style:p==null?void 0:p.style,unstyled:p==null?void 0:p.unstyled,classNames:p==null?void 0:p.classNames,cancelButtonStyle:p==null?void 0:p.cancelButtonStyle,actionButtonStyle:p==null?void 0:p.actionButtonStyle,removeToast:Y,toasts:S.filter(Si=>Si.position==me.position),heights:x.filter(Si=>Si.position==me.position),setHeights:R,expandByDefault:s,gap:m,loadingIcon:g,expanded:L,pauseWhenPageIsHidden:k,swipeDirections:t.swipeDirections})})):null}))});const j1=({...t})=>{const{theme:e="system"}=c1();return A.jsx(L1,{theme:e,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...t})},U1=["top","right","bottom","left"],hr=Math.min,Mt=Math.max,Dc=Math.round,El=Math.floor,$n=t=>({x:t,y:t}),F1={left:"right",right:"left",bottom:"top",top:"bottom"},B1={start:"end",end:"start"};function nf(t,e,n){return Mt(t,hr(e,n))}function gi(t,e){return typeof t=="function"?t(e):t}function vi(t){return t.split("-")[0]}function wo(t){return t.split("-")[1]}function em(t){return t==="x"?"y":"x"}function tm(t){return t==="y"?"height":"width"}const $1=new Set(["top","bottom"]);function Un(t){return $1.has(vi(t))?"y":"x"}function nm(t){return em(Un(t))}function V1(t,e,n){n===void 0&&(n=!1);const i=wo(t),r=nm(t),s=tm(r);let o=r==="x"?i===(n?"end":"start")?"right":"left":i==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=Mc(o)),[o,Mc(o)]}function z1(t){const e=Mc(t);return[rf(t),e,rf(e)]}function rf(t){return t.replace(/start|end/g,e=>B1[e])}const vv=["left","right"],yv=["right","left"],q1=["top","bottom"],W1=["bottom","top"];function H1(t,e,n){switch(t){case"top":case"bottom":return n?e?yv:vv:e?vv:yv;case"left":case"right":return e?q1:W1;default:return[]}}function K1(t,e,n,i){const r=wo(t);let s=H1(vi(t),n==="start",i);return r&&(s=s.map(o=>o+"-"+r),e&&(s=s.concat(s.map(rf)))),s}function Mc(t){return t.replace(/left|right|bottom|top/g,e=>F1[e])}function G1(t){return{top:0,right:0,bottom:0,left:0,...t}}function Tk(t){return typeof t!="number"?G1(t):{top:t,right:t,bottom:t,left:t}}function Nc(t){const{x:e,y:n,width:i,height:r}=t;return{width:i,height:r,top:n,left:e,right:e+i,bottom:n+r,x:e,y:n}}function bv(t,e,n){let{reference:i,floating:r}=t;const s=Un(e),o=nm(e),a=tm(o),l=vi(e),c=s==="y",u=i.x+i.width/2-r.width/2,d=i.y+i.height/2-r.height/2,h=i[a]/2-r[a]/2;let f;switch(l){case"top":f={x:u,y:i.y-r.height};break;case"bottom":f={x:u,y:i.y+i.height};break;case"right":f={x:i.x+i.width,y:d};break;case"left":f={x:i.x-r.width,y:d};break;default:f={x:i.x,y:i.y}}switch(wo(e)){case"start":f[o]-=h*(n&&c?-1:1);break;case"end":f[o]+=h*(n&&c?-1:1);break}return f}const J1=async(t,e,n)=>{const{placement:i="bottom",strategy:r="absolute",middleware:s=[],platform:o}=n,a=s.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:t,floating:e,strategy:r}),{x:u,y:d}=bv(c,i,l),h=i,f={},v=0;for(let p=0;p<a.length;p++){const{name:y,fn:m}=a[p],{x:g,y:b,data:w,reset:k}=await m({x:u,y:d,initialPlacement:i,placement:h,strategy:r,middlewareData:f,rects:c,platform:o,elements:{reference:t,floating:e}});u=g??u,d=b??d,f={...f,[y]:{...f[y],...w}},k&&v<=50&&(v++,typeof k=="object"&&(k.placement&&(h=k.placement),k.rects&&(c=k.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:r}):k.rects),{x:u,y:d}=bv(c,h,l)),p=-1)}return{x:u,y:d,placement:h,strategy:r,middlewareData:f}};async function Aa(t,e){var n;e===void 0&&(e={});const{x:i,y:r,platform:s,rects:o,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:f=0}=gi(e,t),v=Tk(f),y=a[h?d==="floating"?"reference":"floating":d],m=Nc(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(y)))==null||n?y:y.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),g=d==="floating"?{x:i,y:r,width:o.floating.width,height:o.floating.height}:o.reference,b=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),w=await(s.isElement==null?void 0:s.isElement(b))?await(s.getScale==null?void 0:s.getScale(b))||{x:1,y:1}:{x:1,y:1},k=Nc(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:g,offsetParent:b,strategy:l}):g);return{top:(m.top-k.top+v.top)/w.y,bottom:(k.bottom-m.bottom+v.bottom)/w.y,left:(m.left-k.left+v.left)/w.x,right:(k.right-m.right+v.right)/w.x}}const Q1=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:i,placement:r,rects:s,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=gi(t,e)||{};if(c==null)return{};const d=Tk(u),h={x:n,y:i},f=nm(r),v=tm(f),p=await o.getDimensions(c),y=f==="y",m=y?"top":"left",g=y?"bottom":"right",b=y?"clientHeight":"clientWidth",w=s.reference[v]+s.reference[f]-h[f]-s.floating[v],k=h[f]-s.reference[f],S=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let _=S?S[b]:0;(!_||!await(o.isElement==null?void 0:o.isElement(S)))&&(_=a.floating[b]||s.floating[v]);const E=w/2-k/2,x=_/2-p[v]/2-1,R=hr(d[m],x),L=hr(d[g],x),j=R,K=_-p[v]-L,B=_/2-p[v]/2+E,J=nf(j,B,K),Q=!l.arrow&&wo(r)!=null&&B!==J&&s.reference[v]/2-(B<j?R:L)-p[v]/2<0,X=Q?B<j?B-j:B-K:0;return{[f]:h[f]+X,data:{[f]:J,centerOffset:B-J-X,...Q&&{alignmentOffset:X}},reset:Q}}}),Y1=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,i;const{placement:r,middlewareData:s,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:v="none",flipAlignment:p=!0,...y}=gi(t,e);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const m=vi(r),g=Un(a),b=vi(a)===a,w=await(l.isRTL==null?void 0:l.isRTL(c.floating)),k=h||(b||!p?[Mc(a)]:z1(a)),S=v!=="none";!h&&S&&k.push(...K1(a,p,v,w));const _=[a,...k],E=await Aa(e,y),x=[];let R=((i=s.flip)==null?void 0:i.overflows)||[];if(u&&x.push(E[m]),d){const B=V1(r,o,w);x.push(E[B[0]],E[B[1]])}if(R=[...R,{placement:r,overflows:x}],!x.every(B=>B<=0)){var L,j;const B=(((L=s.flip)==null?void 0:L.index)||0)+1,J=_[B];if(J&&(!(d==="alignment"?g!==Un(J):!1)||R.every(I=>I.overflows[0]>0&&Un(I.placement)===g)))return{data:{index:B,overflows:R},reset:{placement:J}};let Q=(j=R.filter(X=>X.overflows[0]<=0).sort((X,I)=>X.overflows[1]-I.overflows[1])[0])==null?void 0:j.placement;if(!Q)switch(f){case"bestFit":{var K;const X=(K=R.filter(I=>{if(S){const M=Un(I.placement);return M===g||M==="y"}return!0}).map(I=>[I.placement,I.overflows.filter(M=>M>0).reduce((M,W)=>M+W,0)]).sort((I,M)=>I[1]-M[1])[0])==null?void 0:K[0];X&&(Q=X);break}case"initialPlacement":Q=a;break}if(r!==Q)return{reset:{placement:Q}}}return{}}}};function wv(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function kv(t){return U1.some(e=>t[e]>=0)}const X1=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:i="referenceHidden",...r}=gi(t,e);switch(i){case"referenceHidden":{const s=await Aa(e,{...r,elementContext:"reference"}),o=wv(s,n.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:kv(o)}}}case"escaped":{const s=await Aa(e,{...r,altBoundary:!0}),o=wv(s,n.floating);return{data:{escapedOffsets:o,escaped:kv(o)}}}default:return{}}}}},Ck=new Set(["left","top"]);async function Z1(t,e){const{placement:n,platform:i,elements:r}=t,s=await(i.isRTL==null?void 0:i.isRTL(r.floating)),o=vi(n),a=wo(n),l=Un(n)==="y",c=Ck.has(o)?-1:1,u=s&&l?-1:1,d=gi(e,t);let{mainAxis:h,crossAxis:f,alignmentAxis:v}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof v=="number"&&(f=a==="end"?v*-1:v),l?{x:f*u,y:h*c}:{x:h*c,y:f*u}}const eR=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,i;const{x:r,y:s,placement:o,middlewareData:a}=e,l=await Z1(e,t);return o===((n=a.offset)==null?void 0:n.placement)&&(i=a.arrow)!=null&&i.alignmentOffset?{}:{x:r+l.x,y:s+l.y,data:{...l,placement:o}}}}},tR=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:i,placement:r}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:y=>{let{x:m,y:g}=y;return{x:m,y:g}}},...l}=gi(t,e),c={x:n,y:i},u=await Aa(e,l),d=Un(vi(r)),h=em(d);let f=c[h],v=c[d];if(s){const y=h==="y"?"top":"left",m=h==="y"?"bottom":"right",g=f+u[y],b=f-u[m];f=nf(g,f,b)}if(o){const y=d==="y"?"top":"left",m=d==="y"?"bottom":"right",g=v+u[y],b=v-u[m];v=nf(g,v,b)}const p=a.fn({...e,[h]:f,[d]:v});return{...p,data:{x:p.x-n,y:p.y-i,enabled:{[h]:s,[d]:o}}}}}},nR=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:i,placement:r,rects:s,middlewareData:o}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=gi(t,e),u={x:n,y:i},d=Un(r),h=em(d);let f=u[h],v=u[d];const p=gi(a,e),y=typeof p=="number"?{mainAxis:p,crossAxis:0}:{mainAxis:0,crossAxis:0,...p};if(l){const b=h==="y"?"height":"width",w=s.reference[h]-s.floating[b]+y.mainAxis,k=s.reference[h]+s.reference[b]-y.mainAxis;f<w?f=w:f>k&&(f=k)}if(c){var m,g;const b=h==="y"?"width":"height",w=Ck.has(vi(r)),k=s.reference[d]-s.floating[b]+(w&&((m=o.offset)==null?void 0:m[d])||0)+(w?0:y.crossAxis),S=s.reference[d]+s.reference[b]+(w?0:((g=o.offset)==null?void 0:g[d])||0)-(w?y.crossAxis:0);v<k?v=k:v>S&&(v=S)}return{[h]:f,[d]:v}}}},iR=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,i;const{placement:r,rects:s,platform:o,elements:a}=e,{apply:l=()=>{},...c}=gi(t,e),u=await Aa(e,c),d=vi(r),h=wo(r),f=Un(r)==="y",{width:v,height:p}=s.floating;let y,m;d==="top"||d==="bottom"?(y=d,m=h===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(m=d,y=h==="end"?"top":"bottom");const g=p-u.top-u.bottom,b=v-u.left-u.right,w=hr(p-u[y],g),k=hr(v-u[m],b),S=!e.middlewareData.shift;let _=w,E=k;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(E=b),(i=e.middlewareData.shift)!=null&&i.enabled.y&&(_=g),S&&!h){const R=Mt(u.left,0),L=Mt(u.right,0),j=Mt(u.top,0),K=Mt(u.bottom,0);f?E=v-2*(R!==0||L!==0?R+L:Mt(u.left,u.right)):_=p-2*(j!==0||K!==0?j+K:Mt(u.top,u.bottom))}await l({...e,availableWidth:E,availableHeight:_});const x=await o.getDimensions(a.floating);return v!==x.width||p!==x.height?{reset:{rects:!0}}:{}}}};function Cu(){return typeof window<"u"}function ko(t){return _k(t)?(t.nodeName||"").toLowerCase():"#document"}function Ut(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function Hn(t){var e;return(e=(_k(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function _k(t){return Cu()?t instanceof Node||t instanceof Ut(t).Node:!1}function Cn(t){return Cu()?t instanceof Element||t instanceof Ut(t).Element:!1}function zn(t){return Cu()?t instanceof HTMLElement||t instanceof Ut(t).HTMLElement:!1}function Sv(t){return!Cu()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Ut(t).ShadowRoot}const rR=new Set(["inline","contents"]);function Xa(t){const{overflow:e,overflowX:n,overflowY:i,display:r}=_n(t);return/auto|scroll|overlay|hidden|clip/.test(e+i+n)&&!rR.has(r)}const sR=new Set(["table","td","th"]);function oR(t){return sR.has(ko(t))}const aR=[":popover-open",":modal"];function _u(t){return aR.some(e=>{try{return t.matches(e)}catch{return!1}})}const lR=["transform","translate","scale","rotate","perspective"],cR=["transform","translate","scale","rotate","perspective","filter"],uR=["paint","layout","strict","content"];function im(t){const e=rm(),n=Cn(t)?_n(t):t;return lR.some(i=>n[i]?n[i]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||cR.some(i=>(n.willChange||"").includes(i))||uR.some(i=>(n.contain||"").includes(i))}function dR(t){let e=fr(t);for(;zn(e)&&!uo(e);){if(im(e))return e;if(_u(e))return null;e=fr(e)}return null}function rm(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const hR=new Set(["html","body","#document"]);function uo(t){return hR.has(ko(t))}function _n(t){return Ut(t).getComputedStyle(t)}function Eu(t){return Cn(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function fr(t){if(ko(t)==="html")return t;const e=t.assignedSlot||t.parentNode||Sv(t)&&t.host||Hn(t);return Sv(e)?e.host:e}function Ek(t){const e=fr(t);return uo(e)?t.ownerDocument?t.ownerDocument.body:t.body:zn(e)&&Xa(e)?e:Ek(e)}function Da(t,e,n){var i;e===void 0&&(e=[]),n===void 0&&(n=!0);const r=Ek(t),s=r===((i=t.ownerDocument)==null?void 0:i.body),o=Ut(r);if(s){const a=sf(o);return e.concat(o,o.visualViewport||[],Xa(r)?r:[],a&&n?Da(a):[])}return e.concat(r,Da(r,[],n))}function sf(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function Pk(t){const e=_n(t);let n=parseFloat(e.width)||0,i=parseFloat(e.height)||0;const r=zn(t),s=r?t.offsetWidth:n,o=r?t.offsetHeight:i,a=Dc(n)!==s||Dc(i)!==o;return a&&(n=s,i=o),{width:n,height:i,$:a}}function sm(t){return Cn(t)?t:t.contextElement}function $s(t){const e=sm(t);if(!zn(e))return $n(1);const n=e.getBoundingClientRect(),{width:i,height:r,$:s}=Pk(e);let o=(s?Dc(n.width):n.width)/i,a=(s?Dc(n.height):n.height)/r;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const fR=$n(0);function xk(t){const e=Ut(t);return!rm()||!e.visualViewport?fR:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function pR(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==Ut(t)?!1:e}function Gr(t,e,n,i){e===void 0&&(e=!1),n===void 0&&(n=!1);const r=t.getBoundingClientRect(),s=sm(t);let o=$n(1);e&&(i?Cn(i)&&(o=$s(i)):o=$s(t));const a=pR(s,n,i)?xk(s):$n(0);let l=(r.left+a.x)/o.x,c=(r.top+a.y)/o.y,u=r.width/o.x,d=r.height/o.y;if(s){const h=Ut(s),f=i&&Cn(i)?Ut(i):i;let v=h,p=sf(v);for(;p&&i&&f!==v;){const y=$s(p),m=p.getBoundingClientRect(),g=_n(p),b=m.left+(p.clientLeft+parseFloat(g.paddingLeft))*y.x,w=m.top+(p.clientTop+parseFloat(g.paddingTop))*y.y;l*=y.x,c*=y.y,u*=y.x,d*=y.y,l+=b,c+=w,v=Ut(p),p=sf(v)}}return Nc({width:u,height:d,x:l,y:c})}function om(t,e){const n=Eu(t).scrollLeft;return e?e.left+n:Gr(Hn(t)).left+n}function Rk(t,e,n){n===void 0&&(n=!1);const i=t.getBoundingClientRect(),r=i.left+e.scrollLeft-(n?0:om(t,i)),s=i.top+e.scrollTop;return{x:r,y:s}}function mR(t){let{elements:e,rect:n,offsetParent:i,strategy:r}=t;const s=r==="fixed",o=Hn(i),a=e?_u(e.floating):!1;if(i===o||a&&s)return n;let l={scrollLeft:0,scrollTop:0},c=$n(1);const u=$n(0),d=zn(i);if((d||!d&&!s)&&((ko(i)!=="body"||Xa(o))&&(l=Eu(i)),zn(i))){const f=Gr(i);c=$s(i),u.x=f.x+i.clientLeft,u.y=f.y+i.clientTop}const h=o&&!d&&!s?Rk(o,l,!0):$n(0);return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+u.x+h.x,y:n.y*c.y-l.scrollTop*c.y+u.y+h.y}}function gR(t){return Array.from(t.getClientRects())}function vR(t){const e=Hn(t),n=Eu(t),i=t.ownerDocument.body,r=Mt(e.scrollWidth,e.clientWidth,i.scrollWidth,i.clientWidth),s=Mt(e.scrollHeight,e.clientHeight,i.scrollHeight,i.clientHeight);let o=-n.scrollLeft+om(t);const a=-n.scrollTop;return _n(i).direction==="rtl"&&(o+=Mt(e.clientWidth,i.clientWidth)-r),{width:r,height:s,x:o,y:a}}function yR(t,e){const n=Ut(t),i=Hn(t),r=n.visualViewport;let s=i.clientWidth,o=i.clientHeight,a=0,l=0;if(r){s=r.width,o=r.height;const c=rm();(!c||c&&e==="fixed")&&(a=r.offsetLeft,l=r.offsetTop)}return{width:s,height:o,x:a,y:l}}const bR=new Set(["absolute","fixed"]);function wR(t,e){const n=Gr(t,!0,e==="fixed"),i=n.top+t.clientTop,r=n.left+t.clientLeft,s=zn(t)?$s(t):$n(1),o=t.clientWidth*s.x,a=t.clientHeight*s.y,l=r*s.x,c=i*s.y;return{width:o,height:a,x:l,y:c}}function Tv(t,e,n){let i;if(e==="viewport")i=yR(t,n);else if(e==="document")i=vR(Hn(t));else if(Cn(e))i=wR(e,n);else{const r=xk(t);i={x:e.x-r.x,y:e.y-r.y,width:e.width,height:e.height}}return Nc(i)}function Ik(t,e){const n=fr(t);return n===e||!Cn(n)||uo(n)?!1:_n(n).position==="fixed"||Ik(n,e)}function kR(t,e){const n=e.get(t);if(n)return n;let i=Da(t,[],!1).filter(a=>Cn(a)&&ko(a)!=="body"),r=null;const s=_n(t).position==="fixed";let o=s?fr(t):t;for(;Cn(o)&&!uo(o);){const a=_n(o),l=im(o);!l&&a.position==="fixed"&&(r=null),(s?!l&&!r:!l&&a.position==="static"&&!!r&&bR.has(r.position)||Xa(o)&&!l&&Ik(t,o))?i=i.filter(u=>u!==o):r=a,o=fr(o)}return e.set(t,i),i}function SR(t){let{element:e,boundary:n,rootBoundary:i,strategy:r}=t;const o=[...n==="clippingAncestors"?_u(e)?[]:kR(e,this._c):[].concat(n),i],a=o[0],l=o.reduce((c,u)=>{const d=Tv(e,u,r);return c.top=Mt(d.top,c.top),c.right=hr(d.right,c.right),c.bottom=hr(d.bottom,c.bottom),c.left=Mt(d.left,c.left),c},Tv(e,a,r));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function TR(t){const{width:e,height:n}=Pk(t);return{width:e,height:n}}function CR(t,e,n){const i=zn(e),r=Hn(e),s=n==="fixed",o=Gr(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=$n(0);function c(){l.x=om(r)}if(i||!i&&!s)if((ko(e)!=="body"||Xa(r))&&(a=Eu(e)),i){const f=Gr(e,!0,s,e);l.x=f.x+e.clientLeft,l.y=f.y+e.clientTop}else r&&c();s&&!i&&r&&c();const u=r&&!i&&!s?Rk(r,a):$n(0),d=o.left+a.scrollLeft-l.x-u.x,h=o.top+a.scrollTop-l.y-u.y;return{x:d,y:h,width:o.width,height:o.height}}function Rd(t){return _n(t).position==="static"}function Cv(t,e){if(!zn(t)||_n(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return Hn(t)===n&&(n=n.ownerDocument.body),n}function Ok(t,e){const n=Ut(t);if(_u(t))return n;if(!zn(t)){let r=fr(t);for(;r&&!uo(r);){if(Cn(r)&&!Rd(r))return r;r=fr(r)}return n}let i=Cv(t,e);for(;i&&oR(i)&&Rd(i);)i=Cv(i,e);return i&&uo(i)&&Rd(i)&&!im(i)?n:i||dR(t)||n}const _R=async function(t){const e=this.getOffsetParent||Ok,n=this.getDimensions,i=await n(t.floating);return{reference:CR(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}};function ER(t){return _n(t).direction==="rtl"}const PR={convertOffsetParentRelativeRectToViewportRelativeRect:mR,getDocumentElement:Hn,getClippingRect:SR,getOffsetParent:Ok,getElementRects:_R,getClientRects:gR,getDimensions:TR,getScale:$s,isElement:Cn,isRTL:ER};function Ak(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function xR(t,e){let n=null,i;const r=Hn(t);function s(){var a;clearTimeout(i),(a=n)==null||a.disconnect(),n=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const c=t.getBoundingClientRect(),{left:u,top:d,width:h,height:f}=c;if(a||e(),!h||!f)return;const v=El(d),p=El(r.clientWidth-(u+h)),y=El(r.clientHeight-(d+f)),m=El(u),b={rootMargin:-v+"px "+-p+"px "+-y+"px "+-m+"px",threshold:Mt(0,hr(1,l))||1};let w=!0;function k(S){const _=S[0].intersectionRatio;if(_!==l){if(!w)return o();_?o(!1,_):i=setTimeout(()=>{o(!1,1e-7)},1e3)}_===1&&!Ak(c,t.getBoundingClientRect())&&o(),w=!1}try{n=new IntersectionObserver(k,{...b,root:r.ownerDocument})}catch{n=new IntersectionObserver(k,b)}n.observe(t)}return o(!0),s}function RR(t,e,n,i){i===void 0&&(i={});const{ancestorScroll:r=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=i,c=sm(t),u=r||s?[...c?Da(c):[],...Da(e)]:[];u.forEach(m=>{r&&m.addEventListener("scroll",n,{passive:!0}),s&&m.addEventListener("resize",n)});const d=c&&a?xR(c,n):null;let h=-1,f=null;o&&(f=new ResizeObserver(m=>{let[g]=m;g&&g.target===c&&f&&(f.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var b;(b=f)==null||b.observe(e)})),n()}),c&&!l&&f.observe(c),f.observe(e));let v,p=l?Gr(t):null;l&&y();function y(){const m=Gr(t);p&&!Ak(p,m)&&n(),p=m,v=requestAnimationFrame(y)}return n(),()=>{var m;u.forEach(g=>{r&&g.removeEventListener("scroll",n),s&&g.removeEventListener("resize",n)}),d==null||d(),(m=f)==null||m.disconnect(),f=null,l&&cancelAnimationFrame(v)}}const IR=eR,OR=tR,AR=Y1,DR=iR,MR=X1,_v=Q1,NR=nR,LR=(t,e,n)=>{const i=new Map,r={platform:PR,...n},s={...r.platform,_c:i};return J1(t,e,{...r,platform:s})};var jR=typeof document<"u",UR=function(){},Gl=jR?C.useLayoutEffect:UR;function Lc(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,i,r;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(i=n;i--!==0;)if(!Lc(t[i],e[i]))return!1;return!0}if(r=Object.keys(t),n=r.length,n!==Object.keys(e).length)return!1;for(i=n;i--!==0;)if(!{}.hasOwnProperty.call(e,r[i]))return!1;for(i=n;i--!==0;){const s=r[i];if(!(s==="_owner"&&t.$$typeof)&&!Lc(t[s],e[s]))return!1}return!0}return t!==t&&e!==e}function Dk(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function Ev(t,e){const n=Dk(t);return Math.round(e*n)/n}function Id(t){const e=C.useRef(t);return Gl(()=>{e.current=t}),e}function FR(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:i=[],platform:r,elements:{reference:s,floating:o}={},transform:a=!0,whileElementsMounted:l,open:c}=t,[u,d]=C.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[h,f]=C.useState(i);Lc(h,i)||f(i);const[v,p]=C.useState(null),[y,m]=C.useState(null),g=C.useCallback(I=>{I!==S.current&&(S.current=I,p(I))},[]),b=C.useCallback(I=>{I!==_.current&&(_.current=I,m(I))},[]),w=s||v,k=o||y,S=C.useRef(null),_=C.useRef(null),E=C.useRef(u),x=l!=null,R=Id(l),L=Id(r),j=Id(c),K=C.useCallback(()=>{if(!S.current||!_.current)return;const I={placement:e,strategy:n,middleware:h};L.current&&(I.platform=L.current),LR(S.current,_.current,I).then(M=>{const W={...M,isPositioned:j.current!==!1};B.current&&!Lc(E.current,W)&&(E.current=W,Qa.flushSync(()=>{d(W)}))})},[h,e,n,L,j]);Gl(()=>{c===!1&&E.current.isPositioned&&(E.current.isPositioned=!1,d(I=>({...I,isPositioned:!1})))},[c]);const B=C.useRef(!1);Gl(()=>(B.current=!0,()=>{B.current=!1}),[]),Gl(()=>{if(w&&(S.current=w),k&&(_.current=k),w&&k){if(R.current)return R.current(w,k,K);K()}},[w,k,K,R,x]);const J=C.useMemo(()=>({reference:S,floating:_,setReference:g,setFloating:b}),[g,b]),Q=C.useMemo(()=>({reference:w,floating:k}),[w,k]),X=C.useMemo(()=>{const I={position:n,left:0,top:0};if(!Q.floating)return I;const M=Ev(Q.floating,u.x),W=Ev(Q.floating,u.y);return a?{...I,transform:"translate("+M+"px, "+W+"px)",...Dk(Q.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:M,top:W}},[n,a,Q.floating,u.x,u.y]);return C.useMemo(()=>({...u,update:K,refs:J,elements:Q,floatingStyles:X}),[u,K,J,Q,X])}const BR=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:i,padding:r}=typeof t=="function"?t(n):t;return i&&e(i)?i.current!=null?_v({element:i.current,padding:r}).fn(n):{}:i?_v({element:i,padding:r}).fn(n):{}}}},$R=(t,e)=>({...IR(t),options:[t,e]}),VR=(t,e)=>({...OR(t),options:[t,e]}),zR=(t,e)=>({...NR(t),options:[t,e]}),qR=(t,e)=>({...AR(t),options:[t,e]}),WR=(t,e)=>({...DR(t),options:[t,e]}),HR=(t,e)=>({...MR(t),options:[t,e]}),KR=(t,e)=>({...BR(t),options:[t,e]});var GR="Arrow",Mk=C.forwardRef((t,e)=>{const{children:n,width:i=10,height:r=5,...s}=t;return A.jsx(At.svg,{...s,ref:e,width:i,height:r,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:A.jsx("polygon",{points:"0,0 30,0 15,10"})})});Mk.displayName=GR;var JR=Mk;function QR(t){const[e,n]=C.useState(void 0);return dr(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const i=new ResizeObserver(r=>{if(!Array.isArray(r)||!r.length)return;const s=r[0];let o,a;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;o=c.inlineSize,a=c.blockSize}else o=t.offsetWidth,a=t.offsetHeight;n({width:o,height:a})});return i.observe(t,{box:"border-box"}),()=>i.unobserve(t)}else n(void 0)},[t]),e}var Nk="Popper",[Lk,jk]=wu(Nk),[PU,Uk]=Lk(Nk),Fk="PopperAnchor",Bk=C.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:i,...r}=t,s=Uk(Fk,n),o=C.useRef(null),a=Tn(e,o);return C.useEffect(()=>{s.onAnchorChange((i==null?void 0:i.current)||o.current)}),i?null:A.jsx(At.div,{...r,ref:a})});Bk.displayName=Fk;var am="PopperContent",[YR,XR]=Lk(am),$k=C.forwardRef((t,e)=>{var me,is,ki,Sr,Si,rs;const{__scopePopper:n,side:i="bottom",sideOffset:r=0,align:s="center",alignOffset:o=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:h=!1,updatePositionStrategy:f="optimized",onPlaced:v,...p}=t,y=Uk(am,n),[m,g]=C.useState(null),b=Tn(e,Ti=>g(Ti)),[w,k]=C.useState(null),S=QR(w),_=(S==null?void 0:S.width)??0,E=(S==null?void 0:S.height)??0,x=i+(s!=="center"?"-"+s:""),R=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},L=Array.isArray(c)?c:[c],j=L.length>0,K={padding:R,boundary:L.filter(eI),altBoundary:j},{refs:B,floatingStyles:J,placement:Q,isPositioned:X,middlewareData:I}=FR({strategy:"fixed",placement:x,whileElementsMounted:(...Ti)=>RR(...Ti,{animationFrame:f==="always"}),elements:{reference:y.anchor},middleware:[$R({mainAxis:r+E,alignmentAxis:o}),l&&VR({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?zR():void 0,...K}),l&&qR({...K}),WR({...K,apply:({elements:Ti,rects:nl,availableWidth:Gu,availableHeight:il})=>{const{width:Ju,height:Co}=nl.reference,ss=Ti.floating.style;ss.setProperty("--radix-popper-available-width",`${Gu}px`),ss.setProperty("--radix-popper-available-height",`${il}px`),ss.setProperty("--radix-popper-anchor-width",`${Ju}px`),ss.setProperty("--radix-popper-anchor-height",`${Co}px`)}}),w&&KR({element:w,padding:a}),tI({arrowWidth:_,arrowHeight:E}),h&&HR({strategy:"referenceHidden",...K})]}),[M,W]=qk(Q),Y=ur(v);dr(()=>{X&&(Y==null||Y())},[X,Y]);const G=(me=I.arrow)==null?void 0:me.x,ne=(is=I.arrow)==null?void 0:is.y,se=((ki=I.arrow)==null?void 0:ki.centerOffset)!==0,[Re,Be]=C.useState();return dr(()=>{m&&Be(window.getComputedStyle(m).zIndex)},[m]),A.jsx("div",{ref:B.setFloating,"data-radix-popper-content-wrapper":"",style:{...J,transform:X?J.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Re,"--radix-popper-transform-origin":[(Sr=I.transformOrigin)==null?void 0:Sr.x,(Si=I.transformOrigin)==null?void 0:Si.y].join(" "),...((rs=I.hide)==null?void 0:rs.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:A.jsx(YR,{scope:n,placedSide:M,onArrowChange:k,arrowX:G,arrowY:ne,shouldHideArrow:se,children:A.jsx(At.div,{"data-side":M,"data-align":W,...p,ref:b,style:{...p.style,animation:X?void 0:"none"}})})})});$k.displayName=am;var Vk="PopperArrow",ZR={top:"bottom",right:"left",bottom:"top",left:"right"},zk=C.forwardRef(function(e,n){const{__scopePopper:i,...r}=e,s=XR(Vk,i),o=ZR[s.placedSide];return A.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:A.jsx(JR,{...r,ref:n,style:{...r.style,display:"block"}})})});zk.displayName=Vk;function eI(t){return t!==null}var tI=t=>({name:"transformOrigin",options:t,fn(e){var y,m,g;const{placement:n,rects:i,middlewareData:r}=e,o=((y=r.arrow)==null?void 0:y.centerOffset)!==0,a=o?0:t.arrowWidth,l=o?0:t.arrowHeight,[c,u]=qk(n),d={start:"0%",center:"50%",end:"100%"}[u],h=(((m=r.arrow)==null?void 0:m.x)??0)+a/2,f=(((g=r.arrow)==null?void 0:g.y)??0)+l/2;let v="",p="";return c==="bottom"?(v=o?d:`${h}px`,p=`${-l}px`):c==="top"?(v=o?d:`${h}px`,p=`${i.floating.height+l}px`):c==="right"?(v=`${-l}px`,p=o?d:`${f}px`):c==="left"&&(v=`${i.floating.width+l}px`,p=o?d:`${f}px`),{data:{x:v,y:p}}}});function qk(t){const[e,n="center"]=t.split("-");return[e,n]}var nI=Bk,iI=$k,rI=zk,[Pu,xU]=wu("Tooltip",[jk]),lm=jk(),Wk="TooltipProvider",sI=700,Pv="tooltip.open",[oI,Hk]=Pu(Wk),Kk=t=>{const{__scopeTooltip:e,delayDuration:n=sI,skipDelayDuration:i=300,disableHoverableContent:r=!1,children:s}=t,o=C.useRef(!0),a=C.useRef(!1),l=C.useRef(0);return C.useEffect(()=>{const c=l.current;return()=>window.clearTimeout(c)},[]),A.jsx(oI,{scope:e,isOpenDelayedRef:o,delayDuration:n,onOpen:C.useCallback(()=>{window.clearTimeout(l.current),o.current=!1},[]),onClose:C.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>o.current=!0,i)},[i]),isPointerInTransitRef:a,onPointerInTransitChange:C.useCallback(c=>{a.current=c},[]),disableHoverableContent:r,children:s})};Kk.displayName=Wk;var Gk="Tooltip",[RU,xu]=Pu(Gk),of="TooltipTrigger",aI=C.forwardRef((t,e)=>{const{__scopeTooltip:n,...i}=t,r=xu(of,n),s=Hk(of,n),o=lm(n),a=C.useRef(null),l=Tn(e,a,r.onTriggerChange),c=C.useRef(!1),u=C.useRef(!1),d=C.useCallback(()=>c.current=!1,[]);return C.useEffect(()=>()=>document.removeEventListener("pointerup",d),[d]),A.jsx(nI,{asChild:!0,...o,children:A.jsx(At.button,{"aria-describedby":r.open?r.contentId:void 0,"data-state":r.stateAttribute,...i,ref:l,onPointerMove:Ke(t.onPointerMove,h=>{h.pointerType!=="touch"&&!u.current&&!s.isPointerInTransitRef.current&&(r.onTriggerEnter(),u.current=!0)}),onPointerLeave:Ke(t.onPointerLeave,()=>{r.onTriggerLeave(),u.current=!1}),onPointerDown:Ke(t.onPointerDown,()=>{r.open&&r.onClose(),c.current=!0,document.addEventListener("pointerup",d,{once:!0})}),onFocus:Ke(t.onFocus,()=>{c.current||r.onOpen()}),onBlur:Ke(t.onBlur,r.onClose),onClick:Ke(t.onClick,r.onClose)})})});aI.displayName=of;var lI="TooltipPortal",[IU,cI]=Pu(lI,{forceMount:void 0}),ho="TooltipContent",Jk=C.forwardRef((t,e)=>{const n=cI(ho,t.__scopeTooltip),{forceMount:i=n.forceMount,side:r="top",...s}=t,o=xu(ho,t.__scopeTooltip);return A.jsx(Jp,{present:i||o.open,children:o.disableHoverableContent?A.jsx(Qk,{side:r,...s,ref:e}):A.jsx(uI,{side:r,...s,ref:e})})}),uI=C.forwardRef((t,e)=>{const n=xu(ho,t.__scopeTooltip),i=Hk(ho,t.__scopeTooltip),r=C.useRef(null),s=Tn(e,r),[o,a]=C.useState(null),{trigger:l,onClose:c}=n,u=r.current,{onPointerInTransitChange:d}=i,h=C.useCallback(()=>{a(null),d(!1)},[d]),f=C.useCallback((v,p)=>{const y=v.currentTarget,m={x:v.clientX,y:v.clientY},g=mI(m,y.getBoundingClientRect()),b=gI(m,g),w=vI(p.getBoundingClientRect()),k=bI([...b,...w]);a(k),d(!0)},[d]);return C.useEffect(()=>()=>h(),[h]),C.useEffect(()=>{if(l&&u){const v=y=>f(y,u),p=y=>f(y,l);return l.addEventListener("pointerleave",v),u.addEventListener("pointerleave",p),()=>{l.removeEventListener("pointerleave",v),u.removeEventListener("pointerleave",p)}}},[l,u,f,h]),C.useEffect(()=>{if(o){const v=p=>{const y=p.target,m={x:p.clientX,y:p.clientY},g=(l==null?void 0:l.contains(y))||(u==null?void 0:u.contains(y)),b=!yI(m,o);g?h():b&&(h(),c())};return document.addEventListener("pointermove",v),()=>document.removeEventListener("pointermove",v)}},[l,u,o,c,h]),A.jsx(Qk,{...t,ref:s})}),[dI,hI]=Pu(Gk,{isInside:!1}),fI=PP("TooltipContent"),Qk=C.forwardRef((t,e)=>{const{__scopeTooltip:n,children:i,"aria-label":r,onEscapeKeyDown:s,onPointerDownOutside:o,...a}=t,l=xu(ho,n),c=lm(n),{onClose:u}=l;return C.useEffect(()=>(document.addEventListener(Pv,u),()=>document.removeEventListener(Pv,u)),[u]),C.useEffect(()=>{if(l.trigger){const d=h=>{const f=h.target;f!=null&&f.contains(l.trigger)&&u()};return window.addEventListener("scroll",d,{capture:!0}),()=>window.removeEventListener("scroll",d,{capture:!0})}},[l.trigger,u]),A.jsx(Gp,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:s,onPointerDownOutside:o,onFocusOutside:d=>d.preventDefault(),onDismiss:u,children:A.jsxs(iI,{"data-state":l.stateAttribute,...c,...a,ref:e,style:{...a.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[A.jsx(fI,{children:i}),A.jsx(dI,{scope:n,isInside:!0,children:A.jsx(XP,{id:l.contentId,role:"tooltip",children:r||i})})]})})});Jk.displayName=ho;var Yk="TooltipArrow",pI=C.forwardRef((t,e)=>{const{__scopeTooltip:n,...i}=t,r=lm(n);return hI(Yk,n).isInside?null:A.jsx(rI,{...r,...i,ref:e})});pI.displayName=Yk;function mI(t,e){const n=Math.abs(e.top-t.y),i=Math.abs(e.bottom-t.y),r=Math.abs(e.right-t.x),s=Math.abs(e.left-t.x);switch(Math.min(n,i,r,s)){case s:return"left";case r:return"right";case n:return"top";case i:return"bottom";default:throw new Error("unreachable")}}function gI(t,e,n=5){const i=[];switch(e){case"top":i.push({x:t.x-n,y:t.y+n},{x:t.x+n,y:t.y+n});break;case"bottom":i.push({x:t.x-n,y:t.y-n},{x:t.x+n,y:t.y-n});break;case"left":i.push({x:t.x+n,y:t.y-n},{x:t.x+n,y:t.y+n});break;case"right":i.push({x:t.x-n,y:t.y-n},{x:t.x-n,y:t.y+n});break}return i}function vI(t){const{top:e,right:n,bottom:i,left:r}=t;return[{x:r,y:e},{x:n,y:e},{x:n,y:i},{x:r,y:i}]}function yI(t,e){const{x:n,y:i}=t;let r=!1;for(let s=0,o=e.length-1;s<e.length;o=s++){const a=e[s],l=e[o],c=a.x,u=a.y,d=l.x,h=l.y;u>i!=h>i&&n<(d-c)*(i-u)/(h-u)+c&&(r=!r)}return r}function bI(t){const e=t.slice();return e.sort((n,i)=>n.x<i.x?-1:n.x>i.x?1:n.y<i.y?-1:n.y>i.y?1:0),wI(e)}function wI(t){if(t.length<=1)return t.slice();const e=[];for(let i=0;i<t.length;i++){const r=t[i];for(;e.length>=2;){const s=e[e.length-1],o=e[e.length-2];if((s.x-o.x)*(r.y-o.y)>=(s.y-o.y)*(r.x-o.x))e.pop();else break}e.push(r)}e.pop();const n=[];for(let i=t.length-1;i>=0;i--){const r=t[i];for(;n.length>=2;){const s=n[n.length-1],o=n[n.length-2];if((s.x-o.x)*(r.y-o.y)>=(s.y-o.y)*(r.x-o.x))n.pop();else break}n.push(r)}return n.pop(),e.length===1&&n.length===1&&e[0].x===n[0].x&&e[0].y===n[0].y?e:e.concat(n)}var kI=Kk,Xk=Jk;const SI=kI,TI=C.forwardRef(({className:t,sideOffset:e=4,...n},i)=>A.jsx(Xk,{ref:i,sideOffset:e,className:yr("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n}));TI.displayName=Xk.displayName;var Ru=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Iu=typeof window>"u"||"Deno"in globalThis;function un(){}function CI(t,e){return typeof t=="function"?t(e):t}function _I(t){return typeof t=="number"&&t>=0&&t!==1/0}function EI(t,e){return Math.max(t+(e||0)-Date.now(),0)}function af(t,e){return typeof t=="function"?t(e):t}function PI(t,e){return typeof t=="function"?t(e):t}function xv(t,e){const{type:n="all",exact:i,fetchStatus:r,predicate:s,queryKey:o,stale:a}=t;if(o){if(i){if(e.queryHash!==cm(o,e.options))return!1}else if(!Na(e.queryKey,o))return!1}if(n!=="all"){const l=e.isActive();if(n==="active"&&!l||n==="inactive"&&l)return!1}return!(typeof a=="boolean"&&e.isStale()!==a||r&&r!==e.state.fetchStatus||s&&!s(e))}function Rv(t,e){const{exact:n,status:i,predicate:r,mutationKey:s}=t;if(s){if(!e.options.mutationKey)return!1;if(n){if(Ma(e.options.mutationKey)!==Ma(s))return!1}else if(!Na(e.options.mutationKey,s))return!1}return!(i&&e.state.status!==i||r&&!r(e))}function cm(t,e){return((e==null?void 0:e.queryKeyHashFn)||Ma)(t)}function Ma(t){return JSON.stringify(t,(e,n)=>lf(n)?Object.keys(n).sort().reduce((i,r)=>(i[r]=n[r],i),{}):n)}function Na(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>Na(t[n],e[n])):!1}function Zk(t,e){if(t===e)return t;const n=Iv(t)&&Iv(e);if(n||lf(t)&&lf(e)){const i=n?t:Object.keys(t),r=i.length,s=n?e:Object.keys(e),o=s.length,a=n?[]:{},l=new Set(i);let c=0;for(let u=0;u<o;u++){const d=n?u:s[u];(!n&&l.has(d)||n)&&t[d]===void 0&&e[d]===void 0?(a[d]=void 0,c++):(a[d]=Zk(t[d],e[d]),a[d]===t[d]&&t[d]!==void 0&&c++)}return r===o&&c===r?t:a}return e}function Iv(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function lf(t){if(!Ov(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!Ov(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function Ov(t){return Object.prototype.toString.call(t)==="[object Object]"}function xI(t){return new Promise(e=>{setTimeout(e,t)})}function RI(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?Zk(t,e):e}function II(t,e,n=0){const i=[...t,e];return n&&i.length>n?i.slice(1):i}function OI(t,e,n=0){const i=[e,...t];return n&&i.length>n?i.slice(0,-1):i}var um=Symbol();function eS(t,e){return!t.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!t.queryFn||t.queryFn===um?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}var Nr,Vi,Js,h0,AI=(h0=class extends Ru{constructor(){super();fe(this,Nr);fe(this,Vi);fe(this,Js);ee(this,Js,e=>{if(!Iu&&window.addEventListener){const n=()=>e();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}})}onSubscribe(){O(this,Vi)||this.setEventListener(O(this,Js))}onUnsubscribe(){var e;this.hasListeners()||((e=O(this,Vi))==null||e.call(this),ee(this,Vi,void 0))}setEventListener(e){var n;ee(this,Js,e),(n=O(this,Vi))==null||n.call(this),ee(this,Vi,e(i=>{typeof i=="boolean"?this.setFocused(i):this.onFocus()}))}setFocused(e){O(this,Nr)!==e&&(ee(this,Nr,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(n=>{n(e)})}isFocused(){var e;return typeof O(this,Nr)=="boolean"?O(this,Nr):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},Nr=new WeakMap,Vi=new WeakMap,Js=new WeakMap,h0),tS=new AI,Qs,zi,Ys,f0,DI=(f0=class extends Ru{constructor(){super();fe(this,Qs,!0);fe(this,zi);fe(this,Ys);ee(this,Ys,e=>{if(!Iu&&window.addEventListener){const n=()=>e(!0),i=()=>e(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",i,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",i)}}})}onSubscribe(){O(this,zi)||this.setEventListener(O(this,Ys))}onUnsubscribe(){var e;this.hasListeners()||((e=O(this,zi))==null||e.call(this),ee(this,zi,void 0))}setEventListener(e){var n;ee(this,Ys,e),(n=O(this,zi))==null||n.call(this),ee(this,zi,e(this.setOnline.bind(this)))}setOnline(e){O(this,Qs)!==e&&(ee(this,Qs,e),this.listeners.forEach(i=>{i(e)}))}isOnline(){return O(this,Qs)}},Qs=new WeakMap,zi=new WeakMap,Ys=new WeakMap,f0),jc=new DI;function MI(){let t,e;const n=new Promise((r,s)=>{t=r,e=s});n.status="pending",n.catch(()=>{});function i(r){Object.assign(n,r),delete n.resolve,delete n.reject}return n.resolve=r=>{i({status:"fulfilled",value:r}),t(r)},n.reject=r=>{i({status:"rejected",reason:r}),e(r)},n}function NI(t){return Math.min(1e3*2**t,3e4)}function nS(t){return(t??"online")==="online"?jc.isOnline():!0}var iS=class extends Error{constructor(t){super("CancelledError"),this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}};function Od(t){return t instanceof iS}function rS(t){let e=!1,n=0,i=!1,r;const s=MI(),o=p=>{var y;i||(h(new iS(p)),(y=t.abort)==null||y.call(t))},a=()=>{e=!0},l=()=>{e=!1},c=()=>tS.isFocused()&&(t.networkMode==="always"||jc.isOnline())&&t.canRun(),u=()=>nS(t.networkMode)&&t.canRun(),d=p=>{var y;i||(i=!0,(y=t.onSuccess)==null||y.call(t,p),r==null||r(),s.resolve(p))},h=p=>{var y;i||(i=!0,(y=t.onError)==null||y.call(t,p),r==null||r(),s.reject(p))},f=()=>new Promise(p=>{var y;r=m=>{(i||c())&&p(m)},(y=t.onPause)==null||y.call(t)}).then(()=>{var p;r=void 0,i||(p=t.onContinue)==null||p.call(t)}),v=()=>{if(i)return;let p;const y=n===0?t.initialPromise:void 0;try{p=y??t.fn()}catch(m){p=Promise.reject(m)}Promise.resolve(p).then(d).catch(m=>{var S;if(i)return;const g=t.retry??(Iu?0:3),b=t.retryDelay??NI,w=typeof b=="function"?b(n,m):b,k=g===!0||typeof g=="number"&&n<g||typeof g=="function"&&g(n,m);if(e||!k){h(m);return}n++,(S=t.onFail)==null||S.call(t,n,m),xI(w).then(()=>c()?void 0:f()).then(()=>{e?h(m):v()})})};return{promise:s,cancel:o,continue:()=>(r==null||r(),s),cancelRetry:a,continueRetry:l,canStart:u,start:()=>(u()?v():f().then(v),s)}}var LI=t=>setTimeout(t,0);function jI(){let t=[],e=0,n=a=>{a()},i=a=>{a()},r=LI;const s=a=>{e?t.push(a):r(()=>{n(a)})},o=()=>{const a=t;t=[],a.length&&r(()=>{i(()=>{a.forEach(l=>{n(l)})})})};return{batch:a=>{let l;e++;try{l=a()}finally{e--,e||o()}return l},batchCalls:a=>(...l)=>{s(()=>{a(...l)})},schedule:s,setNotifyFunction:a=>{n=a},setBatchNotifyFunction:a=>{i=a},setScheduler:a=>{r=a}}}var ft=jI(),Lr,p0,sS=(p0=class{constructor(){fe(this,Lr)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),_I(this.gcTime)&&ee(this,Lr,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(Iu?1/0:5*60*1e3))}clearGcTimeout(){O(this,Lr)&&(clearTimeout(O(this,Lr)),ee(this,Lr,void 0))}},Lr=new WeakMap,p0),Xs,jr,Kt,Ur,at,za,Fr,dn,Qn,m0,UI=(m0=class extends sS{constructor(e){super();fe(this,dn);fe(this,Xs);fe(this,jr);fe(this,Kt);fe(this,Ur);fe(this,at);fe(this,za);fe(this,Fr);ee(this,Fr,!1),ee(this,za,e.defaultOptions),this.setOptions(e.options),this.observers=[],ee(this,Ur,e.client),ee(this,Kt,O(this,Ur).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,ee(this,Xs,BI(this.options)),this.state=e.state??O(this,Xs),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=O(this,at))==null?void 0:e.promise}setOptions(e){this.options={...O(this,za),...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&O(this,Kt).remove(this)}setData(e,n){const i=RI(this.state.data,e,this.options);return rt(this,dn,Qn).call(this,{data:i,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),i}setState(e,n){rt(this,dn,Qn).call(this,{type:"setState",state:e,setStateOptions:n})}cancel(e){var i,r;const n=(i=O(this,at))==null?void 0:i.promise;return(r=O(this,at))==null||r.cancel(e),n?n.then(un).catch(un):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(O(this,Xs))}isActive(){return this.observers.some(e=>PI(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===um||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>af(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!EI(this.state.dataUpdatedAt,e)}onFocus(){var n;const e=this.observers.find(i=>i.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(n=O(this,at))==null||n.continue()}onOnline(){var n;const e=this.observers.find(i=>i.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(n=O(this,at))==null||n.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),O(this,Kt).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(O(this,at)&&(O(this,Fr)?O(this,at).cancel({revert:!0}):O(this,at).cancelRetry()),this.scheduleGc()),O(this,Kt).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||rt(this,dn,Qn).call(this,{type:"invalidate"})}fetch(e,n){var c,u,d;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(n!=null&&n.cancelRefetch))this.cancel({silent:!0});else if(O(this,at))return O(this,at).continueRetry(),O(this,at).promise}if(e&&this.setOptions(e),!this.options.queryFn){const h=this.observers.find(f=>f.options.queryFn);h&&this.setOptions(h.options)}const i=new AbortController,r=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(ee(this,Fr,!0),i.signal)})},s=()=>{const h=eS(this.options,n),v=(()=>{const p={client:O(this,Ur),queryKey:this.queryKey,meta:this.meta};return r(p),p})();return ee(this,Fr,!1),this.options.persister?this.options.persister(h,v,this):h(v)},a=(()=>{const h={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:O(this,Ur),state:this.state,fetchFn:s};return r(h),h})();(c=this.options.behavior)==null||c.onFetch(a,this),ee(this,jr,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((u=a.fetchOptions)==null?void 0:u.meta))&&rt(this,dn,Qn).call(this,{type:"fetch",meta:(d=a.fetchOptions)==null?void 0:d.meta});const l=h=>{var f,v,p,y;Od(h)&&h.silent||rt(this,dn,Qn).call(this,{type:"error",error:h}),Od(h)||((v=(f=O(this,Kt).config).onError)==null||v.call(f,h,this),(y=(p=O(this,Kt).config).onSettled)==null||y.call(p,this.state.data,h,this)),this.scheduleGc()};return ee(this,at,rS({initialPromise:n==null?void 0:n.initialPromise,fn:a.fetchFn,abort:i.abort.bind(i),onSuccess:h=>{var f,v,p,y;if(h===void 0){l(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(h)}catch(m){l(m);return}(v=(f=O(this,Kt).config).onSuccess)==null||v.call(f,h,this),(y=(p=O(this,Kt).config).onSettled)==null||y.call(p,h,this.state.error,this),this.scheduleGc()},onError:l,onFail:(h,f)=>{rt(this,dn,Qn).call(this,{type:"failed",failureCount:h,error:f})},onPause:()=>{rt(this,dn,Qn).call(this,{type:"pause"})},onContinue:()=>{rt(this,dn,Qn).call(this,{type:"continue"})},retry:a.options.retry,retryDelay:a.options.retryDelay,networkMode:a.options.networkMode,canRun:()=>!0})),O(this,at).start()}},Xs=new WeakMap,jr=new WeakMap,Kt=new WeakMap,Ur=new WeakMap,at=new WeakMap,za=new WeakMap,Fr=new WeakMap,dn=new WeakSet,Qn=function(e){const n=i=>{switch(e.type){case"failed":return{...i,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...i,fetchStatus:"paused"};case"continue":return{...i,fetchStatus:"fetching"};case"fetch":return{...i,...FI(i.data,this.options),fetchMeta:e.meta??null};case"success":return ee(this,jr,void 0),{...i,data:e.data,dataUpdateCount:i.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const r=e.error;return Od(r)&&r.revert&&O(this,jr)?{...O(this,jr),fetchStatus:"idle"}:{...i,error:r,errorUpdateCount:i.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:i.fetchFailureCount+1,fetchFailureReason:r,fetchStatus:"idle",status:"error"};case"invalidate":return{...i,isInvalidated:!0};case"setState":return{...i,...e.state}}};this.state=n(this.state),ft.batch(()=>{this.observers.forEach(i=>{i.onQueryUpdate()}),O(this,Kt).notify({query:this,type:"updated",action:e})})},m0);function FI(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:nS(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function BI(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,i=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?i??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var Dn,g0,$I=(g0=class extends Ru{constructor(e={}){super();fe(this,Dn);this.config=e,ee(this,Dn,new Map)}build(e,n,i){const r=n.queryKey,s=n.queryHash??cm(r,n);let o=this.get(s);return o||(o=new UI({client:e,queryKey:r,queryHash:s,options:e.defaultQueryOptions(n),state:i,defaultOptions:e.getQueryDefaults(r)}),this.add(o)),o}add(e){O(this,Dn).has(e.queryHash)||(O(this,Dn).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const n=O(this,Dn).get(e.queryHash);n&&(e.destroy(),n===e&&O(this,Dn).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){ft.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return O(this,Dn).get(e)}getAll(){return[...O(this,Dn).values()]}find(e){const n={exact:!0,...e};return this.getAll().find(i=>xv(n,i))}findAll(e={}){const n=this.getAll();return Object.keys(e).length>0?n.filter(i=>xv(e,i)):n}notify(e){ft.batch(()=>{this.listeners.forEach(n=>{n(e)})})}onFocus(){ft.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){ft.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},Dn=new WeakMap,g0),Mn,ut,Br,Nn,Di,v0,VI=(v0=class extends sS{constructor(e){super();fe(this,Nn);fe(this,Mn);fe(this,ut);fe(this,Br);this.mutationId=e.mutationId,ee(this,ut,e.mutationCache),ee(this,Mn,[]),this.state=e.state||zI(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){O(this,Mn).includes(e)||(O(this,Mn).push(e),this.clearGcTimeout(),O(this,ut).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){ee(this,Mn,O(this,Mn).filter(n=>n!==e)),this.scheduleGc(),O(this,ut).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){O(this,Mn).length||(this.state.status==="pending"?this.scheduleGc():O(this,ut).remove(this))}continue(){var e;return((e=O(this,Br))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var s,o,a,l,c,u,d,h,f,v,p,y,m,g,b,w,k,S,_,E;const n=()=>{rt(this,Nn,Di).call(this,{type:"continue"})};ee(this,Br,rS({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(x,R)=>{rt(this,Nn,Di).call(this,{type:"failed",failureCount:x,error:R})},onPause:()=>{rt(this,Nn,Di).call(this,{type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>O(this,ut).canRun(this)}));const i=this.state.status==="pending",r=!O(this,Br).canStart();try{if(i)n();else{rt(this,Nn,Di).call(this,{type:"pending",variables:e,isPaused:r}),await((o=(s=O(this,ut).config).onMutate)==null?void 0:o.call(s,e,this));const R=await((l=(a=this.options).onMutate)==null?void 0:l.call(a,e));R!==this.state.context&&rt(this,Nn,Di).call(this,{type:"pending",context:R,variables:e,isPaused:r})}const x=await O(this,Br).start();return await((u=(c=O(this,ut).config).onSuccess)==null?void 0:u.call(c,x,e,this.state.context,this)),await((h=(d=this.options).onSuccess)==null?void 0:h.call(d,x,e,this.state.context)),await((v=(f=O(this,ut).config).onSettled)==null?void 0:v.call(f,x,null,this.state.variables,this.state.context,this)),await((y=(p=this.options).onSettled)==null?void 0:y.call(p,x,null,e,this.state.context)),rt(this,Nn,Di).call(this,{type:"success",data:x}),x}catch(x){try{throw await((g=(m=O(this,ut).config).onError)==null?void 0:g.call(m,x,e,this.state.context,this)),await((w=(b=this.options).onError)==null?void 0:w.call(b,x,e,this.state.context)),await((S=(k=O(this,ut).config).onSettled)==null?void 0:S.call(k,void 0,x,this.state.variables,this.state.context,this)),await((E=(_=this.options).onSettled)==null?void 0:E.call(_,void 0,x,e,this.state.context)),x}finally{rt(this,Nn,Di).call(this,{type:"error",error:x})}}finally{O(this,ut).runNext(this)}}},Mn=new WeakMap,ut=new WeakMap,Br=new WeakMap,Nn=new WeakSet,Di=function(e){const n=i=>{switch(e.type){case"failed":return{...i,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...i,isPaused:!0};case"continue":return{...i,isPaused:!1};case"pending":return{...i,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...i,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...i,data:void 0,error:e.error,failureCount:i.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),ft.batch(()=>{O(this,Mn).forEach(i=>{i.onMutationUpdate(e)}),O(this,ut).notify({mutation:this,type:"updated",action:e})})},v0);function zI(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var ii,hn,qa,y0,qI=(y0=class extends Ru{constructor(e={}){super();fe(this,ii);fe(this,hn);fe(this,qa);this.config=e,ee(this,ii,new Set),ee(this,hn,new Map),ee(this,qa,0)}build(e,n,i){const r=new VI({mutationCache:this,mutationId:++sl(this,qa)._,options:e.defaultMutationOptions(n),state:i});return this.add(r),r}add(e){O(this,ii).add(e);const n=Pl(e);if(typeof n=="string"){const i=O(this,hn).get(n);i?i.push(e):O(this,hn).set(n,[e])}this.notify({type:"added",mutation:e})}remove(e){if(O(this,ii).delete(e)){const n=Pl(e);if(typeof n=="string"){const i=O(this,hn).get(n);if(i)if(i.length>1){const r=i.indexOf(e);r!==-1&&i.splice(r,1)}else i[0]===e&&O(this,hn).delete(n)}}this.notify({type:"removed",mutation:e})}canRun(e){const n=Pl(e);if(typeof n=="string"){const i=O(this,hn).get(n),r=i==null?void 0:i.find(s=>s.state.status==="pending");return!r||r===e}else return!0}runNext(e){var i;const n=Pl(e);if(typeof n=="string"){const r=(i=O(this,hn).get(n))==null?void 0:i.find(s=>s!==e&&s.state.isPaused);return(r==null?void 0:r.continue())??Promise.resolve()}else return Promise.resolve()}clear(){ft.batch(()=>{O(this,ii).forEach(e=>{this.notify({type:"removed",mutation:e})}),O(this,ii).clear(),O(this,hn).clear()})}getAll(){return Array.from(O(this,ii))}find(e){const n={exact:!0,...e};return this.getAll().find(i=>Rv(n,i))}findAll(e={}){return this.getAll().filter(n=>Rv(e,n))}notify(e){ft.batch(()=>{this.listeners.forEach(n=>{n(e)})})}resumePausedMutations(){const e=this.getAll().filter(n=>n.state.isPaused);return ft.batch(()=>Promise.all(e.map(n=>n.continue().catch(un))))}},ii=new WeakMap,hn=new WeakMap,qa=new WeakMap,y0);function Pl(t){var e;return(e=t.options.scope)==null?void 0:e.id}function Av(t){return{onFetch:(e,n)=>{var u,d,h,f,v;const i=e.options,r=(h=(d=(u=e.fetchOptions)==null?void 0:u.meta)==null?void 0:d.fetchMore)==null?void 0:h.direction,s=((f=e.state.data)==null?void 0:f.pages)||[],o=((v=e.state.data)==null?void 0:v.pageParams)||[];let a={pages:[],pageParams:[]},l=0;const c=async()=>{let p=!1;const y=b=>{Object.defineProperty(b,"signal",{enumerable:!0,get:()=>(e.signal.aborted?p=!0:e.signal.addEventListener("abort",()=>{p=!0}),e.signal)})},m=eS(e.options,e.fetchOptions),g=async(b,w,k)=>{if(p)return Promise.reject();if(w==null&&b.pages.length)return Promise.resolve(b);const _=(()=>{const L={client:e.client,queryKey:e.queryKey,pageParam:w,direction:k?"backward":"forward",meta:e.options.meta};return y(L),L})(),E=await m(_),{maxPages:x}=e.options,R=k?OI:II;return{pages:R(b.pages,E,x),pageParams:R(b.pageParams,w,x)}};if(r&&s.length){const b=r==="backward",w=b?WI:Dv,k={pages:s,pageParams:o},S=w(i,k);a=await g(k,S,b)}else{const b=t??s.length;do{const w=l===0?o[0]??i.initialPageParam:Dv(i,a);if(l>0&&w==null)break;a=await g(a,w),l++}while(l<b)}return a};e.options.persister?e.fetchFn=()=>{var p,y;return(y=(p=e.options).persister)==null?void 0:y.call(p,c,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n)}:e.fetchFn=c}}}function Dv(t,{pages:e,pageParams:n}){const i=e.length-1;return e.length>0?t.getNextPageParam(e[i],e,n[i],n):void 0}function WI(t,{pages:e,pageParams:n}){var i;return e.length>0?(i=t.getPreviousPageParam)==null?void 0:i.call(t,e[0],e,n[0],n):void 0}var De,qi,Wi,Zs,eo,Hi,to,no,b0,HI=(b0=class{constructor(t={}){fe(this,De);fe(this,qi);fe(this,Wi);fe(this,Zs);fe(this,eo);fe(this,Hi);fe(this,to);fe(this,no);ee(this,De,t.queryCache||new $I),ee(this,qi,t.mutationCache||new qI),ee(this,Wi,t.defaultOptions||{}),ee(this,Zs,new Map),ee(this,eo,new Map),ee(this,Hi,0)}mount(){sl(this,Hi)._++,O(this,Hi)===1&&(ee(this,to,tS.subscribe(async t=>{t&&(await this.resumePausedMutations(),O(this,De).onFocus())})),ee(this,no,jc.subscribe(async t=>{t&&(await this.resumePausedMutations(),O(this,De).onOnline())})))}unmount(){var t,e;sl(this,Hi)._--,O(this,Hi)===0&&((t=O(this,to))==null||t.call(this),ee(this,to,void 0),(e=O(this,no))==null||e.call(this),ee(this,no,void 0))}isFetching(t){return O(this,De).findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return O(this,qi).findAll({...t,status:"pending"}).length}getQueryData(t){var n;const e=this.defaultQueryOptions({queryKey:t});return(n=O(this,De).get(e.queryHash))==null?void 0:n.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=O(this,De).build(this,e),i=n.state.data;return i===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(af(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(i))}getQueriesData(t){return O(this,De).findAll(t).map(({queryKey:e,state:n})=>{const i=n.data;return[e,i]})}setQueryData(t,e,n){const i=this.defaultQueryOptions({queryKey:t}),r=O(this,De).get(i.queryHash),s=r==null?void 0:r.state.data,o=CI(e,s);if(o!==void 0)return O(this,De).build(this,i).setData(o,{...n,manual:!0})}setQueriesData(t,e,n){return ft.batch(()=>O(this,De).findAll(t).map(({queryKey:i})=>[i,this.setQueryData(i,e,n)]))}getQueryState(t){var n;const e=this.defaultQueryOptions({queryKey:t});return(n=O(this,De).get(e.queryHash))==null?void 0:n.state}removeQueries(t){const e=O(this,De);ft.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=O(this,De);return ft.batch(()=>(n.findAll(t).forEach(i=>{i.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},i=ft.batch(()=>O(this,De).findAll(t).map(r=>r.cancel(n)));return Promise.all(i).then(un).catch(un)}invalidateQueries(t,e={}){return ft.batch(()=>(O(this,De).findAll(t).forEach(n=>{n.invalidate()}),(t==null?void 0:t.refetchType)==="none"?Promise.resolve():this.refetchQueries({...t,type:(t==null?void 0:t.refetchType)??(t==null?void 0:t.type)??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},i=ft.batch(()=>O(this,De).findAll(t).filter(r=>!r.isDisabled()&&!r.isStatic()).map(r=>{let s=r.fetch(void 0,n);return n.throwOnError||(s=s.catch(un)),r.state.fetchStatus==="paused"?Promise.resolve():s}));return Promise.all(i).then(un)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=O(this,De).build(this,e);return n.isStaleByTime(af(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(un).catch(un)}fetchInfiniteQuery(t){return t.behavior=Av(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(un).catch(un)}ensureInfiniteQueryData(t){return t.behavior=Av(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return jc.isOnline()?O(this,qi).resumePausedMutations():Promise.resolve()}getQueryCache(){return O(this,De)}getMutationCache(){return O(this,qi)}getDefaultOptions(){return O(this,Wi)}setDefaultOptions(t){ee(this,Wi,t)}setQueryDefaults(t,e){O(this,Zs).set(Ma(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...O(this,Zs).values()],n={};return e.forEach(i=>{Na(t,i.queryKey)&&Object.assign(n,i.defaultOptions)}),n}setMutationDefaults(t,e){O(this,eo).set(Ma(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...O(this,eo).values()],n={};return e.forEach(i=>{Na(t,i.mutationKey)&&Object.assign(n,i.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...O(this,Wi).queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=cm(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===um&&(e.enabled=!1),e}defaultMutationOptions(t){return t!=null&&t._defaulted?t:{...O(this,Wi).mutations,...(t==null?void 0:t.mutationKey)&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){O(this,De).clear(),O(this,qi).clear()}},De=new WeakMap,qi=new WeakMap,Wi=new WeakMap,Zs=new WeakMap,eo=new WeakMap,Hi=new WeakMap,to=new WeakMap,no=new WeakMap,b0),KI=C.createContext(void 0),GI=({client:t,children:e})=>(C.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),A.jsx(KI.Provider,{value:t,children:e}));/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Uc(){return Uc=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Uc.apply(this,arguments)}var Ji;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Ji||(Ji={}));const Mv="popstate";function JI(t){t===void 0&&(t={});function e(i,r){let{pathname:s,search:o,hash:a}=i.location;return cf("",{pathname:s,search:o,hash:a},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function n(i,r){return typeof r=="string"?r:aS(r)}return YI(e,n,null,t)}function Ot(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function oS(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function QI(){return Math.random().toString(36).substr(2,8)}function Nv(t,e){return{usr:t.state,key:t.key,idx:e}}function cf(t,e,n,i){return n===void 0&&(n=null),Uc({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Ou(e):e,{state:n,key:e&&e.key||i||QI()})}function aS(t){let{pathname:e="/",search:n="",hash:i=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function Ou(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let i=t.indexOf("?");i>=0&&(e.search=t.substr(i),t=t.substr(0,i)),t&&(e.pathname=t)}return e}function YI(t,e,n,i){i===void 0&&(i={});let{window:r=document.defaultView,v5Compat:s=!1}=i,o=r.history,a=Ji.Pop,l=null,c=u();c==null&&(c=0,o.replaceState(Uc({},o.state,{idx:c}),""));function u(){return(o.state||{idx:null}).idx}function d(){a=Ji.Pop;let y=u(),m=y==null?null:y-c;c=y,l&&l({action:a,location:p.location,delta:m})}function h(y,m){a=Ji.Push;let g=cf(p.location,y,m);c=u()+1;let b=Nv(g,c),w=p.createHref(g);try{o.pushState(b,"",w)}catch(k){if(k instanceof DOMException&&k.name==="DataCloneError")throw k;r.location.assign(w)}s&&l&&l({action:a,location:p.location,delta:1})}function f(y,m){a=Ji.Replace;let g=cf(p.location,y,m);c=u();let b=Nv(g,c),w=p.createHref(g);o.replaceState(b,"",w),s&&l&&l({action:a,location:p.location,delta:0})}function v(y){let m=r.location.origin!=="null"?r.location.origin:r.location.href,g=typeof y=="string"?y:aS(y);return g=g.replace(/ $/,"%20"),Ot(m,"No window.location.(origin|href) available to create URL for href: "+g),new URL(g,m)}let p={get action(){return a},get location(){return t(r,o)},listen(y){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(Mv,d),l=y,()=>{r.removeEventListener(Mv,d),l=null}},createHref(y){return e(r,y)},createURL:v,encodeLocation(y){let m=v(y);return{pathname:m.pathname,search:m.search,hash:m.hash}},push:h,replace:f,go(y){return o.go(y)}};return p}var Lv;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Lv||(Lv={}));function XI(t,e,n){return n===void 0&&(n="/"),ZI(t,e,n,!1)}function ZI(t,e,n,i){let r=typeof e=="string"?Ou(e):e,s=uS(r.pathname||"/",n);if(s==null)return null;let o=lS(t);eO(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let c=dO(s);a=cO(o[l],c,i)}return a}function lS(t,e,n,i){e===void 0&&(e=[]),n===void 0&&(n=[]),i===void 0&&(i="");let r=(s,o,a)=>{let l={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};l.relativePath.startsWith("/")&&(Ot(l.relativePath.startsWith(i),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(i.length));let c=Vs([i,l.relativePath]),u=n.concat(l);s.children&&s.children.length>0&&(Ot(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),lS(s.children,e,u,c)),!(s.path==null&&!s.index)&&e.push({path:c,score:aO(c,s.index),routesMeta:u})};return t.forEach((s,o)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))r(s,o);else for(let l of cS(s.path))r(s,o,l)}),e}function cS(t){let e=t.split("/");if(e.length===0)return[];let[n,...i]=e,r=n.endsWith("?"),s=n.replace(/\?$/,"");if(i.length===0)return r?[s,""]:[s];let o=cS(i.join("/")),a=[];return a.push(...o.map(l=>l===""?s:[s,l].join("/"))),r&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function eO(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:lO(e.routesMeta.map(i=>i.childrenIndex),n.routesMeta.map(i=>i.childrenIndex)))}const tO=/^:[\w-]+$/,nO=3,iO=2,rO=1,sO=10,oO=-2,jv=t=>t==="*";function aO(t,e){let n=t.split("/"),i=n.length;return n.some(jv)&&(i+=oO),e&&(i+=iO),n.filter(r=>!jv(r)).reduce((r,s)=>r+(tO.test(s)?nO:s===""?rO:sO),i)}function lO(t,e){return t.length===e.length&&t.slice(0,-1).every((i,r)=>i===e[r])?t[t.length-1]-e[e.length-1]:0}function cO(t,e,n){let{routesMeta:i}=t,r={},s="/",o=[];for(let a=0;a<i.length;++a){let l=i[a],c=a===i.length-1,u=s==="/"?e:e.slice(s.length)||"/",d=Uv({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),h=l.route;if(!d&&c&&n&&!i[i.length-1].route.index&&(d=Uv({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},u)),!d)return null;Object.assign(r,d.params),o.push({params:r,pathname:Vs([s,d.pathname]),pathnameBase:hO(Vs([s,d.pathnameBase])),route:h}),d.pathnameBase!=="/"&&(s=Vs([s,d.pathnameBase]))}return o}function Uv(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=uO(t.path,t.caseSensitive,t.end),r=e.match(n);if(!r)return null;let s=r[0],o=s.replace(/(.)\/+$/,"$1"),a=r.slice(1);return{params:i.reduce((c,u,d)=>{let{paramName:h,isOptional:f}=u;if(h==="*"){let p=a[d]||"";o=s.slice(0,s.length-p.length).replace(/(.)\/+$/,"$1")}const v=a[d];return f&&!v?c[h]=void 0:c[h]=(v||"").replace(/%2F/g,"/"),c},{}),pathname:s,pathnameBase:o,pattern:t}}function uO(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),oS(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let i=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(i.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(i.push({paramName:"*"}),r+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":t!==""&&t!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),i]}function dO(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return oS(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function uS(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,i=t.charAt(n);return i&&i!=="/"?null:t.slice(n)||"/"}const Vs=t=>t.join("/").replace(/\/\/+/g,"/"),hO=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/");function fO(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const dS=["post","put","patch","delete"];new Set(dS);const pO=["get",...dS];new Set(pO);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Fc(){return Fc=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Fc.apply(this,arguments)}const mO=C.createContext(null),gO=C.createContext(null),hS=C.createContext(null),Au=C.createContext(null),Du=C.createContext({outlet:null,matches:[],isDataRoute:!1}),fS=C.createContext(null);function dm(){return C.useContext(Au)!=null}function pS(){return dm()||Ot(!1),C.useContext(Au).location}function vO(t,e){return yO(t,e)}function yO(t,e,n,i){dm()||Ot(!1);let{navigator:r}=C.useContext(hS),{matches:s}=C.useContext(Du),o=s[s.length-1],a=o?o.params:{};o&&o.pathname;let l=o?o.pathnameBase:"/";o&&o.route;let c=pS(),u;if(e){var d;let y=typeof e=="string"?Ou(e):e;l==="/"||(d=y.pathname)!=null&&d.startsWith(l)||Ot(!1),u=y}else u=c;let h=u.pathname||"/",f=h;if(l!=="/"){let y=l.replace(/^\//,"").split("/");f="/"+h.replace(/^\//,"").split("/").slice(y.length).join("/")}let v=XI(t,{pathname:f}),p=TO(v&&v.map(y=>Object.assign({},y,{params:Object.assign({},a,y.params),pathname:Vs([l,r.encodeLocation?r.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?l:Vs([l,r.encodeLocation?r.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),s,n,i);return e&&p?C.createElement(Au.Provider,{value:{location:Fc({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:Ji.Pop}},p):p}function bO(){let t=PO(),e=fO(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return C.createElement(C.Fragment,null,C.createElement("h2",null,"Unexpected Application Error!"),C.createElement("h3",{style:{fontStyle:"italic"}},e),n?C.createElement("pre",{style:r},n):null,null)}const wO=C.createElement(bO,null);class kO extends C.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?C.createElement(Du.Provider,{value:this.props.routeContext},C.createElement(fS.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function SO(t){let{routeContext:e,match:n,children:i}=t,r=C.useContext(mO);return r&&r.static&&r.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=n.route.id),C.createElement(Du.Provider,{value:e},i)}function TO(t,e,n,i){var r;if(e===void 0&&(e=[]),n===void 0&&(n=null),i===void 0&&(i=null),t==null){var s;if(!n)return null;if(n.errors)t=n.matches;else if((s=i)!=null&&s.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,a=(r=n)==null?void 0:r.errors;if(a!=null){let u=o.findIndex(d=>d.route.id&&(a==null?void 0:a[d.route.id])!==void 0);u>=0||Ot(!1),o=o.slice(0,Math.min(o.length,u+1))}let l=!1,c=-1;if(n&&i&&i.v7_partialHydration)for(let u=0;u<o.length;u++){let d=o[u];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(c=u),d.route.id){let{loaderData:h,errors:f}=n,v=d.route.loader&&h[d.route.id]===void 0&&(!f||f[d.route.id]===void 0);if(d.route.lazy||v){l=!0,c>=0?o=o.slice(0,c+1):o=[o[0]];break}}}return o.reduceRight((u,d,h)=>{let f,v=!1,p=null,y=null;n&&(f=a&&d.route.id?a[d.route.id]:void 0,p=d.route.errorElement||wO,l&&(c<0&&h===0?(v=!0,y=null):c===h&&(v=!0,y=d.route.hydrateFallbackElement||null)));let m=e.concat(o.slice(0,h+1)),g=()=>{let b;return f?b=p:v?b=y:d.route.Component?b=C.createElement(d.route.Component,null):d.route.element?b=d.route.element:b=u,C.createElement(SO,{match:d,routeContext:{outlet:u,matches:m,isDataRoute:n!=null},children:b})};return n&&(d.route.ErrorBoundary||d.route.errorElement||h===0)?C.createElement(kO,{location:n.location,revalidation:n.revalidation,component:p,error:f,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):g()},null)}var uf=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(uf||{});function CO(t){let e=C.useContext(gO);return e||Ot(!1),e}function _O(t){let e=C.useContext(Du);return e||Ot(!1),e}function EO(t){let e=_O(),n=e.matches[e.matches.length-1];return n.route.id||Ot(!1),n.route.id}function PO(){var t;let e=C.useContext(fS),n=CO(uf.UseRouteError),i=EO(uf.UseRouteError);return e!==void 0?e:(t=n.errors)==null?void 0:t[i]}function xO(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function df(t){Ot(!1)}function RO(t){let{basename:e="/",children:n=null,location:i,navigationType:r=Ji.Pop,navigator:s,static:o=!1,future:a}=t;dm()&&Ot(!1);let l=e.replace(/^\/*/,"/"),c=C.useMemo(()=>({basename:l,navigator:s,static:o,future:Fc({v7_relativeSplatPath:!1},a)}),[l,a,s,o]);typeof i=="string"&&(i=Ou(i));let{pathname:u="/",search:d="",hash:h="",state:f=null,key:v="default"}=i,p=C.useMemo(()=>{let y=uS(u,l);return y==null?null:{location:{pathname:y,search:d,hash:h,state:f,key:v},navigationType:r}},[l,u,d,h,f,v,r]);return p==null?null:C.createElement(hS.Provider,{value:c},C.createElement(Au.Provider,{children:n,value:p}))}function IO(t){let{children:e,location:n}=t;return vO(hf(e),n)}new Promise(()=>{});function hf(t,e){e===void 0&&(e=[]);let n=[];return C.Children.forEach(t,(i,r)=>{if(!C.isValidElement(i))return;let s=[...e,r];if(i.type===C.Fragment){n.push.apply(n,hf(i.props.children,s));return}i.type!==df&&Ot(!1),!i.props.index||!i.props.children||Ot(!1);let o={id:i.props.id||s.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(o.children=hf(i.props.children,s)),n.push(o)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const OO="6";try{window.__reactRouterVersion=OO}catch{}const AO="startTransition",Fv=O0[AO];function DO(t){let{basename:e,children:n,future:i,window:r}=t,s=C.useRef();s.current==null&&(s.current=JI({window:r,v5Compat:!0}));let o=s.current,[a,l]=C.useState({action:o.action,location:o.location}),{v7_startTransition:c}=i||{},u=C.useCallback(d=>{c&&Fv?Fv(()=>l(d)):l(d)},[l,c]);return C.useLayoutEffect(()=>o.listen(u),[o,u]),C.useEffect(()=>xO(i),[i]),C.createElement(RO,{basename:e,children:n,location:a.location,navigationType:a.action,navigator:o,future:i})}var Bv;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(Bv||(Bv={}));var $v;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})($v||($v={}));var Vv={};function MO(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var NO=Object.defineProperty,LO=(t,e,n)=>e in t?NO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,zv=(t,e,n)=>LO(t,typeof e!="symbol"?e+"":e,n);let Rt=class{constructor(){zv(this,"_locking"),zv(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}};function Le(t,e){if(!t)throw new Error(e)}const jO=34028234663852886e22,UO=-34028234663852886e22,FO=4294967295,BO=2147483647,$O=-2147483648;function Jl(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>BO||t<$O)throw new Error("invalid int 32: "+t)}function ff(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>FO||t<0)throw new Error("invalid uint 32: "+t)}function mS(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>jO||t<UO))throw new Error("invalid float 32: "+t)}const gS=Symbol("@bufbuild/protobuf/enum-type");function VO(t){const e=t[gS];return Le(e,"missing enum type on enum object"),e}function vS(t,e,n,i){t[gS]=yS(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function yS(t,e,n){const i=Object.create(null),r=Object.create(null),s=[];for(const o of e){const a=bS(o);s.push(a),i[o.name]=a,r[o.no]=a}return{typeName:t,values:s,findName(o){return i[o]},findNumber(o){return r[o]}}}function zO(t,e,n){const i={};for(const r of e){const s=bS(r);i[s.localName]=s.no,i[s.no]=s.localName}return vS(i,t,e),i}function bS(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class hm{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),r=i.runtime.bin,s=r.makeReadOptions(n);return r.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,n){const i=this.getType(),r=i.runtime.json,s=r.makeReadOptions(n);return r.readMessage(i,e,s,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,r=i.makeWriteOptions(e),s=r.writerFactory();return i.writeMessage(this,s,r),s.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function qO(t,e,n,i){var r;const s=(r=i==null?void 0:i.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),o={[s]:function(a){t.util.initFields(this),t.util.initPartial(a,this)}}[s];return Object.setPrototypeOf(o.prototype,new hm),Object.assign(o,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(a,l){return new o().fromBinary(a,l)},fromJson(a,l){return new o().fromJson(a,l)},fromJsonString(a,l){return new o().fromJsonString(a,l)},equals(a,l){return t.util.equals(o,a,l)}}),o}function WO(){let t=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function Ad(t,e,n){for(let s=0;s<28;s=s+7){const o=t>>>s,a=!(!(o>>>7)&&e==0),l=(a?o|128:o)&255;if(n.push(l),!a)return}const i=t>>>28&15|(e&7)<<4,r=!!(e>>3);if(n.push((r?i|128:i)&255),!!r){for(let s=3;s<31;s=s+7){const o=e>>>s,a=!!(o>>>7),l=(a?o|128:o)&255;if(n.push(l),!a)return}n.push(e>>>31&1)}}const Ql=4294967296;function qv(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,r=0;function s(o,a){const l=Number(t.slice(o,a));r*=n,i=i*n+l,i>=Ql&&(r=r+(i/Ql|0),i=i%Ql)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?kS(i,r):fm(i,r)}function HO(t,e){let n=fm(t,e);const i=n.hi&2147483648;i&&(n=kS(n.lo,n.hi));const r=wS(n.lo,n.hi);return i?"-"+r:r}function wS(t,e){if({lo:t,hi:e}=KO(t,e),e<=2097151)return String(Ql*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,r=e>>16&65535;let s=n+i*6777216+r*6710656,o=i+r*8147497,a=r*2;const l=1e7;return s>=l&&(o+=Math.floor(s/l),s%=l),o>=l&&(a+=Math.floor(o/l),o%=l),a.toString()+Wv(o)+Wv(s)}function KO(t,e){return{lo:t>>>0,hi:e>>>0}}function fm(t,e){return{lo:t|0,hi:e|0}}function kS(t,e){return e=~e,t?t=~t+1:e+=1,fm(t,e)}const Wv=t=>{const e=String(t);return"0000000".slice(e.length)+e};function Hv(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function GO(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function JO(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof Vv!="object"||Vv.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(l){const c=typeof l=="bigint"?l:BigInt(l);if(c>s||c<r)throw new Error("int64 invalid: ".concat(l));return c},uParse(l){const c=typeof l=="bigint"?l:BigInt(l);if(c>a||c<o)throw new Error("uint64 invalid: ".concat(l));return c},enc(l){return t.setBigInt64(0,this.parse(l),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(l){return t.setBigInt64(0,this.uParse(l),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(l,c){return t.setInt32(0,l,!0),t.setInt32(4,c,!0),t.getBigInt64(0,!0)},uDec(l,c){return t.setInt32(0,l,!0),t.setInt32(4,c,!0),t.getBigUint64(0,!0)}}}const n=r=>Le(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>Le(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),qv(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),qv(r)},dec(r,s){return HO(r,s)},uDec(r,s){return wS(r,s)}}}const xe=JO();var N;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(N||(N={}));var pr;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(pr||(pr={}));function Ii(t,e,n){if(e===n)return!0;if(t==N.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case N.UINT64:case N.FIXED64:case N.INT64:case N.SFIXED64:case N.SINT64:return e==n}return!1}function fo(t,e){switch(t){case N.BOOL:return!1;case N.UINT64:case N.FIXED64:case N.INT64:case N.SFIXED64:case N.SINT64:return e==0?xe.zero:"0";case N.DOUBLE:case N.FLOAT:return 0;case N.BYTES:return new Uint8Array(0);case N.STRING:return"";default:return 0}}function SS(t,e){switch(t){case N.BOOL:return e===!1;case N.STRING:return e==="";case N.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Fe;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(Fe||(Fe={}));class QO{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(ff(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Jl(e),Hv(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){mS(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){ff(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){Jl(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return Jl(e),e=(e<<1^e>>31)>>>0,Hv(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=xe.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=xe.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=xe.enc(e);return Ad(n.lo,n.hi,this.buf),this}sint64(e){let n=xe.enc(e),i=n.hi>>31,r=n.lo<<1^i,s=(n.hi<<1|n.lo>>>31)^i;return Ad(r,s,this.buf),this}uint64(e){let n=xe.uEnc(e);return Ad(n.lo,n.hi,this.buf),this}}class YO{constructor(e,n){this.varint64=WO,this.uint32=GO,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case Fe.Varint:for(;this.buf[this.pos++]&128;);break;case Fe.Bit64:this.pos+=4;case Fe.Bit32:this.pos+=4;break;case Fe.LengthDelimited:let r=this.uint32();this.pos+=r;break;case Fe.StartGroup:for(;;){const[s,o]=this.tag();if(o===Fe.EndGroup){if(n!==void 0&&s!==n)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return xe.dec(...this.varint64())}uint64(){return xe.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,xe.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return xe.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return xe.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function XO(t,e,n,i){let r;return{typeName:e,extendee:n,get field(){if(!r){const s=typeof i=="function"?i():i;s.name=e.split(".").pop(),s.jsonName="[".concat(e,"]"),r=t.util.newFieldList([s]).list()[0]}return r},runtime:t}}function TS(t){const e=t.field.localName,n=Object.create(null);return n[e]=ZO(t),[n,()=>n[e]]}function ZO(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return fo(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function eA(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let ri="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Mu=[];for(let t=0;t<ri.length;t++)Mu[ri[t].charCodeAt(0)]=t;Mu[45]=ri.indexOf("+");Mu[95]=ri.indexOf("/");const CS={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,r=0,s,o=0;for(let a=0;a<t.length;a++){if(s=Mu[t.charCodeAt(a)],s===void 0)switch(t[a]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:o=s,r=1;break;case 1:n[i++]=o<<2|(s&48)>>4,o=s,r=2;break;case 2:n[i++]=(o&15)<<4|(s&60)>>2,o=s,r=3;break;case 3:n[i++]=(o&3)<<6|s,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,r=0;for(let s=0;s<t.length;s++)switch(i=t[s],n){case 0:e+=ri[i>>2],r=(i&3)<<4,n=1;break;case 1:e+=ri[r|i>>4],r=(i&15)<<2,n=2;break;case 2:e+=ri[r|i>>6],e+=ri[i&63],n=0;break}return n&&(e+=ri[r],e+="=",n==1&&(e+="=")),e}};function tA(t,e,n){ES(e,t);const i=e.runtime.bin.makeReadOptions(n),r=eA(t.getType().runtime.bin.listUnknownFields(t),e.field),[s,o]=TS(e);for(const a of r)e.runtime.bin.readField(s,i.readerFactory(a.data),e.field,a.wireType,i);return o()}function nA(t,e,n,i){ES(e,t);const r=e.runtime.bin.makeReadOptions(i),s=e.runtime.bin.makeWriteOptions(i);if(_S(t,e)){const c=t.getType().runtime.bin.listUnknownFields(t).filter(u=>u.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const u of c)t.getType().runtime.bin.onUnknownField(t,u.no,u.wireType,u.data)}const o=s.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,n,o,s);const l=r.readerFactory(o.finish());for(;l.pos<l.len;){const[c,u]=l.tag(),d=l.skip(u,c);t.getType().runtime.bin.onUnknownField(t,c,u,d)}}function _S(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function ES(t,e){Le(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function PS(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!SS(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function Kv(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?fo(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function si(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(hm.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function xS(t,e){return si(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}N.DOUBLE,N.FLOAT,N.INT64,N.UINT64,N.INT32,N.UINT32,N.BOOL,N.STRING,N.BYTES;const Gv={ignoreUnknownFields:!1},Jv={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function iA(t){return t?Object.assign(Object.assign({},Gv),t):Gv}function rA(t){return t?Object.assign(Object.assign({},Jv),t):Jv}const Bc=Symbol(),Yl=Symbol();function sA(){return{makeReadOptions:iA,makeWriteOptions:rA,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(An(e)));i=i??new t;const r=new Map,s=n.typeRegistry;for(const[o,a]of Object.entries(e)){const l=t.fields.findJsonName(o);if(l){if(l.oneof){if(a===null&&l.kind=="scalar")continue;const c=r.get(l.oneof);if(c!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(l.oneof.name,'" present: "').concat(c,'", "').concat(o,'"'));r.set(l.oneof,o)}Qv(i,a,l,n,t)}else{let c=!1;if(s!=null&&s.findExtension&&o.startsWith("[")&&o.endsWith("]")){const u=s.findExtension(o.substring(1,o.length-1));if(u&&u.extendee.typeName==t.typeName){c=!0;const[d,h]=TS(u);Qv(d,a,u.field,n,u),nA(i,u,h(),n)}}if(!c&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!PS(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!aA(r))continue}const o=r.oneof?t[r.oneof.localName].value:t[r.localName],a=Yv(r,o,e);a!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=a)}const s=e.typeRegistry;if(s!=null&&s.findExtensionFor)for(const o of n.runtime.bin.listUnknownFields(t)){const a=s.findExtensionFor(n.typeName,o.no);if(a&&_S(t,a)){const l=tA(t,a,e),c=Yv(a.field,l,e);c!==void 0&&(i[a.field.jsonName]=c)}}}catch(s){const o=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),a=s instanceof Error?s.message:String(s);throw new Error(o+(a.length>0?": ".concat(a):""))}return i},readScalar(t,e,n){return aa(t,e,n??pr.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||SS(t,e)))return Xl(t,e)},debug:An}}function An(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function Qv(t,e,n,i,r){let s=n.localName;if(n.repeated){if(Le(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(An(e)));const o=t[s];for(const a of e){if(a===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(An(a)));switch(n.kind){case"message":o.push(n.T.fromJson(a,i));break;case"enum":const l=Dd(n.T,a,i.ignoreUnknownFields,!0);l!==Yl&&o.push(l);break;case"scalar":try{o.push(aa(n.T,a,n.L,!0))}catch(c){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(An(a));throw c instanceof Error&&c.message.length>0&&(u+=": ".concat(c.message)),new Error(u)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(An(e)));const o=t[s];for(const[a,l]of Object.entries(e)){if(l===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let c;try{c=oA(n.K,a)}catch(u){let d="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(An(e));throw u instanceof Error&&u.message.length>0&&(d+=": ".concat(u.message)),new Error(d)}switch(n.V.kind){case"message":o[c]=n.V.T.fromJson(l,i);break;case"enum":const u=Dd(n.V.T,l,i.ignoreUnknownFields,!0);u!==Yl&&(o[c]=u);break;case"scalar":try{o[c]=aa(n.V.T,l,pr.BIGINT,!0)}catch(d){let h="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(An(e));throw d instanceof Error&&d.message.length>0&&(h+=": ".concat(d.message)),new Error(h)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:s},s="value"),n.kind){case"message":const o=n.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let a=t[s];si(a)?a.fromJson(e,i):(t[s]=a=o.fromJson(e,i),o.fieldWrapper&&!n.oneof&&(t[s]=o.fieldWrapper.unwrapField(a)));break;case"enum":const l=Dd(n.T,e,i.ignoreUnknownFields,!1);switch(l){case Bc:Kv(n,t);break;case Yl:break;default:t[s]=l;break}break;case"scalar":try{const c=aa(n.T,e,n.L,!1);switch(c){case Bc:Kv(n,t);break;default:t[s]=c;break}}catch(c){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(An(e));throw c instanceof Error&&c.message.length>0&&(u+=": ".concat(c.message)),new Error(u)}break}}function oA(t,e){if(t===N.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return aa(t,e,pr.BIGINT,!0).toString()}function aa(t,e,n,i){if(e===null)return i?fo(t,n):Bc;switch(t){case N.DOUBLE:case N.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==N.FLOAT&&mS(r),r;case N.INT32:case N.FIXED32:case N.SFIXED32:case N.SINT32:case N.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return t==N.UINT32||t==N.FIXED32?ff(s):Jl(s),s;case N.INT64:case N.SFIXED64:case N.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=xe.parse(e);return n?o.toString():o;case N.FIXED64:case N.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=xe.uParse(e);return n?a.toString():a;case N.BOOL:if(typeof e!="boolean")break;return e;case N.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case N.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return CS.dec(e)}throw new Error}function Dd(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:Bc;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return Yl;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(An(e)))}function aA(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function Yv(t,e,n){if(t.kind=="map"){Le(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[o,a]of r)i[o.toString()]=Xl(t.V.T,a);break;case"message":for(const[o,a]of r)i[o.toString()]=a.toJson(n);break;case"enum":const s=t.V.T;for(const[o,a]of r)i[o.toString()]=Md(s,a,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?i:void 0}if(t.repeated){Le(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(Xl(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(Md(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return Xl(t.T,e);case"enum":return Md(t.T,e,n.enumAsInteger);case"message":return xS(t.T,e).toJson(n)}}function Md(t,e,n){var i;if(Le(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(i=r==null?void 0:r.name)!==null&&i!==void 0?i:e}function Xl(t,e){switch(t){case N.INT32:case N.SFIXED32:case N.SINT32:case N.FIXED32:case N.UINT32:return Le(typeof e=="number"),e;case N.FLOAT:case N.DOUBLE:return Le(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case N.STRING:return Le(typeof e=="string"),e;case N.BOOL:return Le(typeof e=="boolean"),e;case N.UINT64:case N.FIXED64:case N.INT64:case N.SFIXED64:case N.SINT64:return Le(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case N.BYTES:return Le(e instanceof Uint8Array),CS.enc(e)}}const us=Symbol("@bufbuild/protobuf/unknown-fields"),Xv={readUnknownFields:!0,readerFactory:t=>new YO(t)},Zv={writeUnknownFields:!0,writerFactory:()=>new QO};function lA(t){return t?Object.assign(Object.assign({},Xv),t):Xv}function cA(t){return t?Object.assign(Object.assign({},Zv),t):Zv}function uA(){return{makeReadOptions:lA,makeWriteOptions:cA,listUnknownFields(t){var e;return(e=t[us])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[us]},writeUnknownFields(t,e){const i=t[us];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,i){const r=t;Array.isArray(r[us])||(r[us]=[]),r[us].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,r){const s=t.getType(),o=r?e.len:e.pos+n;let a,l;for(;e.pos<o&&([a,l]=e.tag(),!(r===!0&&l==Fe.EndGroup));){const c=s.fields.find(a);if(!c){const u=e.skip(l,a);i.readUnknownFields&&this.onUnknownField(t,a,l,u);continue}ey(t,e,c,l,i)}if(r&&(l!=Fe.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:ey,writeMessage(t,e,n){const i=t.getType();for(const r of i.fields.byNumber()){if(!PS(r,t)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const s=r.oneof?t[r.oneof.localName].value:t[r.localName];ty(r,s,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&ty(t,e,n,i)}}}function ey(t,e,n,i,r){let{repeated:s,localName:o}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=o&&delete t.value,t.case=o,o="value"),n.kind){case"scalar":case"enum":const a=n.kind=="enum"?N.INT32:n.T;let l=$c;if(n.kind=="scalar"&&n.L>0&&(l=hA),s){let h=t[o];if(i==Fe.LengthDelimited&&a!=N.STRING&&a!=N.BYTES){let v=e.uint32()+e.pos;for(;e.pos<v;)h.push(l(e,a))}else h.push(l(e,a))}else t[o]=l(e,a);break;case"message":const c=n.T;s?t[o].push(Zl(e,new c,r,n)):si(t[o])?Zl(e,t[o],r,n):(t[o]=Zl(e,new c,r,n),c.fieldWrapper&&!n.oneof&&!n.repeated&&(t[o]=c.fieldWrapper.unwrapField(t[o])));break;case"map":let[u,d]=dA(n,e,r);t[o][u]=d;break}}function Zl(t,e,n,i){const r=e.getType().runtime.bin,s=i==null?void 0:i.delimited;return r.readMessage(e,t,s?i.no:t.uint32(),n,s),e}function dA(t,e,n){const i=e.uint32(),r=e.pos+i;let s,o;for(;e.pos<r;){const[a]=e.tag();switch(a){case 1:s=$c(e,t.K);break;case 2:switch(t.V.kind){case"scalar":o=$c(e,t.V.T);break;case"enum":o=e.int32();break;case"message":o=Zl(e,new t.V.T,n,void 0);break}break}}if(s===void 0&&(s=fo(t.K,pr.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(t.V.kind){case"scalar":o=fo(t.V.T,pr.BIGINT);break;case"enum":o=t.V.T.values[0].no;break;case"message":o=new t.V.T;break}return[s,o]}function hA(t,e){const n=$c(t,e);return typeof n=="bigint"?n.toString():n}function $c(t,e){switch(e){case N.STRING:return t.string();case N.BOOL:return t.bool();case N.DOUBLE:return t.double();case N.FLOAT:return t.float();case N.INT32:return t.int32();case N.INT64:return t.int64();case N.UINT64:return t.uint64();case N.FIXED64:return t.fixed64();case N.BYTES:return t.bytes();case N.FIXED32:return t.fixed32();case N.SFIXED32:return t.sfixed32();case N.SFIXED64:return t.sfixed64();case N.SINT64:return t.sint64();case N.UINT32:return t.uint32();case N.SINT32:return t.sint32()}}function ty(t,e,n,i){Le(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let s=t.kind=="enum"?N.INT32:t.T;if(r)if(Le(Array.isArray(e)),t.packed)pA(n,s,t.no,e);else for(const o of e)la(n,s,t.no,o);else la(n,s,t.no,e);break;case"message":if(r){Le(Array.isArray(e));for(const o of e)ny(n,i,t,o)}else ny(n,i,t,e);break;case"map":Le(typeof e=="object"&&e!=null);for(const[o,a]of Object.entries(e))fA(n,i,t,o,a);break}}function fA(t,e,n,i,r){t.tag(n.no,Fe.LengthDelimited),t.fork();let s=i;switch(n.K){case N.INT32:case N.FIXED32:case N.UINT32:case N.SFIXED32:case N.SINT32:s=Number.parseInt(i);break;case N.BOOL:Le(i=="true"||i=="false"),s=i=="true";break}switch(la(t,n.K,1,s),n.V.kind){case"scalar":la(t,n.V.T,2,r);break;case"enum":la(t,N.INT32,2,r);break;case"message":Le(r!==void 0),t.tag(2,Fe.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function ny(t,e,n,i){const r=xS(n.T,i);n.delimited?t.tag(n.no,Fe.StartGroup).raw(r.toBinary(e)).tag(n.no,Fe.EndGroup):t.tag(n.no,Fe.LengthDelimited).bytes(r.toBinary(e))}function la(t,e,n,i){Le(i!==void 0);let[r,s]=RS(e);t.tag(n,r)[s](i)}function pA(t,e,n,i){if(!i.length)return;t.tag(n,Fe.LengthDelimited).fork();let[,r]=RS(e);for(let s=0;s<i.length;s++)t[r](i[s]);t.join()}function RS(t){let e=Fe.Varint;switch(t){case N.BYTES:case N.STRING:e=Fe.LengthDelimited;break;case N.DOUBLE:case N.FIXED64:case N.SFIXED64:e=Fe.Bit64;break;case N.FIXED32:case N.SFIXED32:case N.FLOAT:e=Fe.Bit32;break}const n=N[t].toLowerCase();return[e,n]}function mA(){return{setEnumType:vS,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const r=i.localName,s=e,o=t;if(o[r]!=null)switch(i.kind){case"oneof":const a=o[r].case;if(a===void 0)continue;const l=i.findField(a);let c=o[r].value;l&&l.kind=="message"&&!si(c,l.T)?c=new l.T(c):l&&l.kind==="scalar"&&l.T===N.BYTES&&(c=Lo(c)),s[r]={case:a,value:c};break;case"scalar":case"enum":let u=o[r];i.T===N.BYTES&&(u=i.repeated?u.map(Lo):Lo(u)),s[r]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===N.BYTES)for(const[f,v]of Object.entries(o[r]))s[r][f]=Lo(v);else Object.assign(s[r],o[r]);break;case"message":const h=i.V.T;for(const f of Object.keys(o[r])){let v=o[r][f];h.fieldWrapper||(v=new h(v)),s[r][f]=v}break}break;case"message":const d=i.T;if(i.repeated)s[r]=o[r].map(h=>si(h,d)?h:new d(h));else{const h=o[r];d.fieldWrapper?d.typeName==="google.protobuf.BytesValue"?s[r]=Lo(h):s[r]=h:s[r]=si(h,d)?h:new d(h)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const r=e[i.localName],s=n[i.localName];if(i.repeated){if(r.length!==s.length)return!1;switch(i.kind){case"message":return r.every((o,a)=>i.T.equals(o,s[a]));case"scalar":return r.every((o,a)=>Ii(i.T,o,s[a]));case"enum":return r.every((o,a)=>Ii(N.INT32,o,s[a]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let o=r,a=s;return i.T.fieldWrapper&&(o!==void 0&&!si(o)&&(o=i.T.fieldWrapper.wrapField(o)),a!==void 0&&!si(a)&&(a=i.T.fieldWrapper.wrapField(a))),i.T.equals(o,a);case"enum":return Ii(N.INT32,r,s);case"scalar":return Ii(i.T,r,s);case"oneof":if(r.case!==s.case)return!1;const l=i.findField(r.case);if(l===void 0)return!0;switch(l.kind){case"message":return l.T.equals(r.value,s.value);case"enum":return Ii(N.INT32,r.value,s.value);case"scalar":return Ii(l.T,r.value,s.value)}throw new Error("oneof cannot contain ".concat(l.kind));case"map":const c=Object.keys(r).concat(Object.keys(s));switch(i.V.kind){case"message":const u=i.V.T;return c.every(h=>u.equals(r[h],s[h]));case"enum":return c.every(h=>Ii(N.INT32,r[h],s[h]));case"scalar":const d=i.V.T;return c.every(h=>Ii(d,r[h],s[h]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const r of e.fields.byMember()){const s=t[r.localName];let o;if(r.repeated)o=s.map(xl);else if(r.kind=="map"){o=i[r.localName];for(const[a,l]of Object.entries(s))o[a]=xl(l)}else r.kind=="oneof"?o=r.findField(s.case)?{case:s.case,value:xl(s.value)}:{case:void 0}:o=xl(s);i[r.localName]=o}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}}function xl(t){if(t===void 0)return t;if(si(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function Lo(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function gA(t,e,n){return{syntax:t,json:sA(),bin:uA(),util:Object.assign(Object.assign({},mA()),{newFieldList:e,initFields:n}),makeMessageType(i,r,s){return qO(this,i,r,s)},makeEnum:zO,makeEnumType:yS,getEnumType:VO,makeExtension(i,r,s){return XO(this,i,r,s)}}}class vA{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function IS(t,e){const n=OS(t);return e?n:TA(SA(n))}function yA(t){return IS(t,!1)}const bA=OS;function OS(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let r=t.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const wA=new Set(["constructor","toString","toJSON","valueOf"]),kA=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),AS=t=>"".concat(t,"$"),SA=t=>kA.has(t)?AS(t):t,TA=t=>wA.has(t)?AS(t):t;class CA{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=yA(e)}addField(e){Le(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function _A(t,e){var n,i,r,s,o,a;const l=[];let c;for(const u of typeof t=="function"?t():t){const d=u;if(d.localName=IS(u.name,u.oneof!==void 0),d.jsonName=(n=u.jsonName)!==null&&n!==void 0?n:bA(u.name),d.repeated=(i=u.repeated)!==null&&i!==void 0?i:!1,u.kind=="scalar"&&(d.L=(r=u.L)!==null&&r!==void 0?r:pr.BIGINT),d.delimited=(s=u.delimited)!==null&&s!==void 0?s:!1,d.req=(o=u.req)!==null&&o!==void 0?o:!1,d.opt=(a=u.opt)!==null&&a!==void 0?a:!1,u.packed===void 0&&(d.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=N.BYTES&&u.T!=N.STRING),u.oneof!==void 0){const h=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!c||c.name!=h)&&(c=new CA(h)),d.oneof=c,c.addField(d)}l.push(d)}return l}const P=gA("proto3",t=>new vA(t,e=>_A(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=fo(e.T,e.L);break}}});class St extends hm{constructor(e){super(),this.seconds=xe.zero,this.nanos=0,P.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(P.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=xe.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return St.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new St({seconds:xe.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new St().fromBinary(e,n)}static fromJson(e,n){return new St().fromJson(e,n)}static fromJsonString(e,n){return new St().fromJsonString(e,n)}static equals(e,n){return P.util.equals(St,e,n)}}St.runtime=P;St.typeName="google.protobuf.Timestamp";St.fields=P.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const EA=P.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:St},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:PA,repeated:!0},{no:5,name:"events",kind:"message",T:RA,repeated:!0}]),PA=P.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:xA,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),xA=P.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:St},{no:3,name:"value",kind:"scalar",T:2}]),RA=P.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:St},{no:7,name:"normalized_end_timestamp",kind:"message",T:St,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),DS=P.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),vn=P.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Ve=P.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),pm=P.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Go=P.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),La=P.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),bn=P.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),ds=P.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),IA=P.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Ye=P.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),Nu=P.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Vc,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:WS}]),Vc=P.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),OA=P.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:P.getEnumType(Ve),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Jr=P.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:P.getEnumType(zs)},{no:4,name:"tracks",kind:"message",T:As,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:OA},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:P.getEnumType(ja)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:P.getEnumType(bn)},{no:18,name:"kind_details",kind:"enum",T:P.getEnumType(AA),repeated:!0}]),zs=P.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),ja=P.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"}]),AA=P.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),Ge=P.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),DA=P.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:sr,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:P.getEnumType(MS)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),As=P.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:P.getEnumType(vn)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:P.getEnumType(Ve)},{no:10,name:"layers",kind:"message",T:sr,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:DA,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:P.getEnumType(Ge)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:WS},{no:19,name:"audio_features",kind:"enum",T:P.getEnumType(Ye),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:P.getEnumType(DS)}]),sr=P.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:P.getEnumType(pm)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),MS=P.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),pt=P.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:P.getEnumType(re)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:mm,oneof:"value"},{no:3,name:"speaker",kind:"message",T:MA,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:US,oneof:"value"},{no:7,name:"transcription",kind:"message",T:NA,oneof:"value"},{no:8,name:"metrics",kind:"message",T:EA,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:zc,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:gm,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:vm,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:ym,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:qc,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Wc,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:Hc,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:NS,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),re=P.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),NS=P.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:P.getEnumType(Ge)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),LS=P.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:mm,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:zc,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:gm,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:vm,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:ym,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:qc,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:Wc,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:Hc,oneof:"value"}]),MA=P.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:jS,repeated:!0}]),jS=P.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),mm=P.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),US=P.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),NA=P.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:LA,repeated:!0}]),LA=P.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),zc=P.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),gm=P.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),vm=P.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),ym=P.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:FS,oneof:"value"}]),FS=P.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),BS=P.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),$S=P.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:P.getEnumType(VS)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),VS=P.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),jA=P.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:P.getEnumType(zS)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),zS=P.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),qS=P.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:iy},{no:2,name:"screen",kind:"message",T:iy},{no:3,name:"resume_connection",kind:"enum",T:P.getEnumType(La)},{no:4,name:"disabled_codecs",kind:"message",T:UA},{no:5,name:"force_relay",kind:"enum",T:P.getEnumType(La)}]),iy=P.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:P.getEnumType(La)}]),UA=P.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Vc,repeated:!0},{no:2,name:"publish",kind:"message",T:Vc,repeated:!0}]),WS=P.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),pf=P.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),HS=P.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:P.getEnumType(pf)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),KS=P.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),qc=P.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:P.getEnumType(Ge)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:HS,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:KS,oneof:"content_header"}],{localName:"DataStream_Header"}),Wc=P.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),Hc=P.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),FA=P.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),yn=P.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),mf=P.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),BA=P.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),$A=P.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Qr,oneof:"message"},{no:2,name:"answer",kind:"message",T:Qr,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Lu,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Kc,oneof:"message"},{no:5,name:"mute",kind:"message",T:ju,oneof:"message"},{no:6,name:"subscription",kind:"message",T:Uu,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:GS,oneof:"message"},{no:8,name:"leave",kind:"message",T:Fu,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:QS,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:ZS,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:eT,oneof:"message"},{no:13,name:"simulate",kind:"message",T:xn,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:km,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:iT,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:wm,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:JS,oneof:"message"}]),ry=P.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:VA,oneof:"message"},{no:2,name:"answer",kind:"message",T:Qr,oneof:"message"},{no:3,name:"offer",kind:"message",T:Qr,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Lu,oneof:"message"},{no:5,name:"update",kind:"message",T:WA,oneof:"message"},{no:6,name:"track_published",kind:"message",T:bm,oneof:"message"},{no:8,name:"leave",kind:"message",T:Fu,oneof:"message"},{no:9,name:"mute",kind:"message",T:ju,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:HA,oneof:"message"},{no:11,name:"room_update",kind:"message",T:KA,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:JA,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:YA,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:ZA,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:tD,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:qA,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:zA,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:iD,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:oD,oneof:"message"},{no:22,name:"request_response",kind:"message",T:aD,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:lD,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:nD,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:cD,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:eD,oneof:"message"}]),gf=P.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:sr,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:P.getEnumType(MS)}]),Kc=P.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:P.getEnumType(vn)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:P.getEnumType(Ve)},{no:9,name:"layers",kind:"message",T:sr,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:gf,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:P.getEnumType(Ge)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:P.getEnumType(DS)},{no:17,name:"audio_features",kind:"enum",T:P.getEnumType(Ye),repeated:!0}]),Lu=P.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:P.getEnumType(yn)},{no:3,name:"final",kind:"scalar",T:8}]),ju=P.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),VA=P.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:Nu},{no:2,name:"participant",kind:"message",T:Jr},{no:3,name:"other_participants",kind:"message",T:Jr,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:YS,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:qS},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:$S},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Vc,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),zA=P.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:YS,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:qS},{no:3,name:"server_info",kind:"message",T:$S},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),bm=P.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:As}]),qA=P.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Qr=P.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13}]),WA=P.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Jr,repeated:!0}]),Uu=P.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:BS,repeated:!0}]),GS=P.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:P.getEnumType(pm)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),wm=P.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:P.getEnumType(Ye),repeated:!0}]),JS=P.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Fu=P.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:P.getEnumType(bn)},{no:3,name:"action",kind:"enum",T:P.getEnumType(qs)},{no:4,name:"regions",kind:"message",T:rD}]),qs=P.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),QS=P.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:sr,repeated:!0}]),km=P.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),YS=P.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),HA=P.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:jS,repeated:!0}]),KA=P.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:Nu}]),GA=P.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:P.getEnumType(Go)},{no:3,name:"score",kind:"scalar",T:2}]),JA=P.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:GA,repeated:!0}]),QA=P.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:P.getEnumType(mf)}]),YA=P.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:QA,repeated:!0}]),Sm=P.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:P.getEnumType(pm)},{no:2,name:"enabled",kind:"scalar",T:8}]),XA=P.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:Sm,repeated:!0}]),ZA=P.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:Sm,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:XA,repeated:!0}]),eD=P.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:FA,repeated:!0}]),XS=P.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),ZS=P.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:XS,repeated:!0}]),tD=P.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),nD=P.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:Nu},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:Jr},{no:4,name:"other_participants",kind:"message",T:Jr,repeated:!0}]),eT=P.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Qr},{no:2,name:"subscription",kind:"message",T:Uu},{no:3,name:"publish_tracks",kind:"message",T:bm,repeated:!0},{no:4,name:"data_channels",kind:"message",T:nT,repeated:!0},{no:5,name:"offer",kind:"message",T:Qr},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:tT,repeated:!0}]),tT=P.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),nT=P.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:P.getEnumType(yn)}]),xn=P.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:P.getEnumType(BA),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),iT=P.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),iD=P.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),rD=P.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:sD,repeated:!0}]),sD=P.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),oD=P.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:P.getEnumType(IA)}]),aD=P.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:P.getEnumType(Tm)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:Lu,oneof:"request"},{no:5,name:"add_track",kind:"message",T:Kc,oneof:"request"},{no:6,name:"mute",kind:"message",T:ju,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:km,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:wm,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:JS,oneof:"request"}]),Tm=P.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),lD=P.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),cD=P.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function uD(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ec={exports:{}},dD=ec.exports,sy;function hD(){return sy||(sy=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(dD,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},o=null;function a(p,y){var m=p[y];if(typeof m.bind=="function")return m.bind(p);try{return Function.prototype.bind.call(m,p)}catch{return function(){return Function.prototype.apply.apply(m,[p,arguments])}}}function l(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(p){return p==="debug"&&(p="log"),typeof console===n?!1:p==="trace"&&i?l:console[p]!==void 0?a(console,p):console.log!==void 0?a(console,"log"):e}function u(){for(var p=this.getLevel(),y=0;y<r.length;y++){var m=r[y];this[m]=y<p?e:this.methodFactory(m,p,this.name)}if(this.log=this.debug,typeof console===n&&p<this.levels.SILENT)return"No console available for logging"}function d(p){return function(){typeof console!==n&&(u.call(this),this[p].apply(this,arguments))}}function h(p,y,m){return c(p)||d.apply(this,arguments)}function f(p,y){var m=this,g,b,w,k="loglevel";typeof p=="string"?k+=":"+p:typeof p=="symbol"&&(k=void 0);function S(L){var j=(r[L]||"silent").toUpperCase();if(!(typeof window===n||!k)){try{window.localStorage[k]=j;return}catch{}try{window.document.cookie=encodeURIComponent(k)+"="+j+";"}catch{}}}function _(){var L;if(!(typeof window===n||!k)){try{L=window.localStorage[k]}catch{}if(typeof L===n)try{var j=window.document.cookie,K=encodeURIComponent(k),B=j.indexOf(K+"=");B!==-1&&(L=/^([^;]+)/.exec(j.slice(B+K.length+1))[1])}catch{}return m.levels[L]===void 0&&(L=void 0),L}}function E(){if(!(typeof window===n||!k)){try{window.localStorage.removeItem(k)}catch{}try{window.document.cookie=encodeURIComponent(k)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function x(L){var j=L;if(typeof j=="string"&&m.levels[j.toUpperCase()]!==void 0&&(j=m.levels[j.toUpperCase()]),typeof j=="number"&&j>=0&&j<=m.levels.SILENT)return j;throw new TypeError("log.setLevel() called with invalid level: "+L)}m.name=p,m.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},m.methodFactory=y||h,m.getLevel=function(){return w??b??g},m.setLevel=function(L,j){return w=x(L),j!==!1&&S(w),u.call(m)},m.setDefaultLevel=function(L){b=x(L),_()||m.setLevel(L,!1)},m.resetLevel=function(){w=null,E(),u.call(m)},m.enableAll=function(L){m.setLevel(m.levels.TRACE,L)},m.disableAll=function(L){m.setLevel(m.levels.SILENT,L)},m.rebuild=function(){if(o!==m&&(g=x(o.getLevel())),u.call(m),o===m)for(var L in s)s[L].rebuild()},g=x(o?o.getLevel():"WARN");var R=_();R!=null&&(w=x(R)),u.call(m)}o=new f,o.getLogger=function(y){if(typeof y!="symbol"&&typeof y!="string"||y==="")throw new TypeError("You must supply a name when creating a logger.");var m=s[y];return m||(m=s[y]=new f(y,o.methodFactory)),m};var v=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=v),o},o.getLoggers=function(){return s},o.default=o,o})}(ec)),ec.exports}var Bu=hD(),vf;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(vf||(vf={}));var En;(function(t){t.Default="livekit",t.Room="livekit-room",t.TokenSource="livekit-token-source",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(En||(En={}));let ae=Bu.getLogger("livekit");Object.values(En).map(t=>Bu.getLogger(t));ae.setDefaultLevel(vf.info);function yi(t){const e=Bu.getLogger(t);return e.setDefaultLevel(ae.getLevel()),e}const fD=Bu.getLogger("lk-e2ee"),jo=7e3,pD=[0,300,2*2*300,3*3*300,4*4*300,jo,jo,jo,jo,jo];class mD{constructor(e){this._retryDelays=e!==void 0?[...e]:pD}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function gD(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function T(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):r(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})}function oy(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function oi(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof oy=="function"?oy(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,l){o=t[s](o),r(a,l,o.done,o.value)})}}function r(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}}var Rl={exports:{}},ay;function vD(){if(ay)return Rl.exports;ay=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(k,S,_){return Function.prototype.apply.call(k,S,_)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(k){return Object.getOwnPropertyNames(k).concat(Object.getOwnPropertySymbols(k))}:n=function(k){return Object.getOwnPropertyNames(k)};function i(w){console&&console.warn&&console.warn(w)}var r=Number.isNaN||function(k){return k!==k};function s(){s.init.call(this)}Rl.exports=s,Rl.exports.once=m,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(w){if(typeof w!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof w)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(w){if(typeof w!="number"||w<0||r(w))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+w+".");o=w}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(k){if(typeof k!="number"||k<0||r(k))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+k+".");return this._maxListeners=k,this};function l(w){return w._maxListeners===void 0?s.defaultMaxListeners:w._maxListeners}s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(k){for(var S=[],_=1;_<arguments.length;_++)S.push(arguments[_]);var E=k==="error",x=this._events;if(x!==void 0)E=E&&x.error===void 0;else if(!E)return!1;if(E){var R;if(S.length>0&&(R=S[0]),R instanceof Error)throw R;var L=new Error("Unhandled error."+(R?" ("+R.message+")":""));throw L.context=R,L}var j=x[k];if(j===void 0)return!1;if(typeof j=="function")e(j,this,S);else for(var K=j.length,B=v(j,K),_=0;_<K;++_)e(B[_],this,S);return!0};function c(w,k,S,_){var E,x,R;if(a(S),x=w._events,x===void 0?(x=w._events=Object.create(null),w._eventsCount=0):(x.newListener!==void 0&&(w.emit("newListener",k,S.listener?S.listener:S),x=w._events),R=x[k]),R===void 0)R=x[k]=S,++w._eventsCount;else if(typeof R=="function"?R=x[k]=_?[S,R]:[R,S]:_?R.unshift(S):R.push(S),E=l(w),E>0&&R.length>E&&!R.warned){R.warned=!0;var L=new Error("Possible EventEmitter memory leak detected. "+R.length+" "+String(k)+" listeners added. Use emitter.setMaxListeners() to increase limit");L.name="MaxListenersExceededWarning",L.emitter=w,L.type=k,L.count=R.length,i(L)}return w}s.prototype.addListener=function(k,S){return c(this,k,S,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(k,S){return c(this,k,S,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(w,k,S){var _={fired:!1,wrapFn:void 0,target:w,type:k,listener:S},E=u.bind(_);return E.listener=S,_.wrapFn=E,E}s.prototype.once=function(k,S){return a(S),this.on(k,d(this,k,S)),this},s.prototype.prependOnceListener=function(k,S){return a(S),this.prependListener(k,d(this,k,S)),this},s.prototype.removeListener=function(k,S){var _,E,x,R,L;if(a(S),E=this._events,E===void 0)return this;if(_=E[k],_===void 0)return this;if(_===S||_.listener===S)--this._eventsCount===0?this._events=Object.create(null):(delete E[k],E.removeListener&&this.emit("removeListener",k,_.listener||S));else if(typeof _!="function"){for(x=-1,R=_.length-1;R>=0;R--)if(_[R]===S||_[R].listener===S){L=_[R].listener,x=R;break}if(x<0)return this;x===0?_.shift():p(_,x),_.length===1&&(E[k]=_[0]),E.removeListener!==void 0&&this.emit("removeListener",k,L||S)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(k){var S,_,E;if(_=this._events,_===void 0)return this;if(_.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):_[k]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete _[k]),this;if(arguments.length===0){var x=Object.keys(_),R;for(E=0;E<x.length;++E)R=x[E],R!=="removeListener"&&this.removeAllListeners(R);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(S=_[k],typeof S=="function")this.removeListener(k,S);else if(S!==void 0)for(E=S.length-1;E>=0;E--)this.removeListener(k,S[E]);return this};function h(w,k,S){var _=w._events;if(_===void 0)return[];var E=_[k];return E===void 0?[]:typeof E=="function"?S?[E.listener||E]:[E]:S?y(E):v(E,E.length)}s.prototype.listeners=function(k){return h(this,k,!0)},s.prototype.rawListeners=function(k){return h(this,k,!1)},s.listenerCount=function(w,k){return typeof w.listenerCount=="function"?w.listenerCount(k):f.call(w,k)},s.prototype.listenerCount=f;function f(w){var k=this._events;if(k!==void 0){var S=k[w];if(typeof S=="function")return 1;if(S!==void 0)return S.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function v(w,k){for(var S=new Array(k),_=0;_<k;++_)S[_]=w[_];return S}function p(w,k){for(;k+1<w.length;k++)w[k]=w[k+1];w.pop()}function y(w){for(var k=new Array(w.length),S=0;S<k.length;++S)k[S]=w[S].listener||w[S];return k}function m(w,k){return new Promise(function(S,_){function E(R){w.removeListener(k,x),_(R)}function x(){typeof w.removeListener=="function"&&w.removeListener("error",E),S([].slice.call(arguments))}b(w,k,x,{once:!0}),k!=="error"&&g(w,E,{once:!0})})}function g(w,k,S){typeof w.on=="function"&&b(w,"error",k,S)}function b(w,k,S,_){if(typeof w.on=="function")_.once?w.once(k,S):w.on(k,S);else if(typeof w.addEventListener=="function")w.addEventListener(k,function E(x){_.once&&w.removeEventListener(k,E),S(x)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof w)}return Rl.exports}var Kn=vD();let rT=!0,sT=!0;function Jo(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function ts(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(o,a){if(o!==e)return r.apply(this,arguments);const l=c=>{const u=n(c);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,l),r.apply(this,[o,l])};const s=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const l=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,l])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function yD(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(rT=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function bD(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(sT=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function oT(){if(typeof window=="object"){if(rT)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Cm(t,e){sT&&console.warn(t+" is deprecated, please use "+e+" instead.")}function wD(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Jo(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Jo(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Jo(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=Jo(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function ly(t){return Object.prototype.toString.call(t)==="[object Object]"}function aT(t){return ly(t)?Object.keys(t).reduce(function(e,n){const i=ly(t[n]),r=i?aT(t[n]):t[n],s=i&&!Object.keys(r).length;return r===void 0||s?e:Object.assign(e,{[n]:r})},{}):t}function yf(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?yf(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{yf(t,t.get(r),n)})}))}function cy(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===i&&a.trackId===o.id&&yf(t,a,r)})}),r}const uy=oT;function lT(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const l={};return Object.keys(a).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const u=typeof a[c]=="object"?a[c]:{ideal:a[c]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(h,f){return h?h+f.charAt(0).toUpperCase()+f.slice(1):f==="deviceId"?"sourceId":f};if(u.ideal!==void 0){l.optional=l.optional||[];let h={};typeof u.ideal=="number"?(h[d("min",c)]=u.ideal,l.optional.push(h),h={},h[d("max",c)]=u.ideal,l.optional.push(h)):(h[d("",c)]=u.ideal,l.optional.push(h))}u.exact!==void 0&&typeof u.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[d("",c)]=u.exact):["min","max"].forEach(h=>{u[h]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[d(h,c)]=u[h])})}),a.advanced&&(l.optional=(l.optional||[]).concat(a.advanced)),l},r=function(a,l){if(e.version>=61)return l(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const c=function(u,d,h){d in u&&!(h in u)&&(u[h]=u[d],delete u[d])};a=JSON.parse(JSON.stringify(a)),c(a.audio,"autoGainControl","googAutoGainControl"),c(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let c=a.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const u=e.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let d;if(c.exact==="environment"||c.ideal==="environment"?d=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(h=>{h=h.filter(v=>v.kind==="videoinput");let f=h.find(v=>d.some(p=>v.label.toLowerCase().includes(p)));return!f&&h.length&&d.includes("back")&&(f=h[h.length-1]),f&&(a.video.deviceId=c.exact?{exact:f.deviceId}:{ideal:f.deviceId}),a.video=i(a.video),uy("chrome: "+JSON.stringify(a)),l(a)})}a.video=i(a.video)}return uy("chrome: "+JSON.stringify(a)),l(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,l,c){r(a,u=>{n.webkitGetUserMedia(u,l,d=>{c&&c(s(d))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return r(l,c=>a(c).then(u=>{if(c.audio&&!u.getAudioTracks().length||c.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function cT(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function uT(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):s={track:r.track};const o=new Event("track");o.track=r.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.id):s={track:r};const o=new Event("track");o.track=r,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else ts(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function dT(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,l){let c=r.apply(this,arguments);return c||(c=e(this,a),this._senders.push(c)),c};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const l=this._senders.indexOf(a);l!==-1&&this._senders.splice(l,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(l=>l.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function hT(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>cy(o,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r}),ts(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>cy(s,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let r,s,o;return this.getSenders().forEach(a=>{a.track===i&&(r?o=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===i&&(s?o=!0:s=a),a.track===i)),o||r&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function fT(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(l)===-1&&this._shimmedLocalStreams[a.id].push(l):this._shimmedLocalStreams[a.id]=[a,l],l};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(c=>{if(this.getSenders().find(d=>d.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(c=>a.indexOf(c)===-1);this._shimmedLocalStreams[o.id]=[o].concat(l)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const l=this._shimmedLocalStreams[a].indexOf(o);l!==-1&&this._shimmedLocalStreams[a].splice(l,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),r.apply(this,arguments)}}function pT(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return fT(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(f=>f.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new t.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}i.apply(this,[u])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(p=>p===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(p=>p.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const v=this._streams[d.id];if(v)v.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const p=new t.MediaStream([u]);this._streams[d.id]=p,this._reverseStreams[p.id]=d,this.addStream(p)}return this.getSenders().find(p=>p.track===u)};function s(c,u){let d=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(h=>{const f=c._reverseStreams[h],v=c._streams[f.id];d=d.replace(new RegExp(v.id,"g"),f.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function o(c,u){let d=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(h=>{const f=c._reverseStreams[h],v=c._streams[f.id];d=d.replace(new RegExp(f.id,"g"),v.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(c){const u=t.RTCPeerConnection.prototype[c],d={[c](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[v=>{const p=s(this,v);h[0].apply(null,[p])},v=>{h[1]&&h[1].apply(null,v)},arguments[2]]):u.apply(this,arguments).then(v=>s(this,v))}};t.RTCPeerConnection.prototype[c]=d[c]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const c=l.get.apply(this);return c.type===""?c:s(this,c)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(f=>{this._streams[f].getTracks().find(p=>u.track===p)&&(h=this._streams[f])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function bf(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function mT(t,e){ts(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var dy=Object.freeze({__proto__:null,fixNegotiationNeeded:mT,shimAddTrackRemoveTrack:pT,shimAddTrackRemoveTrackWithNative:fT,shimGetSendersWithDtmf:dT,shimGetUserMedia:lT,shimMediaStream:cT,shimOnTrack:uT,shimPeerConnection:bf,shimSenderReceiverGetStats:hT});function gT(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,s,o){Cm("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(o,a,l){a in o&&!(l in o)&&(o[l]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),r(o.audio,"autoGainControl","mozAutoGainControl"),r(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return r(a,"mozAutoGainControl","autoGainControl"),r(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a,"autoGainControl","mozAutoGainControl"),r(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function kD(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function vT(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function wf(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=t.RTCPeerConnection.prototype[r],o={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=o[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return i.apply(this,[s||null]).then(l=>{if(e.version<53&&!o)try{l.forEach(c=>{c.type=n[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;l.forEach((u,d)=>{l.set(d,Object.assign({},u,{type:n[u.type]||u.type}))})}return l}).then(o,a)}}function yT(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function bT(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),ts(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function wT(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){Cm("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function kT(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function ST(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(r){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i,o.sendEncodings=i,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function TT(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function CT(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function _T(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var hy=Object.freeze({__proto__:null,shimAddTransceiver:ST,shimCreateAnswer:_T,shimCreateOffer:CT,shimGetDisplayMedia:kD,shimGetParameters:TT,shimGetUserMedia:gT,shimOnTrack:vT,shimPeerConnection:wf,shimRTCDataChannel:kT,shimReceiverGetStats:bT,shimRemoveStream:wT,shimSenderGetStats:yT});function ET(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return s&&s.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const r=n.getTracks();this.getSenders().forEach(s=>{r.includes(s.track)&&this.removeTrack(s)})})}}function PT(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(s=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(s)>=0)return;i._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function xT(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(c,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=n.apply(this,[d]);return u?(h.then(c,u),Promise.resolve()):h},e.createAnswer=function(c,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=i.apply(this,[d]);return u?(h.then(c,u),Promise.resolve()):h};let a=function(l,c,u){const d=r.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d};e.setLocalDescription=a,a=function(l,c,u){const d=s.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d},e.setRemoteDescription=a,a=function(l,c,u){const d=o.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d},e.addIceCandidate=a}function RT(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(IT(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,s){e.mediaDevices.getUserMedia(i).then(r,s)}).bind(e))}function IT(t){return t&&t.video!==void 0?Object.assign({},t,{video:aT(t.video)}):t}function OT(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const s=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];a.urls===void 0&&a.url?(Cm("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(i.iceServers[o])}i.iceServers=s}return new e(i,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function AT(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function DT(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function MT(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var fy=Object.freeze({__proto__:null,shimAudioContext:MT,shimCallbacksAPI:xT,shimConstraints:IT,shimCreateOfferLegacy:DT,shimGetUserMedia:RT,shimLocalStreamsAPI:ET,shimRTCIceServerUrls:OT,shimRemoteStreamsAPI:PT,shimTrackEventTransceiver:AT}),Nd={exports:{}},py;function SD(){return py||(py=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,s)=>(s>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]===void 0&&(r[i[s]]=i[s+1]);break}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const s=n.type;return i.push("typ"),i.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)r=s[o].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},s=n.indexOf(":",i);return s>-1?(r.attribute=n.substring(i+1,s),r.value=n.substring(s+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],s=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");i.profile=s[2];for(let a=3;a<s.length;a++){const l=s[a],c=e.matchPrefix(n,"a=rtpmap:"+l+" ")[0];if(c){const u=e.parseRtpMap(c),d=e.matchPrefix(n,"a=fmtp:"+l+" ");switch(u.parameters=d.length?e.parseFmtp(d[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{i.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(a=>{o.forEach(l=>{a.rtcpFeedback.find(u=>u.type===l.type&&u.parameter===l.parameter)||a.rtcpFeedback.push(l)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(o=>{r+=e.writeRtpMap(o),r+=e.writeFmtp(o),r+=e.writeRtcpFb(o)});let s=0;return i.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(o=>{r+=e.writeExtmap(o)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),s=r.fecMechanisms.indexOf("RED")!==-1,o=r.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(h=>e.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),l=a.length>0&&a[0].ssrc;let c;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(v=>parseInt(v,10)));u.length>0&&u[0].length>1&&u[0][0]===l&&(c=u[0][1]),r.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let f={ssrc:l,codecPayloadType:parseInt(h.parameters.apt,10)};l&&c&&(f.rtx={ssrc:c}),i.push(f),s&&(f=JSON.parse(JSON.stringify(f)),f.fec={ssrc:l,mechanism:o?"red+ulpfec":"red"},i.push(f))}}),i.length===0&&l&&i.push({ssrc:l});let d=e.matchPrefix(n,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substring(5),10)*1e3*.95-50*40*8:d=void 0,i.forEach(h=>{h.maxBitrate=d})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return i.mux=o.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return i=s[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const l=a[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,i){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let s;const o=i!==void 0?i:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e}(Nd)),Nd.exports}var NT=SD(),Ws=uD(NT),TD=MO({__proto__:null,default:Ws},[NT]);function tc(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),s=Ws.parseCandidate(i.candidate);for(const o in s)o in r||Object.defineProperty(r,o,{value:s[o]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,ts(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function kf(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||ts(t,"icecandidate",e=>{if(e.candidate){const n=Ws.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function nc(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const l=Ws.splitSections(a.sdp);return l.shift(),l.some(c=>{const u=Ws.parseMLine(c);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},i=function(a){const l=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const c=parseInt(l[1],10);return c!==c?-1:c},r=function(a){let l=65536;return e.browser==="firefox"&&(e.version<57?a===-1?l=16384:l=2147483637:e.version<60?l=e.version===57?65535:65536:l=2147483637),l},s=function(a,l){let c=65536;e.browser==="firefox"&&e.version===57&&(c=65535);const u=Ws.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?c=parseInt(u[0].substring(19),10):e.browser==="firefox"&&l!==-1&&(c=2147483637),c},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const l=i(arguments[0]),c=r(l),u=s(arguments[0],l);let d;c===0&&u===0?d=Number.POSITIVE_INFINITY:c===0||u===0?d=Math.max(c,u):d=Math.min(c,u);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return d}}),this._sctp=h}return o.apply(this,arguments)}}function ic(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const s=i.send;i.send=function(){const a=arguments[0],l=a.length||a.size||a.byteLength;if(i.readyState==="open"&&r.sctp&&l>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},ts(t,"datachannel",i=>(e(i.channel,i.target),i))}function Sf(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",r);s.dispatchEvent(o)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function Tf(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=r.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:s}):r.sdp=s}return n.apply(this,arguments)}}function rc(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function sc(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var CD=Object.freeze({__proto__:null,removeExtmapAllowMixed:Tf,shimAddIceCandidateNullOrEmpty:rc,shimConnectionState:Sf,shimMaxMessageSize:nc,shimParameterlessSetLocalDescription:sc,shimRTCIceCandidate:tc,shimRTCIceCandidateRelayProtocol:kf,shimSendThrowTypeError:ic});function _D(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=oT,i=wD(t),r={browserDetails:i,commonShim:CD,extractVersion:Jo,disableLog:yD,disableWarnings:bD,sdp:TD};switch(i.browser){case"chrome":if(!dy||!bf||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=dy,rc(t,i),sc(t),lT(t,i),cT(t),bf(t,i),uT(t),pT(t,i),dT(t),hT(t),mT(t,i),tc(t),kf(t),Sf(t),nc(t,i),ic(t),Tf(t,i);break;case"firefox":if(!hy||!wf||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=hy,rc(t,i),sc(t),gT(t,i),wf(t,i),vT(t),wT(t),yT(t),bT(t),kT(t),ST(t),TT(t),CT(t),_T(t),tc(t),Sf(t),nc(t,i),ic(t);break;case"safari":if(!fy||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=fy,rc(t,i),sc(t),OT(t),DT(t),xT(t),ET(t),PT(t),AT(t),RT(t),MT(t),tc(t),kf(t),nc(t,i),ic(t),Tf(t,i);break;default:n("Unsupported browser!");break}return r}_D({window:typeof window>"u"?void 0:window});const ED=10,Uo="lk_e2ee",PD="LKFrameEncryptionKey",xD={sharedKey:!1,ratchetSalt:PD,ratchetWindowSize:8,failureTolerance:ED,keyringSize:16};var or;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(or||(or={}));var my;(function(t){t.KeyRatcheted="keyRatcheted"})(my||(my={}));var Qi;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(Qi||(Qi={}));var gy;(function(t){t.Error="cryptorError"})(gy||(gy={}));function RD(){return ID()||Cf()}function Cf(){return typeof window.RTCRtpScriptTransform<"u"}function ID(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function OD(t){var e,n,i,r,s;if(((e=t.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((n=t.value)===null||n===void 0?void 0:n.case)!=="metrics"&&((i=t.value)===null||i===void 0?void 0:i.case)!=="speaker"&&((r=t.value)===null||r===void 0?void 0:r.case)!=="transcription"&&((s=t.value)===null||s===void 0?void 0:s.case)!=="encryptedPacket")return new LS({value:t.value})}class AU extends Kn.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,r)=>{ae.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},xD),e),this.on(or.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const r={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),r),this.emit(or.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(or.RatchetRequest,e,n)}}class wi extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var de;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout"})(de||(de={}));class be extends wi{constructor(e,n,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=de[n]}}class _m extends wi{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class ai extends wi{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class AD extends wi{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class We extends wi{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class _f extends wi{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class vy extends wi{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class yy extends wi{constructor(e,n){super(15,e),this.reason=n,this.reasonName=typeof n=="string"?n:Tm[n]}}var ht;(function(t){t[t.AlreadyOpened=0]="AlreadyOpened",t[t.AbnormalEnd=1]="AbnormalEnd",t[t.DecodeFailed=2]="DecodeFailed",t[t.LengthExceeded=3]="LengthExceeded",t[t.Incomplete=4]="Incomplete",t[t.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",t[t.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(ht||(ht={}));class Ht extends wi{constructor(e,n){super(16,e),this.name="DataStreamError",this.reason=n,this.reasonName=ht[n]}}var Gc;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(Gc||(Gc={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(Gc||(Gc={}));var by;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(by||(by={}));var U;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(U||(U={}));var q;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(q||(q={}));var z;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(z||(z={}));var $;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})($||($={}));function DD(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}const MD=/version\/(\d+(\.?_?\d+)+)/i;let Ld;function Ft(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(Ld===void 0||e){const i=ND.find(r=>{let{test:s}=r;return s.test(n)});Ld=i==null?void 0:i.describe(n)}return Ld}const ND=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:oc(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:jd(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:oc(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:jd(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:oc(MD,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:jd(t)}}}];function oc(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function jd(t){return t.includes("mac os")?oc(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var LD="2.15.8";const jD=LD,UD=16;class tt{}tt.setTimeout=function(){return setTimeout(...arguments)};tt.setInterval=function(){return setInterval(...arguments)};tt.clearTimeout=function(){return clearTimeout(...arguments)};tt.clearInterval=function(){return clearInterval(...arguments)};const FD=5e3,Fo=[];var Lt;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(Lt||(Lt={}));class D extends Kn.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=D.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=ae,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),FD):this.handleAppVisibilityChanged()},this.log=yi((r=i.loggerName)!==null&&r!==void 0?r:En.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=D.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),le(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===D.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===D.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(Fo.forEach(s=>{s.parentElement===null&&!e&&(e=s)}),e&&Fo.splice(Fo.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),Ds(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(s=>s.kind==="audio");return e.play().then(()=>{this.emit(r?$.AudioPlaybackStarted:$.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(r?$.AudioPlaybackFailed:$.VideoPlaybackFailed,s):s.name==="AbortError"?ae.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):ae.warn("could not playback ".concat(r?"audio":"video"),s),r&&e&&i.some(o=>o.kind==="video")&&s.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit($.ElementAttached,e),e}detach(e){try{if(e){Hs(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit($.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{Hs(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit($.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=yi(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),Fo.forEach(i=>{i.parentElement||(n=!1)}),n&&Fo.push(e)}}handleAppVisibilityChanged(){return T(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===D.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){_t()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){_t()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Ds(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!Xr()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(Xr()||Yr())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function Hs(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(c){c.Audio="audio",c.Video="video",c.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(c){c.Camera="camera",c.Microphone="microphone",c.ScreenShare="screen_share",c.ScreenShareAudio="screen_share_audio",c.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(c){c.Active="active",c.Paused="paused",c.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function r(c){switch(c){case e.Audio:return vn.AUDIO;case e.Video:return vn.VIDEO;default:return vn.DATA}}t.kindToProto=r;function s(c){switch(c){case vn.AUDIO:return e.Audio;case vn.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=s;function o(c){switch(c){case n.Camera:return Ve.CAMERA;case n.Microphone:return Ve.MICROPHONE;case n.ScreenShare:return Ve.SCREEN_SHARE;case n.ScreenShareAudio:return Ve.SCREEN_SHARE_AUDIO;default:return Ve.UNKNOWN}}t.sourceToProto=o;function a(c){switch(c){case Ve.CAMERA:return n.Camera;case Ve.MICROPHONE:return n.Microphone;case Ve.SCREEN_SHARE:return n.ScreenShare;case Ve.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=a;function l(c){switch(c){case mf.ACTIVE:return i.Active;case mf.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=l})(D||(D={}));class ye{constructor(e,n,i,r,s){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:r,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const BD=["vp8","h264"],$D=["vp8","h264","vp9","av1","h265"];function VD(t){return!!BD.find(e=>e===t)}const zD=VD;var wy;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(wy||(wy={}));var Ef;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(Ef||(Ef={}));const Ua={h90:new ye(160,90,9e4,20),h180:new ye(320,180,16e4,20),h216:new ye(384,216,18e4,20),h360:new ye(640,360,45e4,20),h540:new ye(960,540,8e5,25),h720:new ye(1280,720,17e5,30),h1080:new ye(1920,1080,3e6,30),h1440:new ye(2560,1440,5e6,30),h2160:new ye(3840,2160,8e6,30)},Pf={h120:new ye(160,120,7e4,20),h180:new ye(240,180,125e3,20),h240:new ye(320,240,14e4,20),h360:new ye(480,360,33e4,20),h480:new ye(640,480,5e5,20),h540:new ye(720,540,6e5,25),h720:new ye(960,720,13e5,30),h1080:new ye(1440,1080,23e5,30),h1440:new ye(1920,1440,38e5,30)},Em={h360fps3:new ye(640,360,2e5,3,"medium"),h360fps15:new ye(640,360,4e5,15,"medium"),h720fps5:new ye(1280,720,8e5,5,"medium"),h720fps15:new ye(1280,720,15e5,15,"medium"),h720fps30:new ye(1280,720,2e6,30,"medium"),h1080fps15:new ye(1920,1080,25e5,15,"medium"),h1080fps30:new ye(1920,1080,5e6,30,"medium"),original:new ye(0,0,7e6,30,"medium")},qD="|",ky="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function WD(t){const e=t.split(qD);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function It(t){return T(this,void 0,void 0,function*(){return new Promise(e=>tt.setTimeout(e,t))})}function xf(){return"addTransceiver"in RTCPeerConnection.prototype}function Rf(){return"addTrack"in RTCPeerConnection.prototype}function HD(){if(!("getCapabilities"in RTCRtpSender)||Xr()||Yr())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function KD(){if(!("getCapabilities"in RTCRtpSender)||Yr())return!1;if(Xr()){const n=Ft();if(n!=null&&n.version&&Wn(n.version,"16")<0||(n==null?void 0:n.os)==="iOS"&&(n!=null&&n.osVersion)&&Wn(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function jn(t){return t==="av1"||t==="vp9"}function If(t){return!document||Fa()?!1:(t||(t=document.createElement("audio")),"setSinkId"in t)}function GD(){return typeof RTCPeerConnection>"u"?!1:xf()||Rf()}function Yr(){var t;return((t=Ft())===null||t===void 0?void 0:t.name)==="Firefox"}function Xr(){var t;return((t=Ft())===null||t===void 0?void 0:t.name)==="Safari"}function Fa(){const t=Ft();return(t==null?void 0:t.name)==="Safari"||(t==null?void 0:t.os)==="iOS"}function JD(){const t=Ft();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&Wn(t.osVersion,"17")>=0}function QD(t){return t||(t=Ft()),(t==null?void 0:t.name)==="Safari"&&Wn(t.version,"18.3")>0||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&Wn(t.osVersion,"18.3")>0}function LT(){var t,e;return _t()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function YD(){const t=Ft(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&Wn(t.osVersion,e)>=0?!0:t.name==="Safari"&&Wn(t.version,e)>=0}function _t(){return typeof document<"u"}function qn(){return navigator.product=="ReactNative"}function Of(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function jT(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function UT(){if(!qn())return;let t=jT();if(t)return t.platform}function Sy(){if(_t())return window.devicePixelRatio;if(qn()){let t=jT();if(t)return t.devicePixelRatio}return 1}function Wn(t,e){const n=t.split("."),i=e.split("."),r=Math.min(n.length,i.length);for(let s=0;s<r;++s){const o=parseInt(n[s],10),a=parseInt(i[s],10);if(o>a)return 1;if(o<a)return-1;if(s===r-1&&o===a)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function XD(t){for(const e of t)e.target.handleResize(e)}function ZD(t){for(const e of t)e.target.handleVisibilityChanged(e)}let Ud=null;const Ty=()=>(Ud||(Ud=new ResizeObserver(XD)),Ud);let Fd=null;const Cy=()=>(Fd||(Fd=new IntersectionObserver(ZD,{root:null,rootMargin:"0px"})),Fd);function eM(){var t;const e=new jA({sdk:zS.JS,protocol:UD,version:jD});return qn()&&(e.os=(t=UT())!==null&&t!==void 0?t:""),e}function _y(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const s=r.getContext("2d");s==null||s.fillRect(0,0,r.width,r.height),i&&s&&(s.beginPath(),s.arc(t/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=r.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let Bo;function Bd(){if(!Bo){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[Bo]=i.stream.getAudioTracks(),!Bo)throw Error("Could not get empty media stream audio track");Bo.enabled=!1}return Bo.clone()}class Yt{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,r)=>T(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function tM(t){return $D.includes(t)}function ar(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact!==void 0)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal!==void 0)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function nM(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function Af(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function iM(t,e){return t.segments.map(n=>{let{id:i,text:r,language:s,startTime:o,endTime:a,final:l}=n;var c;const u=(c=e.get(i))!==null&&c!==void 0?c:Date.now(),d=Date.now();return l?e.delete(i):e.set(i,u),{id:i,text:r,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:l,language:s,firstReceivedTime:u,lastReceivedTime:d}})}function rM(t){const{id:e,timestamp:n,message:i,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function Ey(t){switch(t.reason){case de.LeaveRequest:return t.context;case de.Cancelled:return bn.CLIENT_INITIATED;case de.NotAllowed:return bn.USER_REJECTED;case de.ServerUnreachable:return bn.JOIN_FAILURE;default:return bn.UNKNOWN_REASON}}function ac(t){return t!==void 0?Number(t):void 0}function Rr(t){return t!==void 0?BigInt(t):void 0}function Ks(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function Vn(t){return!!t&&t.kind==D.Kind.Audio}function br(t){return!!t&&t.kind==D.Kind.Video}function Oi(t){return Ks(t)&&br(t)}function Yn(t){return Ks(t)&&Vn(t)}function Df(t){return!!t&&!t.isLocal}function sM(t){return!!t&&!t.isLocal}function $d(t){return Df(t)&&br(t)}function oM(t){return t.isLocal}function aM(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let r=e;for(;r>0;){const s=i[r];if(s!==void 0&&(s&192)!==128)break;r--}n.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&n.push(i),n}function FT(t,e,n){var i,r,s,o;const{optionsWithoutProcessor:a,audioProcessor:l,videoProcessor:c}=VT(t??{}),u=e==null?void 0:e.processor,d=n==null?void 0:n.processor,h=a??{};return h.audio===!0&&(h.audio={}),h.video===!0&&(h.video={}),h.audio&&(Mf(h.audio,e),(i=(s=h.audio).deviceId)!==null&&i!==void 0||(s.deviceId={ideal:"default"}),(l||u)&&(h.audio.processor=l??u)),h.video&&(Mf(h.video,n),(r=(o=h.video).deviceId)!==null&&r!==void 0||(o.deviceId={ideal:"default"}),(c||d)&&(h.video.processor=c??d)),h}function Mf(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function Pm(t){var e,n,i,r;const s={};if(t.video)if(typeof t.video=="object"){const o={},a=o,l=t.video;Object.keys(l).forEach(c=>{switch(c){case"resolution":Mf(a,l.resolution);break;default:a[c]=l[c]}}),s.video=o,(e=(i=s.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else s.video=t.video?{deviceId:{ideal:"default"}}:!1;else s.video=!1;return t.audio?typeof t.audio=="object"?(s.audio=t.audio,(n=(r=s.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):s.audio={deviceId:{ideal:"default"}}:s.audio=!1,s}function BT(t){return T(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const i=$T();if(i){const r=i.createAnalyser();r.fftSize=2048;const s=r.frequencyBinCount,o=new Uint8Array(s);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield It(n),r.getByteTimeDomainData(o);const l=o.some(c=>c!==128&&c!==0);return i.close(),!l}return!1}()})}function $T(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>T(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(s){console.warn("Error trying to auto-resume audio context",s)}finally{(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)}});n.addEventListener("statechange",()=>{var r;n.state==="closed"&&((r=window.document.body)===null||r===void 0||r.removeEventListener("click",i))}),window.document.body.addEventListener("click",i)}return n}}function lM(t){return t==="audioinput"?D.Source.Microphone:t==="videoinput"?D.Source.Camera:D.Source.Unknown}function Nf(t){return t===D.Source.Microphone?"audioinput":t===D.Source.Camera?"videoinput":void 0}function cM(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,Xr()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function ca(t){return t.split("/")[1].toLowerCase()}function uM(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new bm({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function le(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?le(t.track):{})}}function dM(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function hM(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],r={};for(const s of i)t[s]!==e[s]&&(r[s]=(n=e[s])!==null&&n!==void 0?n:"");return r}function VT(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:DD(e)}}function fM(t){switch(t){case Ve.CAMERA:return D.Source.Camera;case Ve.MICROPHONE:return D.Source.Microphone;case Ve.SCREEN_SHARE:return D.Source.ScreenShare;case Ve.SCREEN_SHARE_AUDIO:return D.Source.ScreenShareAudio;default:return D.Source.Unknown}}function Py(t,e){return t.width*t.height<e.width*e.height}function pM(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(i=>i.quality===e)}class mM extends Kn.EventEmitter{constructor(e,n){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=i=>{var r,s;const{kind:o,data:a}=i.data;switch(o){case"error":ae.error(a.error.message),this.emit(Qi.EncryptionError,a.error);break;case"initAck":a.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)});break;case"enable":if(a.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)}),this.encryptionEnabled!==a.enabled&&a.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(Qi.ParticipantEncryptionStatusChanged,a.enabled,this.room.localParticipant),this.encryptionEnabled=a.enabled;else if(a.participantIdentity){const u=(s=this.room)===null||s===void 0?void 0:s.getParticipantByIdentity(a.participantIdentity);if(!u)throw TypeError("couldn't set encryption status, participant not found".concat(a.participantIdentity));this.emit(Qi.ParticipantEncryptionStatusChanged,a.enabled,u)}break;case"ratchetKey":this.keyProvider.emit(or.KeyRatcheted,a.ratchetResult,a.participantIdentity,a.keyIndex);break;case"decryptDataResponse":const l=this.decryptDataRequests.get(a.uuid);l!=null&&l.resolve&&l.resolve(a);break;case"encryptDataResponse":const c=this.encryptDataRequests.get(a.uuid);c!=null&&c.resolve&&c.resolve(a);break}},this.onWorkerError=i=>{ae.error("e2ee worker encountered an error:",{error:i.error}),this.emit(Qi.EncryptionError,i.error)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=n}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!RD())throw new _m("tried to setup end-to-end encryption on an unsupported browser");if(ae.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:fD.getLevel()}};this.worker&&(ae.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){ae.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?ae.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(z.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(U.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==Ge.NONE,r.identity)),e.on(U.ConnectionStateChanged,i=>{i===pe.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==Ge.NONE,r.identity)})})}).on(U.TrackUnsubscribed,(i,r,s)=>{var o;const a={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:i.mediaStreamID}};(o=this.worker)===null||o===void 0||o.postMessage(a)}).on(U.TrackSubscribed,(i,r,s)=>{this.setupE2EEReceiver(i,s.identity,r.trackInfo)}).on(U.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(q.LocalSenderCreated,(i,r)=>T(this,void 0,void 0,function*(){this.setupE2EESender(r,i)})),e.localParticipant.on(q.LocalTrackPublished,i=>{if(!br(i.track)||!Fa())return;const r={kind:"updateCodec",data:{trackId:i.track.mediaStreamID,codec:ca(i.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}),n.on(or.SetKey,i=>this.postKey(i)).on(or.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}encryptData(e){return T(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const n=crypto.randomUUID(),i={kind:"encryptDataRequest",data:{uuid:n,payload:e,participantIdentity:this.room.localParticipant.identity}},r=new Yt;return r.onFinally=()=>{this.encryptDataRequests.delete(n)},this.encryptDataRequests.set(n,r),this.worker.postMessage(i),r.promise})}handleEncryptedData(e,n,i,r){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const s=crypto.randomUUID(),o={kind:"decryptDataRequest",data:{uuid:s,payload:e,iv:n,participantIdentity:i,keyIndex:r}},a=new Yt;return a.onFinally=()=>{this.decryptDataRequests.delete(s)},this.decryptDataRequests.set(s,a),this.worker.postMessage(o),a.promise}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:r}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(o)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!(i!=null&&i.mimeType)||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?ca(i.mimeType):void 0)}}setupE2EESender(e,n){if(!Ks(e)||!n){n||ae.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,r){return T(this,void 0,void 0,function*(){if(this.worker){if(Cf()){const s={kind:"decode",participantIdentity:i,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(Uo in e&&r){const l={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(l);return}let s=e.writableStream,o=e.readableStream;if(!s||!o){const l=e.createEncodedStreams();e.writableStream=l.writable,s=l.writable,e.readableStream=l.readable,o=l.readable}const a={kind:"decode",data:{readableStream:o,writableStream:s,trackId:n,codec:r,participantIdentity:i,isReuse:Uo in e}};this.worker.postMessage(a,[o,s])}e[Uo]=!0}})}handleSender(e,n,i){var r;if(!(Uo in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Cf()){ae.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{ae.info("initialize encoded streams");const s=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(o,[s.readable,s.writable])}e[Uo]=!0}}}const Vd="default";class Xe{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new Xe),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return T(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;if(((s=Xe.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){ae.debug("awaiting getUserMedia promise");try{n?yield Xe.userMediaPromiseMap.get(n):yield Promise.all(Xe.userMediaPromiseMap.values())}catch{ae.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(r&&!(Xr()&&i.hasDeviceInUse(n))&&(o.filter(l=>l.kind===n).length===0||o.some(l=>{const c=l.label==="",u=n?l.kind===n:!0;return c&&u}))){const l={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},c=yield navigator.mediaDevices.getUserMedia(l);o=yield navigator.mediaDevices.enumerateDevices(),c.getTracks().forEach(u=>{u.stop()})}return i._previousDevices=o,n&&(o=o.filter(a=>a.kind===n)),o}()})}normalizeDeviceId(e,n,i){return T(this,void 0,void 0,function*(){if(n!==Vd)return n;const r=yield this.getDevices(e),s=r.find(a=>a.deviceId===Vd);if(!s){ae.warn("could not reliably determine default device");return}const o=r.find(a=>a.deviceId!==Vd&&a.groupId===(i??s.groupId));if(!o){ae.warn("could not reliably determine default device");return}return o==null?void 0:o.deviceId})}hasDeviceInUse(e){return e?Xe.userMediaPromiseMap.has(e):Xe.userMediaPromiseMap.size>0}}Xe.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];Xe.userMediaPromiseMap=new Map;var ua;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(ua||(ua={}));class gM{constructor(){this.pendingTasks=new Map,this.taskMutex=new Rt,this.nextTaskIndex=0}run(e){return T(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:ua.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=ua.RUNNING,yield e()}finally{n.status=ua.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return T(this,void 0,void 0,function*(){return this.run(()=>T(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}function vM(t,e){const n=new URL(nM(t));return e.forEach((i,r)=>{n.searchParams.set(r,i)}),zT(n,"rtc")}function yM(t){const e=new URL(Af(t));return zT(e,"validate")}function bM(t){return t.endsWith("/")?t:"".concat(t,"/")}function zT(t,e){return t.pathname="".concat(bM(t.pathname)).concat(e),t.toString()}const wM=["syncState","trickle","offer","answer","simulate","leave"];function kM(t){const e=wM.indexOf(t.case)>=0;return ae.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var Ce;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(Ce||(Ce={}));class xm{get currentState(){return this.state}get isDisconnected(){return this.state===Ce.DISCONNECTING||this.state===Ce.DISCONNECTED}get isEstablishingConnection(){return this.state===Ce.CONNECTING||this.state===Ce.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=Ce.DISCONNECTED,this.log=ae,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0},this.log=yi((i=n.loggerName)!==null&&i!==void 0?i:En.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new gM,this.queuedRequests=[],this.closingLock=new Rt,this.connectionLock=new Rt,this.state=Ce.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,r){return T(this,void 0,void 0,function*(){return this.state=Ce.CONNECTING,this.options=i,yield this.connect(e,n,i,r)})}reconnect(e,n,i,r){return T(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=Ce.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}))})}connect(e,n,i,r){this.connectOptions=i;const s=eM(),o=SM(n,s,i),a=vM(e,o),l=yM(a);return new Promise((c,u)=>T(this,void 0,void 0,function*(){const d=yield this.connectionLock.lock();try{const h=()=>T(this,void 0,void 0,function*(){this.close(),clearTimeout(f),u(new be("room connection has been cancelled (signal)",de.Cancelled))}),f=setTimeout(()=>{this.close(),u(new be("room connection has timed out (signal)",de.ServerUnreachable))},i.websocketTimeout);r!=null&&r.aborted&&h(),r==null||r.addEventListener("abort",h);const v=new URL(a);v.searchParams.has("access_token")&&v.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(v),Object.assign({reconnect:i.reconnect,reconnectReason:i.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new WebSocket(a),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{clearTimeout(f)},this.ws.onerror=p=>T(this,void 0,void 0,function*(){if(this.state!==Ce.CONNECTED){this.state=Ce.DISCONNECTED,clearTimeout(f);try{const y=yield fetch(l);if(y.status.toFixed(0).startsWith("4")){const m=yield y.text();u(new be(m,de.NotAllowed,y.status))}else u(new be("Encountered unknown websocket error during connection: ".concat(p.toString()),de.InternalError,y.status))}catch(y){u(new be(y instanceof Error?y.message:"server was not reachable",de.ServerUnreachable))}return}this.handleWSError(p)}),this.ws.onmessage=p=>T(this,void 0,void 0,function*(){var y,m,g;let b;if(typeof p.data=="string"){const w=JSON.parse(p.data);b=ry.fromJson(w,{ignoreUnknownFields:!0})}else if(p.data instanceof ArrayBuffer)b=ry.fromBinary(new Uint8Array(p.data));else{this.log.error("could not decode websocket message: ".concat(typeof p.data),this.logContext);return}if(this.state!==Ce.CONNECTED){let w=!1;if(((y=b.message)===null||y===void 0?void 0:y.case)==="join"?(this.state=Ce.CONNECTED,r==null||r.removeEventListener("abort",h),this.pingTimeoutDuration=b.message.value.pingTimeout,this.pingIntervalDuration=b.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&(this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})),this.startPingInterval()),c(b.message.value)):this.state===Ce.RECONNECTING&&b.message.case!=="leave"?(this.state=Ce.CONNECTED,r==null||r.removeEventListener("abort",h),this.startPingInterval(),((m=b.message)===null||m===void 0?void 0:m.case)==="reconnect"?c(b.message.value):(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),c(void 0),w=!0)):this.isEstablishingConnection&&b.message.case==="leave"?u(new be("Received leave request while trying to (re)connect",de.LeaveRequest,void 0,b.message.value.reason)):i.reconnect||u(new be("did not receive join response, got ".concat((g=b.message)===null||g===void 0?void 0:g.case," instead"),de.InternalError)),!w)return}this.signalLatency&&(yield It(this.signalLatency)),this.handleSignalResponse(b)}),this.ws.onclose=p=>{this.isEstablishingConnection&&u(new be("Websocket got closed during a (re)connection attempt",de.InternalError)),this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:p.reason,code:p.code,wasClean:p.wasClean,state:this.state})),this.handleOnClose(p.reason)}}finally{d()}}))}close(){return T(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const i=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=Ce.DISCONNECTING),e.ws){e.ws.onmessage=null,e.ws.onopen=null,e.ws.onclose=null;const r=new Promise(s=>{e.ws?e.ws.onclose=()=>{s()}:s()});e.ws.readyState<e.ws.CLOSING&&(e.ws.close(),yield Promise.race([r,It(250)])),e.ws=void 0}}finally{n&&(e.state=Ce.DISCONNECTED),i()}}()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Jc(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Jc(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new Lu({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new ju({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return T(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const a=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new km({requestId:a,metadata:i,name:r,attributes:o})}),a}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new QS({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new ZS({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:xe.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new iT({timestamp:xe.parse(Date.now()),rtt:xe.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new wm({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new Fu({reason:bn.CLIENT_INITIATED,action:qs.DISCONNECT})})}sendRequest(e){return T(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!r&&!kM(n)&&i.state===Ce.RECONNECTING){i.queuedRequests.push(()=>T(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield It(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!i.ws||i.ws.readyState!==i.ws.OPEN){i.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),i.logContext);return}const o=new $A({message:n});try{i.useJSON?i.ws.send(o.toJsonString()):i.ws.send(o.toBinary())}catch(a){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:a}))}}()})}handleSignalResponse(e){var n,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(r.case==="answer"){const o=xy(r.value);this.onAnswer&&this.onAnswer(o,r.value.id)}else if(r.case==="offer"){const o=xy(r.value);this.onOffer&&this.onOffer(o,r.value.id)}else if(r.case==="trickle"){const o=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(o,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return T(this,void 0,void 0,function*(){if(this.state===Ce.DISCONNECTED)return;const n=this.onClose;yield this.close(),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=tt.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&tt.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=tt.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&tt.clearInterval(this.pingInterval)}}function xy(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function Jc(t,e){return new Qr({sdp:t.sdp,type:t.type,id:e})}function SM(t,e,n){var i;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",qn()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}class Ry{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class TM{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const r=i+this.ttl;return this._map.set(e,{value:n,expiresAt:r}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[r,s]of i.entries())n.push(e(s,r,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var ln={},zd={},qd={exports:{}},Iy;function Rm(){if(Iy)return qd.exports;Iy=1;var t=qd.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),qd.exports}var Oy;function CM(){return Oy||(Oy=1,function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,l,c,u){if(u&&!c)l[u]=e(a[1]);else for(var d=0;d<c.length;d+=1)a[d+1]!=null&&(l[c[d]]=e(a[d+1]))},i=function(a,l,c){var u=a.name&&a.names;a.push&&!l[a.push]?l[a.push]=[]:u&&!l[a.name]&&(l[a.name]={});var d=a.push?{}:u?l[a.name]:l;n(c.match(a.reg),d,a.names,a.name),a.push&&l[a.push].push(d)},r=Rm(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var l={},c=[],u=l;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(d){var h=d[0],f=d.slice(2);h==="m"&&(c.push({rtp:[],fmtp:[]}),u=c[c.length-1]);for(var v=0;v<(r[h]||[]).length;v+=1){var p=r[h][v];if(p.reg.test(f))return i(p,u,f)}}),l.media=c,l};var o=function(a,l){var c=l.split(/=(.+)/,2);return c.length===2?a[c[0]]=e(c[1]):c.length===1&&l.length>1&&(a[c[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var l=[],c=a.split(" ").map(e),u=0;u<c.length;u+=3)l.push({component:c[u],ip:c[u+1],port:c[u+2]});return l},t.parseImageAttributes=function(a){return a.split(" ").map(function(l){return l.substring(1,l.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(l){return l.split(",").map(function(c){var u,d=!1;return c[0]!=="~"?u=e(c):(u=e(c.substring(1,c.length)),d=!0),{scid:u,paused:d}})})}}(zd)),zd}var Wd,Ay;function _M(){if(Ay)return Wd;Ay=1;var t=Rm(),e=/%[sdv%]/g,n=function(o){var a=1,l=arguments,c=l.length;return o.replace(e,function(u){if(a>=c)return u;var d=l[a];switch(a+=1,u){case"%%":return"%";case"%s":return String(d);case"%d":return Number(d);case"%v":return""}})},i=function(o,a,l){var c=a.format instanceof Function?a.format(a.push?l:l[a.name]):a.format,u=[o+"="+c];if(a.names)for(var d=0;d<a.names.length;d+=1){var h=a.names[d];a.name?u.push(l[a.name][h]):u.push(l[a.names[d]])}else u.push(l[a.name]);return n.apply(null,u)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return Wd=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(d){d.payloads==null&&(d.payloads="")});var l=a.outerOrder||r,c=a.innerOrder||s,u=[];return l.forEach(function(d){t[d].forEach(function(h){h.name in o&&o[h.name]!=null?u.push(i(d,h,o)):h.push in o&&o[h.push]!=null&&o[h.push].forEach(function(f){u.push(i(d,h,f))})})}),o.media.forEach(function(d){u.push(i("m",t.m[0],d)),c.forEach(function(h){t[h].forEach(function(f){f.name in d&&d[f.name]!=null?u.push(i(h,f,d)):f.push in d&&d[f.push]!=null&&d[f.push].forEach(function(v){u.push(i(h,f,v))})})})}),u.join(`\r
`)+`\r
`},Wd}var Dy;function EM(){if(Dy)return ln;Dy=1;var t=CM(),e=_M(),n=Rm();return ln.grammar=n,ln.write=e,ln.parse=t.parse,ln.parseParams=t.parseParams,ln.parseFmtpConfig=t.parseFmtpConfig,ln.parsePayloads=t.parsePayloads,ln.parseRemoteCandidates=t.parseRemoteCandidates,ln.parseImageAttributes=t.parseImageAttributes,ln.parseSimulcastStreamList=t.parseSimulcastStreamList,ln}var Mi=EM();function Im(t,e,n){var i,r,s;e===void 0&&(e=50),n===void 0&&(n={});var o=(i=n.isImmediate)!=null&&i,a=(r=n.callback)!=null&&r,l=n.maxWait,c=Date.now(),u=[];function d(){if(l!==void 0){var f=Date.now()-c;if(f+e>=l)return l-f}return e}var h=function(){var f=[].slice.call(arguments),v=this;return new Promise(function(p,y){var m=o&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,c=Date.now(),!o){var b=t.apply(v,f);a&&a(b),u.forEach(function(w){return(0,w.resolve)(b)}),u=[]}},d()),m){var g=t.apply(v,f);return a&&a(g),p(g)}u.push({resolve:p,reject:y})})};return h.cancel=function(f){s!==void 0&&clearTimeout(s),u.forEach(function(v){return(0,v.reject)(f)}),u=[]},h}const PM=.7,xM=20,Gs={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class My extends Kn.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=ae,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Im(r=>T(this,void 0,void 0,function*(){this.emit(Gs.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(r)r(s);else throw s}}),xM),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=yi((i=n.loggerName)!==null&&i!==void 0?i:En.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new Rt}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return T(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return T(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:s,nackMids:o}=RM(e);this.remoteStereoMids=s,this.remoteNackMids=o}else if(e.type==="answer"){const s=Mi.parse((i=e.sdp)!==null&&i!==void 0?i:"");s.media.forEach(o=>{const a=Om(o.mid);o.type==="audio"&&this.trackBitrates.some(l=>{if(!l.transceiver||a!=l.transceiver.mid)return!1;let c=0;if(o.rtp.some(d=>d.codec.toUpperCase()===l.codec.toUpperCase()?(c=d.payload,!0):!1),c===0)return!0;let u=!1;for(const d of o.fmtp)if(d.payload===c){d.config=d.config.split(";").filter(h=>!h.includes("maxaveragebitrate")).join(";"),l.maxbr>0&&(d.config+=";maxaveragebitrate=".concat(l.maxbr*1e3)),u=!0;break}return u||l.maxbr>0&&o.fmtp.push({payload:c,config:"maxaveragebitrate=".concat(l.maxbr*1e3)}),!0})}),r=Mi.write(s)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(s=>{this.pc.addIceCandidate(s)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(Gs.NegotiationComplete),e.sdp&&Mi.parse(e.sdp).media.forEach(o=>{o.type==="video"&&this.emit(Gs.RTPVideoPayloadTypes,o.rtp)})),!0})}createAndSendOffer(e){return T(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const a=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&a)yield this._pc.setRemoteDescription(a);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=this.latestOfferId+1;this.latestOfferId=r;const s=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:s.sdp},this.logContext));const o=Mi.parse((n=s.sdp)!==null&&n!==void 0?n:"");if(o.media.forEach(a=>{Ly(a),a.type==="audio"?Ny(a,[],[]):a.type==="video"&&this.trackBitrates.some(l=>{if(!a.msid||!l.cid||!a.msid.includes(l.cid))return!1;let c=0;if(a.rtp.some(d=>d.codec.toUpperCase()===l.codec.toUpperCase()?(c=d.payload,!0):!1),c===0||(jn(l.codec)&&!Xr()&&this.ensureVideoDDExtensionForSVC(a,o),l.codec!=="av1"))return!0;const u=Math.round(l.maxbr*PM);for(const d of a.fmtp)if(d.payload===c){d.config.includes("x-google-start-bitrate")||(d.config+=";x-google-start-bitrate=".concat(u));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(s,Mi.write(o)),this.onOffer(s,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return T(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=Mi.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{Ly(r),r.type==="audio"&&Ny(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,Mi.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new We("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new We("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return T(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),i.set(a.id,a);break;case"remote-candidate":r.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const o=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(o!==void 0)return r.get(o)})}setMungedSDP(e,n,i){return T(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:n})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let s="unknown error";r instanceof Error?s=r.message:typeof r=="string"&&(s=r);const o={error:s,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new _f(s)}})}ensureVideoDDExtensionForSVC(e,n){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(o=>o.uri===ky))){if(this.ddExtID===0){let o=0;n.media.forEach(a=>{var l;a.type==="video"&&((l=a.ext)===null||l===void 0||l.forEach(c=>{c.value>o&&(o=c.value)}))}),this.ddExtID=o+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:ky})}}}function Ny(t,e,n){const i=Om(t.mid);let r=0;t.rtp.some(s=>s.codec==="opus"?(r=s.payload,!0):!1),r>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(i)&&!t.rtcpFb.some(s=>s.payload===r&&s.type==="nack")&&t.rtcpFb.push({payload:r,type:"nack"}),e.includes(i)&&t.fmtp.some(s=>s.payload===r?(s.config.includes("stereo=1")||(s.config+=";stereo=1"),!0):!1))}function RM(t){var e;const n=[],i=[],r=Mi.parse((e=t.sdp)!==null&&e!==void 0?e:"");let s=0;return r.media.forEach(o=>{var a;const l=Om(o.mid);o.type==="audio"&&(o.rtp.some(c=>c.codec==="opus"?(s=c.payload,!0):!1),!((a=o.rtcpFb)===null||a===void 0)&&a.some(c=>c.payload===s&&c.type==="nack")&&i.push(l),o.fmtp.some(c=>c.payload===s?(c.config.includes("sprop-stereo=1")&&n.push(l),!0):!1))}),{stereoMids:n,nackMids:i}}function Ly(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}function Om(t){return typeof t=="number"?t.toFixed(0):t}const Lf="vp8",IM={audioPreset:Ef.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Em.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Lf,backupCodec:!0,preConnectBuffer:!1},qT={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},WT={deviceId:{ideal:"default"},resolution:Ua.h720.resolution},OM={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new mD,disconnectOnPageLeave:!0,webAudioMix:!1},Am={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Me;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(Me||(Me={}));class AM{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,i){var r;this.peerConnectionTimeout=Am.peerConnectionTimeout,this.log=ae,this.updateState=()=>{var s;const o=this.state,a=this.requiredTransports.map(l=>l.getConnectionState());a.every(l=>l==="connected")?this.state=Me.CONNECTED:a.some(l=>l==="failed")?this.state=Me.FAILED:a.some(l=>l==="connecting")?this.state=Me.CONNECTING:a.every(l=>l==="closed")?this.state=Me.CLOSED:a.some(l=>l==="closed")?this.state=Me.CLOSING:a.every(l=>l==="new")&&(this.state=Me.NEW),o!==this.state&&(this.log.debug("pc state change: from ".concat(Me[o]," to ").concat(Me[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),this.subscriber.getConnectionState()))},this.log=yi((r=i.loggerName)!==null&&r!==void 0?r:En.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=!n,this.isSubscriberConnectionRequired=n,this.publisher=new My(e,i),this.subscriber=new My(e,i),this.publisher.onConnectionStateChange=this.updateState,this.subscriber.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,yn.PUBLISHER)},this.subscriber.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,yn.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var o;(o=this.onDataChannel)===null||o===void 0||o.call(this,s)},this.subscriber.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)},this.publisher.onOffer=(s,o)=>{var a;(a=this.onPublisherOffer)===null||a===void 0||a.call(this,s,o)},this.state=Me.NEW,this.connectionLock=new Rt,this.remoteOfferLock=new Rt}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}requireSubscriber(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isSubscriberConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return T(this,void 0,void 0,function*(){if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const e=this.publisher;for(const n of e.getSenders())try{e.canRemoveTrack()&&e.removeTrack(n)}catch(i){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:i}))}}yield Promise.all([this.publisher.close(),this.subscriber.close()]),this.updateState()})}triggerIceRestart(){return T(this,void 0,void 0,function*(){this.subscriber.restartingIce=!0,this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return T(this,void 0,void 0,function*(){n===yn.PUBLISHER?yield this.publisher.addIceCandidate(e):yield this.subscriber.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return T(this,void 0,void 0,function*(){this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:this.subscriber.getSignallingState().toString()}));const i=yield this.remoteOfferLock.lock();try{return(yield this.subscriber.setRemoteDescription(e,n))?yield this.subscriber.createAndSetAnswer():void 0}finally{i()}})}updateConfiguration(e,n){this.publisher.setConfiguration(e),this.subscriber.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return T(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(s=>this.ensureTransportConnected(s,e,n)))}finally{r()}})}negotiate(e){return T(this,void 0,void 0,function*(){return new Promise((n,i)=>T(this,void 0,void 0,function*(){const r=setTimeout(()=>{i("negotiation timed out")},this.peerConnectionTimeout),s=()=>{clearTimeout(r),i("negotiation aborted")};e.signal.addEventListener("abort",s),this.publisher.once(Gs.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(Gs.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(o=>{clearTimeout(r),i(o)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===yn.PUBLISHER?this.publisher.getConnectedAddress():e===yn.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return T(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(i.getConnectionState()!=="connected")return new Promise((l,c)=>T(s,void 0,void 0,function*(){const u=()=>{this.log.warn("abort transport connection",this.logContext),tt.clearTimeout(d),c(new be("room connection has been cancelled",de.Cancelled))};r!=null&&r.signal.aborted&&u(),r==null||r.signal.addEventListener("abort",u);const d=tt.setTimeout(()=>{r==null||r.signal.removeEventListener("abort",u),c(new be("could not establish pc connection",de.InternalError))},o);for(;this.state!==Me.CONNECTED;)if(yield It(50),r!=null&&r.signal.aborted){c(new be("room connection has been cancelled",de.Cancelled));return}tt.clearTimeout(d),r==null||r.signal.removeEventListener("abort",u),l()}))}()})}}class je extends Error{constructor(e,n,i){super(n),this.code=e,this.message=jy(n,je.MAX_MESSAGE_BYTES),this.data=i?jy(i,je.MAX_DATA_BYTES):void 0}static fromProto(e){return new je(e.code,e.message,e.data)}toProto(){return new FS({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new je(je.ErrorCode[e],je.ErrorMessage[e],n)}}je.MAX_MESSAGE_BYTES=256;je.MAX_DATA_BYTES=15360;je.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};je.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const HT=15360;function Dm(t){return new TextEncoder().encode(t).length}function jy(t,e){if(Dm(t)<=e)return t;let n=0,i=t.length;const r=new TextEncoder;for(;n<i;){const s=Math.floor((n+i+1)/2);r.encode(t.slice(0,s)).length<=e?n=s:i=s-1}return t.slice(0,n)}const Mm=2e3;function $u(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const Nm=typeof MediaRecorder<"u";class DM{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const MM=Nm?MediaRecorder:DM;class NM extends MM{constructor(e,n){if(!Nm)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,r;const s=()=>r===void 0,o=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r==null||r.close(),r=void 0},a=l=>{r==null||r.error(l),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r=void 0};this.byteStream=new ReadableStream({start:l=>{r=l,i=c=>T(this,void 0,void 0,function*(){let u;if(c.data.arrayBuffer){const d=yield c.data.arrayBuffer();u=new Uint8Array(d)}else if(c.data.byteArray)u=c.data.byteArray;else throw new Error("no data available!");s()||l.enqueue(u)}),this.addEventListener("dataavailable",i)},cancel:()=>{o()}}),this.addEventListener("stop",o),this.addEventListener("error",a)}}function LM(){return Nm}const jM=1e3,UM=1e4;class KT extends D{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(e,n,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Im(()=>T(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>T(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit($.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new Rt,this.pauseUpstreamLock=new Rt,this.trackChangeLock=new Rt,this.trackChangeLock.lock().then(o=>T(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{o()}})),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==D.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return T(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(s=>{Hs(this._mediaStreamTrack,s)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Ds(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(s=>{Ds(r??e,s)}))})}waitForDimensions(){return T(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:jM;return function*(){var i;if(e.kind===D.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=Ft())===null||i===void 0?void 0:i.os)==="iOS"&&(yield It(10));const r=Date.now();for(;Date.now()-r<n;){const s=e.dimensions;if(s)return s;yield It(50)}throw new ai("unable to get track dimensions after timeout")}()})}setDeviceId(e){return T(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===ar(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),ar(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return T(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===D.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),s=e.kind===D.Kind.Audio?"audioinput":"videoinput";return n?Xe.getInstance().normalizeDeviceId(s,i,r):i}()})}mute(){return T(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return T(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return T(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new ai("unable to replace an unpublished track");let r,s;return typeof n=="boolean"?r=n:n!==void 0&&(r=n.userProvidedTrack,s=n.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),s&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(e){return T(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,s=gD(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const o={audio:!1,video:!1};this.kind===D.Kind.Video?o.video=i||r?{deviceId:i,facingMode:r}:!0:o.audio=i?Object.assign({deviceId:i},s):!0,this.attachedElements.forEach(c=>{Hs(this.mediaStreamTrack,c)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const l=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return this.kind===D.Kind.Video&&(yield l.applyConstraints(s)),l.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(l),this._constraints=e,this.emit($.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?$.Muted:$.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),LT()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return T(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit($.UpstreamPaused,this);const i=Ft();if((i==null?void 0:i.name)==="Safari"&&Wn(i.version,"12.0")<0)throw new _m("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return T(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit($.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return T(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return T(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;const o=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const a=document.createElement(i.kind),l={kind:i.kind,track:i._mediaStreamTrack,element:a,audioContext:i.audioContext};if(yield n.init(l),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(Ds(i._mediaStreamTrack,a),a.muted=!0,a.play().catch(c=>{c instanceof DOMException&&c.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:c})),setTimeout(()=>{a.play().catch(u=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:u}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:c}))}),i.processor=n,i.processorElement=a,i.processor.processedTrack){for(const c of i.attachedElements)c!==i.processorElement&&r&&(Hs(i._mediaStreamTrack,c),Ds(i.processor.processedTrack,c));yield(s=i.sender)===null||s===void 0?void 0:s.replaceTrack(i.processor.processedTrack)}i.emit($.TrackProcessorUpdate,i.processor)}finally{o()}}()})}getProcessor(){return this.processor}stopProcessor(){return T(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const i=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(n)}finally{i()}}()})}internalStopProcessor(){return T(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit($.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!LM()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new NM(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},UM)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class Qc extends KT{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(e,D.Kind.Audio,n,i,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>T(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}o&&this.prevStats&&(this._currentBitrate=$u(o,this.prevStats)),this.prevStats=o}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit($.AudioTrackFeatureUpdate,this,Ye.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit($.AudioTrackFeatureUpdate,this,Ye.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return T(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===D.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return T(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==ar(this._constraints.deviceId);return this.source===D.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return T(this,void 0,void 0,function*(){let n;if(e){const i=Pm({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return T(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){_t()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},Mm)))}setProcessor(e){return T(this,void 0,void 0,function*(){var n;const i=yield this.trackChangeLock.lock();try{if(!qn()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit($.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return T(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return T(this,void 0,void 0,function*(){const e=yield BT(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit($.AudioSilenceDetected)),e})}}function FM(t,e,n){switch(t.kind){case"audio":return new Qc(t,e,!1,void 0,n);case"video":return new Yc(t,e,!1,n);default:throw new ai("unsupported track type: ".concat(t.kind))}}const BM=Object.values(Ua),$M=Object.values(Pf),VM=Object.values(Em),zM=[Ua.h180,Ua.h360],qM=[Pf.h180,Pf.h360],WM=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,r;return new ye(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),jf=["q","h","f"];function Uf(t,e,n,i){var r,s;let o=i==null?void 0:i.videoEncoding;t&&(o=i==null?void 0:i.screenShareEncoding);const a=i==null?void 0:i.simulcast,l=i==null?void 0:i.scalabilityMode,c=i==null?void 0:i.videoCodec;if(!o&&!a&&!l||!e||!n)return[{}];o||(o=KM(t,e,n,c),ae.debug("using video encoding",o));const u=o.maxFramerate,d=new ye(e,n,o.maxBitrate,o.maxFramerate,o.priority);if(l&&jn(c)){const v=new GT(l),p=[];if(v.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(l));const y=Ft();if(Fa()||qn()||(y==null?void 0:y.name)==="Chrome"&&Wn(y==null?void 0:y.version,"113")<0){const m=v.suffix=="h"?2:3,g=QD(y);for(let b=0;b<v.spatial;b+=1)p.push({rid:jf[2-b],maxBitrate:o.maxBitrate/Math.pow(m,b),maxFramerate:d.encoding.maxFramerate,scaleResolutionDownBy:g?Math.pow(2,b):void 0});p[0].scalabilityMode=l}else p.push({maxBitrate:o.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:l});return d.encoding.priority&&(p[0].priority=d.encoding.priority,p[0].networkPriority=d.encoding.priority),ae.debug("using svc encoding",{encodings:p}),p}if(!a)return[o];let h=[];t?h=(r=Fy(i==null?void 0:i.screenShareSimulcastLayers))!==null&&r!==void 0?r:Uy(t,d):h=(s=Fy(i==null?void 0:i.videoSimulcastLayers))!==null&&s!==void 0?s:Uy(t,d);let f;if(h.length>0){const v=h[0];h.length>1&&([,f]=h);const p=Math.max(e,n);if(p>=960&&f)return Hd(e,n,[v,f,d],u);if(p>=480)return Hd(e,n,[v,d],u)}return Hd(e,n,[d])}function HM(t,e,n){var i,r,s,o;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&ae.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const a=t.mediaStreamTrack.getSettings(),l=(i=a.width)!==null&&i!==void 0?i:(r=t.dimensions)===null||r===void 0?void 0:r.width,c=(s=a.height)!==null&&s!==void 0?s:(o=t.dimensions)===null||o===void 0?void 0:o.height;return t.source===D.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),Uf(t.source===D.Source.ScreenShare,l,c,n)}function KM(t,e,n,i){const r=GM(t,e,n);let{encoding:s}=r[0];const o=Math.max(e,n);for(let a=0;a<r.length;a+=1){const l=r[a];if(s=l.encoding,l.width>=o)break}if(i)switch(i){case"av1":case"h265":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function GM(t,e,n){if(t)return VM;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?BM:$M}function Uy(t,e){if(t)return WM(e);const{width:n,height:i}=e,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?zM:qM}function Hd(t,e,n,i){const r=[];if(n.forEach((s,o)=>{if(o>=jf.length)return;const a=Math.min(t,e),c={rid:jf[o],scaleResolutionDownBy:Math.max(1,a/Math.min(s.width,s.height)),maxBitrate:s.encoding.maxBitrate},u=i&&s.encoding.maxFramerate?Math.min(i,s.encoding.maxFramerate):s.encoding.maxFramerate;u&&(c.maxFramerate=u);const d=Yr()||o===0;s.encoding.priority&&d&&(c.priority=s.encoding.priority,c.networkPriority=s.encoding.priority),r.push(c)}),qn()&&UT()==="ios"){let s;r.forEach(a=>{s?a.maxFramerate&&a.maxFramerate>s&&(s=a.maxFramerate):s=a.maxFramerate});let o=!0;r.forEach(a=>{var l;a.maxFramerate!=s&&(o&&(o=!1,ae.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),ae.info('Setting framerate of encoding "'.concat((l=a.rid)!==null&&l!==void 0?l:"",'" to ').concat(s)),a.maxFramerate=s)})}return r}function Fy(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:r}=n;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class GT{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function JM(t){return t.source===D.Source.ScreenShare||t.constraints.height&&ar(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const QM=5e3;class Yc extends KT{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,D.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>T(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(l){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:l}));return}const o=new Map(s.map(l=>[l.rid,l])),a=s.some(l=>l.qualityLimitationReason==="cpu");if(a!==this.isCpuConstrained&&(this.isCpuConstrained=a,this.isCpuConstrained&&this.emit($.CpuConstrained)),this.prevStats){let l=0;o.forEach((c,u)=>{var d;const h=(d=this.prevStats)===null||d===void 0?void 0:d.get(u);l+=$u(c,h)}),this._currentBitrate=l}this.prevStats=o}),this.senderLock=new Rt}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!_t())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},Mm))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return T(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.pauseUpstream.call(this);try{for(var a=!0,l=oi(this.simulcastCodecs.values()),c;c=yield l.next(),n=c.done,!n;a=!0)s=c.value,a=!1,yield(o=s.sender)===null||o===void 0?void 0:o.replaceTrack(null)}catch(u){i={error:u}}finally{try{!a&&!n&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return T(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.resumeUpstream.call(this);try{for(var a=!0,l=oi(this.simulcastCodecs.values()),c;c=yield l.next(),n=c.done,!n;a=!0){s=c.value,a=!1;const u=s;yield(o=u.sender)===null||o===void 0?void 0:o.replaceTrack(u.mediaStreamTrack)}}catch(u){i={error:u}}finally{try{!a&&!n&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return T(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===D.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return T(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===D.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return T(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(r=>{var s;if(r.type==="outbound-rtp"){const o={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(s=r.rid)!==null&&s!==void 0?s:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},a=i.get(r.remoteId);a&&(o.jitter=a.jitter,o.packetsLost=a.packetsLost,o.roundTripTime=a.roundTripTime),n.push(o)}}),n.sort((r,s)=>{var o,a;return((o=s.frameWidth)!==null&&o!==void 0?o:0)-((a=r.frameWidth)!==null&&a!==void 0?a:0)}),n})}setPublishingQuality(e){const n=[];for(let i=Lt.LOW;i<=Lt.HIGH;i+=1)n.push(new Sm({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(jn(this.codec),n)}restartTrack(e){return T(this,void 0,void 0,function*(){var n,i,r,s,o;let a;if(e){const d=Pm({video:e});typeof d.video!="boolean"&&(a=d.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var l=!0,c=oi(this.simulcastCodecs.values()),u;u=yield c.next(),n=u.done,!n;l=!0){s=u.value,l=!1;const d=s;d.sender&&((o=d.sender.transport)===null||o===void 0?void 0:o.state)!=="closed"&&(d.mediaStreamTrack=this.mediaStreamTrack.clone(),yield d.sender.replaceTrack(d.mediaStreamTrack))}}catch(d){i={error:d}}finally{try{!l&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return T(this,arguments,void 0,function(i){var r=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var o,a,l,c,u,d;if(yield n.setProcessor.call(r,i,s),!((u=r.processor)===null||u===void 0)&&u.processedTrack)try{for(var h=!0,f=oi(r.simulcastCodecs.values()),v;v=yield f.next(),o=v.done,!o;h=!0)c=v.value,h=!1,yield(d=c.sender)===null||d===void 0?void 0:d.replaceTrack(r.processor.processedTrack)}catch(p){a={error:p}}finally{try{!h&&!o&&(l=f.return)&&(yield l.call(f))}finally{if(a)throw a.error}}}()})}setDegradationPreference(e){return T(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},QM))}setPublishingCodecs(e){return T(this,void 0,void 0,function*(){var n,i,r,s,o,a,l;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(jn(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const c=[];try{for(n=!0,i=oi(e);r=yield i.next(),s=r.done,!s;n=!0){l=r.value,n=!1;const u=l;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(jn(u.codec),u.qualities);else{const d=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:d})),!d||!d.sender){for(const h of u.qualities)if(h.enabled){c.push(u.codec);break}}else d.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield By(d.sender,d.encodings,u.qualities,this.senderLock,jn(u.codec),this.log,this.logContext))}}}catch(u){o={error:u}}finally{try{!n&&!s&&(a=i.return)&&(yield a.call(i))}finally{if(o)throw o.error}}return c})}setPublishingLayers(e,n){return T(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield By(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return T(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,r)=>{var s;return Object.assign(Object.assign({},i),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((s=this.mediaStreamTrack.getSettings().height)!==null&&s!==void 0?s:360)/360)),scalabilityMode:r===0&&jn(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),LT()&&this.isInBackground&&this.source===D.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function By(t,e,n,i,r,s,o){return T(this,void 0,void 0,function*(){const a=yield i.lock();s.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:t,qualities:n,senderEncodings:e}));try{const l=t.getParameters(),{encodings:c}=l;if(!c)return;if(c.length!==e.length){s.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:c,senderEncodings:e}));return}let u=!1;!1&&c[0].scalabilityMode||(r&&n.some(f=>f.enabled)&&n.forEach(f=>f.enabled=!0),c.forEach((h,f)=>{var v;let p=(v=h.rid)!==null&&v!==void 0?v:"";p===""&&(p="q");const y=JT(p),m=n.find(g=>g.quality===y);m&&h.active!==m.enabled&&(u=!0,h.active=m.enabled,s.debug("setting layer ".concat(m.quality," to ").concat(h.active?"enabled":"disabled"),o),Yr()&&(m.enabled?(h.scaleResolutionDownBy=e[f].scaleResolutionDownBy,h.maxBitrate=e[f].maxBitrate,h.maxFrameRate=e[f].maxFrameRate):(h.scaleResolutionDownBy=4,h.maxBitrate=10,h.maxFrameRate=2)))})),u&&(l.encodings=c,s.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:l.encodings})),yield t.setParameters(l))}finally{a()}})}function JT(t){switch(t){case"f":return Lt.HIGH;case"h":return Lt.MEDIUM;case"q":return Lt.LOW;default:return Lt.HIGH}}function $y(t,e,n,i){if(!n)return[new sr({quality:Lt.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const r=n[0].scalabilityMode,s=new GT(r),o=[],a=s.suffix=="h"?1.5:2,l=s.suffix=="h"?2:3;for(let c=0;c<s.spatial;c+=1)o.push(new sr({quality:Math.min(Lt.HIGH,s.spatial-1)-c,width:Math.ceil(t/Math.pow(a,c)),height:Math.ceil(e/Math.pow(a,c)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(l,c)):0,ssrc:0}));return o}return n.map(r=>{var s,o,a;const l=(s=r.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let c=JT((o=r.rid)!==null&&o!==void 0?o:"");return new sr({quality:c,width:Math.ceil(t/l),height:Math.ceil(e/l),bitrate:(a=r.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const Vy="_lossy",zy="_reliable",YM=2*1e3,Kd="leave-reconnect",XM=3e4;var Wt;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(Wt||(Wt={}));class ZM extends Kn.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=Am.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=Wt.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=ae,this.reliableDataSequence=1,this.reliableMessageBuffer=new Ry,this.reliableReceivedState=new TM(XM),this.handleDataChannel=i=>T(this,[i],void 0,function(r){var s=this;let{channel:o}=r;return function*(){if(o){if(o.label===zy)s.reliableDCSub=o;else if(o.label===Vy)s.lossyDCSub=o;else return;s.log.debug("on data channel ".concat(o.id,", ").concat(o.label),s.logContext),o.onmessage=s.handleDataMessage}}()}),this.handleDataMessage=i=>T(this,void 0,void 0,function*(){var r,s,o,a,l;const c=yield this.dataProcessLock.lock();try{let u;if(i.data instanceof ArrayBuffer)u=i.data;else if(i.data instanceof Blob)u=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const d=pt.fromBinary(new Uint8Array(u));if(d.sequence>0&&d.participantSid!==""){const h=this.reliableReceivedState.get(d.participantSid);if(h&&d.sequence<=h)return;this.reliableReceivedState.set(d.participantSid,d.sequence)}if(((r=d.value)===null||r===void 0?void 0:r.case)==="speaker")this.emit(z.ActiveSpeakersUpdate,d.value.value.speakers);else if(((s=d.value)===null||s===void 0?void 0:s.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const h=yield(o=this.e2eeManager)===null||o===void 0?void 0:o.handleEncryptedData(d.value.value.encryptedValue,d.value.value.iv,d.participantIdentity,d.value.value.keyIndex),f=LS.fromBinary(h.payload),v=new pt({value:f.value});((a=v.value)===null||a===void 0?void 0:a.case)==="user"&&qy(v,v.value.value),this.emit(z.DataPacketReceived,v,d.value.value.encryptionType)}else((l=d.value)===null||l===void 0?void 0:l.case)==="user"&&qy(d,d.value.value),this.emit(z.DataPacketReceived,d,Ge.NONE)}finally{c()}}),this.handleDataError=i=>{const s=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:o}=i.error;this.log.error("DataChannel error on ".concat(s,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:o}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const s=i.currentTarget.maxRetransmits===0?re.LOSSY:re.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=l=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(l,"ms. giving up"),this.logContext),this.emit(z.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(a===null){s(o);return}i===Kd&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=tt.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===Wt.Connected&&i();const s=()=>{this.off(z.Disconnected,o),i()},o=()=>{this.off(z.Restarted,s),r()};this.once(z.Restarted,s),this.once(z.Disconnected,o)}),this.updateAndEmitDCBufferStatus=i=>{const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit(z.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return i===re.RELIABLE&&this.reliableMessageBuffer.alignBufferedAmount(r.bufferedAmount),r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>{this.client.currentState===Ce.RECONNECTING&&(this.clearReconnectTimeout(),this.attemptReconnect(ds.RR_SIGNAL_DISCONNECTED))},this.log=yi((n=e.loggerName)!==null&&n!==void 0?n:En.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new xm(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new Rt,this.dataProcessLock=new Rt,this.dcBufferStatus=new Map([[re.LOSSY,!0],[re.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(z.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(z.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(z.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(z.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(z.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(z.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(z.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(z.SignalRequestResponse,i)}get logContext(){var e,n,i,r,s,o;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(o=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||o===void 0?void 0:o.identity,pID:this.participantSid}}join(e,n,i,r){return T(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=i,this.maxJoinAttempts=i.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const s=yield this.client.join(e,n,i,r);return this._isClosed=!1,this.latestJoinResponse=s,this.subscriberPrimary=s.subscriberPrimary,this.pcManager||(yield this.configure(s)),(!this.subscriberPrimary||s.fastPublish)&&this.negotiate().catch(o=>{ae.error(o,this.logContext)}),this.registerOnLineListener(),this.clientConfiguration=s.clientConfiguration,this.emit(z.SignalConnected,s),s}catch(s){if(s instanceof be&&s.reason===de.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,i,r);throw s}})}close(){return T(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(z.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return T(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new Ry,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupClient(){return T(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new ai("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(new be("publication of local track timed out, no response from server",de.Timeout))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(r),n(s)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return T(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return T(this,void 0,void 0,function*(){var n,i;if(this.pcManager&&this.pcManager.currentState!==Me.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new AM(r,e.subscriberPrimary,this.loggerOptions),this.emit(z.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(s,o)=>{this.client.sendIceCandidate(s,o)},this.pcManager.onPublisherOffer=(s,o)=>{this.client.sendOffer(s,o)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(s,o,a)=>T(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(s),this.logContext),["closed","disconnected","failed"].includes(o)&&(this.publisherConnectionPromise=void 0),s===Me.CONNECTED){const u=this.pcState===Wt.New;this.pcState=Wt.Connected,u&&this.emit(z.Connected,e)}else s===Me.FAILED&&(this.pcState===Wt.Connected||this.pcState===Wt.Reconnecting)&&(this.pcState=Wt.Disconnected,this.handleDisconnect("peerconnection failed",a==="failed"?ds.RR_SUBSCRIBER_FAILED:ds.RR_PUBLISHER_FAILED));const l=this.client.isDisconnected||this.client.currentState===Ce.RECONNECTING,c=[Me.FAILED,Me.CLOSING,Me.CLOSED].includes(s);l&&c&&!this._isClosed&&this.emit(z.Offline)}),this.pcManager.onTrack=s=>{this.emit(z.MediaTrackAdded,s.track,s.streams[0],s.receiver)},eN((i=e.serverInfo)===null||i===void 0?void 0:i.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n)=>T(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type})),yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n)=>T(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;const i=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);i&&this.client.sendAnswer(i,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(z.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(z.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{this.token=e},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(z.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(z.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(z.RoomMoved,e)},this.client.onClose=()=>{this.handleDisconnect("signal",ds.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions(e.regions)),e.action){case qs.DISCONNECT:this.emit(z.Disconnected,e==null?void 0:e.reason),this.close();break;case qs.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Kd);break;case qs.RESUME:this.handleDisconnect(Kd)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(s=>{const o={urls:s.urls};s.username&&(o.username=s.username),s.credential&&(o.credential=s.credential),r.push(o)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===La.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(Vy,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(zy,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,n,i){return T(this,void 0,void 0,function*(){if(xf())return yield this.createTransceiverRTCRtpSender(e,n,i);if(Rf())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new We("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,r){return T(this,void 0,void 0,function*(){if(xf())return this.createSimulcastTransceiverSender(e,n,i,r);if(Rf())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new We("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new We("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),br(e)&&(e.codec=n.videoCodec);const s={direction:"sendonly",streams:r};return i&&(s.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(e,n,i,r){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new We("publisher is closed");const s={direction:"sendonly"};r&&(s.sendEncodings=r);const o=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,s);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new We("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return T(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed){if(this.attemptingReconnect){ae.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===La.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:Me.NEW)===Me.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let o=!0;s instanceof We?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),o=!1):s instanceof hs||(this.fullReconnectOnNext=!0),o?this.handleDisconnect("reconnect",ds.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(z.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return T(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new We("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(z.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new hs;s=yield this.join(e??this.url,this.token,this.signalOpts)}catch(o){throw o instanceof be&&o.reason===de.NotAllowed?new We("could not reconnect, token might be expired"):new hs}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(z.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==Ce.CONNECTED)throw new hs("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(z.Restarted)}catch(s){const o=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(o){yield this.restartConnection(o);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),s}})}resumeConnection(e){return T(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new We("could not reconnect, url or token not saved");if(!this.pcManager)throw new We("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(z.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let s="";throw r instanceof Error&&(s=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof be&&r.reason===de.NotAllowed?new We("could not reconnect, token might be expired"):r instanceof be&&r.reason===de.LeaveRequest?r:new hs(s)}if(this.emit(z.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==Ce.CONNECTED)throw new hs("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i!=null&&i.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(z.Resumed)})}waitForPCInitialConnection(e,n){return T(this,void 0,void 0,function*(){if(!this.pcManager)throw new We("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return T(this,void 0,void 0,function*(){this.pcState=Wt.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield It(YM),!this.pcManager)throw new We("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Wt.Connected}catch(e){throw this.pcState=Wt.Disconnected,new be("could not establish PC connection, ".concat(e.message),de.InternalError)}})}publishRpcResponse(e,n,i,r){return T(this,void 0,void 0,function*(){const s=new pt({destinationIdentities:[e],kind:re.RELIABLE,value:{case:"rpcResponse",value:new ym({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(s,re.RELIABLE)})}publishRpcAck(e,n){return T(this,void 0,void 0,function*(){const i=new pt({destinationIdentities:[e],kind:re.RELIABLE,value:{case:"rpcAck",value:new vm({requestId:n})}});yield this.sendDataPacket(i,re.RELIABLE)})}sendDataPacket(e,n){return T(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(n),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const s=OD(e);if(s){const o=yield this.e2eeManager.encryptData(s.toBinary());e.value={case:"encryptedPacket",value:new NS({encryptedValue:o.payload,iv:o.iv,keyIndex:o.keyIndex})}}}n===re.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),r=this.dataChannelForKind(n);if(r){if(n===re.RELIABLE&&this.reliableMessageBuffer.push({data:i,sequence:e.sequence}),this.attemptingReconnect)return;r.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return T(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(re.RELIABLE);const n=this.dataChannelForKind(re.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(re.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((n,i)=>T(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>i("Engine closed");for(this.once(z.Closing,r);!this.dcBufferStatus.get(e);)yield It(10);this.off(z.Closing,r),n()}}))}ensureDataTransportConnected(e){return T(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var s;if(!i.pcManager)throw new We("PC manager is closed");const o=r?i.pcManager.subscriber:i.pcManager.publisher,a=r?"Subscriber":"Publisher";if(!o)throw new be("".concat(a," connection not set"),de.InternalError);let l=!1;!r&&!i.dataChannelForKind(n,r)&&(i.createDataChannels(),l=!0),!l&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(l=!0),l&&i.negotiate().catch(d=>{ae.error(d,i.logContext)});const c=i.dataChannelForKind(n,r);if((c==null?void 0:c.readyState)==="open")return;const u=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<u;){if(o.isICEConnected&&((s=i.dataChannelForKind(n,r))===null||s===void 0?void 0:s.readyState)==="open")return;yield It(50)}throw new be("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()),de.InternalError)}()})}ensurePublisherConnected(e){return T(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==Me.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return T(this,void 0,void 0,function*(){return new Promise((e,n)=>T(this,void 0,void 0,function*(){if(!this.pcManager){n(new _f("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(z.Closing,r),this.pcManager.publisher.once(Gs.RTPVideoPayloadTypes,s=>{const o=new Map;s.forEach(a=>{const l=a.codec.toLowerCase();tM(l)&&o.set(a.payload,l)}),this.emit(z.RTPVideoMapUpdate,o)});try{yield this.pcManager.negotiate(i),e()}catch(s){s instanceof _f&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",ds.RR_UNKNOWN),n(s)}finally{this.off(z.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===re.LOSSY)return this.lossyDCSub;if(e===re.RELIABLE)return this.reliableDCSub}else{if(e===re.LOSSY)return this.lossyDC;if(e===re.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,r;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const s=this.pcManager.subscriber.getLocalDescription(),o=this.pcManager.subscriber.getRemoteDescription(),a=(r=(i=this.signalOpts)===null||i===void 0?void 0:i.autoSubscribe)!==null&&r!==void 0?r:!0,l=new Array,c=new Array;e.forEach(u=>{u.isDesired!==a&&l.push(u.trackSid),u.isEnabled||c.push(u.trackSid)}),this.client.sendSyncState(new eT({answer:s?Jc({sdp:s.sdp,type:s.type}):void 0,offer:o?Jc({sdp:o.sdp,type:o.type}):void 0,subscription:new Uu({trackSids:l,subscribe:!a,participantTracks:[]}),publishTracks:uM(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:c,datachannelReceiveStates:this.reliableReceivedState.map((u,d)=>new tT({publisherSid:d,lastSeq:u}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,r)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&e.push(new nT({label:i.label,id:i.id,target:r}))};return n(this.dataChannelForKind(re.LOSSY),yn.PUBLISHER),n(this.dataChannelForKind(re.RELIABLE),yn.PUBLISHER),n(this.dataChannelForKind(re.LOSSY,!0),yn.SUBSCRIBER),n(this.dataChannelForKind(re.RELIABLE,!0),yn.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&tt.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){_t()&&window.addEventListener("online",this.handleBrowserOnLine)}deregisterOnLineListener(){_t()&&window.removeEventListener("online",this.handleBrowserOnLine)}}class hs extends Error{}function eN(t){return t!==void 0&&t>13}function qy(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class Ff{constructor(e,n){this.lastUpdateAt=0,this.settingsCacheTime=3e3,this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return Of(this.serverUrl)}getServerUrl(){return this.serverUrl}getNextBestRegionUrl(e){return T(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");(!this.regionSettings||Date.now()-this.lastUpdateAt>this.settingsCacheTime)&&(this.regionSettings=yield this.fetchRegionSettings(e));const n=this.regionSettings.regions.filter(i=>!this.attemptedRegions.find(r=>r.url===i.url));if(n.length>0){const i=n[0];return this.attemptedRegions.push(i),ae.debug("next region: ".concat(i.region)),i.url}else return null})}resetAttempts(){this.attemptedRegions=[]}fetchRegionSettings(e){return T(this,void 0,void 0,function*(){const n=yield fetch("".concat(tN(this.serverUrl),"/regions"),{headers:{authorization:"Bearer ".concat(this.token)},signal:e});if(n.ok){const i=yield n.json();return this.lastUpdateAt=Date.now(),i}else throw new be("Could not fetch region settings: ".concat(n.statusText),n.status===401?de.NotAllowed:de.InternalError,n.status)})}setServerReportedRegions(e){this.regionSettings=e,this.lastUpdateAt=Date.now()}}function tN(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class QT{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new Ht("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),ht.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new Ht("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),ht.LengthExceeded)}}constructor(e,n,i,r){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=r}}class nN extends QT{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();let n=new Yt,i=null,r=null;if(this.signal){const o=this.signal;r=()=>{var a;(a=n.reject)===null||a===void 0||a.call(n,o.reason)},o.addEventListener("abort",r),i=o}const s=()=>{e.releaseLock(),i&&r&&i.removeEventListener("abort",r),this.signal=void 0};return{next:()=>T(this,void 0,void 0,function*(){var o,a;try{const{done:l,value:c}=yield Promise.race([e.read(),n.promise,(a=(o=this.outOfBandFailureRejectingFuture)===null||o===void 0?void 0:o.promise)!==null&&a!==void 0?a:new Promise(()=>{})]);return l?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(c),{done:!1,value:c.content})}catch(l){throw s(),l}}),return(){return T(this,void 0,void 0,function*(){return s(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return T(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,r,s,o;let a=new Set;const l=n.signal?e.withAbortSignal(n.signal):e;try{for(var c=!0,u=oi(l),d;d=yield u.next(),i=d.done,!i;c=!0){o=d.value,c=!1;const h=o;a.add(h)}}catch(h){r={error:h}}finally{try{!c&&!i&&(s=u.return)&&(yield s.call(u))}finally{if(r)throw r.error}}return Array.from(a)}()})}}class iN extends QT{constructor(e,n,i,r){super(e,n,i,r),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=ac(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const s=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,s)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let i=new Yt,r=null,s=null;if(this.signal){const a=this.signal;s=()=>{var l;(l=i.reject)===null||l===void 0||l.call(i,a.reason)},a.addEventListener("abort",s),r=a}const o=()=>{e.releaseLock(),r&&s&&r.removeEventListener("abort",s),this.signal=void 0};return{next:()=>T(this,void 0,void 0,function*(){var a,l;try{const{done:c,value:u}=yield Promise.race([e.read(),i.promise,(l=(a=this.outOfBandFailureRejectingFuture)===null||a===void 0?void 0:a.promise)!==null&&l!==void 0?l:new Promise(()=>{})]);if(c)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(u);let d;try{d=n.decode(u.content)}catch(h){throw new Ht("Cannot decode datastream chunk ".concat(u.chunkIndex," as text: ").concat(h),ht.DecodeFailed)}return{done:!1,value:d}}}catch(c){throw o(),c}}),return(){return T(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return T(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,r,s,o;let a="";const l=n.signal?e.withAbortSignal(n.signal):e;try{for(var c=!0,u=oi(l),d;d=yield u.next(),i=d.done,!i;c=!0)o=d.value,c=!1,a+=o}catch(h){r={error:h}}finally{try{!c&&!i&&(s=u.return)&&(yield s.call(u))}finally{if(r)throw r.error}}return a}()})}}class rN{constructor(){this.log=ae,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new Ht('A text stream handler for topic "'.concat(e,'" has already been set.'),ht.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new Ht('A byte stream handler for topic "'.concat(e,'" has already been set.'),ht.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearHandlersAndControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear(),this.byteStreamHandlers.clear(),this.textStreamHandlers.clear()}validateParticipantHasNoActiveDataStreams(e){var n,i,r,s;const o=Array.from(this.textStreamControllers.entries()).filter(l=>l[1].sendingParticipantIdentity===e),a=Array.from(this.byteStreamControllers.entries()).filter(l=>l[1].sendingParticipantIdentity===e);if(o.length>0||a.length>0){const l=new Ht("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),ht.AbnormalEnd);for(const[c,u]of a)(i=(n=u.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(n,l),this.byteStreamControllers.delete(c);for(const[c,u]of o)(s=(r=u.outOfBandFailureRejectingFuture).reject)===null||s===void 0||s.call(r,l),this.textStreamControllers.delete(c)}}handleDataStreamPacket(e,n){return T(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,n);case"streamChunk":return this.handleStreamChunk(e.value.value,n);case"streamTrailer":return this.handleStreamTrailer(e.value.value,n);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,n,i){return T(this,void 0,void 0,function*(){var r;if(e.contentHeader.case==="byteHeader"){const s=this.byteStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let o;const a=new Yt;a.promise.catch(u=>{this.log.error(u)});const l={id:e.streamId,name:(r=e.contentHeader.value.name)!==null&&r!==void 0?r:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:ac(e.timestamp),attributes:e.attributes,encryptionType:i},c=new ReadableStream({start:u=>{if(o=u,this.textStreamControllers.has(e.streamId))throw new Ht("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),ht.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:l,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});s(new nN(l,c,ac(e.totalLength),a),{identity:n})}else if(e.contentHeader.case==="textHeader"){const s=this.textStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let o;const a=new Yt;a.promise.catch(u=>{this.log.error(u)});const l={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:i},c=new ReadableStream({start:u=>{if(o=u,this.textStreamControllers.has(e.streamId))throw new Ht("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),ht.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:l,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});s(new iN(l,c,ac(e.totalLength),a),{identity:n})}})}handleStreamChunk(e,n){const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?(i.controller.error(new Ht("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),ht.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e));const r=this.textStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?(r.controller.error(new Ht("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),ht.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&r.controller.enqueue(e))}handleStreamTrailer(e,n){const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?i.controller.error(new Ht("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),ht.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.textStreamControllers.delete(e.streamId)));const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?r.controller.error(new Ht("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),ht.EncryptionTypeMismatch)):(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class YT{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return T(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class sN extends YT{}class oN extends YT{}const Wy=15e3;class aN{constructor(e,n){this.engine=e,this.log=n}setupEngine(e){this.engine=e}sendText(e,n){return T(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),o=new TextEncoder().encode(e).byteLength,a=(i=n==null?void 0:n.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),l=new Array(a?a.length+1:1).fill(0),c=(d,h)=>{var f;l[h]=d;const v=l.reduce((p,y)=>p+y,0);(f=n==null?void 0:n.onProgress)===null||f===void 0||f.call(n,v)},u=yield this.streamText({streamId:r,totalSize:o,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:a,attributes:n==null?void 0:n.attributes});return yield u.write(e),c(1,0),yield u.close(),n!=null&&n.attachments&&a&&(yield Promise.all(n.attachments.map((d,h)=>T(this,void 0,void 0,function*(){return this._sendFile(a[h],d,{topic:n.topic,mimeType:d.type,onProgress:f=>{c(f,h+1)}})})))),u.info})}streamText(e){return T(this,void 0,void 0,function*(){var n,i,r;const s=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),o={id:s,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e==null?void 0:e.topic)!==null&&i!==void 0?i:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes,encryptionType:!((r=this.engine.e2eeManager)===null||r===void 0)&&r.isDataChannelEncryptionEnabled?Ge.GCM:Ge.NONE},a=new qc({streamId:s,mimeType:o.mimeType,topic:o.topic,timestamp:Rr(o.timestamp),totalLength:Rr(e==null?void 0:e.totalSize),attributes:o.attributes,contentHeader:{case:"textHeader",value:new HS({version:e==null?void 0:e.version,attachedStreamIds:e==null?void 0:e.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?pf.UPDATE:pf.CREATE})}}),l=e==null?void 0:e.destinationIdentities,c=new pt({destinationIdentities:l,value:{case:"streamHeader",value:a}});yield this.engine.sendDataPacket(c,re.RELIABLE);let u=0;const d=this.engine,h=new WritableStream({write(p){return T(this,void 0,void 0,function*(){for(const y of aM(p,Wy)){yield d.waitForBufferStatusLow(re.RELIABLE);const m=new Wc({content:y,streamId:s,chunkIndex:Rr(u)}),g=new pt({destinationIdentities:l,value:{case:"streamChunk",value:m}});yield d.sendDataPacket(g,re.RELIABLE),u+=1}})},close(){return T(this,void 0,void 0,function*(){const p=new Hc({streamId:s}),y=new pt({destinationIdentities:l,value:{case:"streamTrailer",value:p}});yield d.sendDataPacket(y,re.RELIABLE)})},abort(p){console.log("Sink error:",p)}});let f=()=>T(this,void 0,void 0,function*(){yield v.close()});d.once(z.Closing,f);const v=new sN(h,o,()=>this.engine.off(z.Closing,f));return v})}sendFile(e,n){return T(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return T(this,void 0,void 0,function*(){var r;const s=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=i==null?void 0:i.mimeType)!==null&&r!==void 0?r:n.type,topic:i==null?void 0:i.topic,destinationIdentities:i==null?void 0:i.destinationIdentities}),o=n.stream().getReader();for(;;){const{done:a,value:l}=yield o.read();if(a)break;yield s.write(l)}return yield s.close(),s.info})}streamBytes(e){return T(this,void 0,void 0,function*(){var n,i,r,s,o,a;const l=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),c=e==null?void 0:e.destinationIdentities,u={id:l,mimeType:(i=e==null?void 0:e.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(s=e==null?void 0:e.name)!==null&&s!==void 0?s:"unknown",encryptionType:!((o=this.engine.e2eeManager)===null||o===void 0)&&o.isDataChannelEncryptionEnabled?Ge.GCM:Ge.NONE},d=new qc({totalLength:Rr((a=u.size)!==null&&a!==void 0?a:0),mimeType:u.mimeType,streamId:l,topic:u.topic,timestamp:Rr(Date.now()),attributes:u.attributes,contentHeader:{case:"byteHeader",value:new KS({name:u.name})}}),h=new pt({destinationIdentities:c,value:{case:"streamHeader",value:d}});yield this.engine.sendDataPacket(h,re.RELIABLE);let f=0;const v=new Rt,p=this.engine,y=this.log,m=new WritableStream({write(b){return T(this,void 0,void 0,function*(){const w=yield v.lock();let k=0;try{for(;k<b.byteLength;){const S=b.slice(k,k+Wy);yield p.waitForBufferStatusLow(re.RELIABLE);const _=new pt({destinationIdentities:c,value:{case:"streamChunk",value:new Wc({content:S,streamId:l,chunkIndex:Rr(f)})}});yield p.sendDataPacket(_,re.RELIABLE),f+=1,k+=S.byteLength}}finally{w()}})},close(){return T(this,void 0,void 0,function*(){const b=new Hc({streamId:l}),w=new pt({destinationIdentities:c,value:{case:"streamTrailer",value:b}});yield p.sendDataPacket(w,re.RELIABLE)})},abort(b){y.error("Sink error:",b)}});return new oN(m,u)})}}class XT extends D{constructor(e,n,i,r,s){super(e,i,s),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?$.Muted:$.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit($.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return T(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),Mm)),dM()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:s}=i;s&&this.rtpTimestamp!==s&&(this.emit($.TimeSyncUpdate,{timestamp:r,rtpTimestamp:s}),this.rtpTimestamp=s)}};e()}}class lN extends XT{constructor(e,n,i,r,s,o){super(e,n,D.Kind.Audio,i,o),this.monitorReceiver=()=>T(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=$u(a,this.prevStats)),this.prevStats=a}),this.audioContext=r,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;qn()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(qn())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return T(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(If(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&If(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit($.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit($.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return T(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const Gd=100;class cN extends XT{constructor(e,n,i,r,s){super(e,n,D.Kind.Video,i,s),this.elementInfos=[],this.monitorReceiver=()=>T(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=$u(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=Im(()=>{this.updateDimensions()},Gd),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),console.log("setStreamState",e),e===D.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?Hs(this._mediaStreamTrack,n):Ds(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new uN(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return T(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",r=new Map;return e.forEach(s=>{s.type==="inbound-rtp"?(i=s.codecId,n={type:"video",streamId:s.id,framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&r.set(s.id,s)}),n&&i!==""&&r.get(i)&&(n.mimeType=r.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return T(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var n,i;const r=this.elementInfos.reduce((l,c)=>Math.max(l,c.visibilityChangedAt||0),0),s=!((i=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&i!==void 0)||i?this.isInBackground:!1,o=this.elementInfos.some(l=>l.pictureInPicture),a=this.elementInfos.some(l=>l.visible)&&!s||o;if(!(this.lastVisible===a&&!e)){if(!a&&Date.now()-r<Gd){tt.setTimeout(()=>{this.updateVisibility()},Gd);return}this.lastVisible=a,this.emit($.VisibilityChanged,a,this)}}updateDimensions(){var e,n;let i=0,r=0;const s=this.getPixelDensity();for(const o of this.elementInfos){const a=o.width()*s,l=o.height()*s;a+l>i+r&&(i=a,r=l)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit($.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?Sy():n||(Sy()>2?2:1)}}class uN{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var r;const{target:s,isIntersecting:o}=i;s===this.element&&(this.isIntersecting=o,this.isPiP=$o(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,s;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=$o(this.element),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=$o(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??Bf(e),this.isPiP=_t()&&$o(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=Bf(this.element),this.isPiP=$o(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Cy().observe(this.element),Ty().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,r,s;(e=Cy())===null||e===void 0||e.unobserve(this.element),(n=Ty())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(s=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}function $o(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?Bf(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function Bf(t,e){const n=e||window;let i=t.offsetTop,r=t.offsetLeft;const s=t.offsetWidth,o=t.offsetHeight,{hidden:a}=t,{display:l}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,r+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+o>n.pageYOffset&&r+s>n.pageXOffset&&!a&&l!=="none"}class ti extends Kn.EventEmitter{constructor(e,n,i,r){var s;super(),this.metadataMuted=!1,this.encryption=Ge.NONE,this.log=ae,this.handleMuted=()=>{this.emit($.Muted)},this.handleUnmuted=()=>{this.emit($.Unmuted)},this.log=yi((s=r==null?void 0:r.loggerName)!==null&&s!==void 0?s:En.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=D.Source.Unknown}setTrack(e){this.track&&(this.track.off($.Muted,this.handleMuted),this.track.off($.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on($.Muted,this.handleMuted),e.on($.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),le(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Ge.NONE}get audioTrack(){if(Vn(this.track))return this.track}get videoTrack(){if(br(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=D.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===D.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})(ti||(ti={}));class $f extends ti{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit($.Ended)},this.handleCpuConstrained=()=>{this.track&&br(this.track)&&this.emit($.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off($.Ended,this.handleTrackEnded),this.track.off($.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on($.Ended,this.handleTrackEnded),e.on($.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return T(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return T(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return T(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return T(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(Vn(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(Ye.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(Ye.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(Ye.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(Ye.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(Ye.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(Ye.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function Vu(t,e){return T(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:s}=VT(t);let o=s.audio,a=s.video;if(i&&typeof s.audio=="object"&&(s.audio.processor=i),r&&typeof s.video=="object"&&(s.video.processor=r),t.audio&&typeof s.audio=="object"&&typeof s.audio.deviceId=="string"){const d=s.audio.deviceId;s.audio.deviceId={exact:d},n=!0,o=Object.assign(Object.assign({},s.audio),{deviceId:{ideal:d}})}if(s.video&&typeof s.video=="object"&&typeof s.video.deviceId=="string"){const d=s.video.deviceId;s.video.deviceId={exact:d},n=!0,a=Object.assign(Object.assign({},s.video),{deviceId:{ideal:d}})}(s.audio===!0||typeof s.audio=="object"&&!s.audio.deviceId)&&(s.audio={deviceId:"default"}),s.video===!0?s.video={deviceId:"default"}:typeof s.video=="object"&&!s.video.deviceId&&(s.video.deviceId="default");const l=FT(s,qT,WT),c=Pm(l),u=navigator.mediaDevices.getUserMedia(c);s.audio&&(Xe.userMediaPromiseMap.set("audioinput",u),u.catch(()=>Xe.userMediaPromiseMap.delete("audioinput"))),s.video&&(Xe.userMediaPromiseMap.set("videoinput",u),u.catch(()=>Xe.userMediaPromiseMap.delete("videoinput")));try{const d=yield u;return yield Promise.all(d.getTracks().map(h=>T(this,void 0,void 0,function*(){const f=h.kind==="audio";let v=f?l.audio:l.video;(typeof v=="boolean"||!v)&&(v={});let p;const y=f?c.audio:c.video;typeof y!="boolean"&&(p=y);const m=h.getSettings().deviceId;p!=null&&p.deviceId&&ar(p.deviceId)!==m?p.deviceId=m:p||(p={deviceId:m});const g=FM(h,p,e);return g.kind===D.Kind.Video?g.source=D.Source.Camera:g.kind===D.Kind.Audio&&(g.source=D.Source.Microphone),g.mediaStream=d,Vn(g)&&i?yield g.setProcessor(i):br(g)&&r&&(yield g.setProcessor(r)),g})))}catch(d){if(!n)throw d;return Vu(Object.assign(Object.assign({},t),{audio:o,video:a}),e)}})}function dN(t){return T(this,void 0,void 0,function*(){return(yield Vu({audio:!1,video:!0}))[0]})}function ZT(t){return T(this,void 0,void 0,function*(){return(yield Vu({audio:t??!0,video:!1}))[0]})}var Bi;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(Bi||(Bi={}));function hN(t){switch(t){case Go.EXCELLENT:return Bi.Excellent;case Go.GOOD:return Bi.Good;case Go.POOR:return Bi.Poor;case Go.LOST:return Bi.Lost;default:return Bi.Unknown}}class eC extends Kn.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===ja.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===zs.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,r,s,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:ja.STANDARD;var l;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Bi.Unknown,this.log=ae,this.log=yi((l=o==null?void 0:o.loggerName)!==null&&l!==void 0?l:En.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=s??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Yt,this.once(q.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(D.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(D.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(D.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===zs.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==zs.ACTIVE&&this.emit(q.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(q.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(q.ParticipantNameChanged,e)}_setAttributes(e){const n=hM(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(q.AttributesChanged,n)}setPermissions(e){var n,i,r,s,o,a;const l=this.permissions,c=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((o=this.permissions)===null||o===void 0?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((u,d)=>{var h;return u!==((h=this.permissions)===null||h===void 0?void 0:h.canPublishSources[d])})||e.canSubscribeMetrics!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribeMetrics);return this.permissions=e,c&&this.emit(q.ParticipantPermissionsChanged,l),c}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(q.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=hN(e),n!==this._connectionQuality&&this.emit(q.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>Vn(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on($.Muted,()=>{this.emit(q.TrackMuted,e)}),e.on($.Unmuted,()=>{this.emit(q.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case D.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case D.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function fN(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new XS({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}class pN extends eC{constructor(e,n,i,r,s,o){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Ge.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Yt)},this.handleReconnected=()=>{var a,l;(l=(a=this.reconnectFuture)===null||a===void 0?void 0:a.resolve)===null||l===void 0||l.call(a),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var a,l,c,u,d,h;this.reconnectFuture&&(this.reconnectFuture.promise.catch(f=>this.log.warn(f.message,this.logContext)),(l=(a=this.reconnectFuture)===null||a===void 0?void 0:a.reject)===null||l===void 0||l.call(a,"Got disconnected during reconnection attempt"),this.reconnectFuture=void 0),this.signalConnectedFuture&&((u=(c=this.signalConnectedFuture).reject)===null||u===void 0||u.call(c,"Got disconnected without signal connected"),this.signalConnectedFuture=void 0),(h=(d=this.activeAgentFuture)===null||d===void 0?void 0:d.reject)===null||h===void 0||h.call(d,"Got disconnected without active agent present"),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=a=>{var l,c;a.participant&&this.updateInfo(a.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Yt),(c=(l=this.signalConnectedFuture).resolve)===null||c===void 0||c.call(l)},this.handleSignalRequestResponse=a=>{const{requestId:l,reason:c,message:u}=a,d=this.pendingSignalRequests.get(l);d&&(c!==Tm.OK&&d.reject(new yy(u,c)),this.pendingSignalRequests.delete(l))},this.handleDataPacket=a=>{switch(a.value.case){case"rpcResponse":let l=a.value.value,c=null,u=null;l.value.case==="payload"?c=l.value.value:l.value.case==="error"&&(u=je.fromProto(l.value.value)),this.handleIncomingRpcResponse(l.requestId,c,u);break;case"rpcAck":let d=a.value.value;this.handleIncomingRpcAck(d.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(a=>fN(a)))},this.onTrackUnmuted=a=>{this.onTrackMuted(a,a.isUpstreamPaused)},this.onTrackMuted=(a,l)=>{if(l===void 0&&(l=!0),!a.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),le(a)));return}this.engine.updateMuteStatus(a.sid,l)},this.onTrackUpstreamPaused=a=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),le(a))),this.onTrackMuted(a,!0)},this.onTrackUpstreamResumed=a=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),le(a))),this.onTrackMuted(a,a.isMuted)},this.onTrackFeatureUpdate=a=>{const l=this.audioTrackPublications.get(a.sid);if(!l){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(a.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(l.trackSid,l.getTrackFeatures())},this.onTrackCpuConstrained=(a,l)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),le(l))),this.emit(q.LocalTrackCpuConstrained,a,l)},this.handleSubscribedQualityUpdate=a=>T(this,void 0,void 0,function*(){var l,c,u,d,h;if(!(!((h=this.roomOptions)===null||h===void 0)&&h.dynacast))return;const f=this.videoTrackPublications.get(a.trackSid);if(!f){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}if(!f.videoTrack)return;const v=yield f.videoTrack.setPublishingCodecs(a.subscribedCodecs);try{for(var p=!0,y=oi(v),m;m=yield y.next(),l=m.done,!l;p=!0){d=m.value,p=!1;const g=d;zD(g)&&(this.log.debug("publish ".concat(g," for ").concat(f.videoTrack.sid),Object.assign(Object.assign({},this.logContext),le(f))),yield this.publishAdditionalCodecForTrack(f.videoTrack,g,f.options))}}catch(g){c={error:g}}finally{try{!p&&!l&&(u=y.return)&&(yield u.call(y))}finally{if(c)throw c.error}}}),this.handleLocalTrackUnpublished=a=>{const l=this.trackPublications.get(a.trackSid);if(!l){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}this.unpublishTrack(l.track)},this.handleTrackEnded=a=>T(this,void 0,void 0,function*(){if(a.source===D.Source.ScreenShare||a.source===D.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),le(a))),this.unpublishTrack(a);else if(a.isUserProvided)yield a.mute();else if(Yn(a)||Oi(a))try{if(_t())try{const l=yield navigator==null?void 0:navigator.permissions.query({name:a.source===D.Source.Camera?"camera":"microphone"});if(l&&l.state==="denied")throw this.log.warn("user has revoked access to ".concat(a.source),Object.assign(Object.assign({},this.logContext),le(a))),l.onchange=()=>{l.state!=="denied"&&(a.isMuted||a.restartTrack(),l.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}a.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),le(a))),Yn(a)?yield a.restartTrack({deviceId:"default"}):yield a.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),le(a))),yield a.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=s,this.roomOutgoingDataStreamManager=o}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Ge.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(z.RemoteMute,(i,r)=>{const s=this.trackPublications.get(i);!s||!s.track||(r?s.mute():s.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(z.Connected,this.handleReconnected).on(z.SignalConnected,this.handleSignalConnected).on(z.SignalRestarted,this.handleReconnected).on(z.SignalResumed,this.handleReconnected).on(z.Restarting,this.handleReconnecting).on(z.Resuming,this.handleReconnecting).on(z.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(z.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(z.Closing,this.handleClosing).on(z.SignalRequestResponse,this.handleSignalRequestResponse).on(z.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return T(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return T(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return T(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return T(this,arguments,void 0,function(n){var i=this;let{metadata:r,name:s,attributes:o}=n;return function*(){return new Promise((a,l)=>T(i,void 0,void 0,function*(){var c,u;try{let d=!1;const h=yield this.engine.client.sendUpdateLocalMetadata((c=r??this.metadata)!==null&&c!==void 0?c:"",(u=s??this.name)!==null&&u!==void 0?u:"",o),f=performance.now();for(this.pendingSignalRequests.set(h,{resolve:a,reject:v=>{l(v),d=!0},values:{name:s,metadata:r,attributes:o}});performance.now()-f<5e3&&!d;){if((!s||this.name===s)&&(!r||this.metadata===r)&&(!o||Object.entries(o).every(v=>{let[p,y]=v;return this.attributes[p]===y||y===""&&!this.attributes[p]}))){this.pendingSignalRequests.delete(h),a();return}yield It(50)}l(new yy("Request to update local metadata timed out","TimeoutError"))}catch(d){d instanceof Error&&l(d)}}))}()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(D.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(D.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(D.Source.ScreenShare,e,n,i)}setE2EEEnabled(e){return T(this,void 0,void 0,function*(){this.encryptionType=e?Ge.GCM:Ge.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,r){return T(this,void 0,void 0,function*(){var s,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(n)if(a)yield a.unmute();else{let l;if(this.pendingPublishing.has(e)){const c=yield this.waitForPendingPublicationOfSource(e);return c||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield c==null?void 0:c.unmute(),c}this.pendingPublishing.add(e);try{switch(e){case D.Source.Camera:l=yield this.createTracks({video:(s=i)!==null&&s!==void 0?s:!0});break;case D.Source.Microphone:l=yield this.createTracks({audio:(o=i)!==null&&o!==void 0?o:!0});break;case D.Source.ScreenShare:l=yield this.createScreenTracks(Object.assign({},i));break;default:throw new ai(e)}}catch(c){throw l==null||l.forEach(u=>{u.stop()}),c instanceof Error&&this.emit(q.MediaDevicesError,c,Nf(e)),this.pendingPublishing.delete(e),c}for(const c of l){const u=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);e===D.Source.Microphone&&Vn(c)&&u.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),c.startPreConnectBuffer())}try{const c=[];for(const d of l)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),le(d))),c.push(this.publishTrack(d,r));[a]=yield Promise.all(c)}catch(c){throw l==null||l.forEach(u=>{u.stop()}),c}finally{this.pendingPublishing.delete(e)}}else if(!(a!=null&&a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===D.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const l=this.getTrackPublication(D.Source.ScreenShareAudio);l&&l.track&&this.unpublishTrack(l.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return T(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(D.Source.Camera)||this.pendingPublishing.has(D.Source.Microphone))){this.pendingPublishing.add(D.Source.Camera),this.pendingPublishing.add(D.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(D.Source.Camera),this.pendingPublishing.delete(D.Source.Microphone)}}})}createTracks(e){return T(this,void 0,void 0,function*(){var n,i;e??(e={});const r=FT(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield Vu(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(a=>(Vn(a)&&(this.microphoneError=void 0,a.setAudioContext(this.audioContext),a.source=D.Source.Microphone,this.emit(q.AudioStreamAcquired)),br(a)&&(this.cameraError=void 0,a.source=D.Source.Camera),a))}catch(s){throw s instanceof Error&&(e.audio&&(this.microphoneError=s),e.video&&(this.cameraError=s)),s}})}createScreenTracks(e){return T(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new _m("getDisplayMedia not supported");e.resolution===void 0&&!JD()&&(e.resolution=Em.h1080fps30.resolution);const n=cM(e),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(r.length===0)throw new ai("no video track found");const s=new Yc(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=D.Source.ScreenShare,e.contentHint&&(s.mediaStreamTrack.contentHint=e.contentHint);const o=[s];if(i.getAudioTracks().length>0){this.emit(q.AudioStreamAcquired);const a=new Qc(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=D.Source.ScreenShareAudio,o.push(a)}return o})}publishTrack(e,n){return T(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return T(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var a,l,c,u;Yn(i)&&i.setAudioContext(s.audioContext),yield(a=s.reconnectFuture)===null||a===void 0?void 0:a.promise,s.republishPromise&&!o&&(yield s.republishPromise),Ks(i)&&s.pendingPublishPromises.has(i)&&(yield s.pendingPublishPromises.get(i));let d;if(i instanceof MediaStreamTrack)d=i.getConstraints();else{d=i.constraints;let m;switch(i.source){case D.Source.Microphone:m="audioinput";break;case D.Source.Camera:m="videoinput"}m&&s.activeDeviceMap.has(m)&&(d=Object.assign(Object.assign({},d),{deviceId:s.activeDeviceMap.get(m)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new Qc(i,d,!0,s.audioContext,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;case"video":i=new Yc(i,d,!0,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;default:throw new ai("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});let h;if(s.trackPublications.forEach(m=>{m.track&&m.track===i&&(h=m)}),h)return s.log.warn("track has already been published, skipping",Object.assign(Object.assign({},s.logContext),le(h))),h;const f=Object.assign(Object.assign({},s.roomOptions.publishDefaults),r),v="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,p=(l=f.forceStereo)!==null&&l!==void 0?l:v;p&&(f.dtx===void 0&&s.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},s.logContext),le(i))),f.red===void 0&&s.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(c=f.dtx)!==null&&c!==void 0||(f.dtx=!1),(u=f.red)!==null&&u!==void 0||(f.red=!1)),!YD()&&s.roomOptions.e2ee&&(s.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},s.logContext)),f.simulcast=!1),f.source&&(i.source=f.source);const y=new Promise((m,g)=>T(s,void 0,void 0,function*(){try{if(this.engine.client.currentState!==Ce.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:le(i)}));const b=setTimeout(()=>{g(new vy("publishing rejected as engine not connected within timeout",408))},15e3);yield this.waitUntilEngineConnected(),clearTimeout(b);const w=yield this.publish(i,f,p);m(w)}else try{const b=yield this.publish(i,f,p);m(b)}catch(b){g(b)}}catch(b){g(b)}}));s.pendingPublishPromises.set(i,y);try{return yield y}catch(m){throw m}finally{s.pendingPublishPromises.delete(i)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Yt),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),le(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(r=>fM(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),le(e))),!1)}publish(e,n,i){return T(this,void 0,void 0,function*(){var r,s,o,a,l,c,u,d,h,f;if(!this.hasPermissionsToPublish(e))throw new vy("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(x=>Ks(e)&&x.source===e.source)&&e.source!==D.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),le(e))),n.stopMicTrackOnMute&&Vn(e)&&(e.stopOnMute=!0),e.source===D.Source.ScreenShare&&Yr()&&(n.simulcast=!1),n.videoCodec==="av1"&&!HD()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!KD()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=Lf),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(x=>n.videoCodec===ca(x.mime))||(n.videoCodec=ca(this.enabledPublishVideoCodecs[0].mime)));const p=n.videoCodec;e.on($.Muted,this.onTrackMuted),e.on($.Unmuted,this.onTrackUnmuted),e.on($.Ended,this.handleTrackEnded),e.on($.UpstreamPaused,this.onTrackUpstreamPaused),e.on($.UpstreamResumed,this.onTrackUpstreamResumed),e.on($.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const y=[],m=!(!((r=n.dtx)!==null&&r!==void 0)||r),g=e.getSourceTrackSettings();g.autoGainControl&&y.push(Ye.TF_AUTO_GAIN_CONTROL),g.echoCancellation&&y.push(Ye.TF_ECHO_CANCELLATION),g.noiseSuppression&&y.push(Ye.TF_NOISE_SUPPRESSION),g.channelCount&&g.channelCount>1&&y.push(Ye.TF_STEREO),m&&y.push(Ye.TF_NO_DTX),Yn(e)&&e.hasPreConnectBuffer&&y.push(Ye.TF_PRECONNECT_BUFFER);const b=new Kc({cid:e.mediaStreamTrack.id,name:n.name,type:D.kindToProto(e.kind),muted:e.isMuted,source:D.sourceToProto(e.source),disableDtx:m,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((s=n.red)!==null&&s!==void 0)||s),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy,audioFeatures:y});let w;if(e.kind===D.Kind.Video){let x={width:0,height:0};try{x=yield e.waitForDimensions()}catch{const L=(a=(o=this.roomOptions.videoCaptureDefaults)===null||o===void 0?void 0:o.resolution)!==null&&a!==void 0?a:Ua.h720.resolution;x={width:L.width,height:L.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),le(e)),{dims:x}))}b.width=x.width,b.height=x.height,Oi(e)&&(jn(p)&&(e.source===D.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),le(e))))),n.scalabilityMode=(l=n.scalabilityMode)!==null&&l!==void 0?l:"L3T3_KEY"),b.simulcastCodecs=[new gf({codec:p,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:Lf}),n.backupCodec&&p!==n.backupCodec.codec&&b.encryption===Ge.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),b.simulcastCodecs.push(new gf({codec:n.backupCodec.codec,cid:""})))),w=Uf(e.source===D.Source.ScreenShare,b.width,b.height,n),b.layers=$y(b.width,b.height,w,jn(n.videoCodec))}else e.kind===D.Kind.Audio&&(w=[{maxBitrate:(c=n.audioPreset)===null||c===void 0?void 0:c.maxBitrate,priority:(d=(u=n.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&d!==void 0?d:"high",networkPriority:(f=(h=n.audioPreset)===null||h===void 0?void 0:h.priority)!==null&&f!==void 0?f:"high"}]);if(!this.engine||this.engine.isClosed)throw new We("cannot publish track when not connected");const k=()=>T(this,void 0,void 0,function*(){var x,R,L;if(!this.engine.pcManager)throw new We("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,w),this.emit(q.LocalSenderCreated,e.sender,e),Oi(e)&&((x=n.degradationPreference)!==null&&x!==void 0||(n.degradationPreference=JM(e)),e.setDegradationPreference(n.degradationPreference)),w)if(Yr()&&e.kind===D.Kind.Audio){let j;for(const K of this.engine.pcManager.publisher.getTransceivers())if(K.sender===e.sender){j=K;break}j&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:j,codec:"opus",maxbr:!((R=w[0])===null||R===void 0)&&R.maxBitrate?w[0].maxBitrate/1e3:0})}else e.codec&&jn(e.codec)&&(!((L=w[0])===null||L===void 0)&&L.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:b.cid,codec:e.codec,maxbr:w[0].maxBitrate/1e3});yield this.engine.negotiate()});let S;const _=new Promise((x,R)=>T(this,void 0,void 0,function*(){var L;try{S=yield this.engine.addTrack(b),x(S)}catch(j){e.sender&&(!((L=this.engine.pcManager)===null||L===void 0)&&L.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(K=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),le(e)),{error:K}))})),R(j)}}));if(this.enabledPublishVideoCodecs.length>0)S=(yield Promise.all([_,k()]))[0];else{S=yield _;let x;if(S.codecs.forEach(R=>{x===void 0&&(x=R.mimeType)}),x&&e.kind===D.Kind.Video){const R=ca(x);R!==p&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),le(e)),{codec:R})),n.videoCodec=R,w=Uf(e.source===D.Source.ScreenShare,b.width,b.height,n))}yield k()}const E=new $f(e.kind,S,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(E.on($.CpuConstrained,x=>this.onTrackCpuConstrained(x,E)),E.options=n,e.sid=S.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:w,trackInfo:S})),Oi(e)?e.startMonitor(this.engine.client):Yn(e)&&e.startMonitor(),this.addTrackPublication(E),this.emit(q.LocalTrackPublished,E),Yn(e)&&S.audioFeatures.includes(Ye.TF_PRECONNECT_BUFFER)){const x=e.getPreConnectBuffer(),R=e.getPreConnectBufferMimeType();this.on(q.LocalTrackSubscribed,L=>{if(L.trackSid===S.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),le(e))),e.stopPreConnectBuffer()}}),x&&new Promise((j,K)=>T(this,void 0,void 0,function*(){var B,J,Q,X,I,M;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),le(e)));const ne=setTimeout(()=>{K(new Error("agent not active within 10 seconds"))},1e4),se=yield this.waitUntilActiveAgentPresent();clearTimeout(ne),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),le(e)));const Re=yield this.streamBytes({name:"preconnect-buffer",mimeType:R,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[se.identity],attributes:{trackId:E.trackSid,sampleRate:String((I=g.sampleRate)!==null&&I!==void 0?I:"48000"),channels:String((M=g.channelCount)!==null&&M!==void 0?M:"1")}});try{for(var W=!0,Y=oi(x),G;G=yield Y.next(),B=G.done,!B;W=!0){X=G.value,W=!1;const Be=X;yield Re.write(Be)}}catch(Be){J={error:Be}}finally{try{!W&&!B&&(Q=Y.return)&&(yield Q.call(Y))}finally{if(J)throw J.error}}yield Re.close(),j()}catch(ne){K(ne)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),le(e)))}).catch(j=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),le(e)),{error:j}))})}return E})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return T(this,void 0,void 0,function*(){var r;if(this.encryptionType!==Ge.NONE)return;let s;if(this.trackPublications.forEach(f=>{f.track&&f.track===e&&(s=f)}),!s)throw new ai("track is not published");if(!Oi(e))throw new ai("track is not a video track");const o=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),a=HM(e,n,o);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),le(e)));return}const l=e.addSimulcastTrack(n,a);if(!l)return;const c=new Kc({cid:l.mediaStreamTrack.id,type:D.kindToProto(e.kind),muted:e.isMuted,source:D.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:l.mediaStreamTrack.id}]});if(c.layers=$y(c.width,c.height,a),!this.engine||this.engine.isClosed)throw new We("cannot publish track when not connected");const u=()=>T(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,l,o,a),yield this.engine.negotiate()}),h=(yield Promise.all([this.engine.addTrack(c),u()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:h}))})}unpublishTrack(e,n){return T(this,void 0,void 0,function*(){var i,r;if(Ks(e)){const c=this.pendingPublishPromises.get(e);c&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),le(e))),yield c)}const s=this.getPublicationForTrack(e),o=s?le(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));return}e=s.track,e.off($.Muted,this.onTrackMuted),e.off($.Unmuted,this.onTrackUnmuted),e.off($.Ended,this.handleTrackEnded),e.off($.UpstreamPaused,this.onTrackUpstreamPaused),e.off($.UpstreamResumed,this.onTrackUpstreamResumed),e.off($.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let a=!1;const l=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Me.FAILED&&l)try{for(const c of this.engine.pcManager.publisher.getTransceivers())c.sender===l&&(c.direction="inactive",a=!0);if(this.engine.removeTrack(l)&&(a=!0),Oi(e)){for(const[,c]of e.simulcastCodecs)c.sender&&(this.engine.removeTrack(c.sender)&&(a=!0),c.sender=void 0);e.simulcastCodecs.clear()}}catch(c){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:c}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case D.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case D.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(q.LocalTrackUnpublished,s),s.setTrack(void 0),a&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return T(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return T(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Promise((s,o)=>T(i,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(l=>{l.track&&(n&&(l.options=Object.assign(Object.assign({},l.options),n)),a.push(l))}),yield Promise.all(a.map(l=>T(this,void 0,void 0,function*(){const c=l.track;yield this.unpublishTrack(c,!1),r&&!c.isMuted&&c.source!==D.Source.ScreenShare&&c.source!==D.Source.ScreenShareAudio&&(Yn(c)||Oi(c))&&!c.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:l.trackSid})),yield c.restartTrack()),yield this.publishOrRepublishTrack(c,l.options,!0)}))),s()}catch(a){o(a)}finally{this.republishPromise=void 0}})),yield i.republishPromise}()})}publishData(e){return T(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const s=r.reliable?re.RELIABLE:re.LOSSY,o=r.destinationIdentities,a=r.topic;let l=new mm({participantIdentity:i.identity,payload:n,destinationIdentities:o,topic:a});const c=new pt({kind:s,value:{case:"user",value:l}});yield i.engine.sendDataPacket(c,s)}()})}publishDtmf(e,n){return T(this,void 0,void 0,function*(){const i=new pt({kind:re.RELIABLE,value:{case:"sipDtmf",value:new US({code:e,digit:n})}});yield this.engine.sendDataPacket(i,re.RELIABLE)})}sendChatMessage(e,n){return T(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},r=new pt({value:{case:"chatMessage",value:new zc(Object.assign(Object.assign({},i),{timestamp:xe.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,re.RELIABLE),this.emit(q.ChatMessage,i),i})}editChatMessage(e,n){return T(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new pt({value:{case:"chatMessage",value:new zc(Object.assign(Object.assign({},i),{timestamp:xe.parse(i.timestamp),editTimestamp:xe.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,re.RELIABLE),this.emit(q.ChatMessage,i),i})}sendText(e,n){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,n)})}streamText(e){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,n){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,n)})}streamBytes(e){return T(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return T(this,arguments,void 0,function(n){var i=this;let{destinationIdentity:r,method:s,payload:o,responseTimeout:a=1e4}=n;return function*(){return new Promise((c,u)=>T(i,void 0,void 0,function*(){var d,h,f,v;if(Dm(o)>HT){u(je.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((h=(d=this.engine.latestJoinResponse)===null||d===void 0?void 0:d.serverInfo)===null||h===void 0)&&h.version&&Wn((v=(f=this.engine.latestJoinResponse)===null||f===void 0?void 0:f.serverInfo)===null||v===void 0?void 0:v.version,"1.8.0")<0){u(je.builtIn("UNSUPPORTED_SERVER"));return}const p=crypto.randomUUID();yield this.publishRpcRequest(r,p,s,o,a-2e3);const y=setTimeout(()=>{this.pendingAcks.delete(p),u(je.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(p),clearTimeout(m)},2e3);this.pendingAcks.set(p,{resolve:()=>{clearTimeout(y)},participantIdentity:r});const m=setTimeout(()=>{this.pendingResponses.delete(p),u(je.builtIn("RESPONSE_TIMEOUT"))},a);this.pendingResponses.set(p,{resolve:(g,b)=>{clearTimeout(m),this.pendingAcks.has(p)&&(console.warn("RPC response received before ack",p),this.pendingAcks.delete(p),clearTimeout(y)),b?u(b):c(g??"")},participantIdentity:r})}))}()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const r=this.pendingResponses.get(e);r?(r.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,r,s){return T(this,void 0,void 0,function*(){const o=new pt({destinationIdentities:[e],kind:re.RELIABLE,value:{case:"rpcRequest",value:new gm({id:n,method:i,payload:r,responseTimeoutMs:s,version:1})}});yield this.engine.sendDataPacket(o,re.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,je.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,r;const s=this.trackPublications.get(n.sid);if(s){const o=s.isMuted||((r=(i=s.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);o!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),le(s)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(n.sid,o))}}),!0):!1}setActiveAgent(e){var n,i,r,s;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(s=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||s===void 0||s.call(r,"Agent disconnected"),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Yt),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(Yn(r)||Oi(r))&&r.mediaStreamTrack===e&&(n=i):e===r&&(n=i))}),n}waitForPendingPublicationOfSource(e){return T(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(s=>{let[o]=s;return o.source===e});if(r)return r[1];yield It(20)}})}}class mN extends ti{constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=s=>{this.setTrack(void 0),this.emit($.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.visible=s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensionsAdaptiveStream=s,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new Uu({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new BS({participantSid:"",trackSids:[this.trackSid]})]});this.emit($.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?ti.SubscriptionStatus.Unsubscribed:super.isSubscribed?ti.SubscriptionStatus.Subscribed:ti.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?ti.PermissionStatus.Allowed:ti.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||($d(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&$d(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:Lt.HIGH}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off($.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off($.VisibilityChanged,this.handleVisibilityChange),r.off($.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit($.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on($.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on($.VisibilityChanged,this.handleVisibilityChange),e.on($.Ended,this.handleEnded),this.emit($.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit($.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?$.Muted:$.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit($.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit($.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return $d(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new GS({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===D.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)Py(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=pM(this.trackInfo,this.requestedMaxQuality);i&&Py(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:Lt.HIGH})),e.quality=Lt.HIGH)}this.emit($.UpdateSettings,e)}}class Xc extends eC{static fromParticipantInfo(e,n,i){return new Xc(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,r,s,o,a){let l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:ja.STANDARD;super(n,i||"",r,s,o,a,l),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on($.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),le(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on($.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on($.SubscriptionPermissionChanged,n=>{this.emit(q.TrackSubscriptionPermissionChanged,e,n)}),e.on($.SubscriptionStatusChanged,n=>{this.emit(q.TrackSubscriptionStatusChanged,e,n)}),e.on($.Subscribed,n=>{this.emit(q.TrackSubscribed,n,e)}),e.on($.Unsubscribed,n=>{this.emit(q.TrackUnsubscribed,n,e)}),e.on($.SubscriptionFailed,n=>{this.emit(q.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:D.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,r,s,o){let a=this.getTrackPublicationBySid(n);if(a||n.startsWith("TR")||this.trackPublications.forEach(u=>{!a&&e.kind===u.kind.toString()&&(a=u)}),!a){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(q.TrackSubscriptionFailed,n);return}o===void 0&&(o=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,r,s,o-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),le(a))),this.emit(q.TrackSubscriptionFailed,n);return}const l=e.kind==="video";let c;return l?c=new cN(e,n,r,s):c=new lN(e,n,r,this.audioContext,this.audioOutput),c.source=a.source,c.isMuted=a.isMuted,c.setMediaStream(i),c.start(),a.setTrack(c),this.volumeMap.has(a.source)&&Df(c)&&Vn(c)&&c.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(r=>{var s,o;let a=this.getTrackPublicationBySid(r.sid);if(a)a.updateInfo(r);else{const l=D.kindFromProto(r.type);if(!l)return;a=new mN(l,r,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(o=this.loggerOptions)===null||o===void 0?void 0:o.loggerName}),a.updateInfo(r),i.set(r.sid,a);const c=Array.from(this.trackPublications.values()).find(u=>u.source===(a==null?void 0:a.source));c&&a.source!==D.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:le(c),newTrack:le(a)})),this.addTrackPublication(a)}n.set(r.sid,a)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),le(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit(q.TrackPublished,r)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case D.Kind.Audio:this.audioTrackPublications.delete(e);break;case D.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(q.TrackUnpublished,i)}setAudioOutput(e){return T(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var r;Vn(i.track)&&Df(i.track)&&n.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var pe;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(pe||(pe={}));const gN=4*1e3;class po extends Kn.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var n,i,r,s;if(super(),n=this,this.state=pe.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=ae,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(o,a,l)=>T(this,void 0,void 0,function*(){var c;if(!GD())throw qn()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const u=yield this.disconnectLock.lock();if(this.state===pe.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),u(),Promise.resolve();if(this.connectFuture)return u(),this.connectFuture.promise;this.setAndEmitConnectionState(pe.Connecting),((c=this.regionUrlProvider)===null||c===void 0?void 0:c.getServerUrl().toString())!==o&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Of(new URL(o))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new Ff(o,a):this.regionUrlProvider.updateToken(a),this.regionUrlProvider.fetchRegionSettings().then(f=>{var v;(v=this.regionUrlProvider)===null||v===void 0||v.setServerReportedRegions(f)}).catch(f=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:f}))}));const d=(f,v,p)=>T(this,void 0,void 0,function*(){var y,m;this.abortController&&this.abortController.abort();const g=new AbortController;this.abortController=g,u==null||u();try{yield this.attemptConnection(p??o,a,l,g),this.abortController=void 0,f()}catch(b){if(this.regionUrlProvider&&b instanceof be&&b.reason!==de.Cancelled&&b.reason!==de.NotAllowed){let w=null;try{w=yield this.regionUrlProvider.getNextBestRegionUrl((y=this.abortController)===null||y===void 0?void 0:y.signal)}catch(k){if(k instanceof be&&(k.status===401||k.reason===de.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),v(k);return}}w&&!(!((m=this.abortController)===null||m===void 0)&&m.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(b.message,". Retrying with another region: ").concat(w),this.logContext),this.recreateEngine(),yield d(f,v,w)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Ey(b)),v(b))}else{let w=bn.UNKNOWN_REASON;b instanceof be&&(w=Ey(b)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,w),v(b)}}}),h=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Yt((f,v)=>{d(f,v,h)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(o,a,l,c,u,d)=>T(this,void 0,void 0,function*(){var h,f,v;const p=yield l.join(o,a,{autoSubscribe:c.autoSubscribe,adaptiveStream:typeof u.adaptiveStream=="object"?!0:u.adaptiveStream,maxRetries:c.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:c.websocketTimeout},d.signal);let y=p.serverInfo;if(y||(y={version:p.serverVersion,region:p.serverRegion}),this.serverInfo=y,this.log.debug("connected to Livekit Server ".concat(Object.entries(y).map(m=>{let[g,b]=m;return"".concat(g,": ").concat(b)}).join(", ")),{room:(h=p.room)===null||h===void 0?void 0:h.name,roomSid:(f=p.room)===null||f===void 0?void 0:f.sid,identity:(v=p.participant)===null||v===void 0?void 0:v.identity}),!y.version)throw new AD("unknown server version");return y.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),u.dynacast=!1),p}),this.applyJoinResponse=o=>{const a=o.participant;if(this.localParticipant.sid=a.sid,this.localParticipant.identity=a.identity,this.localParticipant.setEnabledPublishCodecs(o.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(o.sifTrailer)}catch(l){this.log.error(l instanceof Error?l.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:l}))}this.handleParticipantUpdates([a,...o.otherParticipants]),o.room&&this.handleRoomUpdate(o.room)},this.attemptConnection=(o,a,l,c)=>T(this,void 0,void 0,function*(){var u,d;this.state===pe.Reconnecting||this.isResuming||!((u=this.engine)===null||u===void 0)&&u.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((d=this.regionUrlProvider)===null||d===void 0)&&d.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},Am),l),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const h=yield this.connectSignal(o,a,this.engine,this.connOptions,this.options,c);this.applyJoinResponse(h),this.setupLocalParticipantEvents(),this.emit(U.SignalConnected)}catch(h){yield this.engine.close(),this.recreateEngine();const f=new be("could not establish signal connection",de.ServerUnreachable);throw h instanceof Error&&(f.message="".concat(f.message,": ").concat(h.message)),h instanceof be&&(f.reason=h.reason,f.status=h.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:h})),f}if(c.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new be("Connection attempt aborted",de.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,c)}catch(h){throw yield this.engine.close(),this.recreateEngine(),h}_t()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),_t()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(pe.Connected),this.emit(U.Connected),this.registerConnectionReconcile()}),this.disconnect=function(){for(var o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];return T(n,[...a],void 0,function(){var c=this;let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var d,h,f,v;const p=yield c.disconnectLock.lock();try{if(c.state===pe.Disconnected){c.log.debug("already disconnected",c.logContext);return}c.log.info("disconnect from room",Object.assign({},c.logContext)),(c.state===pe.Connecting||c.state===pe.Reconnecting||c.isResuming)&&(c.log.warn("abort connection attempt",c.logContext),(d=c.abortController)===null||d===void 0||d.abort(),(f=(h=c.connectFuture)===null||h===void 0?void 0:h.reject)===null||f===void 0||f.call(h,new be("Client initiated disconnect",de.Cancelled)),c.connectFuture=void 0),!((v=c.engine)===null||v===void 0)&&v.client.isDisconnected||(yield c.engine.client.sendLeave()),c.engine&&(yield c.engine.close()),c.handleDisconnect(u,bn.CLIENT_INITIATED),c.engine=void 0}finally{p()}}()})},this.onPageLeave=()=>T(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>T(this,void 0,void 0,function*(){const o=[],a=Ft();if(a&&a.os==="iOS"){const l="livekit-dummy-audio-el";let c=document.getElementById(l);if(!c){c=document.createElement("audio"),c.id=l,c.autoplay=!0,c.hidden=!0;const u=Bd();u.enabled=!0;const d=new MediaStream([u]);c.srcObject=d,document.addEventListener("visibilitychange",()=>{c&&(c.srcObject=document.hidden?null:d,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(c),this.once(U.Disconnected,()=>{c==null||c.remove(),c=null})}o.push(c)}this.remoteParticipants.forEach(l=>{l.audioTrackPublications.forEach(c=>{c.track&&c.track.attachedElements.forEach(u=>{o.push(u)})})});try{yield Promise.all([this.acquireAudioContext(),...o.map(l=>(l.muted=!1,l.play()))]),this.handleAudioPlaybackStarted()}catch(l){throw this.handleAudioPlaybackFailed(l),l}}),this.startVideo=()=>T(this,void 0,void 0,function*(){const o=[];for(const a of this.remoteParticipants.values())a.videoTrackPublications.forEach(l=>{var c;(c=l.track)===null||c===void 0||c.attachedElements.forEach(u=>{o.includes(u)||o.push(u)})});yield Promise.all(o.map(a=>a.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(a=>{a.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const o of this.remoteParticipants.values())this.handleParticipantDisconnected(o.identity,o);this.setAndEmitConnectionState(pe.Reconnecting)&&this.emit(U.Reconnecting)},this.handleSignalRestarted=o=>T(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(o.serverRegion),Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(o);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(a){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:a}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:o.serverRegion}))}catch{return}this.setAndEmitConnectionState(pe.Connected),this.emit(U.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=o=>{o.forEach(a=>{var l;if(a.identity===this.localParticipant.identity){this.localParticipant.updateInfo(a);return}a.identity===""&&(a.identity=(l=this.sidToIdentity.get(a.sid))!==null&&l!==void 0?l:"");let c=this.remoteParticipants.get(a.identity);a.state===zs.DISCONNECTED?this.handleParticipantDisconnected(a.identity,c):c=this.getOrCreateParticipant(a.identity,a)})},this.handleActiveSpeakersUpdate=o=>{const a=[],l={};o.forEach(c=>{if(l[c.sid]=!0,c.sid===this.localParticipant.sid)this.localParticipant.audioLevel=c.level,this.localParticipant.setIsSpeaking(!0),a.push(this.localParticipant);else{const u=this.getRemoteParticipantBySid(c.sid);u&&(u.audioLevel=c.level,u.setIsSpeaking(!0),a.push(u))}}),l[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(c=>{l[c.sid]||(c.audioLevel=0,c.setIsSpeaking(!1))}),this.activeSpeakers=a,this.emitWhenConnected(U.ActiveSpeakersChanged,a)},this.handleSpeakersChanged=o=>{const a=new Map;this.activeSpeakers.forEach(c=>{const u=this.remoteParticipants.get(c.identity);u&&u.sid!==c.sid||a.set(c.sid,c)}),o.forEach(c=>{let u=this.getRemoteParticipantBySid(c.sid);c.sid===this.localParticipant.sid&&(u=this.localParticipant),u&&(u.audioLevel=c.level,u.setIsSpeaking(c.active),c.active?a.set(c.sid,u):a.delete(c.sid))});const l=Array.from(a.values());l.sort((c,u)=>u.audioLevel-c.audioLevel),this.activeSpeakers=l,this.emitWhenConnected(U.ActiveSpeakersChanged,l)},this.handleStreamStateUpdate=o=>{o.streamStates.forEach(a=>{const l=this.getRemoteParticipantBySid(a.participantSid);if(!l)return;const c=l.getTrackPublicationBySid(a.trackSid);if(!c||!c.track)return;const u=D.streamStateFromProto(a.state);c.track.setStreamState(u),u!==c.track.streamState&&(l.emit(q.TrackStreamStateChanged,c,c.track.streamState),this.emitWhenConnected(U.TrackStreamStateChanged,c,c.track.streamState,l))})},this.handleSubscriptionPermissionUpdate=o=>{const a=this.getRemoteParticipantBySid(o.participantSid);if(!a)return;const l=a.getTrackPublicationBySid(o.trackSid);l&&l.setAllowed(o.allowed)},this.handleSubscriptionError=o=>{const a=Array.from(this.remoteParticipants.values()).find(c=>c.trackPublications.has(o.trackSid));if(!a)return;const l=a.getTrackPublicationBySid(o.trackSid);l&&l.setSubscriptionError(o.err)},this.handleDataPacket=(o,a)=>{const l=this.remoteParticipants.get(o.participantIdentity);if(o.value.case==="user")this.handleUserPacket(l,o.value.value,o.kind,a);else if(o.value.case==="transcription")this.handleTranscription(l,o.value.value);else if(o.value.case==="sipDtmf")this.handleSipDtmf(l,o.value.value);else if(o.value.case==="chatMessage")this.handleChatMessage(l,o.value.value);else if(o.value.case==="metrics")this.handleMetrics(o.value.value,l);else if(o.value.case==="streamHeader"||o.value.case==="streamChunk"||o.value.case==="streamTrailer")this.handleDataStream(o,a);else if(o.value.case==="rpcRequest"){const c=o.value.value;this.handleIncomingRpcRequest(o.participantIdentity,c.id,c.method,c.payload,c.responseTimeoutMs,c.version)}},this.handleUserPacket=(o,a,l,c)=>{this.emit(U.DataReceived,a.payload,o,l,a.topic,c),o==null||o.emit(q.DataReceived,a.payload,l,c)},this.handleSipDtmf=(o,a)=>{this.emit(U.SipDTMFReceived,a,o),o==null||o.emit(q.SipDTMFReceived,a)},this.handleTranscription=(o,a)=>{const l=a.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(a.transcribedParticipantIdentity),c=l==null?void 0:l.trackPublications.get(a.trackId),u=iM(a,this.transcriptionReceivedTimes);c==null||c.emit($.TranscriptionReceived,u),l==null||l.emit(q.TranscriptionReceived,u,c),this.emit(U.TranscriptionReceived,u,l,c)},this.handleChatMessage=(o,a)=>{const l=rM(a);this.emit(U.ChatMessage,l,o)},this.handleMetrics=(o,a)=>{this.emit(U.MetricsReceived,o,a)},this.handleDataStream=(o,a)=>{this.incomingDataStreamManager.handleDataStreamPacket(o,a)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(U.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=o=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:o})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(U.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(U.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(U.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>T(this,void 0,void 0,function*(){var o;((o=Ft())===null||o===void 0?void 0:o.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(U.MediaDevicesChanged)}),this.handleRoomUpdate=o=>{const a=this.roomInfo;this.roomInfo=o,a&&a.metadata!==o.metadata&&this.emitWhenConnected(U.RoomMetadataChanged,o.metadata),(a==null?void 0:a.activeRecording)!==o.activeRecording&&this.emitWhenConnected(U.RecordingStatusChanged,o.activeRecording)},this.handleConnectionQualityUpdate=o=>{o.updates.forEach(a=>{if(a.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(a.quality);return}const l=this.getRemoteParticipantBySid(a.participantSid);l&&l.setConnectionQuality(a.quality)})},this.onLocalParticipantMetadataChanged=o=>{this.emit(U.ParticipantMetadataChanged,o,this.localParticipant)},this.onLocalParticipantNameChanged=o=>{this.emit(U.ParticipantNameChanged,o,this.localParticipant)},this.onLocalAttributesChanged=o=>{this.emit(U.ParticipantAttributesChanged,o,this.localParticipant)},this.onLocalTrackMuted=o=>{this.emit(U.TrackMuted,o,this.localParticipant)},this.onLocalTrackUnmuted=o=>{this.emit(U.TrackUnmuted,o,this.localParticipant)},this.onTrackProcessorUpdate=o=>{var a;(a=o==null?void 0:o.onPublish)===null||a===void 0||a.call(o,this)},this.onLocalTrackPublished=o=>T(this,void 0,void 0,function*(){var a,l,c,u,d,h;(a=o.track)===null||a===void 0||a.on($.TrackProcessorUpdate,this.onTrackProcessorUpdate),(l=o.track)===null||l===void 0||l.on($.Restarted,this.onLocalTrackRestarted),(d=(u=(c=o.track)===null||c===void 0?void 0:c.getProcessor())===null||u===void 0?void 0:u.onPublish)===null||d===void 0||d.call(u,this),this.emit(U.LocalTrackPublished,o,this.localParticipant),Yn(o.track)&&(yield o.track.checkForSilence())&&this.emit(U.LocalAudioSilenceDetected,o);const f=yield(h=o.track)===null||h===void 0?void 0:h.getDeviceId(!1),v=Nf(o.source);v&&f&&f!==this.localParticipant.activeDeviceMap.get(v)&&(this.localParticipant.activeDeviceMap.set(v,f),this.emit(U.ActiveDeviceChanged,v,f))}),this.onLocalTrackUnpublished=o=>{var a,l;(a=o.track)===null||a===void 0||a.off($.TrackProcessorUpdate,this.onTrackProcessorUpdate),(l=o.track)===null||l===void 0||l.off($.Restarted,this.onLocalTrackRestarted),this.emit(U.LocalTrackUnpublished,o,this.localParticipant)},this.onLocalTrackRestarted=o=>T(this,void 0,void 0,function*(){const a=yield o.getDeviceId(!1),l=Nf(o.source);l&&a&&a!==this.localParticipant.activeDeviceMap.get(l)&&(this.log.debug("local track restarted, setting ".concat(l," ").concat(a," active"),this.logContext),this.localParticipant.activeDeviceMap.set(l,a),this.emit(U.ActiveDeviceChanged,l,a))}),this.onLocalConnectionQualityChanged=o=>{this.emit(U.ConnectionQualityChanged,o,this.localParticipant)},this.onMediaDevicesError=(o,a)=>{this.emit(U.MediaDevicesError,o,a)},this.onLocalParticipantPermissionsChanged=o=>{this.emit(U.ParticipantPermissionsChanged,o,this.localParticipant)},this.onLocalChatMessageSent=o=>{this.emit(U.ChatMessage,o,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},OM),e),this.log=yi((i=this.options.loggerName)!==null&&i!==void 0?i:En.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},qT),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},WT),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},IM),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new rN,this.outgoingDataStreamManager=new aN(this.engine,this.log),this.disconnectLock=new Rt,this.localParticipant=new pN("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",ar(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",ar(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",ar(this.options.audioOutput.deviceId)).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),_t()){const o=new AbortController;(s=navigator.mediaDevices)===null||s===void 0||s.addEventListener("devicechange",this.handleDeviceChange,{signal:o.signal}),po.cleanupRegistry&&po.cleanupRegistry.register(this,()=>{o.abort()})}}registerTextStreamHandler(e,n){return this.incomingDataStreamManager.registerTextStreamHandler(e,n)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,n){return this.incomingDataStreamManager.registerByteStreamHandler(e,n)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return T(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const n=!!this.options.encryption,i=this.options.encryption||this.options.e2ee;i&&("e2eeManager"in i?this.e2eeManager=i.e2eeManager:this.e2eeManager=new mM(i,n),this.e2eeManager.on(Qi.ParticipantEncryptionStatusChanged,(r,s)=>{oM(s)&&(this.isE2EEEnabled=r),this.emit(U.ParticipantEncryptionStatusChanged,r,s)}),this.e2eeManager.on(Qi.EncryptionError,r=>this.emit(U.EncryptionError,r)),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return T(this,void 0,void 0,function*(){return this.state===pe.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const i=r=>{r.sid!==""&&(this.engine.off(z.RoomUpdate,i),e(r.sid))};this.engine.on(z.RoomUpdate,i),this.once(U.Disconnected,()=>{this.engine.off(z.RoomUpdate,i),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new ZM(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(z.ParticipantUpdate,this.handleParticipantUpdates).on(z.RoomUpdate,this.handleRoomUpdate).on(z.SpeakersChanged,this.handleSpeakersChanged).on(z.StreamStateChanged,this.handleStreamStateUpdate).on(z.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(z.SubscriptionError,this.handleSubscriptionError).on(z.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(z.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(z.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(z.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(z.DataPacketReceived,this.handleDataPacket).on(z.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(pe.SignalReconnecting)&&this.emit(U.SignalReconnecting)}).on(z.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(pe.Connected)&&this.emit(U.Reconnected)}).on(z.SignalResumed,()=>{this.bufferedEvents=[],(this.state===pe.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(z.Restarting,this.handleRestarting).on(z.SignalRestarted,this.handleSignalRestarted).on(z.Offline,()=>{this.setAndEmitConnectionState(pe.Reconnecting)&&this.emit(U.Reconnecting)}).on(z.DCBufferStatusChanged,(e,n)=>{this.emit(U.DCBufferStatusChanged,e,n)}).on(z.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(q.LocalTrackSubscribed,n),this.emitWhenConnected(U.LocalTrackSubscribed,n,this.localParticipant)}).on(z.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(U.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Xe.getInstance().getDevices(e,n)}prepareConnection(e,n){return T(this,void 0,void 0,function*(){if(this.state===pe.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Of(new URL(e))&&n){this.regionUrlProvider=new Ff(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===pe.Disconnected&&(this.regionUrl=i,yield fetch(Af(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(Af(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return T(this,void 0,void 0,function*(){let i=()=>T(this,void 0,void 0,function*(){}),r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new xn({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new xn({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new xn({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new xn({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>T(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new xn({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>T(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new xn({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new xn({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>T(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new Fu({reason:bn.CLIENT_INITIATED,action:qs.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new xn({scenario:{case:"subscriberBandwidth",value:Rr(n)}});break;case"leave-full-reconnect":r=new xn({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return T(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return function*(){var a,l,c,u,d,h,f;let v=!0,p=!1;const y=o?{exact:r}:r;if(i==="audioinput"){p=s.localParticipant.audioTrackPublications.size===0;const m=(a=s.getActiveDevice(i))!==null&&a!==void 0?a:s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=y;const g=Array.from(s.localParticipant.audioTrackPublications.values()).filter(w=>w.source===D.Source.Microphone);try{v=(yield Promise.all(g.map(w=>{var k;return(k=w.audioTrack)===null||k===void 0?void 0:k.setDeviceId(y)}))).every(w=>w===!0)}catch(w){throw s.options.audioCaptureDefaults.deviceId=m,w}const b=g.some(w=>{var k,S;return(S=(k=w.track)===null||k===void 0?void 0:k.isMuted)!==null&&S!==void 0?S:!1});v&&b&&(p=!0)}else if(i==="videoinput"){p=s.localParticipant.videoTrackPublications.size===0;const m=(l=s.getActiveDevice(i))!==null&&l!==void 0?l:s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=y;const g=Array.from(s.localParticipant.videoTrackPublications.values()).filter(w=>w.source===D.Source.Camera);try{v=(yield Promise.all(g.map(w=>{var k;return(k=w.videoTrack)===null||k===void 0?void 0:k.setDeviceId(y)}))).every(w=>w===!0)}catch(w){throw s.options.videoCaptureDefaults.deviceId=m,w}const b=g.some(w=>{var k,S;return(S=(k=w.track)===null||k===void 0?void 0:k.isMuted)!==null&&S!==void 0?S:!1});v&&b&&(p=!0)}else if(i==="audiooutput"){if(p=!0,!If()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");s.options.webAudioMix&&(r=(c=yield Xe.getInstance().normalizeDeviceId("audiooutput",r))!==null&&c!==void 0?c:""),(u=(f=s.options).audioOutput)!==null&&u!==void 0||(f.audioOutput={});const m=(d=s.getActiveDevice(i))!==null&&d!==void 0?d:s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=r;try{s.options.webAudioMix&&((h=s.audioContext)===null||h===void 0||h.setSinkId(r)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(g=>g.setAudioOutput({deviceId:r})))}catch(g){throw s.options.audioOutput.deviceId=m,g}}return p&&(s.localParticipant.activeDeviceMap.set(i,r),s.emit(U.ActiveDeviceChanged,i,r)),v}()})}setupLocalParticipantEvents(){this.localParticipant.on(q.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(q.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(q.AttributesChanged,this.onLocalAttributesChanged).on(q.TrackMuted,this.onLocalTrackMuted).on(q.TrackUnmuted,this.onLocalTrackUnmuted).on(q.LocalTrackPublished,this.onLocalTrackPublished).on(q.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(q.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(q.MediaDevicesError,this.onMediaDevicesError).on(q.AudioStreamAcquired,this.startAudio).on(q.ChatMessage,this.onLocalChatMessageSent).on(q.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===pe.Connecting||this.state===pe.Reconnecting){const d=()=>{this.onTrackAdded(e,n,i),h()},h=()=>{this.off(U.Reconnected,d),this.off(U.Connected,d),this.off(U.Disconnected,h)};this.once(U.Reconnected,d),this.once(U.Connected,d),this.once(U.Disconnected,h);return}if(this.state===pe.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=WD(n.id),s=r[0];let o=r[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const l=Array.from(this.remoteParticipants.values()).find(d=>d.sid===s);if(!l){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}let c;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?c=this.options.adaptiveStream:c={});const u=l.addSubscribedMediaTrack(e,a,n,i,c);u!=null&&u.isEncrypted&&!this.e2eeManager&&this.emit(U.EncryptionError,new Error("Encrypted ".concat(u.source," track received from participant ").concat(l.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearHandlersAndControllers(),this.state!==pe.Disconnected){this.regionUrl=void 0;try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{r.unpublishTrack(s.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var s,o,a;r.track&&this.localParticipant.unpublishTrack(r.track,e),e?((s=r.track)===null||s===void 0||s.detach(),(o=r.track)===null||o===void 0||o.stop()):(a=r.track)===null||a===void 0||a.stopMonitor()}),this.localParticipant.off(q.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(q.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(q.AttributesChanged,this.onLocalAttributesChanged).off(q.TrackMuted,this.onLocalTrackMuted).off(q.TrackUnmuted,this.onLocalTrackUnmuted).off(q.LocalTrackPublished,this.onLocalTrackPublished).off(q.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(q.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(q.MediaDevicesError,this.onMediaDevicesError).off(q.AudioStreamAcquired,this.startAudio).off(q.ChatMessage,this.onLocalChatMessageSent).off(q.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),_t()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(i=navigator.mediaDevices)===null||i===void 0||i.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(pe.Disconnected),this.emit(U.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(U.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(e,n,i,r,s,o){return T(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),o!==1){yield this.engine.publishRpcResponse(e,n,null,je.builtIn("UNSUPPORTED_VERSION"));return}const a=this.rpcHandlers.get(i);if(!a){yield this.engine.publishRpcResponse(e,n,null,je.builtIn("UNSUPPORTED_METHOD"));return}let l=null,c=null;try{const u=yield a({requestId:n,callerIdentity:e,payload:r,responseTimeout:s});Dm(u)>HT?(l=je.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(i))):c=u}catch(u){u instanceof je?l=u:(console.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),u),l=je.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,c,l)})}selectDefaultDevices(){return T(this,void 0,void 0,function*(){var e,n,i;const r=Xe.getInstance().previousDevices,s=yield Xe.getInstance().getDevices(void 0,!1),o=Ft();if((o==null?void 0:o.name)==="Chrome"&&o.os!=="iOS")for(let l of s){const c=r.find(u=>u.deviceId===l.deviceId);c&&c.label!==""&&c.kind===l.kind&&c.label!==l.label&&this.getActiveDevice(l.kind)==="default"&&this.emit(U.ActiveDeviceChanged,l.kind,l.deviceId)}const a=["audiooutput","audioinput","videoinput"];for(let l of a){const c=lM(l),u=this.localParticipant.getTrackPublication(c);if(u&&(!((e=u.track)===null||e===void 0)&&e.isUserProvided))continue;const d=s.filter(f=>f.kind===l),h=this.getActiveDevice(l);if(h===((n=r.filter(f=>f.kind===l)[0])===null||n===void 0?void 0:n.deviceId)&&d.length>0&&((i=d[0])===null||i===void 0?void 0:i.deviceId)!==h){yield this.switchActiveDevice(l,d[0].deviceId);continue}l==="audioinput"&&!Fa()||l==="videoinput"||d.length>0&&!d.find(f=>f.deviceId===this.getActiveDevice(l))&&(l!=="audiooutput"||!Fa())&&(yield this.switchActiveDevice(l,d[0].deviceId))}})}acquireAudioContext(){return T(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=$T())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),It(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(U.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let r;return n?r=Xc.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new Xc(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(U.ParticipantConnected,i),i.on(q.TrackPublished,r=>{this.emitWhenConnected(U.TrackPublished,r,i)}).on(q.TrackSubscribed,(r,s)=>{r.kind===D.Kind.Audio?(r.on($.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on($.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===D.Kind.Video&&(r.on($.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on($.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(U.TrackSubscribed,r,s,i)}).on(q.TrackUnpublished,r=>{this.emit(U.TrackUnpublished,r,i)}).on(q.TrackUnsubscribed,(r,s)=>{this.emit(U.TrackUnsubscribed,r,s,i)}).on(q.TrackMuted,r=>{this.emitWhenConnected(U.TrackMuted,r,i)}).on(q.TrackUnmuted,r=>{this.emitWhenConnected(U.TrackUnmuted,r,i)}).on(q.ParticipantMetadataChanged,r=>{this.emitWhenConnected(U.ParticipantMetadataChanged,r,i)}).on(q.ParticipantNameChanged,r=>{this.emitWhenConnected(U.ParticipantNameChanged,r,i)}).on(q.AttributesChanged,r=>{this.emitWhenConnected(U.ParticipantAttributesChanged,r,i)}).on(q.ConnectionQualityChanged,r=>{this.emitWhenConnected(U.ConnectionQualityChanged,r,i)}).on(q.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(U.ParticipantPermissionsChanged,r,i)}).on(q.TrackSubscriptionStatusChanged,(r,s)=>{this.emitWhenConnected(U.TrackSubscriptionStatusChanged,r,s,i)}).on(q.TrackSubscriptionFailed,(r,s)=>{this.emit(U.TrackSubscriptionFailed,r,i,s)}).on(q.TrackSubscriptionPermissionChanged,(r,s)=>{this.emitWhenConnected(U.TrackSubscriptionPermissionChanged,r,s,i)}).on(q.Active,()=>{this.emitWhenConnected(U.ParticipantActive,i),i.kind===ja.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&sM(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=tt.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,bn.STATE_MISMATCH))):e=0},gN)}clearConnectionReconcile(){this.connectionReconcileInterval&&tt.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(U.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===pe.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===pe.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return T(this,void 0,void 0,function*(){var n,i;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),s=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new Nu({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:xe.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Jr({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(U.SignalConnected),this.emit(U.Connected),this.setAndEmitConnectionState(pe.Connected),r.video){const o=new $f(D.Kind.Video,new As({source:Ve.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:vn.AUDIO,name:"video-dummy"}),new Yc(r.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:_y(160*((n=s.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(q.LocalTrackPublished,o)}if(r.audio){const o=new $f(D.Kind.Audio,new As({source:Ve.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:vn.AUDIO}),new Qc(r.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:Bd(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(q.LocalTrackPublished,o)}for(let o=0;o<s.count-1;o+=1){let a=new Jr({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(o),state:zs.ACTIVE,tracks:[],joinedAt:xe.parse(Date.now())});const l=this.getOrCreateParticipant(a.identity,a);if(s.video){const c=_y(160*((i=s.aspectRatios[o%s.aspectRatios.length])!==null&&i!==void 0?i:1),160,!1,!0),u=new As({source:Ve.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:vn.AUDIO});l.addSubscribedMediaTrack(c,u.sid,new MediaStream([c]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}if(s.audio){const c=Bd(),u=new As({source:Ve.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:vn.AUDIO});l.addSubscribedMediaTrack(c,u.sid,new MediaStream([c]),new RTCRtpReceiver),a.tracks=[...a.tracks,u]}l.updateInfo(a)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(e!==U.ActiveSpeakersChanged&&e!==U.TranscriptionReceived){const s=tC(i).filter(o=>o!==void 0);this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s}))}return super.emit(e,...i)}}po.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function tC(t){return t.map(e=>{if(e)return Array.isArray(e)?tC(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var pn;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(pn||(pn={}));class wr extends Kn.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=pn.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new po(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return T(this,void 0,void 0,function*(){if(this.status!==pn.IDLE)throw Error("check is running already");this.setStatus(pn.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==pn.SKIPPED&&this.setStatus(this.isSuccess()?pn.SUCCESS:pn.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return T(this,void 0,void 0,function*(){return this.room.state===pe.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return T(this,void 0,void 0,function*(){this.room&&this.room.state!==pe.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(pn.SKIPPED)}switchProtocol(e){return T(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(U.Reconnecting,()=>{n=!0}),this.room.once(U.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(s=>setTimeout(s,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield It(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class vN extends wr{get description(){return"Cloud regions"}perform(){return T(this,void 0,void 0,function*(){const e=new Ff(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let s=0;s<3;s++){const o=yield e.getNextBestRegionUrl();if(!o)break;if(i.has(o))continue;i.add(o);const a=yield this.checkCloudRegion(o);this.appendMessage("".concat(a.region," RTT: ").concat(a.rtt,"ms, duration: ").concat(a.duration,"ms")),n.push(a)}n.sort((s,o)=>(s.duration-o.duration)*.5+(s.rtt-o.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return T(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const s=yield this.room.localParticipant.streamText({topic:"test"}),o=1e3,l=1e6/o,c="A".repeat(o),u=Date.now();for(let v=0;v<l;v++)yield s.write(c);yield s.close();const d=Date.now(),h=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),f={region:r,rtt:1e4,duration:d-u};return h==null||h.forEach(v=>{v.type==="candidate-pair"&&v.nominated&&(f.rtt=v.currentRoundTripTime*1e3)}),yield this.disconnect(),f})}}const Jd=1e4;class yN extends wr{get description(){return"Connection via UDP vs TCP"}perform(){return T(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(Jd/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(Jd/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return T(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const s=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(s)};s();const a=n.captureStream(30).getVideoTracks()[0],c=(yield this.room.localParticipant.publishTrack(a,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,u={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},d=setInterval(()=>T(this,void 0,void 0,function*(){const h=yield c.getRTCStatsReport();h==null||h.forEach(f=>{f.type==="outbound-rtp"?(u.packetsSent=f.packetsSent,u.qualityLimitationDurations=f.qualityLimitationDurations,u.bitrateTotal+=f.targetBitrate,u.count++):f.type==="remote-inbound-rtp"&&(u.packetsLost=f.packetsLost,u.rttTotal+=f.roundTripTime,u.jitterTotal+=f.jitter)})}),1e3);return yield new Promise(h=>setTimeout(h,Jd)),clearInterval(d),a.stop(),n.remove(),yield this.disconnect(),u})}}class bN extends wr{get description(){return"Can publish audio"}perform(){return T(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield ZT();if(yield BT(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,3e3));const s=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!s)throw new Error("Could not get RTCStats");let o=0;if(s.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(o=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," audio packets"))})}}class wN extends wr{get description(){return"Can publish video"}perform(){return T(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield dN();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(o=>setTimeout(o,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let s=0;if(r.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="video"||!o.kind&&o.mediaType==="video")&&(s+=o.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}checkForVideo(e){return T(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.setAttribute("playsinline","true"),document.body.appendChild(i),yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var s,o,a,l;const c=document.createElement("canvas"),u=e.getSettings(),d=(o=(s=u.width)!==null&&s!==void 0?s:i.videoWidth)!==null&&o!==void 0?o:1280,h=(l=(a=u.height)!==null&&a!==void 0?a:i.videoHeight)!==null&&l!==void 0?l:720;c.width=d,c.height=h;const f=c.getContext("2d");f.drawImage(i,0,0);const p=f.getImageData(0,0,c.width,c.height).data;let y=!0;for(let m=0;m<p.length;m+=4)if(p[m]!==0||p[m+1]!==0||p[m+2]!==0){y=!1;break}y?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),n.getTracks().forEach(r=>r.stop()),i.remove()})}}class kN extends wr{get description(){return"Resuming connection after interruption"}perform(){return T(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,r=!1,s;const o=new Promise(c=>{setTimeout(c,5e3),s=c}),a=()=>{i=!0};n.on(U.SignalReconnecting,a).on(U.Reconnecting,a).on(U.Reconnected,()=>{r=!0,s(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const l=n.engine.client.onClose;if(l&&l(""),yield o,i){if(!r||n.state!==pe.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class SN extends wr{get description(){return"Can connect via TURN"}perform(){return T(this,void 0,void 0,function*(){var e,n;const i=new xm,r=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});let s=!1,o=!1,a=!1;for(let l of r.iceServers)for(let c of l.urls)c.startsWith("turn:")?(o=!0,a=!0):c.startsWith("turns:")&&(o=!0,a=!0,s=!0),c.startsWith("stun:")&&(a=!0);a?o&&!s&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield i.close(),!((n=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||n===void 0)&&n.iceServers||o?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(l=>setTimeout(l,0)))})}}class TN extends wr{get description(){return"Establishing WebRTC connection"}perform(){return T(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(U.SignalConnected,()=>{const i=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(r,s)=>{if(r.candidate){const o=new RTCIceCandidate(r);let a="".concat(o.protocol," ").concat(o.address,":").concat(o.port," ").concat(o.type);o.address&&(CN(o.address)?a+=" (private)":o.protocol==="tcp"&&o.tcpType==="passive"?(e=!0,a+=" (passive)"):o.protocol==="udp"&&(n=!0)),this.appendMessage(a)}i&&i(r,s)},this.room.engine.pcManager&&(this.room.engine.pcManager.subscriber.onIceCandidateError=r=>{r instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(r.errorCode," ").concat(r.errorText," ").concat(r.url))})});try{yield this.connect(),ae.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function CN(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class _N extends wr{get description(){return"Connecting to signal connection via WebSocket"}perform(){return T(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new xm;const s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3});this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===VS.Cloud&&(!((n=s.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=s.serverInfo)===null||i===void 0?void 0:i.region)),yield r.close()})}}class DU extends Kn.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:pn.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==pn.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return T(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=o=>{this.updateCheck(n,o)};i.on("update",r);const s=yield i.run();return i.off("update",r),s})}checkWebsocket(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(_N)})}checkWebRTC(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(TN)})}checkTURN(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(SN)})}checkReconnect(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(kN)})}checkPublishAudio(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(bN)})}checkPublishVideo(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(wN)})}checkConnectionProtocol(){return T(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(yN);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return T(this,void 0,void 0,function*(){return this.createAndRunCheck(vN)})}}function ce(t,e,n){return(e=PN(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function EN(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function PN(t){var e=EN(t,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class yt extends Error{constructor(e,n){var i;super(e,n),ce(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(i=Error.captureStackTrace)===null||i===void 0||i.call(Error,this,this.constructor)}}ce(yt,"code","ERR_JOSE_GENERIC");class xN extends yt{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),ce(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),ce(this,"claim",void 0),ce(this,"reason",void 0),ce(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}ce(xN,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class RN extends yt{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),ce(this,"code","ERR_JWT_EXPIRED"),ce(this,"claim",void 0),ce(this,"reason",void 0),ce(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}ce(RN,"code","ERR_JWT_EXPIRED");class IN extends yt{constructor(){super(...arguments),ce(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}ce(IN,"code","ERR_JOSE_ALG_NOT_ALLOWED");class ON extends yt{constructor(){super(...arguments),ce(this,"code","ERR_JOSE_NOT_SUPPORTED")}}ce(ON,"code","ERR_JOSE_NOT_SUPPORTED");class AN extends yt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),ce(this,"code","ERR_JWE_DECRYPTION_FAILED")}}ce(AN,"code","ERR_JWE_DECRYPTION_FAILED");class DN extends yt{constructor(){super(...arguments),ce(this,"code","ERR_JWE_INVALID")}}ce(DN,"code","ERR_JWE_INVALID");class MN extends yt{constructor(){super(...arguments),ce(this,"code","ERR_JWS_INVALID")}}ce(MN,"code","ERR_JWS_INVALID");class NN extends yt{constructor(){super(...arguments),ce(this,"code","ERR_JWT_INVALID")}}ce(NN,"code","ERR_JWT_INVALID");class LN extends yt{constructor(){super(...arguments),ce(this,"code","ERR_JWK_INVALID")}}ce(LN,"code","ERR_JWK_INVALID");class jN extends yt{constructor(){super(...arguments),ce(this,"code","ERR_JWKS_INVALID")}}ce(jN,"code","ERR_JWKS_INVALID");class UN extends yt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),ce(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}ce(UN,"code","ERR_JWKS_NO_MATCHING_KEY");class FN extends yt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),ce(this,Symbol.asyncIterator,void 0),ce(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}ce(FN,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class BN extends yt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",n=arguments.length>1?arguments[1]:void 0;super(e,n),ce(this,"code","ERR_JWKS_TIMEOUT")}}ce(BN,"code","ERR_JWKS_TIMEOUT");class $N extends yt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),ce(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}ce($N,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function ui(){return ui=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},ui.apply(null,arguments)}const Hy=new Uint8Array(0);let Ba=class{static getFullOptions(e){return ui({clientTools:{},onConnect:()=>{},onDebug:()=>{},onDisconnect:()=>{},onError:()=>{},onMessage:()=>{},onAudio:()=>{},onModeChange:()=>{},onStatusChange:()=>{},onCanSendFeedbackChange:()=>{},onInterruption:()=>{}},e)}constructor(e,n){var i=this;this.options=void 0,this.connection=void 0,this.lastInterruptTimestamp=0,this.mode="listening",this.status="connecting",this.volume=1,this.currentEventId=1,this.lastFeedbackEventId=0,this.canSendFeedback=!1,this.endSessionWithDetails=async function(r){i.status!=="connected"&&i.status!=="connecting"||(i.updateStatus("disconnecting"),await i.handleEndSession(),i.updateStatus("disconnected"),i.options.onDisconnect&&i.options.onDisconnect(r))},this.onMessage=async function(r){switch(r.type){case"interruption":return void i.handleInterruption(r);case"agent_response":return void i.handleAgentResponse(r);case"user_transcript":return void i.handleUserTranscript(r);case"internal_tentative_agent_response":return void i.handleTentativeAgentResponse(r);case"client_tool_call":try{await i.handleClientToolCall(r)}catch(s){i.onError(`Unexpected error in client tool call handling: ${s instanceof Error?s.message:String(s)}`,{clientToolName:r.client_tool_call.tool_name,toolCallId:r.client_tool_call.tool_call_id})}return;case"audio":return void i.handleAudio(r);case"vad_score":return void i.handleVadScore(r);case"ping":return void i.connection.sendMessage({type:"pong",event_id:r.ping_event.event_id});case"mcp_tool_call":return void i.handleMCPToolCall(r);case"mcp_connection_status":return void i.handleMCPConnectionStatus(r);case"agent_tool_response":return void i.handleAgentToolResponse(r);case"conversation_initiation_metadata":return void i.handleConversationMetadata(r);case"asr_initiation_metadata":return void i.handleAsrInitiationMetadata(r);default:return void(i.options.onDebug&&i.options.onDebug(r))}},this.setVolume=({volume:r})=>{this.volume=r},this.options=e,this.connection=n,this.options.onConnect&&this.options.onConnect({conversationId:n.conversationId}),this.connection.onMessage(this.onMessage),this.connection.onDisconnect(this.endSessionWithDetails),this.connection.onModeChange(r=>this.updateMode(r)),this.updateStatus("connected")}endSession(){return this.endSessionWithDetails({reason:"user"})}async handleEndSession(){this.connection.close()}updateMode(e){e!==this.mode&&(this.mode=e,this.options.onModeChange&&this.options.onModeChange({mode:e}))}updateStatus(e){e!==this.status&&(this.status=e,this.options.onStatusChange&&this.options.onStatusChange({status:e}))}updateCanSendFeedback(){const e=this.currentEventId!==this.lastFeedbackEventId;this.canSendFeedback!==e&&(this.canSendFeedback=e,this.options.onCanSendFeedbackChange&&this.options.onCanSendFeedbackChange({canSendFeedback:e}))}handleInterruption(e){e.interruption_event&&(this.lastInterruptTimestamp=e.interruption_event.event_id,this.options.onInterruption&&this.options.onInterruption({event_id:e.interruption_event.event_id}))}handleAgentResponse(e){this.options.onMessage&&this.options.onMessage({source:"ai",message:e.agent_response_event.agent_response})}handleUserTranscript(e){this.options.onMessage&&this.options.onMessage({source:"user",message:e.user_transcription_event.user_transcript})}handleTentativeAgentResponse(e){this.options.onDebug&&this.options.onDebug({type:"tentative_agent_response",response:e.tentative_agent_response_internal_event.tentative_agent_response})}handleVadScore(e){this.options.onVadScore&&this.options.onVadScore({vadScore:e.vad_score_event.vad_score})}async handleClientToolCall(e){if(Object.prototype.hasOwnProperty.call(this.options.clientTools,e.client_tool_call.tool_name))try{var n;const i=(n=await this.options.clientTools[e.client_tool_call.tool_name](e.client_tool_call.parameters))!=null?n:"Client tool execution successful.",r=typeof i=="object"?JSON.stringify(i):String(i);this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:r,is_error:!1})}catch(i){this.onError(`Client tool execution failed with following error: ${i==null?void 0:i.message}`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool execution failed: ${i==null?void 0:i.message}`,is_error:!0})}else{if(this.options.onUnhandledClientToolCall)return void this.options.onUnhandledClientToolCall(e.client_tool_call);this.onError(`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,{clientToolName:e.client_tool_call.tool_name}),this.connection.sendMessage({type:"client_tool_result",tool_call_id:e.client_tool_call.tool_call_id,result:`Client tool with name ${e.client_tool_call.tool_name} is not defined on client`,is_error:!0})}}handleAudio(e){}handleMCPToolCall(e){this.options.onMCPToolCall&&this.options.onMCPToolCall(e.mcp_tool_call)}handleMCPConnectionStatus(e){this.options.onMCPConnectionStatus&&this.options.onMCPConnectionStatus(e.mcp_connection_status)}handleAgentToolResponse(e){this.options.onAgentToolResponse&&this.options.onAgentToolResponse(e.agent_tool_response)}handleConversationMetadata(e){this.options.onConversationMetadata&&this.options.onConversationMetadata(e.conversation_initiation_metadata_event)}handleAsrInitiationMetadata(e){this.options.onAsrInitiationMetadata&&this.options.onAsrInitiationMetadata(e.asr_initiation_metadata_event)}onError(e,n){console.error(e,n),this.options.onError&&this.options.onError(e,n)}getId(){return this.connection.conversationId}isOpen(){return this.status==="connected"}setMicMuted(e){this.connection.setMicMuted(e)}getInputByteFrequencyData(){return Hy}getOutputByteFrequencyData(){return Hy}getInputVolume(){return 0}getOutputVolume(){return 0}sendFeedback(e){this.canSendFeedback?(this.connection.sendMessage({type:"feedback",score:e?"like":"dislike",event_id:this.currentEventId}),this.lastFeedbackEventId=this.currentEventId,this.updateCanSendFeedback()):console.warn(this.lastFeedbackEventId===0?"Cannot send feedback: the conversation has not started yet.":"Cannot send feedback: feedback has already been sent for the current response.")}sendContextualUpdate(e){this.connection.sendMessage({type:"contextual_update",text:e})}sendUserMessage(e){this.connection.sendMessage({type:"user_message",text:e})}sendUserActivity(){this.connection.sendMessage({type:"user_activity"})}sendMCPToolApprovalResult(e,n){this.connection.sendMessage({type:"mcp_tool_approval_result",tool_call_id:e,is_approved:n})}};class nC{constructor(e={}){this.queue=[],this.disconnectionDetails=null,this.onDisconnectCallback=null,this.onMessageCallback=null,this.onModeChangeCallback=null,this.onDebug=void 0,this.onDebug=e.onDebug}debug(e){this.onDebug&&this.onDebug(e)}onMessage(e){this.onMessageCallback=e;const n=this.queue;this.queue=[],n.length>0&&queueMicrotask(()=>{n.forEach(e)})}onDisconnect(e){this.onDisconnectCallback=e;const n=this.disconnectionDetails;n&&queueMicrotask(()=>{e(n)})}onModeChange(e){this.onModeChangeCallback=e}updateMode(e){var n;(n=this.onModeChangeCallback)==null||n.call(this,e)}disconnect(e){var n;this.disconnectionDetails||(this.disconnectionDetails=e,(n=this.onDisconnectCallback)==null||n.call(this,e))}handleMessage(e){this.onMessageCallback?this.onMessageCallback(e):this.queue.push(e)}}function Zc(t){const[e,n]=t.split("_");if(!["pcm","ulaw"].includes(e))throw new Error(`Invalid format: ${t}`);const i=Number.parseInt(n);if(Number.isNaN(i))throw new Error(`Invalid sample rate: ${n}`);return{format:e,sampleRate:i}}const iC="0.7.1";function Vf(t){return!!t.type}const rC="conversation_initiation_client_data";function sC(t){var e;const n={type:rC};var i,r,s,o,a;return t.overrides&&(n.conversation_config_override={agent:{prompt:(i=t.overrides.agent)==null?void 0:i.prompt,first_message:(r=t.overrides.agent)==null?void 0:r.firstMessage,language:(s=t.overrides.agent)==null?void 0:s.language},tts:{voice_id:(o=t.overrides.tts)==null?void 0:o.voiceId},conversation:{text_only:(a=t.overrides.conversation)==null?void 0:a.textOnly}}),t.customLlmExtraBody&&(n.custom_llm_extra_body=t.customLlmExtraBody),t.dynamicVariables&&(n.dynamic_variables=t.dynamicVariables),t.userId&&(n.user_id=t.userId),(e=t.overrides)!=null&&e.client&&(n.source_info={source:t.overrides.client.source,version:t.overrides.client.version}),n}class $a extends nC{constructor(e,n,i,r){super(),this.socket=void 0,this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.socket=e,this.conversationId=n,this.inputFormat=i,this.outputFormat=r,this.socket.addEventListener("error",s=>{setTimeout(()=>this.disconnect({reason:"error",message:"The connection was closed due to a socket error.",context:s}),0)}),this.socket.addEventListener("close",s=>{this.disconnect(s.code===1e3?{reason:"agent",context:s}:{reason:"error",message:s.reason||"The connection was closed by the server.",context:s})}),this.socket.addEventListener("message",s=>{try{const o=JSON.parse(s.data);if(!Vf(o))return void this.debug({type:"invalid_event",message:"Received invalid socket event",data:s.data});this.handleMessage(o)}catch(o){this.debug({type:"parsing_error",message:"Failed to parse socket message",error:o instanceof Error?o.message:String(o),data:s.data})}})}static async create(e){let n=null;try{var i,r,s;const a=(i=e.origin)!=null?i:"wss://api.elevenlabs.io";let l;const c=((r=e.overrides)==null||(r=r.client)==null?void 0:r.version)||iC,u=((s=e.overrides)==null||(s=s.client)==null?void 0:s.source)||"js_sdk";if(e.signedUrl){const g=e.signedUrl.includes("?")?"&":"?";l=`${e.signedUrl}${g}source=${u}&version=${c}`}else l=`${a}/v1/convai/conversation?agent_id=${e.agentId}&source=${u}&version=${c}`;const d=["convai"];e.authorization&&d.push(`bearer.${e.authorization}`),n=new WebSocket(l,d);const h=await new Promise((g,b)=>{n.addEventListener("open",()=>{var w;const k=sC(e);(w=n)==null||w.send(JSON.stringify(k))},{once:!0}),n.addEventListener("error",w=>{setTimeout(()=>b(w),0)}),n.addEventListener("close",b),n.addEventListener("message",w=>{const k=JSON.parse(w.data);Vf(k)&&(k.type==="conversation_initiation_metadata"?g(k.conversation_initiation_metadata_event):console.warn("First received message is not conversation metadata."))},{once:!0})}),{conversation_id:f,agent_output_audio_format:v,user_input_audio_format:p}=h,y=Zc(p??"pcm_16000"),m=Zc(v);return new $a(n,f,y,m)}catch(a){var o;throw(o=n)==null||o.close(),a}}close(){this.socket.close()}sendMessage(e){this.socket.send(JSON.stringify(e))}async setMicMuted(e){console.warn(`WebSocket connection setMicMuted called with ${e}, but this is handled by VoiceConversation`)}}function oC(t){const e=new Uint8Array(t);return window.btoa(String.fromCharCode(...e))}function VN(t){const e=window.atob(t),n=e.length,i=new Uint8Array(n);for(let r=0;r<n;r++)i[r]=e.charCodeAt(r);return i.buffer}const Il=new Map;function aC(t,e){return async(n,i)=>{const r=Il.get(t);if(r)return n.addModule(r);if(i)try{return await n.addModule(i),void Il.set(t,i)}catch(a){throw new Error(`Failed to load the ${t} worklet module from path: ${i}. Error: ${a}`)}const s=new Blob([e],{type:"application/javascript"}),o=URL.createObjectURL(s);try{return await n.addModule(o),void Il.set(t,o)}catch{URL.revokeObjectURL(o)}try{const a=`data:application/javascript;base64,${btoa(e)}`;await n.addModule(a),Il.set(t,a)}catch{throw new Error(`Failed to load the ${t} worklet module. Make sure the browser supports AudioWorklets. If you are using a strict CSP, you may need to self-host the worklet files.`)}}}const lC=aC("rawAudioProcessor",`/*
 * ulaw encoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const BIAS = 0x84;
const CLIP = 32635;
const encodeTable = [
  0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,
  4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7
];

function encodeSample(sample) {
  let sign;
  let exponent;
  let mantissa;
  let muLawSample;
  sign = (sample >> 8) & 0x80;
  if (sign !== 0) sample = -sample;
  sample = sample + BIAS;
  if (sample > CLIP) sample = CLIP;
  exponent = encodeTable[(sample>>7) & 0xFF];
  mantissa = (sample >> (exponent+3)) & 0x0F;
  muLawSample = ~(sign | (exponent << 4) | mantissa);
  
  return muLawSample;
}

class RawAudioProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
              
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.isMuted = false;
          this.buffer = []; // Initialize an empty buffer
          this.bufferSize = data.sampleRate / 4;
          this.format = data.format;

          if (globalThis.LibSampleRate && sampleRate !== data.sampleRate) {
            globalThis.LibSampleRate.create(1, sampleRate, data.sampleRate).then(resampler => {
              this.resampler = resampler;
            });
          }
          break;
        case "setMuted":
          this.isMuted = data.isMuted;
          break;
      }
    };
  }
  process(inputs) {
    if (!this.buffer) {
      return true;
    }
    
    const input = inputs[0]; // Get the first input node
    if (input.length > 0) {
      let channelData = input[0]; // Get the first channel's data

      // Resample the audio if necessary
      if (this.resampler) {
        channelData = this.resampler.full(channelData);
      }

      // Add channel data to the buffer
      this.buffer.push(...channelData);
      // Get max volume 
      let sum = 0.0;
      for (let i = 0; i < channelData.length; i++) {
        sum += channelData[i] * channelData[i];
      }
      const maxVolume = Math.sqrt(sum / channelData.length);
      // Check if buffer size has reached or exceeded the threshold
      if (this.buffer.length >= this.bufferSize) {
        const float32Array = this.isMuted 
          ? new Float32Array(this.buffer.length)
          : new Float32Array(this.buffer);

        let encodedArray = this.format === "ulaw"
          ? new Uint8Array(float32Array.length)
          : new Int16Array(float32Array.length);

        // Iterate through the Float32Array and convert each sample to PCM16
        for (let i = 0; i < float32Array.length; i++) {
          // Clamp the value to the range [-1, 1]
          let sample = Math.max(-1, Math.min(1, float32Array[i]));

          // Scale the sample to the range [-32768, 32767]
          let value = sample < 0 ? sample * 32768 : sample * 32767;
          if (this.format === "ulaw") {
            value = encodeSample(Math.round(value));
          }

          encodedArray[i] = value;
        }

        // Send the buffered data to the main script
        this.port.postMessage([encodedArray, maxVolume]);

        // Clear the buffer after sending
        this.buffer = [];
      }
    }
    return true; // Continue processing
  }
}
registerProcessor("rawAudioProcessor", RawAudioProcessor);
`);class ni extends nC{constructor(e,n,i,r,s={}){super(s),this.conversationId=void 0,this.inputFormat=void 0,this.outputFormat=void 0,this.room=void 0,this.isConnected=!1,this.audioEventId=1,this.audioCaptureContext=null,this.audioElements=[],this.outputDeviceId=null,this.outputAnalyser=null,this.outputFrequencyData=null,this.room=e,this.conversationId=n,this.inputFormat=i,this.outputFormat=r,this.setupRoomEventListeners()}static async create(e){let n;if("conversationToken"in e&&e.conversationToken)n=e.conversationToken;else{if(!("agentId"in e)||!e.agentId)throw new Error("Either conversationToken or agentId is required for WebRTC connection");try{var i,r,s;const c=((i=e.overrides)==null||(i=i.client)==null?void 0:i.version)||iC,u=((r=e.overrides)==null||(r=r.client)==null?void 0:r.source)||"js_sdk",d=`${o=(s=e.origin)!=null?s:"https://api.elevenlabs.io",o.replace(/^wss:\/\//,"https://")}/v1/convai/conversation/token?agent_id=${e.agentId}&source=${u}&version=${c}`,h=await fetch(d);if(!h.ok)throw new Error(`ElevenLabs API returned ${h.status} ${h.statusText}`);if(n=(await h.json()).token,!n)throw new Error("No conversation token received from API")}catch(c){let u=c instanceof Error?c.message:String(c);throw c instanceof Error&&c.message.includes("401")&&(u="Your agent has authentication enabled, but no signed URL or conversation token was provided."),new Error(`Failed to fetch conversation token for agent ${e.agentId}: ${u}`)}}var o;const a=new po;try{const c=`room_${Date.now()}`,u=Zc("pcm_48000"),d=Zc("pcm_48000"),h=new ni(a,c,u,d,e),f=e.livekitUrl||"wss://livekit.rtc.elevenlabs.io";var l;await a.connect(f,n),await new Promise(p=>{if(h.isConnected)p();else{const y=()=>{a.off(U.Connected,y),p()};a.on(U.Connected,y)}}),a.name&&(h.conversationId=((l=a.name.match(/(conv_[a-zA-Z0-9]+)/))==null?void 0:l[0])||a.name),await a.localParticipant.setMicrophoneEnabled(!0);const v=sC(e);return h.debug({type:rC,message:v}),await h.sendMessage(v),h}catch(c){throw await a.disconnect(),c}}setupRoomEventListeners(){var e=this;this.room.on(U.Connected,async function(){e.isConnected=!0,console.info("WebRTC room connected")}),this.room.on(U.Disconnected,n=>{this.isConnected=!1,this.disconnect({reason:"agent",context:new CloseEvent("close",{reason:n==null?void 0:n.toString()})})}),this.room.on(U.ConnectionStateChanged,n=>{n===pe.Disconnected&&(this.isConnected=!1,this.disconnect({reason:"error",message:`LiveKit connection state changed to ${n}`,context:new Event("connection_state_changed")}))}),this.room.on(U.DataReceived,(n,i)=>{try{const r=JSON.parse(new TextDecoder().decode(n));if(r.type==="audio")return;Vf(r)?this.handleMessage(r):console.warn("Invalid socket event received:",r)}catch(r){console.warn("Failed to parse incoming data message:",r),console.warn("Raw payload:",new TextDecoder().decode(n))}}),this.room.on(U.TrackSubscribed,async function(n,i,r){if(n.kind===D.Kind.Audio&&r.identity.includes("agent")){const s=n,o=s.attach();if(o.autoplay=!0,o.controls=!1,e.outputDeviceId&&o.setSinkId)try{await o.setSinkId(e.outputDeviceId)}catch(a){console.warn("Failed to set output device for new audio element:",a)}o.style.display="none",document.body.appendChild(o),e.audioElements.push(o),e.audioElements.length===1&&(e.onDebug==null||e.onDebug({type:"audio_element_ready"})),await e.setupAudioCapture(s)}}),this.room.on(U.ActiveSpeakersChanged,async function(n){e.updateMode(n.length>0&&n[0].identity.startsWith("agent")?"speaking":"listening")})}close(){if(this.isConnected){try{this.room.localParticipant.audioTrackPublications.forEach(e=>{e.track&&e.track.stop()})}catch(e){console.warn("Error stopping local tracks:",e)}this.audioCaptureContext&&(this.audioCaptureContext.close().catch(e=>{console.warn("Error closing audio capture context:",e)}),this.audioCaptureContext=null),this.audioElements.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),this.audioElements=[],this.room.disconnect()}}async sendMessage(e){if(this.isConnected&&this.room.localParticipant){if(!("user_audio_chunk"in e))try{const n=new TextEncoder().encode(JSON.stringify(e));await this.room.localParticipant.publishData(n,{reliable:!0})}catch(n){this.debug({type:"send_message_error",message:{message:e,error:n}}),console.error("Failed to send message via WebRTC:",n)}}else console.warn("Cannot send message: room not connected or no local participant")}getRoom(){return this.room}async setMicMuted(e){if(!this.isConnected||!this.room.localParticipant)return void console.warn("Cannot set microphone muted: room not connected or no local participant");const n=this.room.localParticipant.getTrackPublication(D.Source.Microphone);if(n!=null&&n.track)try{e?await n.track.mute():await n.track.unmute()}catch{await this.room.localParticipant.setMicrophoneEnabled(!e)}else await this.room.localParticipant.setMicrophoneEnabled(!e)}async setupAudioCapture(e){try{const n=new AudioContext;this.audioCaptureContext=n,this.outputAnalyser=n.createAnalyser(),this.outputAnalyser.fftSize=2048,this.outputAnalyser.smoothingTimeConstant=.8;const i=new MediaStream([e.mediaStreamTrack]),r=n.createMediaStreamSource(i);r.connect(this.outputAnalyser),await lC(n.audioWorklet);const s=new AudioWorkletNode(n,"rawAudioProcessor");this.outputAnalyser.connect(s),s.port.postMessage({type:"setFormat",format:this.outputFormat.format,sampleRate:this.outputFormat.sampleRate}),s.port.onmessage=o=>{const[a,l]=o.data;if(l>.01){const c=oC(a.buffer),u=this.audioEventId++;this.handleMessage({type:"audio",audio_event:{audio_base_64:c,event_id:u}})}},r.connect(s)}catch(n){console.warn("Failed to set up audio capture:",n)}}setAudioVolume(e){this.audioElements.forEach(n=>{n.volume=e})}async setAudioOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");const n=this.audioElements.map(async function(i){try{await i.setSinkId(e)}catch(r){throw console.error("Failed to set sink ID for audio element:",r),r}});await Promise.all(n),this.outputDeviceId=e}async setAudioInputDevice(e){if(!this.isConnected||!this.room.localParticipant)throw new Error("Cannot change input device: room not connected or no local participant");try{const n=this.room.localParticipant.getTrackPublication(D.Source.Microphone);n!=null&&n.track&&(await n.track.stop(),await this.room.localParticipant.unpublishTrack(n.track));const i={deviceId:{exact:e},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}},r=await ZT(i);await this.room.localParticipant.publishTrack(r,{name:"microphone",source:D.Source.Microphone})}catch(n){console.error("Failed to change input device:",n);try{await this.room.localParticipant.setMicrophoneEnabled(!0)}catch(i){console.error("Failed to recover microphone after device switch error:",i)}throw n}}getOutputByteFrequencyData(){return this.outputAnalyser?(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.outputAnalyser.frequencyBinCount)),this.outputAnalyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData):null}}async function cC(t){const e=function(n){return n.connectionType?n.connectionType:"conversationToken"in n&&n.conversationToken?"webrtc":"websocket"}(t);switch(e){case"websocket":return $a.create(t);case"webrtc":return ni.create(t);default:throw new Error(`Unknown connection type: ${e}`)}}function uC(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}async function dC(t={default:0,android:3e3}){let e=t.default;var n;if(/android/i.test(navigator.userAgent))e=(n=t.android)!=null?n:e;else if(uC()){var i;e=(i=t.ios)!=null?i:e}e>0&&await new Promise(r=>setTimeout(r,e))}class Lm extends Ba{static async startSession(e){const n=Ba.getFullOptions(e);n.onStatusChange&&n.onStatusChange({status:"connecting"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1}),n.onModeChange&&n.onModeChange({mode:"listening"}),n.onCanSendFeedbackChange&&n.onCanSendFeedbackChange({canSendFeedback:!1});let i=null;try{return await dC(n.connectionDelay),i=await cC(e),new Lm(n,i)}catch(s){var r;throw n.onStatusChange&&n.onStatusChange({status:"disconnected"}),(r=i)==null||r.close(),s}}}const Ky={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,channelCount:{ideal:1}};class eu{static async create({sampleRate:e,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:r,workletPaths:s,libsampleratePath:o}){let a=null,l=null;try{const d=ui({sampleRate:{ideal:e}},Ky);if(uC()&&i){const m=(await window.navigator.mediaDevices.enumerateDevices()).find(g=>g.kind==="audioinput"&&["airpod","headphone","earphone"].find(b=>g.label.toLowerCase().includes(b)));m&&(d.deviceId={ideal:m.deviceId})}r&&(d.deviceId={exact:r});const h=navigator.mediaDevices.getSupportedConstraints().sampleRate;a=new window.AudioContext(h?{sampleRate:e}:{});const f=a.createAnalyser();if(!h){const m=o||"https://cdn.jsdelivr.net/npm/@alexanderolsen/libsamplerate-js@2.1.2/dist/libsamplerate.worklet.js";await a.audioWorklet.addModule(m)}await lC(a.audioWorklet,s==null?void 0:s.rawAudioProcessor);const v=ui({voiceIsolation:!0},d);l=await navigator.mediaDevices.getUserMedia({audio:v});const p=a.createMediaStreamSource(l),y=new AudioWorkletNode(a,"rawAudioProcessor");return y.port.postMessage({type:"setFormat",format:n,sampleRate:e}),p.connect(f),f.connect(y),await a.resume(),new eu(a,f,y,l,p)}catch(d){var c,u;throw(c=l)==null||c.getTracks().forEach(h=>{h.stop()}),(u=a)==null||u.close(),d}}constructor(e,n,i,r,s){this.context=void 0,this.analyser=void 0,this.worklet=void 0,this.inputStream=void 0,this.mediaStreamSource=void 0,this.context=e,this.analyser=n,this.worklet=i,this.inputStream=r,this.mediaStreamSource=s}async close(){this.inputStream.getTracks().forEach(e=>{e.stop()}),this.mediaStreamSource.disconnect(),await this.context.close()}setMuted(e){this.worklet.port.postMessage({type:"setMuted",isMuted:e})}async setInputDevice(e){try{const n=ui({},Ky);e&&(n.deviceId={exact:e});const i=ui({voiceIsolation:!0},n),r=await navigator.mediaDevices.getUserMedia({audio:i});this.inputStream.getTracks().forEach(s=>{s.stop()}),this.mediaStreamSource.disconnect(),this.inputStream=r,this.mediaStreamSource=this.context.createMediaStreamSource(r),this.mediaStreamSource.connect(this.analyser)}catch(n){throw console.error("Failed to switch input device:",n),n}}}const zN=aC("audioConcatProcessor",`/*
 * ulaw decoding logic taken from the wavefile library
 * https://github.com/rochars/wavefile/blob/master/lib/codecs/mulaw.js
 * USED BY @elevenlabs/client
 */

const decodeTable = [0,132,396,924,1980,4092,8316,16764];

function decodeSample(muLawSample) {
  let sign;
  let exponent;
  let mantissa;
  let sample;
  muLawSample = ~muLawSample;
  sign = (muLawSample & 0x80);
  exponent = (muLawSample >> 4) & 0x07;
  mantissa = muLawSample & 0x0F;
  sample = decodeTable[exponent] + (mantissa << (exponent+3));
  if (sign !== 0) sample = -sample;

  return sample;
}

class AudioConcatProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.buffers = []; // Initialize an empty buffer
    this.cursor = 0;
    this.currentBuffer = null;
    this.wasInterrupted = false;
    this.finished = false;
    
    this.port.onmessage = ({ data }) => {
      switch (data.type) {
        case "setFormat":
          this.format = data.format;
          break;
        case "buffer":
          this.wasInterrupted = false;
          this.buffers.push(
            this.format === "ulaw"
              ? new Uint8Array(data.buffer)
              : new Int16Array(data.buffer)
          );
          break;
        case "interrupt":
          this.wasInterrupted = true;
          break;
        case "clearInterrupted":
          if (this.wasInterrupted) {
            this.wasInterrupted = false;
            this.buffers = [];
            this.currentBuffer = null;
          }
      }
    };
  }
  process(_, outputs) {
    let finished = false;
    const output = outputs[0][0];
    for (let i = 0; i < output.length; i++) {
      if (!this.currentBuffer) {
        if (this.buffers.length === 0) {
          finished = true;
          break;
        }
        this.currentBuffer = this.buffers.shift();
        this.cursor = 0;
      }

      let value = this.currentBuffer[this.cursor];
      if (this.format === "ulaw") {
        value = decodeSample(value);
      }
      output[i] = value / 32768;
      this.cursor++;

      if (this.cursor >= this.currentBuffer.length) {
        this.currentBuffer = null;
      }
    }

    if (this.finished !== finished) {
      this.finished = finished;
      this.port.postMessage({ type: "process", finished });
    }

    return true; // Continue processing
  }
}

registerProcessor("audioConcatProcessor", AudioConcatProcessor);
`);class tu{static async create({sampleRate:e,format:n,outputDeviceId:i,workletPaths:r}){let s=null,o=null;try{s=new AudioContext({sampleRate:e});const c=s.createAnalyser(),u=s.createGain();o=new Audio,o.src="",o.load(),o.autoplay=!0,o.style.display="none",document.body.appendChild(o);const d=s.createMediaStreamDestination();o.srcObject=d.stream,u.connect(c),c.connect(d),await zN(s.audioWorklet,r==null?void 0:r.audioConcatProcessor);const h=new AudioWorkletNode(s,"audioConcatProcessor");return h.port.postMessage({type:"setFormat",format:n}),h.connect(u),await s.resume(),i&&o.setSinkId&&await o.setSinkId(i),new tu(s,c,u,h,o)}catch(c){var a,l;throw(a=o)!=null&&a.parentNode&&o.parentNode.removeChild(o),(l=o)==null||l.pause(),s&&s.state!=="closed"&&await s.close(),c}}constructor(e,n,i,r,s){this.context=void 0,this.analyser=void 0,this.gain=void 0,this.worklet=void 0,this.audioElement=void 0,this.context=e,this.analyser=n,this.gain=i,this.worklet=r,this.audioElement=s}async setOutputDevice(e){if(!("setSinkId"in HTMLAudioElement.prototype))throw new Error("setSinkId is not supported in this browser");await this.audioElement.setSinkId(e||"")}async close(){this.audioElement.parentNode&&this.audioElement.parentNode.removeChild(this.audioElement),this.audioElement.pause(),await this.context.close()}}class jm extends Ba{static async startSession(e){var n;const i=Ba.getFullOptions(e);i.onStatusChange&&i.onStatusChange({status:"connecting"}),i.onCanSendFeedbackChange&&i.onCanSendFeedbackChange({canSendFeedback:!1});let r=null,s=null,o=null,a=null,l=null;if((n=e.useWakeLock)==null||n)try{l=await navigator.wakeLock.request("screen")}catch{}try{var c;return a=await navigator.mediaDevices.getUserMedia({audio:!0}),await dC(i.connectionDelay),s=await cC(e),[r,o]=await Promise.all([eu.create(ui({},s.inputFormat,{preferHeadphonesForIosDevices:e.preferHeadphonesForIosDevices,inputDeviceId:e.inputDeviceId,workletPaths:e.workletPaths,libsampleratePath:e.libsampleratePath})),tu.create(ui({},s.outputFormat,{outputDeviceId:e.outputDeviceId,workletPaths:e.workletPaths}))]),(c=a)==null||c.getTracks().forEach(p=>{p.stop()}),a=null,new jm(i,s,r,o,l)}catch(p){var u,d,h,f;i.onStatusChange&&i.onStatusChange({status:"disconnected"}),(u=a)==null||u.getTracks().forEach(y=>{y.stop()}),(d=s)==null||d.close(),await((h=r)==null?void 0:h.close()),await((f=o)==null?void 0:f.close());try{var v;await((v=l)==null?void 0:v.release()),l=null}catch{}throw p}}constructor(e,n,i,r,s){super(e,n),this.input=void 0,this.output=void 0,this.wakeLock=void 0,this.inputFrequencyData=void 0,this.outputFrequencyData=void 0,this.onInputWorkletMessage=o=>{this.status==="connected"&&this.connection.sendMessage({user_audio_chunk:oC(o.data[0].buffer)})},this.onOutputWorkletMessage=({data:o})=>{o.type==="process"&&this.updateMode(o.finished?"listening":"speaking")},this.addAudioBase64Chunk=o=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"}),this.output.worklet.port.postMessage({type:"buffer",buffer:VN(o)})},this.fadeOutAudio=()=>{this.updateMode("listening"),this.output.worklet.port.postMessage({type:"interrupt"}),this.output.gain.gain.exponentialRampToValueAtTime(1e-4,this.output.context.currentTime+2),setTimeout(()=>{this.output.gain.gain.value=this.volume,this.output.worklet.port.postMessage({type:"clearInterrupted"})},2e3)},this.calculateVolume=o=>{if(o.length===0)return 0;let a=0;for(let l=0;l<o.length;l++)a+=o[l]/255;return a/=o.length,a<0?0:a>1?1:a},this.setVolume=({volume:o})=>{const a=Number.isFinite(o)?Math.min(1,Math.max(0,o)):1;this.volume=a,this.connection instanceof ni?this.connection.setAudioVolume(a):this.output.gain.gain.value=a},this.input=i,this.output=r,this.wakeLock=s,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.output.worklet.port.onmessage=this.onOutputWorkletMessage}async handleEndSession(){await super.handleEndSession();try{var e;await((e=this.wakeLock)==null?void 0:e.release()),this.wakeLock=null}catch{}await this.input.close(),await this.output.close()}handleInterruption(e){super.handleInterruption(e),this.fadeOutAudio()}handleAudio(e){var n,i;this.lastInterruptTimestamp<=e.audio_event.event_id&&((n=(i=this.options).onAudio)==null||n.call(i,e.audio_event.audio_base_64),this.connection instanceof ni||this.addAudioBase64Chunk(e.audio_event.audio_base_64),this.currentEventId=e.audio_event.event_id,this.updateCanSendFeedback(),this.updateMode("speaking"))}setMicMuted(e){this.connection instanceof ni?this.connection.setMicMuted(e):this.input.setMuted(e)}getInputByteFrequencyData(){return this.inputFrequencyData!=null||(this.inputFrequencyData=new Uint8Array(this.input.analyser.frequencyBinCount)),this.input.analyser.getByteFrequencyData(this.inputFrequencyData),this.inputFrequencyData}getOutputByteFrequencyData(){return this.connection instanceof ni?this.connection.getOutputByteFrequencyData()||new Uint8Array(1024):(this.outputFrequencyData!=null||(this.outputFrequencyData=new Uint8Array(this.output.analyser.frequencyBinCount)),this.output.analyser.getByteFrequencyData(this.outputFrequencyData),this.outputFrequencyData)}getInputVolume(){return this.calculateVolume(this.getInputByteFrequencyData())}getOutputVolume(){return this.calculateVolume(this.getOutputByteFrequencyData())}async changeInputDevice({sampleRate:e,format:n,preferHeadphonesForIosDevices:i,inputDeviceId:r}){try{if(this.connection instanceof $a)try{return await this.input.setInputDevice(r),this.input}catch(o){console.warn("Failed to change device on existing input, recreating:",o)}this.connection instanceof ni&&await this.connection.setAudioInputDevice(r||""),await this.input.close();const s=await eu.create({sampleRate:e??this.connection.inputFormat.sampleRate,format:n??this.connection.inputFormat.format,preferHeadphonesForIosDevices:i,inputDeviceId:r,workletPaths:this.options.workletPaths,libsampleratePath:this.options.libsampleratePath});return this.input=s,this.input.worklet.port.onmessage=this.onInputWorkletMessage,this.input}catch(s){throw console.error("Error changing input device",s),s}}async changeOutputDevice({sampleRate:e,format:n,outputDeviceId:i}){try{if(this.connection instanceof $a)try{return await this.output.setOutputDevice(i),this.output}catch(s){console.warn("Failed to change device on existing output, recreating:",s)}this.connection instanceof ni&&await this.connection.setAudioOutputDevice(i||""),await this.output.close();const r=await tu.create({sampleRate:e??this.connection.outputFormat.sampleRate,format:n??this.connection.outputFormat.format,outputDeviceId:i,workletPaths:this.options.workletPaths});return this.output=r,this.output}catch(r){throw console.error("Error changing output device",r),r}}}class qN extends Ba{static startSession(e){return e.textOnly?Lm.startSession(e):jm.startSession(e)}}function da(){return da=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},da.apply(null,arguments)}const WN=["micMuted","volume","serverLocation"];function HN(t="us"){switch(t){case"eu-residency":case"in-residency":case"us":case"global":return t;default:return console.warn(`[ConversationalAI] Invalid server-location: ${t}. Defaulting to "us"`),"us"}}function KN(t){return{us:"wss://api.elevenlabs.io","eu-residency":"wss://api.eu.residency.elevenlabs.io","in-residency":"wss://api.in.residency.elevenlabs.io",global:"wss://api.elevenlabs.io"}[t]}function GN(t){return{us:"wss://livekit.rtc.elevenlabs.io","eu-residency":"wss://livekit.rtc.eu.residency.elevenlabs.io","in-residency":"wss://livekit.rtc.in.residency.elevenlabs.io",global:"wss://livekit.rtc.elevenlabs.io"}[t]}function JN(t={}){const{micMuted:e,volume:n,serverLocation:i}=t,r=function(p,y){if(p==null)return{};var m={};for(var g in p)if({}.hasOwnProperty.call(p,g)){if(y.indexOf(g)!==-1)continue;m[g]=p[g]}return m}(t,WN),s=C.useRef(null),o=C.useRef(null),[a,l]=C.useState("disconnected"),[c,u]=C.useState(!1),[d,h]=C.useState("listening"),f=C.useRef(e),v=C.useRef(n);return f.current=e,v.current=n,C.useEffect(()=>{var p;e!==void 0&&(s==null||(p=s.current)==null||p.setMicMuted(e))},[e]),C.useEffect(()=>{var p;n!==void 0&&(s==null||(p=s.current)==null||p.setVolume({volume:n}))},[n]),C.useEffect(()=>()=>{var p;(p=s.current)==null||p.endSession()},[]),{startSession:async p=>{var y;if((y=s.current)!=null&&y.isOpen())return s.current.getId();if(o.current)return(await o.current).getId();try{var m,g,b,w,k,S,_,E,x,R;const L=HN((p==null?void 0:p.serverLocation)||i),j=KN(L),K=GN(L);return o.current=qN.startSession(da({},r??{},p??{},{origin:j,livekitUrl:K,overrides:da({},(m=r==null?void 0:r.overrides)!=null?m:{},(g=p==null?void 0:p.overrides)!=null?g:{},{client:da({},(b=r==null||(w=r.overrides)==null?void 0:w.client)!=null?b:{},(k=p==null||(S=p.overrides)==null?void 0:S.client)!=null?k:{},{source:(p==null||(_=p.overrides)==null||(_=_.client)==null?void 0:_.source)||(r==null||(E=r.overrides)==null||(E=E.client)==null?void 0:E.source)||"react_sdk",version:(p==null||(x=p.overrides)==null||(x=x.client)==null?void 0:x.version)||(r==null||(R=r.overrides)==null||(R=R.client)==null?void 0:R.version)||"0.7.1"})}),onConnect:(p==null?void 0:p.onConnect)||(r==null?void 0:r.onConnect),onDisconnect:(p==null?void 0:p.onDisconnect)||(r==null?void 0:r.onDisconnect),onError:(p==null?void 0:p.onError)||(r==null?void 0:r.onError),onMessage:(p==null?void 0:p.onMessage)||(r==null?void 0:r.onMessage),onAudio:(p==null?void 0:p.onAudio)||(r==null?void 0:r.onAudio),onDebug:(p==null?void 0:p.onDebug)||(r==null?void 0:r.onDebug),onUnhandledClientToolCall:(p==null?void 0:p.onUnhandledClientToolCall)||(r==null?void 0:r.onUnhandledClientToolCall),onVadScore:(p==null?void 0:p.onVadScore)||(r==null?void 0:r.onVadScore),onInterruption:(p==null?void 0:p.onInterruption)||(r==null?void 0:r.onInterruption),onAgentToolResponse:(p==null?void 0:p.onAgentToolResponse)||(r==null?void 0:r.onAgentToolResponse),onConversationMetadata:(p==null?void 0:p.onConversationMetadata)||(r==null?void 0:r.onConversationMetadata),onMCPToolCall:(p==null?void 0:p.onMCPToolCall)||(r==null?void 0:r.onMCPToolCall),onMCPConnectionStatus:(p==null?void 0:p.onMCPConnectionStatus)||(r==null?void 0:r.onMCPConnectionStatus),onAsrInitiationMetadata:(p==null?void 0:p.onAsrInitiationMetadata)||(r==null?void 0:r.onAsrInitiationMetadata),onModeChange:({mode:B})=>{var J;h(B),(J=(p==null?void 0:p.onModeChange)||(r==null?void 0:r.onModeChange))==null||J({mode:B})},onStatusChange:({status:B})=>{var J;l(B),(J=(p==null?void 0:p.onStatusChange)||(r==null?void 0:r.onStatusChange))==null||J({status:B})},onCanSendFeedbackChange:({canSendFeedback:B})=>{var J;u(B),(J=(p==null?void 0:p.onCanSendFeedbackChange)||(r==null?void 0:r.onCanSendFeedbackChange))==null||J({canSendFeedback:B})}})),s.current=await o.current,f.current!==void 0&&s.current.setMicMuted(f.current),v.current!==void 0&&s.current.setVolume({volume:v.current}),s.current.getId()}finally{o.current=null}},endSession:async()=>{const p=s.current;s.current=null,await(p==null?void 0:p.endSession())},setVolume:({volume:p})=>{var y;(y=s.current)==null||y.setVolume({volume:p})},getInputByteFrequencyData:()=>{var p;return(p=s.current)==null?void 0:p.getInputByteFrequencyData()},getOutputByteFrequencyData:()=>{var p;return(p=s.current)==null?void 0:p.getOutputByteFrequencyData()},getInputVolume:()=>{var p,y;return(p=(y=s.current)==null?void 0:y.getInputVolume())!=null?p:0},getOutputVolume:()=>{var p,y;return(p=(y=s.current)==null?void 0:y.getOutputVolume())!=null?p:0},sendFeedback:p=>{var y;(y=s.current)==null||y.sendFeedback(p)},getId:()=>{var p;return(p=s.current)==null?void 0:p.getId()},sendContextualUpdate:p=>{var y;(y=s.current)==null||y.sendContextualUpdate(p)},sendUserMessage:p=>{var y;(y=s.current)==null||y.sendUserMessage(p)},sendUserActivity:()=>{var p;(p=s.current)==null||p.sendUserActivity()},sendMCPToolApprovalResult:(p,y)=>{var m;(m=s.current)==null||m.sendMCPToolApprovalResult(p,y)},changeInputDevice:async p=>{if(s.current&&"changeInputDevice"in s.current)return await s.current.changeInputDevice(p);throw new Error("Device switching is only available for voice conversations")},changeOutputDevice:async p=>{if(s.current&&"changeOutputDevice"in s.current)return await s.current.changeOutputDevice(p);throw new Error("Device switching is only available for voice conversations")},status:a,canSendFeedback:c,micMuted:e,isSpeaking:d==="speaking"}}const QN=dk("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),hC=C.forwardRef(({className:t,variant:e,size:n,asChild:i=!1,...r},s)=>{const o=i?_P:"button";return A.jsx(o,{className:yr(QN({variant:e,size:n,className:t})),ref:s,...r})});hC.displayName="Button";const YN="modulepreload",XN=function(t){return"/"+t},Gy={},Za=function(e,n,i){let r=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));r=Promise.allSettled(n.map(l=>{if(l=XN(l),l in Gy)return;Gy[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":YN,c||(d.as="script"),d.crossOrigin="",d.href=l,a&&d.setAttribute("nonce",a),document.head.appendChild(d),c)return new Promise((h,f)=>{d.addEventListener("load",h),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return r.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})},ZN=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>Za(async()=>{const{default:i}=await Promise.resolve().then(()=>So);return{default:i}},void 0).then(({default:i})=>i(...n)):e=fetch,(...n)=>e(...n)};class Um extends Error{constructor(e,n="FunctionsError",i){super(e),this.name=n,this.context=i}}class Jy extends Um{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Qy extends Um{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Yy extends Um{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var zf;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(zf||(zf={}));var eL=function(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):r(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})};class tL{constructor(e,{headers:n={},customFetch:i,region:r=zf.Any}={}){this.url=e,this.headers=n,this.region=r,this.fetch=ZN(i)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,n={}){var i;return eL(this,void 0,void 0,function*(){try{const{headers:r,method:s,body:o,signal:a}=n;let l={},{region:c}=n;c||(c=this.region);const u=new URL(`${this.url}/${e}`);c&&c!=="any"&&(l["x-region"]=c,u.searchParams.set("forceFunctionRegion",c));let d;o&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",d=o):typeof o=="string"?(l["Content-Type"]="text/plain",d=o):typeof FormData<"u"&&o instanceof FormData?d=o:(l["Content-Type"]="application/json",d=JSON.stringify(o)));const h=yield this.fetch(u.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),r),body:d,signal:a}).catch(y=>{throw y.name==="AbortError"?y:new Jy(y)}),f=h.headers.get("x-relay-error");if(f&&f==="true")throw new Qy(h);if(!h.ok)throw new Yy(h);let v=((i=h.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),p;return v==="application/json"?p=yield h.json():v==="application/octet-stream"?p=yield h.blob():v==="text/event-stream"?p=h:v==="multipart/form-data"?p=yield h.formData():p=yield h.text(),{data:p,error:null,response:h}}catch(r){return r instanceof Error&&r.name==="AbortError"?{data:null,error:new Jy(r)}:{data:null,error:r,response:r instanceof Yy||r instanceof Qy?r.context:void 0}}})}}var Tt={},Fm={},zu={},el={},qu={},Wu={},nL=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},mo=nL();const iL=mo.fetch,fC=mo.fetch.bind(mo),pC=mo.Headers,rL=mo.Request,sL=mo.Response,So=Object.freeze(Object.defineProperty({__proto__:null,Headers:pC,Request:rL,Response:sL,default:fC,fetch:iL},Symbol.toStringTag,{value:"Module"})),oL=KC(So);var Hu={};Object.defineProperty(Hu,"__esModule",{value:!0});let aL=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Hu.default=aL;var mC=Zt&&Zt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Wu,"__esModule",{value:!0});const lL=mC(oL),cL=mC(Hu);let uL=class{constructor(e){var n,i;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(n=e.shouldThrowOnError)!==null&&n!==void 0?n:!1,this.signal=e.signal,this.isMaybeSingle=(i=e.isMaybeSingle)!==null&&i!==void 0?i:!1,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=lL.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,n){return this.headers=new Headers(this.headers),this.headers.set(e,n),this}then(e,n){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const i=this.fetch;let r=i(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async s=>{var o,a,l,c;let u=null,d=null,h=null,f=s.status,v=s.statusText;if(s.ok){if(this.method!=="HEAD"){const g=await s.text();g===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((o=this.headers.get("Accept"))===null||o===void 0)&&o.includes("application/vnd.pgrst.plan+text"))?d=g:d=JSON.parse(g))}const y=(a=this.headers.get("Prefer"))===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),m=(l=s.headers.get("content-range"))===null||l===void 0?void 0:l.split("/");y&&m&&m.length>1&&(h=parseInt(m[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(d)&&(d.length>1?(u={code:"PGRST116",details:`Results contain ${d.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},d=null,h=null,f=406,v="Not Acceptable"):d.length===1?d=d[0]:d=null)}else{const y=await s.text();try{u=JSON.parse(y),Array.isArray(u)&&s.status===404&&(d=[],u=null,f=200,v="OK")}catch{s.status===404&&y===""?(f=204,v="No Content"):u={message:y}}if(u&&this.isMaybeSingle&&(!((c=u==null?void 0:u.details)===null||c===void 0)&&c.includes("0 rows"))&&(u=null,f=200,v="OK"),u&&this.shouldThrowOnError)throw new cL.default(u)}return{error:u,data:d,count:h,status:f,statusText:v}});return this.shouldThrowOnError||(r=r.catch(s=>{var o,a,l;return{error:{message:`${(o=s==null?void 0:s.name)!==null&&o!==void 0?o:"FetchError"}: ${s==null?void 0:s.message}`,details:`${(a=s==null?void 0:s.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(l=s==null?void 0:s.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),r.then(e,n)}returns(){return this}overrideTypes(){return this}};Wu.default=uL;var dL=Zt&&Zt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(qu,"__esModule",{value:!0});const hL=dL(Wu);let fL=class extends hL.default{select(e){let n=!1;const i=(e??"*").split("").map(r=>/\s/.test(r)&&!n?"":(r==='"'&&(n=!n),r)).join("");return this.url.searchParams.set("select",i),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:n=!0,nullsFirst:i,foreignTable:r,referencedTable:s=r}={}){const o=s?`${s}.order`:"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${a?`${a},`:""}${e}.${n?"asc":"desc"}${i===void 0?"":i?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:n,referencedTable:i=n}={}){const r=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,n,{foreignTable:i,referencedTable:r=i}={}){const s=typeof r>"u"?"offset":`${r}.offset`,o=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this.url.searchParams.set(o,`${n-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:n=!1,settings:i=!1,buffers:r=!1,wal:s=!1,format:o="text"}={}){var a;const l=[e?"analyze":null,n?"verbose":null,i?"settings":null,r?"buffers":null,s?"wal":null].filter(Boolean).join("|"),c=(a=this.headers.get("Accept"))!==null&&a!==void 0?a:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${o}; for="${c}"; options=${l};`),o==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};qu.default=fL;var pL=Zt&&Zt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(el,"__esModule",{value:!0});const mL=pL(qu);let gL=class extends mL.default{eq(e,n){return this.url.searchParams.append(e,`eq.${n}`),this}neq(e,n){return this.url.searchParams.append(e,`neq.${n}`),this}gt(e,n){return this.url.searchParams.append(e,`gt.${n}`),this}gte(e,n){return this.url.searchParams.append(e,`gte.${n}`),this}lt(e,n){return this.url.searchParams.append(e,`lt.${n}`),this}lte(e,n){return this.url.searchParams.append(e,`lte.${n}`),this}like(e,n){return this.url.searchParams.append(e,`like.${n}`),this}likeAllOf(e,n){return this.url.searchParams.append(e,`like(all).{${n.join(",")}}`),this}likeAnyOf(e,n){return this.url.searchParams.append(e,`like(any).{${n.join(",")}}`),this}ilike(e,n){return this.url.searchParams.append(e,`ilike.${n}`),this}ilikeAllOf(e,n){return this.url.searchParams.append(e,`ilike(all).{${n.join(",")}}`),this}ilikeAnyOf(e,n){return this.url.searchParams.append(e,`ilike(any).{${n.join(",")}}`),this}is(e,n){return this.url.searchParams.append(e,`is.${n}`),this}in(e,n){const i=Array.from(new Set(n)).map(r=>typeof r=="string"&&new RegExp("[,()]").test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(e,`in.(${i})`),this}contains(e,n){return typeof n=="string"?this.url.searchParams.append(e,`cs.${n}`):Array.isArray(n)?this.url.searchParams.append(e,`cs.{${n.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(n)}`),this}containedBy(e,n){return typeof n=="string"?this.url.searchParams.append(e,`cd.${n}`):Array.isArray(n)?this.url.searchParams.append(e,`cd.{${n.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(n)}`),this}rangeGt(e,n){return this.url.searchParams.append(e,`sr.${n}`),this}rangeGte(e,n){return this.url.searchParams.append(e,`nxl.${n}`),this}rangeLt(e,n){return this.url.searchParams.append(e,`sl.${n}`),this}rangeLte(e,n){return this.url.searchParams.append(e,`nxr.${n}`),this}rangeAdjacent(e,n){return this.url.searchParams.append(e,`adj.${n}`),this}overlaps(e,n){return typeof n=="string"?this.url.searchParams.append(e,`ov.${n}`):this.url.searchParams.append(e,`ov.{${n.join(",")}}`),this}textSearch(e,n,{config:i,type:r}={}){let s="";r==="plain"?s="pl":r==="phrase"?s="ph":r==="websearch"&&(s="w");const o=i===void 0?"":`(${i})`;return this.url.searchParams.append(e,`${s}fts${o}.${n}`),this}match(e){return Object.entries(e).forEach(([n,i])=>{this.url.searchParams.append(n,`eq.${i}`)}),this}not(e,n,i){return this.url.searchParams.append(e,`not.${n}.${i}`),this}or(e,{foreignTable:n,referencedTable:i=n}={}){const r=i?`${i}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,n,i){return this.url.searchParams.append(e,`${n}.${i}`),this}};el.default=gL;var vL=Zt&&Zt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(zu,"__esModule",{value:!0});const Vo=vL(el);let yL=class{constructor(e,{headers:n={},schema:i,fetch:r}){this.url=e,this.headers=new Headers(n),this.schema=i,this.fetch=r}select(e,{head:n=!1,count:i}={}){const r=n?"HEAD":"GET";let s=!1;const o=(e??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",o),i&&this.headers.append("Prefer",`count=${i}`),new Vo.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:n,defaultToNull:i=!0}={}){var r;const s="POST";if(n&&this.headers.append("Prefer",`count=${n}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const o=e.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(o.length>0){const a=[...new Set(o)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new Vo.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}upsert(e,{onConflict:n,ignoreDuplicates:i=!1,count:r,defaultToNull:s=!0}={}){var o;const a="POST";if(this.headers.append("Prefer",`resolution=${i?"ignore":"merge"}-duplicates`),n!==void 0&&this.url.searchParams.set("on_conflict",n),r&&this.headers.append("Prefer",`count=${r}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const l=e.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(l.length>0){const c=[...new Set(l)].map(u=>`"${u}"`);this.url.searchParams.set("columns",c.join(","))}}return new Vo.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}update(e,{count:n}={}){var i;const r="PATCH";return n&&this.headers.append("Prefer",`count=${n}`),new Vo.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}delete({count:e}={}){var n;const i="DELETE";return e&&this.headers.append("Prefer",`count=${e}`),new Vo.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}};zu.default=yL;var gC=Zt&&Zt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Fm,"__esModule",{value:!0});const bL=gC(zu),wL=gC(el);let kL=class vC{constructor(e,{headers:n={},schema:i,fetch:r}={}){this.url=e,this.headers=new Headers(n),this.schemaName=i,this.fetch=r}from(e){const n=new URL(`${this.url}/${e}`);return new bL.default(n,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new vC(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,n={},{head:i=!1,get:r=!1,count:s}={}){var o;let a;const l=new URL(`${this.url}/rpc/${e}`);let c;i||r?(a=i?"HEAD":"GET",Object.entries(n).filter(([d,h])=>h!==void 0).map(([d,h])=>[d,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([d,h])=>{l.searchParams.append(d,h)})):(a="POST",c=n);const u=new Headers(this.headers);return s&&u.set("Prefer",`count=${s}`),new wL.default({method:a,url:l,headers:u,schema:this.schemaName,body:c,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};Fm.default=kL;var To=Zt&&Zt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Tt,"__esModule",{value:!0});Tt.PostgrestError=Tt.PostgrestBuilder=Tt.PostgrestTransformBuilder=Tt.PostgrestFilterBuilder=Tt.PostgrestQueryBuilder=Tt.PostgrestClient=void 0;const yC=To(Fm);Tt.PostgrestClient=yC.default;const bC=To(zu);Tt.PostgrestQueryBuilder=bC.default;const wC=To(el);Tt.PostgrestFilterBuilder=wC.default;const kC=To(qu);Tt.PostgrestTransformBuilder=kC.default;const SC=To(Wu);Tt.PostgrestBuilder=SC.default;const TC=To(Hu);Tt.PostgrestError=TC.default;var SL=Tt.default={PostgrestClient:yC.default,PostgrestQueryBuilder:bC.default,PostgrestFilterBuilder:wC.default,PostgrestTransformBuilder:kC.default,PostgrestBuilder:SC.default,PostgrestError:TC.default};const{PostgrestClient:TL,PostgrestQueryBuilder:BU,PostgrestFilterBuilder:$U,PostgrestTransformBuilder:VU,PostgrestBuilder:zU,PostgrestError:qU}=SL;class CL{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const n=process.versions;if(n&&n.node){const i=n.node,r=parseInt(i.replace(/^v/,"").split(".")[0]);return r>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){const i=this.getWebSocketConstructor();return new i(e,n)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const _L="2.15.5",EL=`realtime-js/${_L}`,PL="1.0.0",qf=1e4,xL=1e3,RL=100;var ha;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(ha||(ha={}));var qe;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(qe||(qe={}));var mn;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(mn||(mn={}));var Wf;(function(t){t.websocket="websocket"})(Wf||(Wf={}));var Or;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Or||(Or={}));class IL{constructor(){this.HEADER_LENGTH=1}decode(e,n){return e.constructor===ArrayBuffer?n(this._binaryDecode(e)):n(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const n=new DataView(e),i=new TextDecoder;return this._decodeBroadcast(e,n,i)}_decodeBroadcast(e,n,i){const r=n.getUint8(1),s=n.getUint8(2);let o=this.HEADER_LENGTH+2;const a=i.decode(e.slice(o,o+r));o=o+r;const l=i.decode(e.slice(o,o+s));o=o+s;const c=JSON.parse(i.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class CC{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var we;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(we||(we={}));const Xy=(t,e,n={})=>{var i;const r=(i=n.skipTypes)!==null&&i!==void 0?i:[];return Object.keys(e).reduce((s,o)=>(s[o]=OL(o,t,e,r),s),{})},OL=(t,e,n,i)=>{const r=e.find(a=>a.name===t),s=r==null?void 0:r.type,o=n[t];return s&&!i.includes(s)?_C(s,o):Hf(o)},_C=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return NL(e,n)}switch(t){case we.bool:return AL(e);case we.float4:case we.float8:case we.int2:case we.int4:case we.int8:case we.numeric:case we.oid:return DL(e);case we.json:case we.jsonb:return ML(e);case we.timestamp:return LL(e);case we.abstime:case we.date:case we.daterange:case we.int4range:case we.int8range:case we.money:case we.reltime:case we.text:case we.time:case we.timestamptz:case we.timetz:case we.tsrange:case we.tstzrange:return Hf(e);default:return Hf(e)}},Hf=t=>t,AL=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},DL=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},ML=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},NL=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,i=t[n];if(t[0]==="{"&&i==="}"){let s;const o=t.slice(1,n);try{s=JSON.parse("["+o+"]")}catch{s=o?o.split(","):[]}return s.map(a=>_C(e,a))}return t},LL=t=>typeof t=="string"?t.replace(" ","T"):t,EC=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Qd{constructor(e,n,i={},r=qf){this.channel=e,this.event=n,this.payload=i,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var i;return this._hasReceived(e)&&n((i=this.receivedResp)===null||i===void 0?void 0:i.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(i=>i.status===e).forEach(i=>i.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Zy;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(Zy||(Zy={}));class fa{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const i=(n==null?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(i.state,{},r=>{const{onJoin:s,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=fa.syncState(this.state,r,s,o),this.pendingDiffs.forEach(l=>{this.state=fa.syncDiff(this.state,l,s,o)}),this.pendingDiffs=[],a()}),this.channel._on(i.diff,{},r=>{const{onJoin:s,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(r):(this.state=fa.syncDiff(this.state,r,s,o),a())}),this.onJoin((r,s,o)=>{this.channel._trigger("presence",{event:"join",key:r,currentPresences:s,newPresences:o})}),this.onLeave((r,s,o)=>{this.channel._trigger("presence",{event:"leave",key:r,currentPresences:s,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,i,r){const s=this.cloneDeep(e),o=this.transformState(n),a={},l={};return this.map(s,(c,u)=>{o[c]||(l[c]=u)}),this.map(o,(c,u)=>{const d=s[c];if(d){const h=u.map(y=>y.presence_ref),f=d.map(y=>y.presence_ref),v=u.filter(y=>f.indexOf(y.presence_ref)<0),p=d.filter(y=>h.indexOf(y.presence_ref)<0);v.length>0&&(a[c]=v),p.length>0&&(l[c]=p)}else a[c]=u}),this.syncDiff(s,{joins:a,leaves:l},i,r)}static syncDiff(e,n,i,r){const{joins:s,leaves:o}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return i||(i=()=>{}),r||(r=()=>{}),this.map(s,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const d=e[a].map(f=>f.presence_ref),h=u.filter(f=>d.indexOf(f.presence_ref)<0);e[a].unshift(...h)}i(a,u,l)}),this.map(o,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),e[a]=c,r(a,c,l),c.length===0&&delete e[a]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(i=>n(i,e[i]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,i)=>{const r=e[i];return"metas"in r?n[i]=r.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):n[i]=r,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var e0;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(e0||(e0={}));var pa;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(pa||(pa={}));var Zn;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(Zn||(Zn={}));class Bm{constructor(e,n={config:{}},i){this.topic=e,this.params=n,this.socket=i,this.bindings={},this.state=qe.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new Qd(this,mn.join,this.params,this.timeout),this.rejoinTimer=new CC(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=qe.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(r=>r.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=qe.closed,this.socket._remove(this)}),this._onError(r=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,r),this.state=qe.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=qe.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",r=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,r),this.state=qe.errored,this.rejoinTimer.scheduleTimeout())}),this._on(mn.reply,{},(r,s)=>{this._trigger(this._replyEventName(s),r)}),this.presence=new fa(this),this.broadcastEndpointURL=EC(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,n=this.timeout){var i,r,s;if(this.socket.isConnected()||this.socket.connect(),this.state==qe.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,c=(r=(i=this.bindings.postgres_changes)===null||i===void 0?void 0:i.map(f=>f.filter))!==null&&r!==void 0?r:[],u=!!this.bindings[pa.PRESENCE]&&this.bindings[pa.PRESENCE].length>0||((s=this.params.config.presence)===null||s===void 0?void 0:s.enabled)===!0,d={},h={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:u}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this._onError(f=>e==null?void 0:e(Zn.CHANNEL_ERROR,f)),this._onClose(()=>e==null?void 0:e(Zn.CLOSED)),this.updateJoinPayload(Object.assign({config:h},d)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:f})=>{var v;if(this.socket.setAuth(),f===void 0){e==null||e(Zn.SUBSCRIBED);return}else{const p=this.bindings.postgres_changes,y=(v=p==null?void 0:p.length)!==null&&v!==void 0?v:0,m=[];for(let g=0;g<y;g++){const b=p[g],{filter:{event:w,schema:k,table:S,filter:_}}=b,E=f&&f[g];if(E&&E.event===w&&E.schema===k&&E.table===S&&E.filter===_)m.push(Object.assign(Object.assign({},b),{id:E.id}));else{this.unsubscribe(),this.state=qe.errored,e==null||e(Zn.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=m,e&&e(Zn.SUBSCRIBED);return}}).receive("error",f=>{this.state=qe.errored,e==null||e(Zn.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Zn.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,i){return this.state===qe.joined&&e===pa.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,n,i)}async send(e,n={}){var i,r;if(!this._canPush()&&e.type==="broadcast"){const{event:s,payload:o}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:o,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(i=n.timeout)!==null&&i!==void 0?i:this.timeout);return await((r=c.body)===null||r===void 0?void 0:r.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var o,a,l;const c=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&s("ok"),c.receive("ok",()=>s("ok")),c.receive("error",()=>s("error")),c.receive("timeout",()=>s("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=qe.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(mn.close,"leave",this._joinRef())};this.joinPush.destroy();let i=null;return new Promise(r=>{i=new Qd(this,mn.leave,{},e),i.receive("ok",()=>{n(),r("ok")}).receive("timeout",()=>{n(),r("timed out")}).receive("error",()=>{r("error")}),i.send(),this._canPush()||i.trigger("ok",{})}).finally(()=>{i==null||i.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=qe.closed,this.bindings={}}async _fetchWithTimeout(e,n,i){const r=new AbortController,s=setTimeout(()=>r.abort(),i),o=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:r.signal}));return clearTimeout(s),o}_push(e,n,i=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new Qd(this,e,n,i);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>RL){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,i){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,i){var r,s;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=mn;if(i&&[a,l,c,u].indexOf(o)>=0&&i!==this._joinRef())return;let h=this._onMessage(o,n,i);if(n&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(r=this.bindings.postgres_changes)===null||r===void 0||r.filter(f=>{var v,p,y;return((v=f.filter)===null||v===void 0?void 0:v.event)==="*"||((y=(p=f.filter)===null||p===void 0?void 0:p.event)===null||y===void 0?void 0:y.toLocaleLowerCase())===o}).map(f=>f.callback(h,i)):(s=this.bindings[o])===null||s===void 0||s.filter(f=>{var v,p,y,m,g,b;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const w=f.id,k=(v=f.filter)===null||v===void 0?void 0:v.event;return w&&((p=n.ids)===null||p===void 0?void 0:p.includes(w))&&(k==="*"||(k==null?void 0:k.toLocaleLowerCase())===((y=n.data)===null||y===void 0?void 0:y.type.toLocaleLowerCase()))}else{const w=(g=(m=f==null?void 0:f.filter)===null||m===void 0?void 0:m.event)===null||g===void 0?void 0:g.toLocaleLowerCase();return w==="*"||w===((b=n==null?void 0:n.event)===null||b===void 0?void 0:b.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof h=="object"&&"ids"in h){const v=h.data,{schema:p,table:y,commit_timestamp:m,type:g,errors:b}=v;h=Object.assign(Object.assign({},{schema:p,table:y,commit_timestamp:m,eventType:g,new:{},old:{},errors:b}),this._getPayloadRecords(v))}f.callback(h,i)})}_isClosed(){return this.state===qe.closed}_isJoined(){return this.state===qe.joined}_isJoining(){return this.state===qe.joining}_isLeaving(){return this.state===qe.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,i){const r=e.toLocaleLowerCase(),s={type:r,filter:n,callback:i};return this.bindings[r]?this.bindings[r].push(s):this.bindings[r]=[s],this}_off(e,n){const i=e.toLocaleLowerCase();return this.bindings[i]&&(this.bindings[i]=this.bindings[i].filter(r=>{var s;return!(((s=r.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===i&&Bm.isEqual(r.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const i in e)if(e[i]!==n[i])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(mn.close,{},e)}_onError(e){this._on(mn.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=qe.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=Xy(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=Xy(e.columns,e.old_record)),n}}const Yd=()=>{},Ol={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},jL=[1e3,2e3,5e3,1e4],UL=1e4,FL=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class BL{constructor(e,n){var i;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=qf,this.transport=null,this.heartbeatIntervalMs=Ol.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Yd,this.ref=0,this.reconnectTimer=null,this.logger=Yd,this.conn=null,this.sendBuffer=[],this.serializer=new IL,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=r=>{let s;return r?s=r:typeof fetch>"u"?s=(...o)=>Za(async()=>{const{default:a}=await Promise.resolve().then(()=>So);return{default:a}},void 0).then(({default:a})=>a(...o)).catch(a=>{throw new Error(`Failed to load @supabase/node-fetch: ${a.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):s=fetch,(...o)=>s(...o)},!(!((i=n==null?void 0:n.params)===null||i===void 0)&&i.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${Wf.websocket}`,this.httpEndpoint=EC(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n==null?void 0:n.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=CL.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:PL}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const i=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(i),this._setConnectionState("disconnected")},e?this.conn.close(e,n??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,i){this.logger(e,n,i)}connectionState(){switch(this.conn&&this.conn.readyState){case ha.connecting:return Or.Connecting;case ha.open:return Or.Open;case ha.closing:return Or.Closing;default:return Or.Closed}}isConnected(){return this.connectionState()===Or.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){const i=`realtime:${e}`,r=this.getChannels().find(s=>s.topic===i);if(r)return r;{const s=new Bm(`realtime:${e}`,n,this);return this.channels.push(s),s}}push(e){const{topic:n,event:i,payload:r,ref:s}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${n} ${i} (${s})`,r),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(xL,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},Ol.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(i=>i.topic===e&&(i._isJoined()||i._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply")try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error")}catch(c){this.log("error","error in heartbeat callback",c)}n.ref&&n.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:i,event:r,payload:s,ref:o}=n,a=o?`(${o})`:"",l=s.status||"";this.log("receive",`${l} ${i} ${r} ${a}`.trim(),s),this.channels.filter(c=>c._isMember(i)).forEach(c=>c._trigger(r,s,o)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this.workerRef.terminate()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(mn.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const i=e.match(/\?/)?"&":"?",r=new URLSearchParams(n);return`${e}${i}${r}`}_workerObjectUrl(e){let n;if(e)n=e;else{const i=new Blob([FL],{type:"application/javascript"});n=URL.createObjectURL(i)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n;e?n=e:this.accessToken?n=await this.accessToken():n=this.accessTokenValue,this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(i=>{const r={access_token:n,version:EL};n&&i.updateJoinPayload(r),i.joinedOnce&&i._isJoined()&&i._push(mn.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(n=>{this.log("error",`error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(i=>{try{i(n)}catch(r){this.log("error",`error in ${e} callback`,r)}})}catch(i){this.log("error",`error triggering ${e} callbacks`,i)}}_setupReconnectionTimer(){this.reconnectTimer=new CC(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Ol.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,i,r,s,o,a,l,c,u;if(this.transport=(n=e==null?void 0:e.transport)!==null&&n!==void 0?n:null,this.timeout=(i=e==null?void 0:e.timeout)!==null&&i!==void 0?i:qf,this.heartbeatIntervalMs=(r=e==null?void 0:e.heartbeatIntervalMs)!==null&&r!==void 0?r:Ol.HEARTBEAT_INTERVAL,this.worker=(s=e==null?void 0:e.worker)!==null&&s!==void 0?s:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e==null?void 0:e.heartbeatCallback)!==null&&a!==void 0?a:Yd,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(l=e==null?void 0:e.reconnectAfterMs)!==null&&l!==void 0?l:d=>jL[d-1]||UL,this.encode=(c=e==null?void 0:e.encode)!==null&&c!==void 0?c:(d,h)=>h(JSON.stringify(d)),this.decode=(u=e==null?void 0:e.decode)!==null&&u!==void 0?u:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class $m extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function $e(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class $L extends $m{constructor(e,n,i){super(e),this.name="StorageApiError",this.status=n,this.statusCode=i}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Kf extends $m{constructor(e,n){super(e),this.name="StorageUnknownError",this.originalError=n}}var VL=function(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):r(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})};const PC=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>Za(async()=>{const{default:i}=await Promise.resolve().then(()=>So);return{default:i}},void 0).then(({default:i})=>i(...n)):e=fetch,(...n)=>e(...n)},zL=()=>VL(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Za(()=>Promise.resolve().then(()=>So),void 0)).Response:Response}),Gf=t=>{if(Array.isArray(t))return t.map(n=>Gf(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,i])=>{const r=n.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[r]=Gf(i)}),e},qL=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)};var ns=function(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):r(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})};const Xd=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),WL=(t,e,n)=>ns(void 0,void 0,void 0,function*(){const i=yield zL();t instanceof i&&!(n!=null&&n.noResolveJson)?t.json().then(r=>{const s=t.status||500,o=(r==null?void 0:r.statusCode)||s+"";e(new $L(Xd(r),s,o))}).catch(r=>{e(new Kf(Xd(r),r))}):e(new Kf(Xd(t),t))}),HL=(t,e,n,i)=>{const r={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!i?r:(qL(i)?(r.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r.body=JSON.stringify(i)):r.body=i,e!=null&&e.duplex&&(r.duplex=e.duplex),Object.assign(Object.assign({},r),n))};function tl(t,e,n,i,r,s){return ns(this,void 0,void 0,function*(){return new Promise((o,a)=>{t(n,HL(e,i,r,s)).then(l=>{if(!l.ok)throw l;return i!=null&&i.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>WL(l,a,i))})})}function nu(t,e,n,i){return ns(this,void 0,void 0,function*(){return tl(t,"GET",e,n,i)})}function On(t,e,n,i,r){return ns(this,void 0,void 0,function*(){return tl(t,"POST",e,i,r,n)})}function Jf(t,e,n,i,r){return ns(this,void 0,void 0,function*(){return tl(t,"PUT",e,i,r,n)})}function KL(t,e,n,i){return ns(this,void 0,void 0,function*(){return tl(t,"HEAD",e,Object.assign(Object.assign({},n),{noResolveJson:!0}),i)})}function xC(t,e,n,i,r){return ns(this,void 0,void 0,function*(){return tl(t,"DELETE",e,i,r,n)})}var GL=function(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):r(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})};class JL{constructor(e,n){this.downloadFn=e,this.shouldThrowOnError=n}then(e,n){return this.execute().then(e,n)}execute(){return GL(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if($e(e))return{data:null,error:e};throw e}})}}var QL=function(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):r(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})};class YL{constructor(e,n){this.downloadFn=e,this.shouldThrowOnError=n}asStream(){return new JL(this.downloadFn,this.shouldThrowOnError)}then(e,n){return this.execute().then(e,n)}execute(){return QL(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if($e(e))return{data:null,error:e};throw e}})}}var bt=function(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):r(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})};const XL={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},t0={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class ZL{constructor(e,n={},i,r){this.shouldThrowOnError=!1,this.url=e,this.headers=n,this.bucketId=i,this.fetch=PC(r)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,n,i,r){return bt(this,void 0,void 0,function*(){try{let s;const o=Object.assign(Object.assign({},t0),r);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&i instanceof Blob?(s=new FormData,s.append("cacheControl",o.cacheControl),l&&s.append("metadata",this.encodeMetadata(l)),s.append("",i)):typeof FormData<"u"&&i instanceof FormData?(s=i,s.append("cacheControl",o.cacheControl),l&&s.append("metadata",this.encodeMetadata(l))):(s=i,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),r!=null&&r.headers&&(a=Object.assign(Object.assign({},a),r.headers));const c=this._removeEmptyFolders(n),u=this._getFinalPath(c),d=yield(e=="PUT"?Jf:On)(this.fetch,`${this.url}/object/${u}`,s,Object.assign({headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:c,id:d.Id,fullPath:d.Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if($e(s))return{data:null,error:s};throw s}})}upload(e,n,i){return bt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,n,i)})}uploadToSignedUrl(e,n,i,r){return bt(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(e),o=this._getFinalPath(s),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",n);try{let l;const c=Object.assign({upsert:t0.upsert},r),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&i instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",i)):typeof FormData<"u"&&i instanceof FormData?(l=i,l.append("cacheControl",c.cacheControl)):(l=i,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const d=yield Jf(this.fetch,a.toString(),l,{headers:u});return{data:{path:s,fullPath:d.Key},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if($e(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,n){return bt(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e);const r=Object.assign({},this.headers);n!=null&&n.upsert&&(r["x-upsert"]="true");const s=yield On(this.fetch,`${this.url}/object/upload/sign/${i}`,{},{headers:r}),o=new URL(this.url+s.url),a=o.searchParams.get("token");if(!a)throw new $m("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if($e(i))return{data:null,error:i};throw i}})}update(e,n,i){return bt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,n,i)})}move(e,n,i){return bt(this,void 0,void 0,function*(){try{return{data:yield On(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:i==null?void 0:i.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if($e(r))return{data:null,error:r};throw r}})}copy(e,n,i){return bt(this,void 0,void 0,function*(){try{return{data:{path:(yield On(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:i==null?void 0:i.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if($e(r))return{data:null,error:r};throw r}})}createSignedUrl(e,n,i){return bt(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),s=yield On(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:n},i!=null&&i.transform?{transform:i.transform}:{}),{headers:this.headers});const o=i!=null&&i.download?`&download=${i.download===!0?"":i.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${o}`)},{data:s,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if($e(r))return{data:null,error:r};throw r}})}createSignedUrls(e,n,i){return bt(this,void 0,void 0,function*(){try{const r=yield On(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:n,paths:e},{headers:this.headers}),s=i!=null&&i.download?`&download=${i.download===!0?"":i.download}`:"";return{data:r.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${s}`):null})),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if($e(r))return{data:null,error:r};throw r}})}download(e,n){const r=typeof(n==null?void 0:n.transform)<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString((n==null?void 0:n.transform)||{}),o=s?`?${s}`:"",a=this._getFinalPath(e),l=()=>nu(this.fetch,`${this.url}/${r}/${a}${o}`,{headers:this.headers,noResolveJson:!0});return new YL(l,this.shouldThrowOnError)}info(e){return bt(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{const i=yield nu(this.fetch,`${this.url}/object/info/${n}`,{headers:this.headers});return{data:Gf(i),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if($e(i))return{data:null,error:i};throw i}})}exists(e){return bt(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{return yield KL(this.fetch,`${this.url}/object/${n}`,{headers:this.headers}),{data:!0,error:null}}catch(i){if(this.shouldThrowOnError)throw i;if($e(i)&&i instanceof Kf){const r=i.originalError;if([400,404].includes(r==null?void 0:r.status))return{data:!1,error:i}}throw i}})}getPublicUrl(e,n){const i=this._getFinalPath(e),r=[],s=n!=null&&n.download?`download=${n.download===!0?"":n.download}`:"";s!==""&&r.push(s);const a=typeof(n==null?void 0:n.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((n==null?void 0:n.transform)||{});l!==""&&r.push(l);let c=r.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${i}${c}`)}}}remove(e){return bt(this,void 0,void 0,function*(){try{return{data:yield xC(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if($e(n))return{data:null,error:n};throw n}})}list(e,n,i){return bt(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},XL),n),{prefix:e||""});return{data:yield On(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},i),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if($e(r))return{data:null,error:r};throw r}})}listV2(e,n){return bt(this,void 0,void 0,function*(){try{const i=Object.assign({},e);return{data:yield On(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,i,{headers:this.headers},n),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if($e(i))return{data:null,error:i};throw i}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const n=[];return e.width&&n.push(`width=${e.width}`),e.height&&n.push(`height=${e.height}`),e.resize&&n.push(`resize=${e.resize}`),e.format&&n.push(`format=${e.format}`),e.quality&&n.push(`quality=${e.quality}`),n.join("&")}}const ej="2.12.2",tj={"X-Client-Info":`storage-js/${ej}`};var fs=function(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):r(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})};class nj{constructor(e,n={},i,r){this.shouldThrowOnError=!1;const s=new URL(e);r!=null&&r.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href,this.headers=Object.assign(Object.assign({},tj),n),this.fetch=PC(i)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return fs(this,void 0,void 0,function*(){try{return{data:yield nu(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if($e(e))return{data:null,error:e};throw e}})}getBucket(e){return fs(this,void 0,void 0,function*(){try{return{data:yield nu(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if($e(n))return{data:null,error:n};throw n}})}createBucket(e,n={public:!1}){return fs(this,void 0,void 0,function*(){try{return{data:yield On(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:n.type,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if($e(i))return{data:null,error:i};throw i}})}updateBucket(e,n){return fs(this,void 0,void 0,function*(){try{return{data:yield Jf(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if($e(i))return{data:null,error:i};throw i}})}emptyBucket(e){return fs(this,void 0,void 0,function*(){try{return{data:yield On(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if($e(n))return{data:null,error:n};throw n}})}deleteBucket(e){return fs(this,void 0,void 0,function*(){try{return{data:yield xC(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if($e(n))return{data:null,error:n};throw n}})}}class ij extends nj{constructor(e,n={},i,r){super(e,n,i,r)}from(e){return new ZL(this.url,this.headers,e,this.fetch)}}const rj="2.58.0";let Qo="";typeof Deno<"u"?Qo="deno":typeof document<"u"?Qo="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Qo="react-native":Qo="node";const sj={"X-Client-Info":`supabase-js-${Qo}/${rj}`},oj={headers:sj},aj={schema:"public"},lj={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},cj={};var uj=function(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):r(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})};const dj=t=>{let e;return t?e=t:typeof fetch>"u"?e=fC:e=fetch,(...n)=>e(...n)},hj=()=>typeof Headers>"u"?pC:Headers,fj=(t,e,n)=>{const i=dj(n),r=hj();return(s,o)=>uj(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:t;let c=new r(o==null?void 0:o.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),i(s,Object.assign(Object.assign({},o),{headers:c}))})};var pj=function(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):r(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})};function mj(t){return t.endsWith("/")?t:t+"/"}function gj(t,e){var n,i;const{db:r,auth:s,realtime:o,global:a}=t,{db:l,auth:c,realtime:u,global:d}=e,h={db:Object.assign(Object.assign({},l),r),auth:Object.assign(Object.assign({},c),s),realtime:Object.assign(Object.assign({},u),o),storage:{},global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},(n=d==null?void 0:d.headers)!==null&&n!==void 0?n:{}),(i=a==null?void 0:a.headers)!==null&&i!==void 0?i:{})}),accessToken:()=>pj(this,void 0,void 0,function*(){return""})};return t.accessToken?h.accessToken=t.accessToken:delete h.accessToken,h}function vj(t){const e=t==null?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(mj(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const RC="2.72.0",ys=30*1e3,Qf=3,Zd=Qf*ys,yj="http://localhost:9999",bj="supabase.auth.token",wj={"X-Client-Info":`gotrue-js/${RC}`},Yf="X-Supabase-Api-Version",IC={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},kj=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Sj=10*60*1e3;class Vm extends Error{constructor(e,n,i){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=i}}function te(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class Tj extends Vm{constructor(e,n,i){super(e,n,i),this.name="AuthApiError",this.status=n,this.code=i}}function Cj(t){return te(t)&&t.name==="AuthApiError"}class OC extends Vm{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class kr extends Vm{constructor(e,n,i,r){super(e,i,r),this.name=n,this.status=i}}class Ni extends kr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function _j(t){return te(t)&&t.name==="AuthSessionMissingError"}class zo extends kr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Al extends kr{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Dl extends kr{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Ej(t){return te(t)&&t.name==="AuthImplicitGrantRedirectError"}class n0 extends kr{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Xf extends kr{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function eh(t){return te(t)&&t.name==="AuthRetryableFetchError"}class i0 extends kr{constructor(e,n,i){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=i}}class Zf extends kr{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const iu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),r0=` 	
\r=`.split(""),Pj=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<r0.length;e+=1)t[r0[e].charCodeAt(0)]=-2;for(let e=0;e<iu.length;e+=1)t[iu[e].charCodeAt(0)]=e;return t})();function s0(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const i=e.queue>>e.queuedBits-6&63;n(iu[i]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const i=e.queue>>e.queuedBits-6&63;n(iu[i]),e.queuedBits-=6}}function AC(t,e,n){const i=Pj[t];if(i>-1)for(e.queue=e.queue<<6|i,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(i===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function o0(t){const e=[],n=o=>{e.push(String.fromCodePoint(o))},i={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},s=o=>{Ij(o,i,n)};for(let o=0;o<t.length;o+=1)AC(t.charCodeAt(o),r,s);return e.join("")}function xj(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function Rj(t,e){for(let n=0;n<t.length;n+=1){let i=t.charCodeAt(n);if(i>55295&&i<=56319){const r=(i-55296)*1024&65535;i=(t.charCodeAt(n+1)-56320&65535|r)+65536,n+=1}xj(i,e)}}function Ij(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let i=1;i<6;i+=1)if(!(t>>7-i&1)){e.utf8seq=i;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function Oj(t){const e=[],n={queue:0,queuedBits:0},i=r=>{e.push(r)};for(let r=0;r<t.length;r+=1)AC(t.charCodeAt(r),n,i);return new Uint8Array(e)}function Aj(t){const e=[];return Rj(t,n=>e.push(n)),new Uint8Array(e)}function Dj(t){const e=[],n={queue:0,queuedBits:0},i=r=>{e.push(r)};return t.forEach(r=>s0(r,n,i)),s0(null,n,i),e.join("")}function Mj(t){return Math.round(Date.now()/1e3)+t}function Nj(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const qt=()=>typeof window<"u"&&typeof document<"u",_r={tested:!1,writable:!1},DC=()=>{if(!qt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(_r.tested)return _r.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),_r.tested=!0,_r.writable=!0}catch{_r.tested=!0,_r.writable=!1}return _r.writable};function Lj(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((r,s)=>{e[s]=r})}catch{}return n.searchParams.forEach((i,r)=>{e[r]=i}),e}const MC=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>Za(async()=>{const{default:i}=await Promise.resolve().then(()=>So);return{default:i}},void 0).then(({default:i})=>i(...n)):e=fetch,(...n)=>e(...n)},jj=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",bs=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},Er=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},Ai=async(t,e)=>{await t.removeItem(e)};class Ku{constructor(){this.promise=new Ku.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}Ku.promiseConstructor=Promise;function th(t){const e=t.split(".");if(e.length!==3)throw new Zf("Invalid JWT structure");for(let i=0;i<e.length;i++)if(!kj.test(e[i]))throw new Zf("JWT not in base64url format");return{header:JSON.parse(o0(e[0])),payload:JSON.parse(o0(e[1])),signature:Oj(e[2]),raw:{header:e[0],payload:e[1]}}}async function Uj(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function Fj(t,e){return new Promise((i,r)=>{(async()=>{for(let s=0;s<1/0;s++)try{const o=await t(s);if(!e(s,null,o)){i(o);return}}catch(o){if(!e(s,o)){r(o);return}}})()})}function Bj(t){return("0"+t.toString(16)).substr(-2)}function $j(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",i=n.length;let r="";for(let s=0;s<56;s++)r+=n.charAt(Math.floor(Math.random()*i));return r}return crypto.getRandomValues(e),Array.from(e,Bj).join("")}async function Vj(t){const n=new TextEncoder().encode(t),i=await crypto.subtle.digest("SHA-256",n),r=new Uint8Array(i);return Array.from(r).map(s=>String.fromCharCode(s)).join("")}async function zj(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await Vj(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ps(t,e,n=!1){const i=$j();let r=i;n&&(r+="/PASSWORD_RECOVERY"),await bs(t,`${e}-code-verifier`,r);const s=await zj(i);return[s,i===s?"plain":"s256"]}const qj=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Wj(t){const e=t.headers.get(Yf);if(!e||!e.match(qj))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Hj(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function Kj(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Gj=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ms(t){if(!Gj.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function nh(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const i=n.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function a0(t){return JSON.parse(JSON.stringify(t))}var Jj=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};const Ir=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Qj=[502,503,504];async function l0(t){var e;if(!jj(t))throw new Xf(Ir(t),0);if(Qj.includes(t.status))throw new Xf(Ir(t),t.status);let n;try{n=await t.json()}catch(s){throw new OC(Ir(s),s)}let i;const r=Wj(t);if(r&&r.getTime()>=IC["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?i=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(i=n.error_code),i){if(i==="weak_password")throw new i0(Ir(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(i==="session_not_found")throw new Ni}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((s,o)=>s&&typeof o=="string",!0))throw new i0(Ir(n),t.status,n.weak_password.reasons);throw new Tj(Ir(n),t.status||500,i)}const Yj=(t,e,n,i)=>{const r={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),r.body=JSON.stringify(i),Object.assign(Object.assign({},r),n))};async function oe(t,e,n,i){var r;const s=Object.assign({},i==null?void 0:i.headers);s[Yf]||(s[Yf]=IC["2024-01-01"].name),i!=null&&i.jwt&&(s.Authorization=`Bearer ${i.jwt}`);const o=(r=i==null?void 0:i.query)!==null&&r!==void 0?r:{};i!=null&&i.redirectTo&&(o.redirect_to=i.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await Xj(t,e,n+a,{headers:s,noResolveJson:i==null?void 0:i.noResolveJson},{},i==null?void 0:i.body);return i!=null&&i.xform?i==null?void 0:i.xform(l):{data:Object.assign({},l),error:null}}async function Xj(t,e,n,i,r,s){const o=Yj(e,i,r,s);let a;try{a=await t(n,Object.assign({},o))}catch(l){throw console.error(l),new Xf(Ir(l),0)}if(a.ok||await l0(a),i!=null&&i.noResolveJson)return a;try{return await a.json()}catch(l){await l0(l)}}function Rn(t){var e;let n=null;nU(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=Mj(t.expires_in)));const i=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:i},error:null}}function c0(t){const e=Rn(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,i)=>n&&typeof i=="string",!0)&&(e.data.weak_password=t.weak_password),e}function $i(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function Zj(t){return{data:t,error:null}}function eU(t){const{action_link:e,email_otp:n,hashed_token:i,redirect_to:r,verification_type:s}=t,o=Jj(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:n,hashed_token:i,redirect_to:r,verification_type:s},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function tU(t){return t}function nU(t){return t.access_token&&t.refresh_token&&t.expires_in}const ih=["global","local","others"];var iU=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};class rU{constructor({url:e="",headers:n={},fetch:i}){this.url=e,this.headers=n,this.fetch=MC(i),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,n=ih[0]){if(ih.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${ih.join(", ")}`);try{return await oe(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(i){if(te(i))return{data:null,error:i};throw i}}async inviteUserByEmail(e,n={}){try{return await oe(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:$i})}catch(i){if(te(i))return{data:{user:null},error:i};throw i}}async generateLink(e){try{const{options:n}=e,i=iU(e,["options"]),r=Object.assign(Object.assign({},i),n);return"newEmail"in i&&(r.new_email=i==null?void 0:i.newEmail,delete r.newEmail),await oe(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:eU,redirectTo:n==null?void 0:n.redirectTo})}catch(n){if(te(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await oe(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:$i})}catch(n){if(te(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,i,r,s,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await oe(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:"",per_page:(s=(r=e==null?void 0:e.perPage)===null||r===void 0?void 0:r.toString())!==null&&s!==void 0?s:""},xform:tU});if(u.error)throw u.error;const d=await u.json(),h=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(v=>{const p=parseInt(v.split(";")[0].split("=")[1].substring(0,1)),y=JSON.parse(v.split(";")[1].split("=")[1]);c[`${y}Page`]=p}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(te(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){ms(e);try{return await oe(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:$i})}catch(n){if(te(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){ms(e);try{return await oe(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:$i})}catch(i){if(te(i))return{data:{user:null},error:i};throw i}}async deleteUser(e,n=!1){ms(e);try{return await oe(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:$i})}catch(i){if(te(i))return{data:{user:null},error:i};throw i}}async _listFactors(e){ms(e.userId);try{const{data:n,error:i}=await oe(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:r=>({data:{factors:r},error:null})});return{data:n,error:i}}catch(n){if(te(n))return{data:null,error:n};throw n}}async _deleteFactor(e){ms(e.userId),ms(e.id);try{return{data:await oe(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(te(n))return{data:null,error:n};throw n}}}function u0(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}function sU(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const gs={debug:!!(globalThis&&DC()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class NC extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class oU extends NC{}async function aU(t,e,n){gs.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const i=new globalThis.AbortController;return e>0&&setTimeout(()=>{i.abort(),gs.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},async r=>{if(r){gs.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,r.name);try{return await n()}finally{gs.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,r.name)}}else{if(e===0)throw gs.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new oU(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(gs.debug)try{const s=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function LC(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function lU(t){return parseInt(t,16)}function cU(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,i=>i.toString(16).padStart(2,"0")).join("")}function uU(t){var e;const{chainId:n,domain:i,expirationTime:r,issuedAt:s=new Date,nonce:o,notBefore:a,requestId:l,resources:c,scheme:u,uri:d,version:h}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!i)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!d)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(h!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const f=LC(t.address),v=u?`${u}://${i}`:i,p=t.statement?`${t.statement}
`:"",y=`${v} wants you to sign in with your Ethereum account:
${f}

${p}`;let m=`URI: ${d}
Version: ${h}
Chain ID: ${n}${o?`
Nonce: ${o}`:""}
Issued At: ${s.toISOString()}`;if(r&&(m+=`
Expiration Time: ${r.toISOString()}`),a&&(m+=`
Not Before: ${a.toISOString()}`),l&&(m+=`
Request ID: ${l}`),c){let g=`
Resources:`;for(const b of c){if(!b||typeof b!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${b}`);g+=`
- ${b}`}m+=g}return`${y}
${m}`}sU();const dU={url:yj,storageKey:bj,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:wj,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function d0(t,e,n){return await n()}const vs={};class Va{constructor(e){var n,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Va.nextInstanceID,Va.nextInstanceID+=1,this.instanceID>0&&qt()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},dU),e);if(this.logDebugMessages=!!r.debug,typeof r.debug=="function"&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new rU({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=MC(r.fetch),this.lock=r.lock||d0,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:qt()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=aU:this.lock=d0,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(r.storage?this.storage=r.storage:DC()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=u0(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=u0(this.memoryStorage)),qt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}get jwks(){var e,n;return(n=(e=vs[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){vs[this.storageKey]=Object.assign(Object.assign({},vs[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=vs[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){vs[this.storageKey]=Object.assign(Object.assign({},vs[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${RC}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const n=Lj(window.location.href);let i="none";if(this._isImplicitGrantCallback(n)?i="implicit":await this._isPKCECallback(n)&&(i="pkce"),qt()&&this.detectSessionInUrl&&i!=="none"){const{data:r,error:s}=await this._getSessionFromURL(n,i);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),Ej(s)){const l=(e=s.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}const{session:o,redirectType:a}=r;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return te(n)?{error:n}:{error:new OC("Unexpected error during initialization",n)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,i,r;try{const s=await oe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(i=(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:(r=e==null?void 0:e.options)===null||r===void 0?void 0:r.captchaToken}},xform:Rn}),{data:o,error:a}=s;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(te(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(e){var n,i,r;try{let s;if("email"in e){const{email:u,password:d,options:h}=e;let f=null,v=null;this.flowType==="pkce"&&([f,v]=await ps(this.storage,this.storageKey)),s=await oe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:u,password:d,data:(n=h==null?void 0:h.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:f,code_challenge_method:v},xform:Rn})}else if("phone"in e){const{phone:u,password:d,options:h}=e;s=await oe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(i=h==null?void 0:h.data)!==null&&i!==void 0?i:{},channel:(r=h==null?void 0:h.channel)!==null&&r!==void 0?r:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:Rn})}else throw new Al("You must provide either an email or phone number and a password");const{data:o,error:a}=s;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(te(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{let n;if("email"in e){const{email:s,password:o,options:a}=e;n=await oe(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:c0})}else if("phone"in e){const{phone:s,password:o,options:a}=e;n=await oe(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:c0})}else throw new Al("You must provide either an email or phone number and a password");const{data:i,error:r}=n;return r?{data:{user:null,session:null},error:r}:!i||!i.session||!i.user?{data:{user:null,session:null},error:new zo}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign({user:i.user,session:i.session},i.weak_password?{weakPassword:i.weak_password}:null),error:r})}catch(n){if(te(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithOAuth(e){var n,i,r,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(i=e.options)===null||i===void 0?void 0:i.scopes,queryParams:(r=e.options)===null||r===void 0?void 0:r.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,i,r,s,o,a,l,c,u,d,h;let f,v;if("message"in e)f=e.message,v=e.signature;else{const{chain:p,wallet:y,statement:m,options:g}=e;let b;if(qt())if(typeof y=="object")b=y;else{const x=window;if("ethereum"in x&&typeof x.ethereum=="object"&&"request"in x.ethereum&&typeof x.ethereum.request=="function")b=x.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!(g!=null&&g.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");b=y}const w=new URL((n=g==null?void 0:g.url)!==null&&n!==void 0?n:window.location.href),k=await b.request({method:"eth_requestAccounts"}).then(x=>x).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!k||k.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const S=LC(k[0]);let _=(i=g==null?void 0:g.signInWithEthereum)===null||i===void 0?void 0:i.chainId;if(!_){const x=await b.request({method:"eth_chainId"});_=lU(x)}const E={domain:w.host,address:S,statement:m,uri:w.href,version:"1",chainId:_,nonce:(r=g==null?void 0:g.signInWithEthereum)===null||r===void 0?void 0:r.nonce,issuedAt:(o=(s=g==null?void 0:g.signInWithEthereum)===null||s===void 0?void 0:s.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=g==null?void 0:g.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=g==null?void 0:g.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=g==null?void 0:g.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(u=g==null?void 0:g.signInWithEthereum)===null||u===void 0?void 0:u.resources};f=uU(E),v=await b.request({method:"personal_sign",params:[cU(f),S]})}try{const{data:p,error:y}=await oe(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:v},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(h=e.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:Rn});if(y)throw y;return!p||!p.session||!p.user?{data:{user:null,session:null},error:new zo}:(p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),{data:Object.assign({},p),error:y})}catch(p){if(te(p))return{data:{user:null,session:null},error:p};throw p}}async signInWithSolana(e){var n,i,r,s,o,a,l,c,u,d,h,f;let v,p;if("message"in e)v=e.message,p=e.signature;else{const{chain:y,wallet:m,statement:g,options:b}=e;let w;if(qt())if(typeof m=="object")w=m;else{const S=window;if("solana"in S&&typeof S.solana=="object"&&("signIn"in S.solana&&typeof S.solana.signIn=="function"||"signMessage"in S.solana&&typeof S.solana.signMessage=="function"))w=S.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof m!="object"||!(b!=null&&b.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=m}const k=new URL((n=b==null?void 0:b.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in w&&w.signIn){const S=await w.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},b==null?void 0:b.signInWithSolana),{version:"1",domain:k.host,uri:k.href}),g?{statement:g}:null));let _;if(Array.isArray(S)&&S[0]&&typeof S[0]=="object")_=S[0];else if(S&&typeof S=="object"&&"signedMessage"in S&&"signature"in S)_=S;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in _&&"signature"in _&&(typeof _.signedMessage=="string"||_.signedMessage instanceof Uint8Array)&&_.signature instanceof Uint8Array)v=typeof _.signedMessage=="string"?_.signedMessage:new TextDecoder().decode(_.signedMessage),p=_.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in w)||typeof w.signMessage!="function"||!("publicKey"in w)||typeof w!="object"||!w.publicKey||!("toBase58"in w.publicKey)||typeof w.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");v=[`${k.host} wants you to sign in with your Solana account:`,w.publicKey.toBase58(),...g?["",g,""]:[""],"Version: 1",`URI: ${k.href}`,`Issued At: ${(r=(i=b==null?void 0:b.signInWithSolana)===null||i===void 0?void 0:i.issuedAt)!==null&&r!==void 0?r:new Date().toISOString()}`,...!((s=b==null?void 0:b.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${b.signInWithSolana.notBefore}`]:[],...!((o=b==null?void 0:b.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${b.signInWithSolana.expirationTime}`]:[],...!((a=b==null?void 0:b.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${b.signInWithSolana.chainId}`]:[],...!((l=b==null?void 0:b.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${b.signInWithSolana.nonce}`]:[],...!((c=b==null?void 0:b.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${b.signInWithSolana.requestId}`]:[],...!((d=(u=b==null?void 0:b.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||d===void 0)&&d.length?["Resources",...b.signInWithSolana.resources.map(_=>`- ${_}`)]:[]].join(`
`);const S=await w.signMessage(new TextEncoder().encode(v),"utf8");if(!S||!(S instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=S}}try{const{data:y,error:m}=await oe(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:v,signature:Dj(p)},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:Rn});if(m)throw m;return!y||!y.session||!y.user?{data:{user:null,session:null},error:new zo}:(y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),{data:Object.assign({},y),error:m})}catch(y){if(te(y))return{data:{user:null,session:null},error:y};throw y}}async _exchangeCodeForSession(e){const n=await Er(this.storage,`${this.storageKey}-code-verifier`),[i,r]=(n??"").split("/");try{const{data:s,error:o}=await oe(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:i},xform:Rn});if(await Ai(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new zo}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:r??null}),error:o})}catch(s){if(te(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(e){try{const{options:n,provider:i,token:r,access_token:s,nonce:o}=e,a=await oe(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:i,id_token:r,access_token:s,nonce:o,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:Rn}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new zo}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(n){if(te(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithOtp(e){var n,i,r,s,o;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await ps(this.storage,this.storageKey));const{error:d}=await oe(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(n=l==null?void 0:l.data)!==null&&n!==void 0?n:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await oe(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(r=l==null?void 0:l.data)!==null&&r!==void 0?r:{},create_user:(s=l==null?void 0:l.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:u}}throw new Al("You must provide either an email or phone number.")}catch(a){if(te(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var n,i;try{let r,s;"options"in e&&(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo,s=(i=e.options)===null||i===void 0?void 0:i.captchaToken);const{data:o,error:a}=await oe(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:r,xform:Rn});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(r){if(te(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithSSO(e){var n,i,r;try{let s=null,o=null;return this.flowType==="pkce"&&([s,o]=await ps(this.storage,this.storageKey)),await oe(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(i=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&i!==void 0?i:void 0}),!((r=e==null?void 0:e.options)===null||r===void 0)&&r.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:o}),headers:this.headers,xform:Zj})}catch(s){if(te(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:i}=e;if(i)throw i;if(!n)throw new Ni;const{error:r}=await oe(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return{data:{user:null,session:null},error:r}})}catch(e){if(te(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:i,type:r,options:s}=e,{error:o}=await oe(this.fetch,"POST",n,{headers:this.headers,body:{email:i,type:r,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},redirectTo:s==null?void 0:s.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:i,type:r,options:s}=e,{data:o,error:a}=await oe(this.fetch,"POST",n,{headers:this.headers,body:{phone:i,type:r,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a}}throw new Al("You must provide either an email or phone number and a type")}catch(n){if(te(n))return{data:{user:null,session:null},error:n};throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const i=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await i,await n()))();return this.pendingInLock.push((async()=>{try{await r}catch{}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const i=n();for(this.pendingInLock.push((async()=>{try{await i}catch{}})()),await i;this.pendingInLock.length;){const r=[...this.pendingInLock];await Promise.all(r),this.pendingInLock.splice(0,r.length)}return await i}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await Er(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const i=e.expires_at?e.expires_at*1e3-Date.now()<Zd:!1;if(this._debug("#__loadSession()",`session has${i?"":" not"} expired`,"expires_at",e.expires_at),!i){if(this.userStorage){const o=await Er(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=nh()}if(this.storage.isServer&&e.user){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,u)=>(!o&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,u))})}return{data:{session:e},error:null}}const{session:r,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await oe(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:$i}):await this._useSession(async n=>{var i,r,s;const{data:o,error:a}=n;if(a)throw a;return!(!((i=o.session)===null||i===void 0)&&i.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ni}:await oe(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(r=o.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0,xform:$i})})}catch(n){if(te(n))return _j(n)&&(await this._removeSession(),await Ai(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:n};throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async i=>{const{data:r,error:s}=i;if(s)throw s;if(!r.session)throw new Ni;const o=r.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await ps(this.storage,this.storageKey));const{data:c,error:u}=await oe(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n==null?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:$i});if(u)throw u;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(i){if(te(i))return{data:{user:null},error:i};throw i}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ni;const n=Date.now()/1e3;let i=n,r=!0,s=null;const{payload:o}=th(e.access_token);if(o.exp&&(i=o.exp,r=i<=n),r){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};s=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;s={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:i-n,expires_at:i},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(n){if(te(n))return{data:{session:null,user:null},error:n};throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var i;if(!e){const{data:o,error:a}=n;if(a)throw a;e=(i=o.session)!==null&&i!==void 0?i:void 0}if(!(e!=null&&e.refresh_token))throw new Ni;const{session:r,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}})}catch(n){if(te(n))return{data:{user:null,session:null},error:n};throw n}}async _getSessionFromURL(e,n){try{if(!qt())throw new Dl("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Dl(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new n0("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Dl("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new n0("No code detected.");const{data:g,error:b}=await this._exchangeCodeForSession(e.code);if(b)throw b;const w=new URL(window.location.href);return w.searchParams.delete("code"),window.history.replaceState(window.history.state,"",w.toString()),{data:{session:g.session,redirectType:null},error:null}}const{provider_token:i,provider_refresh_token:r,access_token:s,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=e;if(!s||!a||!o||!c)throw new Dl("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(a);let h=u+d;l&&(h=parseInt(l));const f=h-u;f*1e3<=ys&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${d}s`);const v=h-d;u-v>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",v,h,u):u-v<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",v,h,u);const{data:p,error:y}=await this._getUser(s);if(y)throw y;const m={provider_token:i,provider_refresh_token:r,access_token:s,expires_in:d,expires_at:h,refresh_token:o,token_type:c,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:m,redirectType:e.type},error:null}}catch(i){if(te(i))return{data:{session:null,redirectType:null},error:i};throw i}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await Er(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var i;const{data:r,error:s}=n;if(s)return{error:s};const o=(i=r.session)===null||i===void 0?void 0:i.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(Cj(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Ai(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const n=Nj(),i={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,i),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:i}}}async _emitInitialSession(e){return await this._useSession(async n=>{var i,r;try{const{data:{session:s},error:o}=n;if(o)throw o;await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,n={}){let i=null,r=null;this.flowType==="pkce"&&([i,r]=await ps(this.storage,this.storageKey,!0));try{return await oe(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:i,code_challenge_method:r,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(s){if(te(s))return{data:null,error:s};throw s}}async getUserIdentities(){var e;try{const{data:n,error:i}=await this.getUser();if(i)throw i;return{data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(n){if(te(n))return{data:null,error:n};throw n}}async linkIdentity(e){var n;try{const{data:i,error:r}=await this._useSession(async s=>{var o,a,l,c,u;const{data:d,error:h}=s;if(h)throw h;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await oe(this.fetch,"GET",f,{headers:this.headers,jwt:(u=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(r)throw r;return qt()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(i==null?void 0:i.url),{data:{provider:e.provider,url:i==null?void 0:i.url},error:null}}catch(i){if(te(i))return{data:{provider:e.provider,url:null},error:i};throw i}}async unlinkIdentity(e){try{return await this._useSession(async n=>{var i,r;const{data:s,error:o}=n;if(o)throw o;return await oe(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(r=(i=s.session)===null||i===void 0?void 0:i.access_token)!==null&&r!==void 0?r:void 0})})}catch(n){if(te(n))return{data:null,error:n};throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const i=Date.now();return await Fj(async r=>(r>0&&await Uj(200*Math.pow(2,r-1)),this._debug(n,"refreshing attempt",r),await oe(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Rn})),(r,s)=>{const o=200*Math.pow(2,r);return s&&eh(s)&&Date.now()+o-i<ys})}catch(i){if(this._debug(n,"error",i),te(i))return{data:{session:null,user:null},error:i};throw i}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const i=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",i),qt()&&!n.skipBrowserRedirect&&window.location.assign(i),{data:{provider:e,url:i},error:null}}async _recoverAndRefresh(){var e,n;const i="#_recoverAndRefresh()";this._debug(i,"begin");try{const r=await Er(this.storage,this.storageKey);if(r&&this.userStorage){let o=await Er(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:r.user},await bs(this.userStorage,this.storageKey+"-user",o)),r.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:nh()}else if(r&&!r.user&&!r.user){const o=await Er(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(r.user=o.user,await Ai(this.storage,this.storageKey+"-user"),await bs(this.storage,this.storageKey,r)):r.user=nh()}if(this._debug(i,"session from storage",r),!this._isValidSession(r)){this._debug(i,"session is not valid"),r!==null&&await this._removeSession();return}const s=((n=r.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<Zd;if(this._debug(i,`session has${s?"":" not"} expired with margin of ${Zd}s`),s){if(this.autoRefreshToken&&r.refresh_token){const{error:o}=await this._callRefreshToken(r.refresh_token);o&&(console.error(o),eh(o)||(this._debug(i,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(r.user&&r.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(r.access_token);!a&&(o!=null&&o.user)?(r.user=o.user,await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)):this._debug(i,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(i,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(i,"error",r),console.error(r);return}finally{this._debug(i,"end")}}async _callRefreshToken(e){var n,i;if(!e)throw new Ni;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new Ku;const{data:s,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!s.session)throw new Ni;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const a={session:s.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(s){if(this._debug(r,"error",s),te(s)){const o={session:null,error:s};return eh(s)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(o),o}throw(i=this.refreshingDeferred)===null||i===void 0||i.reject(s),s}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,n,i=!0){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",n,`broadcast = ${i}`);try{this.broadcastChannel&&i&&this.broadcastChannel.postMessage({event:e,session:n});const s=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,n)}catch(l){s.push(l)}});if(await Promise.all(o),s.length>0){for(let a=0;a<s.length;a+=1)console.error(s[a]);throw s[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const n=Object.assign({},e),i=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!i&&n.user&&await bs(this.userStorage,this.storageKey+"-user",{user:n.user});const r=Object.assign({},n);delete r.user;const s=a0(r);await bs(this.storage,this.storageKey,s)}else{const r=a0(n);await bs(this.storage,this.storageKey,r)}}async _removeSession(){this._debug("#_removeSession()"),await Ai(this.storage,this.storageKey),await Ai(this.storage,this.storageKey+"-code-verifier"),await Ai(this.storage,this.storageKey+"-user"),this.userStorage&&await Ai(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&qt()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ys);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:i}}=n;if(!i||!i.refresh_token||!i.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const r=Math.floor((i.expires_at*1e3-e)/ys);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts ${ys}ms, refresh threshold is ${Qf} ticks`),r<=Qf&&await this._callRefreshToken(i.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof NC)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!qt()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,i){const r=[`provider=${encodeURIComponent(n)}`];if(i!=null&&i.redirectTo&&r.push(`redirect_to=${encodeURIComponent(i.redirectTo)}`),i!=null&&i.scopes&&r.push(`scopes=${encodeURIComponent(i.scopes)}`),this.flowType==="pkce"){const[s,o]=await ps(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(o)}`});r.push(a.toString())}if(i!=null&&i.queryParams){const s=new URLSearchParams(i.queryParams);r.push(s.toString())}return i!=null&&i.skipBrowserRedirect&&r.push(`skip_http_redirect=${i.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var i;const{data:r,error:s}=n;return s?{data:null,error:s}:await oe(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(i=r==null?void 0:r.session)===null||i===void 0?void 0:i.access_token})})}catch(n){if(te(n))return{data:null,error:n};throw n}}async _enroll(e){try{return await this._useSession(async n=>{var i,r;const{data:s,error:o}=n;if(o)return{data:null,error:o};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await oe(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(i=s==null?void 0:s.session)===null||i===void 0?void 0:i.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((r=l==null?void 0:l.totp)===null||r===void 0)&&r.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(n){if(te(n))return{data:null,error:n};throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var i;const{data:r,error:s}=n;if(s)return{data:null,error:s};const{data:o,error:a}=await oe(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(i=r==null?void 0:r.session)===null||i===void 0?void 0:i.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(n){if(te(n))return{data:null,error:n};throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var i;const{data:r,error:s}=n;return s?{data:null,error:s}:await oe(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(i=r==null?void 0:r.session)===null||i===void 0?void 0:i.access_token})})}catch(n){if(te(n))return{data:null,error:n};throw n}})}async _challengeAndVerify(e){const{data:n,error:i}=await this._challenge({factorId:e.factorId});return i?{data:null,error:i}:await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){const{data:{user:e},error:n}=await this.getUser();if(n)return{data:null,error:n};const i=(e==null?void 0:e.factors)||[],r=i.filter(o=>o.factor_type==="totp"&&o.status==="verified"),s=i.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:i,totp:r,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var n,i;const{data:{session:r},error:s}=e;if(s)return{data:null,error:s};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=th(r.access_token);let a=null;o.aal&&(a=o.aal);let l=a;((i=(n=r.user.factors)===null||n===void 0?void 0:n.filter(d=>d.status==="verified"))!==null&&i!==void 0?i:[]).length>0&&(l="aal2");const u=o.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,n={keys:[]}){let i=n.keys.find(a=>a.kid===e);if(i)return i;const r=Date.now();if(i=this.jwks.keys.find(a=>a.kid===e),i&&this.jwks_cached_at+Sj>r)return i;const{data:s,error:o}=await oe(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!s.keys||s.keys.length===0||(this.jwks=s,this.jwks_cached_at=r,i=s.keys.find(a=>a.kid===e),!i)?null:i}async getClaims(e,n={}){try{let i=e;if(!i){const{data:f,error:v}=await this.getSession();if(v||!f.session)return{data:null,error:v};i=f.session.access_token}const{header:r,payload:s,signature:o,raw:{header:a,payload:l}}=th(i);n!=null&&n.allowExpired||Hj(s.exp);const c=!r.alg||r.alg.startsWith("HS")||!r.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(r.kid,n!=null&&n.keys?{keys:n.keys}:n==null?void 0:n.jwks);if(!c){const{error:f}=await this.getUser(i);if(f)throw f;return{data:{claims:s,header:r,signature:o},error:null}}const u=Kj(r.alg),d=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,d,o,Aj(`${a}.${l}`)))throw new Zf("Invalid JWT signature");return{data:{claims:s,header:r,signature:o},error:null}}catch(i){if(te(i))return{data:null,error:i};throw i}}}Va.nextInstanceID=0;const hU=Va;class fU extends hU{constructor(e){super(e)}}var pU=function(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):r(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})};class mU{constructor(e,n,i){var r,s,o;this.supabaseUrl=e,this.supabaseKey=n;const a=vj(e);if(!n)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);const l=`sb-${a.hostname.split(".")[0]}-auth-token`,c={db:aj,realtime:cj,auth:Object.assign(Object.assign({},lj),{storageKey:l}),global:oj},u=gj(i??{},c);this.storageKey=(r=u.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(s=u.global.headers)!==null&&s!==void 0?s:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(d,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=u.auth)!==null&&o!==void 0?o:{},this.headers,u.global.fetch),this.fetch=fj(n,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new TL(new URL("rest/v1",a).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),this.storage=new ij(this.storageUrl.href,this.headers,this.fetch,i==null?void 0:i.storage),u.accessToken||this._listenForAuthEvents()}get functions(){return new tL(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,n={},i={}){return this.rest.rpc(e,n,i)}channel(e,n={config:{}}){return this.realtime.channel(e,n)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,n;return pU(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:i}=yield this.auth.getSession();return(n=(e=i.session)===null||e===void 0?void 0:e.access_token)!==null&&n!==void 0?n:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:n,detectSessionInUrl:i,storage:r,userStorage:s,storageKey:o,flowType:a,lock:l,debug:c},u,d){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new fU({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),u),storageKey:o,autoRefreshToken:e,persistSession:n,detectSessionInUrl:i,storage:r,userStorage:s,flowType:a,lock:l,debug:c,fetch:d,hasCustomAuthorizationHeader:Object.keys(this.headers).some(f=>f.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new BL(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,i)=>{this._handleTokenChanged(n,"CLIENT",i==null?void 0:i.access_token)})}_handleTokenChanged(e,n,i){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==i?(this.changedAccessToken=i,this.realtime.setAuth(i)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),n=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const gU=(t,e,n)=>new mU(t,e,n);function vU(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}vU()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const yU="https://gipkmukpwtwbcvbdsrme.supabase.co",bU="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdpcGttdWtwd3R3YmN2YmRzcm1lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk0ODkwODcsImV4cCI6MjA3NTA2NTA4N30.Y0tOajmayZkAwhjjDqHAJtai2MQYsdD7_pXi-jLxuAw",Jn=gU(yU,bU,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}}),wU=()=>{const{toast:t}=Lw(),[e,n]=C.useState(!1),[i,r]=C.useState(!1),s=JN({clientTools:{save_user_profile:async h=>{try{const{data:f}=await Jn.from("user_profiles").select("*").eq("phone_number",h.phone_number).maybeSingle();if(f){const{error:v}=await Jn.from("user_profiles").update({name:h.name}).eq("phone_number",h.phone_number);if(v)throw v;return`     ${h.name}`}else{const{error:v}=await Jn.from("user_profiles").insert({phone_number:h.phone_number,name:h.name});if(v)throw v;return`     ${h.name}`}}catch(f){return console.error("Error saving profile:",f),"    "}},get_user_profile:async h=>{try{const{data:f,error:v}=await Jn.from("user_profiles").select("*").eq("phone_number",h.phone_number).maybeSingle();if(v)throw v;return f?`    : ${f.name}`:"       "}catch(f){return console.error("Error fetching profile:",f),"   "}},save_order:async h=>{try{const{data:f}=await Jn.from("user_profiles").select("id").eq("phone_number",h.phone_number).maybeSingle();if(!f)return"      .     .";const{error:v}=await Jn.from("orders").insert({user_profile_id:f.id,order_details:h.order_details});if(v)throw v;return`  : ${h.order_details}`}catch(f){return console.error("Error saving order:",f),"  "}},get_order_history:async h=>{try{const{data:f}=await Jn.from("user_profiles").select("id").eq("phone_number",h.phone_number).maybeSingle();if(!f)return"       ";const{data:v,error:p}=await Jn.from("orders").select("*").eq("user_profile_id",f.id).order("order_date",{ascending:!1});if(p)throw p;return!v||v.length===0?"   ":` : ${v.map((m,g)=>` ${g+1}: ${m.order_details}  ${new Date(m.order_date).toLocaleDateString("ar-SA")}`).join(" ")}`}catch(f){return console.error("Error fetching orders:",f),"   "}},search_orders:async h=>{try{const{data:f,error:v}=await Jn.from("orders").select("order_details, order_date").ilike("order_details",`%${h.search_term}%`).order("order_date",{ascending:!1}).limit(10);if(v)throw v;if(!f||f.length===0)return`        "${h.search_term}"`;const p=f.map((y,m)=>` ${m+1}: ${y.order_details}  ${new Date(y.order_date).toLocaleDateString("ar-SA")}`).join(" ");return` ${f.length}    "${h.search_term}": ${p}`}catch(f){return console.error("Error searching orders:",f),"   "}}},onConnect:()=>{r(!1),t({title:"Connected",description:"You can now talk to the AI agent"})},onDisconnect:()=>{t({title:"Disconnected",description:"Conversation ended"})},onError:h=>{r(!1);const f=typeof h=="string"?h:(h==null?void 0:h.message)||"Connection error";t({title:"Error",description:f,variant:"destructive"})}}),{status:o,isSpeaking:a}=s,l=async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0}),n(!0)}catch{t({title:"Microphone Access Denied",description:"Please allow microphone access to talk with the AI",variant:"destructive"})}},c=async()=>{if(!e){await l();return}r(!0);try{await s.startSession({agentId:"agent_01jy1avj0cemdrpjhxpmjf0b2e",connectionType:"webrtc"})}catch{r(!1),t({title:"Connection Failed",description:"Could not connect to the AI agent",variant:"destructive"})}},u=async()=>{await s.endSession()};C.useEffect(()=>{navigator.mediaDevices.getUserMedia({audio:!0}).then(()=>n(!0)).catch(()=>n(!1))},[]);const d=o==="connected";return A.jsxs("div",{className:"flex flex-col items-center gap-6",children:[a&&A.jsxs("div",{className:"relative",children:[A.jsx("div",{className:"absolute inset-0 bg-accent/20 rounded-full animate-wave",style:{width:"200px",height:"200px",margin:"auto"}}),A.jsx("div",{className:"absolute inset-0 bg-accent/10 rounded-full animate-wave",style:{width:"240px",height:"240px",margin:"auto",animationDelay:"0.2s"}}),A.jsx("div",{className:"absolute inset-0 bg-accent/5 rounded-full animate-wave",style:{width:"280px",height:"280px",margin:"auto",animationDelay:"0.4s"}})]}),A.jsx("div",{className:"relative z-10",children:A.jsx(hC,{size:"lg",onClick:d?u:c,disabled:i,className:`
            relative w-32 h-32 rounded-full text-lg font-semibold
            transition-all duration-300 ease-out
            ${d?"bg-destructive hover:bg-destructive/90":"bg-gradient-to-br from-primary to-accent hover:scale-105"}
            ${a?"animate-pulse-glow":""}
            ${!d&&!i?"shadow-lg hover:shadow-xl":""}
          `,children:i?A.jsx(wx,{className:"w-12 h-12 animate-spin"}):d?A.jsx(kx,{className:"w-12 h-12"}):A.jsx(Sx,{className:"w-12 h-12"})})}),A.jsxs("div",{className:"text-center space-y-2",children:[A.jsx("p",{className:"text-xl font-semibold",children:i?"Connecting...":d?a?"AI is speaking...":"Listening...":"Start Conversation"}),!e&&!d&&A.jsx("p",{className:"text-sm text-muted-foreground",children:"Microphone access required"})]})]})},kU=()=>A.jsx("div",{className:"flex min-h-screen items-center justify-center p-4",children:A.jsxs("div",{className:"text-center space-y-8 max-w-2xl",children:[A.jsxs("div",{className:"space-y-4",children:[A.jsx("h1",{className:"text-5xl md:text-6xl font-bold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent",children:"AI Voice Agent"}),A.jsx("p",{className:"text-lg text-muted-foreground max-w-md mx-auto",children:"Click the button below to start a conversation with your AI assistant"})]}),A.jsx(wU,{})]})}),SU=()=>{const t=pS();return C.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",t.pathname)},[t.pathname]),A.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-100",children:A.jsxs("div",{className:"text-center",children:[A.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),A.jsx("p",{className:"mb-4 text-xl text-gray-600",children:"Oops! Page not found"}),A.jsx("a",{href:"/",className:"text-blue-500 underline hover:text-blue-700",children:"Return to Home"})]})})},TU=new HI,CU=()=>A.jsx(GI,{client:TU,children:A.jsxs(SI,{children:[A.jsx(s1,{}),A.jsx(j1,{}),A.jsx(DO,{children:A.jsxs(IO,{children:[A.jsx(df,{path:"/",element:A.jsx(kU,{})}),A.jsx(df,{path:"*",element:A.jsx(SU,{})})]})})]})});Nw(document.getElementById("root")).render(A.jsx(CU,{}));
